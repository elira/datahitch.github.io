(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"723k":function(t,e,i){"use strict";i.r(e),i.d(e,"ProfileModule",(function(){return Ji}));var r=i("2kYt"),s=i("sEIs"),n=i("D57K"),o=i("EM62"),a=i("kuMc"),l=i("ZTXN"),h=i("OZ4H"),c=i("yD3o"),d=i("cxBW"),u=i("LaE4"),f=i("G9cc"),p=i("nIj0"),g=i("P/uR"),m=i("Meci"),b=i("29Wa"),v=i("Cd2c"),y=i("v9BS");const x={provide:p.h,useExisting:Object(o.V)(()=>w),multi:!0};let w=(()=>{class t{constructor(){this.isDisabled=!1,this.max=100,this.propagateChange=t=>{},this.propagateTouched=t=>{}}writeValue(t){void 0!==t&&(this.value=t,this.propagateChange(this.value),this.propagateTouched(this.value))}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){this.propagateTouched=t}changeMade(t){this.propagateChange(t.value)}setDisabledState(t){this.isDisabled=t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-slider-control"]],inputs:{value:"value",max:"max"},features:[o.Cb([x])],decls:1,vars:3,consts:[["thumbLabel","","tickInterval","1","min","1",3,"max","ngModel","disabled","ngModelChange","change"]],template:function(t,e){1&t&&(o.Vb(0,"mat-slider",0),o.cc("ngModelChange",(function(t){return e.value=t}))("change",(function(t){return e.changeMade(t)})),o.Ub()),2&t&&o.mc("max",e.max)("ngModel",e.value)("disabled",e.isDisabled)},directives:[y.a,p.j,p.m],styles:[""]}),t})(),S=(()=>{class t{constructor(t){this.profileStateService=t}transform(t){return Object(n.a)(this,void 0,void 0,(function*(){return null==t?null:(yield this.profileStateService.getProfileMapInState())[t]}))}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(c.a))},t.\u0275pipe=o.Ob({name:"getProfileElementById",type:t,pure:!0}),t})(),I=(()=>{class t{transform(t){return null==t?null:"profile"==t.itemType||"virtual"==t.itemType?t.name:t.originalName}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=o.Ob({name:"getOriginalElementName",type:t,pure:!0}),t})();function C(t,e){if(1&t&&(o.Tb(0),o.Vb(1,"div"),o.Gc(2),o.hc(3,"getOriginalElementName"),o.Ub(),o.Sb()),2&t){const t=e.ngIf;o.Db(2),o.Hc(o.ic(3,1,t))}}function P(t,e){if(1&t&&(o.Vb(0,"div",4),o.Vb(1,"mat-card"),o.Tb(2,5),o.Ec(3,C,4,3,"ng-container",6),o.hc(4,"async"),o.hc(5,"getProfileElementById"),o.Vb(6,"mat-card-content"),o.Vb(7,"mat-form-field"),o.Vb(8,"mat-label"),o.Gc(9,"Weight"),o.Ub(),o.Qb(10,"input",7),o.Ub(),o.Qb(11,"dh-slider-control",8),o.Ub(),o.Sb(),o.Ub(),o.Ub()),2&t){const t=e.index,i=o.gc();o.Db(2),o.mc("formGroupName",t),o.Db(1),o.mc("ngIf",o.ic(4,6,o.ic(5,8,i.subProfiles.controls[t].get("id").value))),o.Db(7),o.nc("max",i.max),o.mc("value",i.subProfiles.controls[t].value.weight),o.Db(1),o.mc("max",i.max)("value",i.subProfiles.controls[t].value.weight)}}let k=(()=>{class t{constructor(t){this.formBuilder=t,this.max=100,this.removeParentIdFromSubProfile=new f.a}ngOnInit(){this.form=this.formBuilder.group({subProfiles:this.formBuilder.array(this.getFormGroupsForIds())})}get subProfiles(){return this.form.get("subProfiles")}getFormGroupsForIds(){return this.ids.map(t=>{const e=this.removeParentIdFromSubProfile.transform(t,this.parentProfileId);return this.formBuilder.group({id:[t,[]],weight:[this.weights[e],[]],isItem:[e!==t]})})}getChanges(){const t=this.subProfiles.controls.map(t=>t.value).reduce((t,e)=>(t[e.id]=e.weight,t),{});return this.ids.reduce((e,i)=>{const r=this.removeParentIdFromSubProfile.transform(i,this.parentProfileId),s=t[i];return s!=this.weights[r]&&e.push({newWeight:s,id:i}),e},[])}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(p.c))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-sub-profiles-edit"]],inputs:{ids:"ids",parentProfileId:"parentProfileId",weights:"weights"},decls:5,vars:2,consts:[[1,"mt-10"],["ngxsForm","selectionActions.subProfileWeightForm",3,"formGroup"],["formArrayName","subProfiles",1,"mt-10"],["class","mb-10",4,"ngFor","ngForOf"],[1,"mb-10"],[3,"formGroupName"],[4,"ngIf"],["type","number","min","1","matInput","","placeholder","Name","formControlName","weight","matInput","","placeholder","element weight",3,"max","value"],["formControlName","weight",3,"max","value"]],template:function(t,e){1&t&&(o.Vb(0,"h3",0),o.Gc(1,"Sub Element names:"),o.Ub(),o.Tb(2,1),o.Vb(3,"div",2),o.Ec(4,P,12,10,"div",3),o.Ub(),o.Sb()),2&t&&(o.Db(2),o.mc("formGroup",e.form),o.Db(2),o.mc("ngForOf",e.subProfiles.controls))},directives:[g.d,p.k,p.e,p.b,r.l,m.a,p.f,r.m,m.b,b.b,b.e,p.n,v.a,p.a,p.j,p.d,w],pipes:[r.b,S,I],styles:[""]}),t})();var A=i("pg5I"),E=i("yzyx"),T=i("mWib"),z=i("Bou+"),_=i("RwDx"),V=i("s9Hp");const M=["chart"];let O=(()=>{class t{constructor(t,e,i){this.bloomaResizeListenerService=t,this.sharedUtilitiesService=e,this.selectionActionStateService=i,this._scores=null,this.readOnly=!1,this.insertNewValueScore=new o.p,this.unsubscribe$=new l.a,this.viewInitialized=!1,this.margin={top:10,bottom:100,left:30,right:10},this.totalComponentWidth=0,this.isListening=!1,this.totalComponentHeight=0,this.widthOfBarChart=0,this.yAxisWidth=30;const r=new l.a;r.pipe(Object(T.a)(300),Object(a.a)(this.unsubscribe$)).subscribe(t=>this.createChart()),this.createSubject=r}get scores(){return this._scores}set scores(t){const e=this.normalizeData(t);this.isDataUpdated(this.scores,e)&&(this._scores=e,this.createSubject.next())}ngOnDestroy(){this.bloomaResizeListenerService.unListenToElementResize(this.chartContainer.nativeElement),this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}listenToElementSizeChange(t){this.isListening||(this.isListening=!0,this.bloomaResizeListenerService.listenToElementResize(t).pipe(Object(a.a)(this.unsubscribe$)).subscribe(t=>{this.createSubject.next()}))}isDataUpdated(t,e){if(null==t&&null!=e)return!0;if(t.length!=e.length)return!0;for(let i=0;i<t.length;i++){if(t[i].name!=e[i].name)return!0;if(t[i].score!=e[i].score)return!0}return!1}ngAfterViewInit(){this.viewInitialized=!0,this.listenToElementSizeChange(this.chartContainer.nativeElement),setTimeout(()=>{this.createSubject.next()},300)}createChart(){if(!this.viewInitialized)return;const t=this.chartContainer.nativeElement;this.totalComponentWidth=t.offsetWidth,this.totalComponentHeight=t.offsetHeight,0!=this.totalComponentHeight&&(this.initSvg(),this.setSvgHeight(),this.widthOfBarChart=this.totalComponentWidth-this.yAxisWidth-this.margin.left-this.margin.right,this.createScales(),this.drawAxes(),this.drawScoresLines(),this.drawScoresArea(),this.drawCircles(),setTimeout(()=>{Object(o.mb)(this)},50))}normalizeData(t){return null==t?null:t.map(t=>({name:t.name,score:z.i([t.score,100])}))}initSvg(){if(!this.svg){const t=z.m(this.chartContainer.nativeElement).append("svg");this.svg=t}}setSvgHeight(){this.svg.attr("height",this.totalComponentHeight).attr("width",this.totalComponentWidth)}createScales(){const t=this.sharedUtilitiesService.pluck(this.scores,"name"),e=this.margin.left;this.scaleX=z.l().domain(t).range([e,e+this.widthOfBarChart]),this.scaleY=z.k().domain([0,100]).range([this.totalComponentHeight-this.margin.bottom,this.margin.top]).nice()}drawAxes(){const t=z.c(this.scaleY).tickSize(-this.widthOfBarChart).tickValues(z.j(0,100.5,10)),e=z.b(this.scaleX),i=this.getAxes();i.yAxis.transition().call(t),i.yAxis.selectAll(".tick text").attr("dx","-0.5em"),i.xAxis.transition().call(e).selectAll(".tick text").style("font-size",this.totalComponentWidth>686?"18px":"14px"),i.xAxis.style("text-anchor","start"),i.xAxis.selectAll(".tick text").attr("dy","0.5em").attr("dx",8).attr("transform","rotate(90)")}getAxes(){this.svg.select(".axes").remove();const t=this.svg.insert("g").attr("class","axes");return{yAxis:t.append("g").attr("class","axis-y axis").attr("transform","translate("+[this.margin.left,0]+")"),xAxis:t.append("g").attr("class","axis-x axis").attr("transform",`translate(0, ${this.totalComponentHeight-this.margin.bottom})`)}}drawScoresLines(){this.svg.select(".line").remove();const t=this.svg.append("g").attr("class","line");this.line=z.g().x(t=>this.scaleX(t.name)).y(t=>this.scaleY(t.score)).curve(z.d),t.append("path").datum(this.scores).attr("class","data-line").attr("d",this.line)}drawClickableArea(){this.svg.select(".clickable-area").remove(),this.svg.append("g").attr("class","clickable-area").append("rect").attr("x",this.margin.left).attr("y",this.margin.top).attr("fill","white").attr("fill-opacity",.01).attr("width",this.widthOfBarChart).attr("height",this.totalComponentHeight-this.margin.top-this.margin.bottom).on("click",t=>this.addNewValueScore(t))}drawCircles(){this.readOnly||this.drawClickableArea(),this.svg.select(".dots").remove();const t=this.svg.append("g").attr("class","dots").selectAll("circle").data(this.scores).enter().append("circle").attr("class","circle").attr("r",5).attr("id",t=>"c"+t.name).attr("cx",t=>this.scaleX(t.name)).attr("cy",t=>this.scaleY(t.score));if(!this.readOnly){const e=this.createDragBehavior();t.style("cursor","pointer").call(e)}}drawScoresArea(){this.svg.select(".area").remove();const t=this.svg.append("g").attr("class","area");this.area=z.a().x(t=>this.scaleX(t.name)).y(t=>this.scaleY(t.score)).y1(this.scaleY(0)).curve(z.d),t.append("path").datum(this.scores).attr("class","data-area").attr("d",this.area).attr("fill","rgb(161,195,214)").attr("fill-opacity",.5)}createDragBehavior(){return z.e().on("start",t=>this.dragstarted(t)).on("drag",(t,e,i)=>this.dragged(t,e)).on("end",t=>this.dragended(t))}dragstarted(t){z.m(t.sourceEvent.target).raise().classed("active",!0)}dragged(t,e){const i=this.scaleY.invert(t.y),r=this.svg.select("circle#c"+e.name),s=this.scaleY.range();t.y>s[0]||t.y<s[1]||(r.attr("cy",t.y),this.updateValueScore(e.name,i),this.refreshLineAndArea())}dragended(t){z.m(t.sourceEvent.target).classed("active",!1),this.updateRestOfApp()}updateRestOfApp(){this.selectionActionStateService.updateScoreItems(this.scores)}updateValueScore(t,e){null!=this.scores&&(this.scores.find(e=>e.name==t).score=Math.ceil(e))}refreshLineAndArea(){this.svg.select(".data-line").attr("d",this.line),this.svg.select(".data-area").attr("d",this.area)}refreshLineAndCircles(){this.refreshLineAndArea(),this.drawCircles()}addNewValueScore(t){var e=Math.ceil(this.scaleY.invert(t.offsetY)),i=t.offsetX,r=0;0!==this.scores.length&&(r=this.scores.findIndex(t=>{var e=this.scaleX(t.name);return i<e})),this.insertNewValueScore.next({index:r,score:e})}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(_.a),o.Pb(V.a),o.Pb(E.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-profile-item-score-chart"]],viewQuery:function(t,e){if(1&t&&o.Kc(M,!0),2&t){let t;o.tc(t=o.dc())&&(e.chartContainer=t.first)}},inputs:{scores:"scores",readOnly:"readOnly"},outputs:{insertNewValueScore:"insertNewValueScore"},decls:2,vars:0,consts:[["id","profile-item-score-graph",1,"profile-item-score-graph"],["chart",""]],template:function(t,e){1&t&&o.Qb(0,"div",0,1)},styles:["#profile-item-score-graph{height:inherit;width:inherit}#profile-item-score-graph .axis-y path{stroke:none}#profile-item-score-graph .axis-y .tick line,#profile-item-score-graph .axis-y line{stroke:#cccced}#profile-item-score-graph .data-line{stroke:#000;stroke-width:2px;fill:none}#profile-item-score-graph .circle{fill:#4682b4;stroke:#000;stroke-width:2px}"],encapsulation:2}),t})();var B=i("Fpl3");let D=(()=>{class t{transform(t,e){if(null==t)return null;if(null==e)return null;for(var i=t;i;){var r=e[i];if("virtual"!=r.itemType)return r.id;i=r.parentIds[0]}return null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=o.Ob({name:"getFirstRealParentId",type:t,pure:!0}),t})();function R(t,e){1&t&&(o.Vb(0,"span"),o.Gc(1,"Item "),o.Ub())}function F(t,e){if(1&t){const t=o.Wb();o.Tb(0),o.Vb(1,"dh-profile-item-score-chart",5),o.cc("insertNewValueScore",(function(e){return o.wc(t),o.gc(3).insertNewValueScore(e)})),o.Ub(),o.Sb()}if(2&t){const t=e.ngIf;o.Db(1),o.mc("scores",t)}}function j(t,e){if(1&t&&(o.Tb(0),o.Ec(1,F,2,1,"ng-container",2),o.hc(2,"async"),o.Sb()),2&t){const t=o.gc(2);o.Db(1),o.mc("ngIf",o.ic(2,1,t.selectionActionStateService.scores$))}}function L(t,e){if(1&t&&(o.Tb(0),o.Qb(1,"dh-profile-item-form",4),o.Ec(2,j,3,3,"ng-container",2),o.Sb()),2&t){const t=o.gc();o.Db(1),o.mc("profile",t.profile),o.Db(1),o.mc("ngIf",t.showGraph)}}function N(t,e){if(1&t&&(o.Tb(0),o.Qb(1,"dh-sub-profiles-edit",6),o.hc(2,"getRealSubItems"),o.hc(3,"getFirstRealParentId"),o.Sb()),2&t){const t=e.ngIf,i=o.gc().ngIf,r=o.gc(2);o.Db(1),o.mc("ids",o.jc(2,3,r.profile,t))("parentProfileId",null==r.profile?null:r.profile.id)("weights",i.weights[o.jc(3,6,null==r.profile?null:r.profile.id,t)])}}function U(t,e){if(1&t&&(o.Tb(0),o.Ec(1,N,4,9,"ng-container",2),o.hc(2,"async"),o.Sb()),2&t){const t=o.gc(2);o.Db(1),o.mc("ngIf",o.ic(2,1,t.profileStateService.profileMap$))}}function G(t,e){if(1&t&&(o.Tb(0),o.Ec(1,U,3,3,"ng-container",2),o.hc(2,"async"),o.Sb()),2&t){const t=o.gc();o.Db(1),o.mc("ngIf",o.ic(2,1,t.weightStateService.weightState$))}}let W=(()=>{class t{constructor(t,e,i,r){this.formBuilder=t,this.weightStateService=e,this.profileStateService=i,this.selectionActionStateService=r,this.showGraph=!1}ngAfterViewInit(){setTimeout(()=>{this.showGraph=!0},1)}ngOnInit(){this.form=this.formBuilder.group({name:this.profile.name})}getProfileName(){return this.form.value.name}insertNewValueScore(t){this.profileItemFormComponent.insertRow(t.index,t.score)}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(p.c),o.Pb(A.a),o.Pb(c.a),o.Pb(E.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-profile-details-edit"]],viewQuery:function(t,e){if(1&t&&(o.Kc(k,!0),o.Kc(u.a,!0)),2&t){let t;o.tc(t=o.dc())&&(e.subProfilesEditComponent=t.first),o.tc(t=o.dc())&&(e.profileItemFormComponent=t.first)}},inputs:{profile:"profile"},decls:9,vars:4,consts:[["ngxsForm","selectionActions.profileNameForm",3,"formGroup"],[1,"w-full"],[4,"ngIf"],["matInput","","placeholder","Name","formControlName","name","matInput","","placeholder","element name"],[3,"profile"],[2,"height","600px",3,"scores","insertNewValueScore"],[3,"ids","parentProfileId","weights"]],template:function(t,e){1&t&&(o.Vb(0,"form",0),o.Vb(1,"mat-form-field",1),o.Vb(2,"mat-label"),o.Gc(3,"Profile "),o.Ec(4,R,2,0,"span",2),o.Gc(5,"Name"),o.Ub(),o.Qb(6,"input",3),o.Ub(),o.Ub(),o.Ec(7,L,3,2,"ng-container",2),o.Ec(8,G,3,3,"ng-container",2)),2&t&&(o.mc("formGroup",e.form),o.Db(4),o.mc("ngIf","profile"!==e.profile.itemType),o.Db(3),o.mc("ngIf",(null==e.profile||null==e.profile.scores?null:e.profile.scores.length)>0),o.Db(1),o.mc("ngIf","virtual"!=e.profile.itemType&&(null==e.profile||null==e.profile.childrenIds?null:e.profile.childrenIds.length)>0))},directives:[p.q,p.k,g.d,p.e,b.b,b.e,r.m,v.a,p.a,p.j,p.d,u.a,O,k],pipes:[r.b,B.a,D],styles:[""]}),t})();function $(t,e){if(1&t&&(o.Tb(0),o.Vb(1,"div"),o.Gc(2),o.hc(3,"getOriginalElementName"),o.Ub(),o.Sb()),2&t){const t=e.ngIf,i=o.gc(2);o.Db(2),o.Jc(" ",o.ic(3,2,t)," ( weight: ",i.weights[t.originalId]||"1",") ")}}function H(t,e){if(1&t&&(o.Vb(0,"li"),o.Ec(1,$,4,4,"ng-container",1),o.hc(2,"async"),o.hc(3,"getProfileElementById"),o.Ub()),2&t){const t=e.$implicit;o.Db(1),o.mc("ngIf",o.ic(2,1,o.ic(3,3,t)))}}let q=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-sub-profiles"]],inputs:{ids:"ids",parentProfileId:"parentProfileId",weights:"weights"},decls:4,vars:1,consts:[[4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(t,e){1&t&&(o.Vb(0,"h3"),o.Gc(1,"Sub-Profiles:"),o.Ub(),o.Vb(2,"ul"),o.Ec(3,H,4,5,"li",0),o.Ub()),2&t&&(o.Db(3),o.mc("ngForOf",e.ids))},directives:[r.l,r.m],pipes:[r.b,S,I],styles:[""]}),t})();function J(t,e){if(1&t&&(o.Vb(0,"div",4),o.Gc(1),o.Ub()),2&t){const t=o.gc();o.Db(1),o.Ic("Id: ",(null==t.profile?null:t.profile.id)||"No Type","")}}function Y(t,e){if(1&t&&(o.Vb(0,"tr"),o.Vb(1,"th",6),o.Gc(2),o.Ub(),o.Vb(3,"th",6),o.Gc(4),o.Ub(),o.Ub()),2&t){const t=e.$implicit;o.Db(2),o.Hc(t.name),o.Db(2),o.Hc(t.score)}}function Q(t,e){if(1&t&&(o.Tb(0),o.Vb(1,"div",5),o.Vb(2,"table",4),o.Vb(3,"thead"),o.Vb(4,"tr"),o.Vb(5,"th",6),o.Gc(6,"Value"),o.Ub(),o.Vb(7,"th",6),o.Gc(8,"Score"),o.Ub(),o.Ub(),o.Ub(),o.Vb(9,"tbody"),o.Ec(10,Y,5,2,"tr",7),o.Ub(),o.Ub(),o.Qb(11,"dh-profile-item-score-chart",8),o.Ub(),o.Sb()),2&t){const t=o.gc();o.Db(10),o.mc("ngForOf",null==t.profile?null:t.profile.scores),o.Db(1),o.mc("scores",t.profile.scores)("readOnly",!0)}}function X(t,e){if(1&t&&(o.Tb(0),o.Qb(1,"dh-sub-profiles",9),o.hc(2,"getRealSubItems"),o.hc(3,"getFirstRealParentId"),o.Sb()),2&t){const t=e.ngIf,i=o.gc().ngIf,r=o.gc(2);o.Db(1),o.mc("ids",o.jc(2,3,r.profile,t))("parentProfileId",null==r.profile?null:r.profile.id)("weights",i.weights[o.jc(3,6,null==r.profile?null:r.profile.id,t)])}}function Z(t,e){if(1&t&&(o.Tb(0),o.Ec(1,X,4,9,"ng-container",3),o.hc(2,"async"),o.Sb()),2&t){const t=o.gc(2);o.Db(1),o.mc("ngIf",o.ic(2,1,t.profileStateService.profileMap$))}}function K(t,e){if(1&t&&(o.Tb(0),o.Ec(1,Z,3,3,"ng-container",3),o.hc(2,"async"),o.Sb()),2&t){const t=o.gc();o.Db(1),o.mc("ngIf",o.ic(2,1,t.weightStateService.weightState$))}}let tt=(()=>{class t{constructor(t,e){this.weightStateService=t,this.profileStateService=e}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(A.a),o.Pb(c.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-profile-details-view"]],inputs:{profile:"profile"},decls:7,vars:5,consts:[[1,"mb-10","truncate"],[1,"mb-5","truncate"],["class","mb-5",4,"ngIf"],[4,"ngIf"],[1,"mb-5"],[1,"overflow-y-auto","limit-height"],[1,"px-4","py-2"],[4,"ngFor","ngForOf"],[2,"height","600px",3,"scores","readOnly"],[3,"ids","parentProfileId","weights"]],template:function(t,e){1&t&&(o.Vb(0,"h2",0),o.Gc(1),o.Ub(),o.Vb(2,"div",1),o.Gc(3),o.Ub(),o.Ec(4,J,2,1,"div",2),o.Ec(5,Q,12,3,"ng-container",3),o.Ec(6,K,3,3,"ng-container",3)),2&t&&(o.Db(1),o.Hc(null==e.profile?null:e.profile.name),o.Db(2),o.Ic("Item Type: ",(null==e.profile?null:e.profile.itemType)||"No Type",""),o.Db(1),o.mc("ngIf",!((null==e.profile||null==e.profile.scores?null:e.profile.scores.length)>0)),o.Db(1),o.mc("ngIf",(null==e.profile||null==e.profile.scores?null:e.profile.scores.length)>0),o.Db(1),o.mc("ngIf",(null==e.profile||null==e.profile.childrenIds?null:e.profile.childrenIds.length)>0))},directives:[r.m,r.l,O,q],pipes:[r.b,B.a,D],styles:[".limit-height[_ngcontent-%COMP%]{height:calc(100vh - 400px);max-height:calc(100vh - 400px)}"]}),t})();function et(t,e){if(1&t&&o.Qb(0,"dh-profile-details-view",5),2&t){const t=o.gc(3);o.mc("profile",t.profile)}}function it(t,e){if(1&t&&o.Qb(0,"dh-profile-details-edit",5),2&t){const t=o.gc(3);o.mc("profile",t.profile)}}function rt(t,e){if(1&t&&(o.Tb(0),o.Ec(1,et,1,1,"dh-profile-details-view",4),o.Ec(2,it,1,1,"dh-profile-details-edit",4),o.Sb()),2&t){const t=e.ngIf;o.Db(1),o.mc("ngIf","none"==t),o.Db(1),o.mc("ngIf","edit"==t)}}function st(t,e){if(1&t&&(o.Tb(0),o.Qb(1,"div",2),o.Ec(2,rt,3,2,"ng-container",3),o.hc(3,"async"),o.Sb()),2&t){const t=o.gc();o.Db(2),o.mc("ngIf",o.ic(3,1,t.selectionActionStateService.action$))}}function nt(t,e){1&t&&o.Gc(0," No selected profile.\n")}let ot=(()=>{class t{constructor(t){this.selectionActionStateService=t}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(E.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-profile-details"]],viewQuery:function(t,e){if(1&t&&o.Kc(W,!0),2&t){let t;o.tc(t=o.dc())&&(e.profileDetailsEdit=t.first)}},inputs:{profile:"profile"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noProfile",""],[1,"flex","justify-end","mb-16","mt-3"],[4,"ngIf"],[3,"profile",4,"ngIf"],[3,"profile"]],template:function(t,e){if(1&t&&(o.Ec(0,st,4,3,"ng-container",0),o.Ec(1,nt,1,0,"ng-template",null,1,o.Fc)),2&t){const t=o.uc(2);o.mc("ngIf",e.profile)("ngIfElse",t)}},directives:[r.m,tt,W],pipes:[r.b],styles:[""]}),t})();function at(t,e){if(1&t){const t=o.Wb();o.Tb(0),o.Vb(1,"dh-top-bar-selection",1),o.cc("exiting",(function(){return o.wc(t),o.gc().close()})),o.Ub(),o.Vb(2,"div",2),o.Qb(3,"dh-profile-details",3),o.Ub(),o.Sb()}if(2&t){const t=e.ngIf;o.Db(3),o.mc("profile",t)}}let lt=(()=>{class t{constructor(t,e){this.dialogRef=t,this.profileStateService=e,this.unsubscribe$=new l.a,e.selectionCleared$.pipe(Object(a.a)(this.unsubscribe$)).subscribe(()=>{this.close()})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}close(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(h.g),o.Pb(c.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-profile-details-modal"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"exiting"],["mat-dialog-content","",1,"p-10"],[1,"block","text-base",2,"width","100%",3,"profile"]],template:function(t,e){1&t&&(o.Ec(0,at,4,1,"ng-container",0),o.hc(1,"async")),2&t&&o.mc("ngIf",o.ic(1,1,e.profileStateService.selectedProfile$))},directives:[r.m,d.a,h.e,ot],pipes:[r.b],styles:[""]}),t})();class ht{constructor(t){this.base=t}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...t){return ct(function*(t){for(const e of t)yield*e}([this,...t.map(ct)]))}entries(){return ct(function*(t){let e=0;for(const i of t)yield[e++,i]}(this))}every(t){return!this.some((e,i)=>!t(e,i))}fill(t){return this.map(()=>t)}filter(t){return ct(function*(e){for(const[i,r]of e)t(r,i)&&(yield r)}(this.entries()))}find(t){for(const[e,i]of this.entries())if(t(i,e))return i}findIndex(t){for(const[e,i]of this.entries())if(t(i,e))return e;return-1}flatMap(t){return ct(function*(e){for(const[i,r]of e)yield*ct(t(r,i))}(this.entries()))}forEach(t){for(const[e,i]of this.entries())t(i,e)}includes(t,e=0){return this.indexOf(t,e)>=0}indexOf(t,e=0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[i,r]of this.entries())if(i>=e&&r===t)return i;return-1}join(t=","){return[...this].join(t)}keys(){return ct(function*(t){let e=0;for(const i of t)yield e++}(this))}lastIndexOf(t,e=1/0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let i=-1;for(const[r,s]of this.entries())r<=e&&s===t&&(i=r);return i}get length(){return this.reduce(t=>t+1,0)}map(t){return ct(function*(e){for(const[i,r]of e)yield t(r,i)}(this.entries()))}reduce(t,e){if(void 0===e){const e=t;let i=!0,r=void 0;for(const[t,s]of this.entries())i?(r=s,i=!1):r=e(r,s,t);if(i)throw new TypeError("Reduce of empty iterable with no initial value");return r}{const i=t;let r=e;for(const[t,e]of this.entries())r=i(r,e,t);return r}}reverse(){return ct([...this].reverse())}slice(t=0,e=1/0){return ct(function*(i){for(const[r,s]of i)if(r<t);else{if(!(r<e))break;yield s}}(this.entries()))}some(t){for(const[e,i]of this.entries())if(t(i,e))return!0;return!1}sort(t){return ct([...this].sort(t))}splice(t,e=0,...i){return ct(function*(r){for(const[s,n]of r)s===t&&(yield*i),(s<t||s>=t+e)&&(yield n)}(this.entries()))}values(){return this}}function ct(t){return function(t){return"function"==typeof t[Symbol.iterator]}(t)?new ht(t):new ht({[Symbol.iterator]:()=>t})}function dt(t,e){e.size<t.size&&([e,t]=[t,e]);for(const i of t)if(e.has(i))return!0;return!1}class ut extends Map{getThrow(t){const e=this.get(t);if(void 0===e)throw new Error("map doesn't contain key: "+t);return e}getDefault(t,e){const i=this.get(t);return void 0===i?e:i}setIfAbsent(t,e){const i=this.get(t);return void 0===i?(this.set(t,e),e):i}}class ft{constructor(t,e,i=[]){this.child=t,this.data=e,this.points=i}}class pt{constructor(t,e,i,r){this.source=t,this.target=e,this.data=i,this.points=r}}class gt{constructor(t,e){this.id=t,this.data=e,this.dataChildren=[]}iroots(){return ct([this])}roots(){return[this]}*iterChildren(){for(const{child:t}of this.dataChildren)yield t}ichildren(){return ct(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:t,data:e,points:i}of this.dataChildren)yield new pt(this,t,e,i)}ichildLinks(){return ct(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new mt([this])[Symbol.iterator]()}idescendants(t="depth"){return new mt([this]).idescendants(t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return new mt([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new mt([this]).size()}sum(t){return new mt([this]).sum(t),this}count(){return new mt([this]).count(),this}height(){return new mt([this]).height(),this}depth(){return new mt([this]).depth(),this}split(){return[this]}connected(){return!0}}class mt{constructor(t){this.dagRoots=t}[Symbol.iterator](){return this.idepth()}iroots(){return ct(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const t=this.roots(),e=new Set;let i;for(;i=t.pop();)e.has(i.id)||(e.add(i.id),yield i,t.push(...i.ichildren()))}*ibreadth(){const t=new Set;let e=this.roots(),i=[];do{let r;for(i=e.reverse(),e=[];r=i.pop();)t.has(r.id)||(t.add(r.id),yield r,e.push(...r.ichildren()))}while(e.length)}*ibefore(){const t=new ut;for(const r of this)for(const e of r.ichildren())t.set(e.id,t.getDefault(e.id,0)+1);const e=this.roots();let i;for(;i=e.pop();){yield i;for(const r of i.ichildren()){const i=t.getThrow(r.id);i>1?t.set(r.id,i-1):e.push(r)}}}*iafter(){const t=this.roots(),e=new Set;let i;for(;i=t.pop();)e.has(i.id)||(i.ichildren().every(t=>e.has(t.id))?(e.add(i.id),yield i):(t.push(i),t.push(...i.ichildren())))}idescendants(t="depth"){if("depth"===t)return ct(this.idepth());if("breadth"===t)return ct(this.ibreadth());if("before"===t)return ct(this.ibefore());if("after"===t)return ct(this.iafter());throw new Error("unknown iteration style: "+t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return this.idescendants().flatMap(t=>t.ichildLinks())}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce(t=>t+1,0)}sum(t){const e=new ut;for(const[i,r]of this.idescendants("after").entries()){const s=t(r,i),n=new ut;n.set(r.id,s);for(const t of r.ichildren()){const i=e.getThrow(t.id);for(const[t,e]of i.entries())n.set(t,e)}r.value=ct(n.entries()).map(([,t])=>t).reduce((t,e)=>t+e),e.set(r.id,n)}return this}count(){const t=new ut;for(const e of this.idescendants("after"))if(e.ichildren()[Symbol.iterator]().next().done)t.set(e.id,new Set([e.id])),e.value=1;else{const i=new Set;for(const r of e.ichildren()){const e=t.getThrow(r.id);for(const t of e)i.add(t)}t.set(e.id,i),e.value=i.size}return this}height(){for(const t of this.idescendants("after"))t.value=Math.max(0,...t.ichildren().map(t=>{if(void 0===t.value)throw new Error("`after` iteration didn't iterate in after order");return t.value+1}));return this}depth(){const t=new ut;for(const e of this)for(const i of e.ichildren())t.setIfAbsent(i.id,[]).push(e);for(const e of this.idescendants("before"))e.value=Math.max(0,...t.getDefault(e.id,[]).map(t=>{if(void 0===t.value)throw new Error("`before` iteration didn't iterate in before order");return t.value+1}));return this}split(){const t=new ut,e=new ut;for(const s of this.iroots())t.set(s.id,[]),e.set(s.id,new Set(s.idescendants().map(t=>t.id)));for(const[s,n]of this.iroots().entries()){const i=e.getThrow(n.id);for(const r of this.iroots().slice(s+1))dt(i,e.getThrow(r.id))&&(t.getThrow(n.id).push(r),t.getThrow(r.id).push(n))}const i=[],r=new Set;for(const s of this.iroots())if(!r.has(s.id)){r.add(s.id);const e=[s];i.push(e);const n=t.getThrow(s.id).slice();let o;for(;o=n.pop();)r.has(o.id)||(r.add(o.id),e.push(o),n.push(...t.getThrow(o.id)))}return i.map(t=>t.length>1?new mt(t):t[0])}connected(){return 1===this.split().length}}function bt(t){function e(e,i){return(t(e,i)||[]).map(t=>[t,void 0])}return e.wrapped=t,e}function vt(t){if(function(t){try{return"string"==typeof t.id}catch(e){return!1}}(t))return t.id;throw new Error("default id function expected datum to have an id field but got: "+t)}function yt(t){if(function(t){try{const e=t.parentIds;return void 0===e||e instanceof Array&&e.every(t=>"string"==typeof t)}catch(e){return!1}}(t))return t.parentIds;throw new Error("default parentIds function expected datum to have a parentIds field but got: "+t)}let xt,wt,St=1e-60;do{St+=St,xt=1+.1*St,wt=1+.2*St}while(xt<=1||wt<=1);var It=St,Ct=function(t,e,i,r=[],s=0,n=[0,0]){const o=[],a=[],l=[],h=[],c=[],d=[];let u="";const f=t.length-1,p=i[1].length-1;if(!r)for(let m=1;m<=p;m+=1)r[m]=0;if(f!==t[1].length-1&&(u="Dmat is not symmetric!"),f!==e.length-1&&(u="Dmat and dvec are incompatible!"),f!==i.length-1&&(u="Amat and dvec are incompatible!"),p!==r.length-1&&(u="Amat and bvec are incompatible!"),(s>p||s<0)&&(u="Value of meq is invalid!"),""!==u)return{message:u};for(let m=1;m<=p;m+=1)a[m]=0,h[m]=0;const g=Math.min(f,p);for(let m=1;m<=f;m+=1)l[m]=0;o[1]=0;for(let m=1;m<=2*f+g*(g+5)/2+2*p+1;m+=1)c[m]=0;for(let m=1;m<=2;m+=1)d[m]=0;return function(t,e,i,r,s,n,o,a,l,h,c,d,u,f=0,p,g,m){let b,v,y,x,w,S,I,C,P,k,A,E,T,z;const _=Math.min(r,c);let V=2*r+_*(_+5)/2+2*c+1;for(let $=1;$<=r;$+=1)g[$]=e[$];for(let $=r+1;$<=V;$+=1)g[$]=0;for(let $=1;$<=c;$+=1)u[$]=0,n[$]=0;const M=[];if(0===m[1]){if(function(t,e,i,r){let s,n,o;for(let a=1;a<=i;a+=1){if(r[1]=a,o=0,s=a-1,s<1){if(o=t[a][a]-o,o<=0)break;t[a][a]=Math.sqrt(o)}else{for(let e=1;e<=s;e+=1){n=t[e][a];for(let i=1;i<e;i+=1)n-=t[i][a]*t[i][e];n/=t[e][e],t[e][a]=n,o+=n*n}if(o=t[a][a]-o,o<=0)break;t[a][a]=Math.sqrt(o)}r[1]=0}}(t,0,r,M),0!==M[1])return void(m[1]=2);(function(t,e,i,r){let s,n;for(s=1;s<=i;s+=1){n=0;for(let e=1;e<s;e+=1)n+=t[e][s]*r[e];r[s]=(r[s]-n)/t[s][s]}for(let o=1;o<=i;o+=1){s=i+1-o,r[s]/=t[s][s],n=-r[s];for(let e=1;e<s;e+=1)r[e]+=n*t[e][s]}})(t,0,r,e),function(t,e,i){let r,s;for(let n=1;n<=i;n+=1){t[n][n]=1/t[n][n],s=-t[n][n];for(let e=1;e<n;e+=1)t[e][n]*=s;if(r=n+1,i<r)break;for(let e=r;e<=i;e+=1){s=t[n][e],t[n][e]=0;for(let i=1;i<=n;i+=1)t[i][e]+=s*t[i][n]}}}(t,0,r)}else{for(let i=1;i<=r;i+=1){s[i]=0;for(let r=1;r<=i;r+=1)s[i]+=t[r][i]*e[r]}for(let i=1;i<=r;i+=1){e[i]=0;for(let n=i;n<=r;n+=1)e[i]+=t[i][n]*s[n]}}o[1]=0;for(let $=1;$<=r;$+=1){s[$]=e[$],o[1]+=g[$]*s[$],g[$]=0;for(let e=$+1;e<=r;e+=1)t[e][$]=0}o[1]=-o[1]/2,m[1]=0;const O=r,B=O+r,D=B+_,R=D+_+1,F=R+_*(_+1)/2,j=F+c;for(let $=1;$<=c;$+=1){S=0;for(let t=1;t<=r;t+=1)S+=a[t][$]*a[t][$];g[j+$]=Math.sqrt(S)}function L(){p[1]+=1,V=F;for(let t=1;t<=c;t+=1){V+=1,S=-l[t];for(let e=1;e<=r;e+=1)S+=a[e][t]*s[e];if(Math.abs(S)<It&&(S=0),t>d)g[V]=S;else if(g[V]=-Math.abs(S),S>0){for(let e=1;e<=r;e+=1)a[e][t]=-a[e][t];l[t]=-l[t]}}for(let t=1;t<=x;t+=1)g[F+u[t]]=0;y=0,w=0;for(let t=1;t<=c;t+=1)g[F+t]<w*g[j+t]&&(y=t,w=g[F+t]/g[j+t]);if(0===y){for(let t=1;t<=x;t+=1)n[u[t]]=g[D+t];return 999}return 0}function N(){for(let e=1;e<=r;e+=1){S=0;for(let i=1;i<=r;i+=1)S+=t[i][e]*a[i][y];g[e]=S}b=O;for(let t=1;t<=r;t+=1)g[b+t]=0;for(let e=x+1;e<=r;e+=1)for(let i=1;i<=r;i+=1)g[b+i]=g[b+i]+t[i][e]*g[e];E=!0;for(let t=x;t>=1;t-=1){S=g[t],V=R+t*(t+3)/2,b=V-t;for(let e=t+1;e<=x;e+=1)S-=g[V]*g[B+e],V+=e;S/=g[b],g[B+t]=S,u[t]<=d||S<=0||(E=!1,v=t)}if(!E){I=g[D+v]/g[B+v];for(let t=1;t<=x;t+=1)u[t]<=d||g[B+t]<=0||(w=g[D+t]/g[B+t],w<I&&(I=w,v=t))}S=0;for(let t=O+1;t<=O+r;t+=1)S+=g[t]*g[t];if(Math.abs(S)<=It){if(E)return m[1]=1,999;for(let t=1;t<=x;t+=1)g[D+t]=g[D+t]-I*g[B+t];return g[D+x+1]=g[D+x+1]+I,700}S=0;for(let t=1;t<=r;t+=1)S+=g[O+t]*a[t][y];C=-g[F+y]/S,T=!0,E||I<C&&(C=I,T=!1);for(let t=1;t<=r;t+=1)s[t]+=C*g[O+t],Math.abs(s[t])<It&&(s[t]=0);o[1]+=C*S*(C/2+g[D+x+1]);for(let t=1;t<=x;t+=1)g[D+t]=g[D+t]-C*g[B+t];if(g[D+x+1]=g[D+x+1]+C,!T){S=-l[y];for(let t=1;t<=r;t+=1)S+=s[t]*a[t][y];if(y>d)g[F+y]=S;else if(g[F+y]=-Math.abs(S),S>0){for(let t=1;t<=r;t+=1)a[t][y]=-a[t][y];l[y]=-l[y]}return 700}x+=1,u[x]=y,V=R+(x-1)*x/2+1;for(let t=1;t<=x-1;t+=1)g[V]=g[t],V+=1;if(x===r)g[V]=g[r];else{for(let e=r;e>=x+1;e-=1)if(0!==g[e]&&(P=Math.max(Math.abs(g[e-1]),Math.abs(g[e])),k=Math.min(Math.abs(g[e-1]),Math.abs(g[e])),w=g[e-1]>=0?Math.abs(P*Math.sqrt(1+k*k/(P*P))):-Math.abs(P*Math.sqrt(1+k*k/(P*P))),P=g[e-1]/w,k=g[e]/w,1!==P))if(0===P){g[e-1]=k*w;for(let i=1;i<=r;i+=1)w=t[i][e-1],t[i][e-1]=t[i][e],t[i][e]=w}else{g[e-1]=w,A=k/(1+P);for(let i=1;i<=r;i+=1)w=P*t[i][e-1]+k*t[i][e],t[i][e]=A*(t[i][e-1]+w)-t[i][e],t[i][e-1]=w}g[V]=g[x]}return 0}function U(){if(V=R+v*(v+1)/2+1,b=V+v,0===g[b])return 798;if(P=Math.max(Math.abs(g[b-1]),Math.abs(g[b])),k=Math.min(Math.abs(g[b-1]),Math.abs(g[b])),w=g[b-1]>=0?Math.abs(P*Math.sqrt(1+k*k/(P*P))):-Math.abs(P*Math.sqrt(1+k*k/(P*P))),P=g[b-1]/w,k=g[b]/w,1===P)return 798;if(0===P){for(let t=v+1;t<=x;t+=1)w=g[b-1],g[b-1]=g[b],g[b]=w,b+=t;for(let e=1;e<=r;e+=1)w=t[e][v],t[e][v]=t[e][v+1],t[e][v+1]=w}else{A=k/(1+P);for(let t=v+1;t<=x;t+=1)w=P*g[b-1]+k*g[b],g[b]=A*(g[b-1]+w)-g[b],g[b-1]=w,b+=t;for(let e=1;e<=r;e+=1)w=P*t[e][v]+k*t[e][v+1],t[e][v+1]=A*(t[e][v]+w)-t[e][v+1],t[e][v]=w}return 0}function G(){b=V-v;for(let t=1;t<=v;t+=1)g[b]=g[V],V+=1,b+=1;return g[D+v]=g[D+v+1],u[v]=u[v+1],v+=1,v<x?797:0}function W(){return g[D+x]=g[D+x+1],g[D+x+1]=0,u[x]=0,x-=1,p[2]+=1,0}for(x=f,p[1]=0,p[2]=0,z=0;;){if(z=L(),999===z)return;for(;z=N(),0!==z;){if(999===z)return;if(700===z)if(v===x)W();else{for(;U(),z=G(),797===z;);W()}}}}(t,e,0,f,l,h,o,i,r,0,p,s,a,0,d,c,n),1===n[1]&&(u="constraints are inconsistent, no solution!"),2===n[1]&&(u="matrix D in quadratic function is not positive definite!"),{solution:l,Lagrangian:h,value:o,unconstrained_solution:e,iterations:d,iact:a,message:u}};function Pt(t,e){let[i,...r]=t,s=i.x=0;for(const n of r)s=n.x=s+e(i,n),i=n;if(s>0)for(const n of t)n.x/=s;else for(const n of t)n.x=.5}function kt(t,e,i,r){t[i][i]+=r,t[i][e]-=r,t[e][i]-=r,t[e][e]+=r}function At(t,e,i,r,s){t[r][r]+=s,t[r][i]-=2*s,t[r][e]+=s,t[i][r]-=2*s,t[i][i]+=4*s,t[i][e]-=2*s,t[e][r]+=s,t[e][i]-=2*s,t[e][e]+=s}class Et extends gt{constructor(t){super(t,void 0)}}function Tt(t,e,i,r){this.feasible=i,this.evaluation=e,this.bounded=r,this._tableau=t}var zt=Tt;function _t(t,e,i,r,s){zt.call(this,t,e,i,r),this.iter=s}Tt.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,i=e.varIndexByRow,r=e.variablesPerIndex,s=e.matrix,n=e.rhsColumn,o=e.height-1,a=Math.round(1/e.precision),l=1;l<=o;l+=1){var h=r[i[l]];void 0!==h&&!0!==h.isSlack&&(t[h.id]=Math.round((Number.EPSILON+s[l][n])*a)/a)}return t};var Vt=_t;function Mt(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}_t.prototype=Object.create(zt.prototype),_t.constructor=_t;var Ot=Mt;function Bt(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var i=0;i<e;i+=1)this.reducedCosts[i]=0}Mt.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},Bt.prototype.copy=function(){var t=new Bt(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t},Mt.prototype.setOptionalObjective=function(t,e,i){var r=this.objectivesByPriority[t];void 0===r&&(r=new Bt(t,Math.max(this.width,e+1)),this.objectivesByPriority[t]=r,this.optionalObjectives.push(r),this.optionalObjectives.sort((function(t,e){return t.priority-e.priority}))),r.reducedCosts[e]=i},Mt.prototype.initialize=function(t,e,i,r){this.variables=i,this.unrestrictedVars=r,this.width=t,this.height=e;for(var s=new Array(t),n=0;n<t;n++)s[n]=0;this.matrix=new Array(e);for(var o=0;o<e;o++)this.matrix[o]=s.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},Mt.prototype._resetMatrix=function(){var t,e,i=this.model.variables,r=this.model.constraints,s=i.length,n=r.length,o=this.matrix[0],a=!0===this.model.isMinimization?-1:1;for(t=0;t<s;t+=1){var l=i[t],h=l.priority,c=a*l.cost;0===h?o[t+1]=c:this.setOptionalObjective(h,t+1,c),this.rowByVarIndex[e=i[t].index]=-1,this.colByVarIndex[e]=t+1,this.varIndexByCol[t+1]=e}for(var d=1,u=0;u<n;u+=1){var f,p,g=r[u],m=g.index;this.rowByVarIndex[m]=d,this.colByVarIndex[m]=-1,this.varIndexByRow[d]=m;var b=g.terms,v=b.length,y=this.matrix[d++];if(g.isUpperBound){for(f=0;f<v;f+=1)y[this.colByVarIndex[(p=b[f]).variable.index]]=p.coefficient;y[0]=g.rhs}else{for(f=0;f<v;f+=1)y[this.colByVarIndex[(p=b[f]).variable.index]]=-p.coefficient;y[0]=-g.rhs}}},Mt.prototype.setModel=function(t){return this.model=t,this.initialize(t.nVariables+1,t.nConstraints+1,t.variables,t.unrestrictedVariables),this._resetMatrix(),this},Mt.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},Mt.prototype.density=function(){for(var t=0,e=this.matrix,i=0;i<this.height;i++)for(var r=e[i],s=0;s<this.width;s++)0!==r[s]&&(t+=1);return t/(this.height*this.width)},Mt.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=Math.round((Number.EPSILON+this.matrix[this.costRowIndex][this.rhsColumn])*t)/t;this.evaluation=e,0===this.simplexIters&&(this.bestPossibleEval=e)},Mt.prototype.getSolution=function(){var t=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new Vt(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new zt(this,t,this.feasible,this.bounded)},Ot.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},Ot.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],i=this.matrix,r=this.rhsColumn,s=this.width-1,n=this.height-1,o=0;;){for(var a=0,l=-this.precision,h=1;h<=n;h++){var c=i[h][r];c<l&&(l=c,a=h)}if(0===a)return this.feasible=!0,o;for(var d=0,u=-1/0,f=i[0],p=i[a],g=1;g<=s;g++){var m=p[g];if(!0===this.unrestrictedVars[this.varIndexByCol[g]]||m<-this.precision){var b=-f[g]/m;u<b&&(u=b,d=g)}}if(0===d)return this.feasible=!1,o;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[d]]);var v=this.checkForCycles(e);if(v.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+v[0]),this.model.messages.push("Length :"+v[1]),this.feasible=!1,o}this.pivot(a,d),o+=1}},Ot.prototype.phase2=function(){for(var t,e,i=this.model.checkForCycles,r=[],s=this.matrix,n=this.rhsColumn,o=this.width-1,a=this.height-1,l=this.precision,h=this.optionalObjectives.length,c=null,d=0;;){var u=s[this.costRowIndex];h>0&&(c=[]);for(var f=0,p=l,g=!1,m=1;m<=o;m++)t=u[m],e=!0===this.unrestrictedVars[this.varIndexByCol[m]],h>0&&-l<t&&t<l?c.push(m):e&&t<0?-t>p&&(p=-t,f=m,g=!0):t>p&&(p=t,f=m,g=!1);if(h>0)for(var b=0;0===f&&c.length>0&&b<h;){var v=[],y=this.optionalObjectives[b].reducedCosts;p=l;for(var x=0;x<c.length;x++)e=!0===this.unrestrictedVars[this.varIndexByCol[m=c[x]]],-l<(t=y[m])&&t<l?v.push(m):e&&t<0?-t>p&&(p=-t,f=m,g=!0):t>p&&(p=t,f=m,g=!1);c=v,b+=1}if(0===f)return this.setEvaluation(),this.simplexIters+=1,d;for(var w=0,S=1/0,I=1;I<=a;I++){var C=s[I],P=C[n],k=C[f];if(!(-l<k&&k<l)){if(k>0&&l>P&&P>-l){S=0,w=I;break}var A=g?-P/k:P/k;A>l&&S>A&&(S=A,w=I)}}if(S===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[f],d;if(i){r.push([this.varIndexByRow[w],this.varIndexByCol[f]]);var E=this.checkForCycles(r);if(E.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+E[0]),this.model.messages.push("Length :"+E[1]),this.feasible=!1,d}this.pivot(w,f,!0),d+=1}};var Dt=[];function Rt(t,e,i,r){this.id=t,this.cost=e,this.index=i,this.value=0,this.priority=r}function Ft(t,e,i,r){Rt.call(this,t,e,i,r)}function jt(t,e){Rt.call(this,t,0,e,0)}function Lt(t,e){this.variable=t,this.coefficient=e}function Nt(t,e,i){return 0===i||"required"===i?null:(e=e||1,i=i||1,!1===t.isMinimization&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,i))}function Ut(t,e,i,r){this.slack=new jt("s"+i,i),this.index=i,this.model=r,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function Gt(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}Ot.prototype.pivot=function(t,e){var i=this.matrix,r=i[t][e],s=this.height-1,n=this.width-1,o=this.varIndexByRow[t],a=this.varIndexByCol[e];this.varIndexByRow[t]=a,this.varIndexByCol[e]=o,this.rowByVarIndex[a]=t,this.rowByVarIndex[o]=-1,this.colByVarIndex[a]=-1,this.colByVarIndex[o]=e;for(var l,h,c,d=i[t],u=0,f=0;f<=n;f++)d[f]>=-1e-16&&d[f]<=1e-16?d[f]=0:(d[f]/=r,Dt[u]=f,u+=1);d[e]=1/r;for(var p=0;p<=s;p++)if(p!==t&&!(i[p][e]>=-1e-16&&i[p][e]<=1e-16)){var g=i[p];if((l=g[e])>=-1e-16&&l<=1e-16)0!==l&&(g[e]=0);else{for(h=0;h<u;h++)(c=d[f=Dt[h]])>=-1e-16&&c<=1e-16?0!==c&&(d[f]=0):g[f]=g[f]-l*c;g[e]=-l/r}}var m=this.optionalObjectives.length;if(m>0)for(var b=0;b<m;b+=1){var v=this.optionalObjectives[b].reducedCosts;if(0!==(l=v[e])){for(h=0;h<u;h++)0!==(c=d[f=Dt[h]])&&(v[f]=v[f]-l*c);v[e]=-l/r}}},Ot.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var i=e+1;i<t.length;i++){var r=t[e],s=t[i];if(r[0]===s[0]&&r[1]===s[1]){if(i-e>t.length-i)break;for(var n=!0,o=1;o<i-e;o++){var a=t[e+o],l=t[i+o];if(a[0]!==l[0]||a[1]!==l[1]){n=!1;break}}if(n)return[e,i-e]}}return[]},Ft.prototype.isInteger=!0,jt.prototype.isSlack=!0,Ut.prototype.addTerm=function(t,e){var i=e.index,r=this.termsByVarIndex[i];return void 0===r?(r=new Lt(e,t),this.termsByVarIndex[i]=r,this.terms.push(r),!0===this.isUpperBound&&(t=-t),this.model.updateConstraintCoefficient(this,e,t)):this.setVariableCoefficient(r.coefficient+t,e),this},Ut.prototype.removeTerm=function(t){return this},Ut.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;!0===this.isUpperBound&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this},Ut.prototype.setVariableCoefficient=function(t,e){var i=e.index;if(-1!==i){var r=this.termsByVarIndex[i];if(void 0===r)this.addTerm(t,e);else if(t!==r.coefficient){var s=t-r.coefficient;!0===this.isUpperBound&&(s=-s),r.coefficient=t,this.model.updateConstraintCoefficient(this,e,s)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},Ut.prototype.relax=function(t,e){this.relaxation=Nt(this.model,t,e),this._relax(this.relaxation)},Ut.prototype._relax=function(t){null!==t&&this.setVariableCoefficient(this.isUpperBound?-1:1,t)},Gt.prototype.isEquality=!0,Gt.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this},Gt.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this},Gt.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t},Gt.prototype.relax=function(t,e){this.relaxation=Nt(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var Wt={Constraint:Ut,Variable:Rt,IntegerVariable:Ft,SlackVariable:jt,Equality:Gt,Term:Lt},$t=Wt.SlackVariable;function Ht(t,e){this.index=t,this.value=e}Ot.prototype.addCutConstraints=function(t){for(var e,i=t.length,r=this.height,s=r+i,n=r;n<s;n+=1)void 0===this.matrix[n]&&(this.matrix[n]=this.matrix[n-1].slice());this.height=s,this.nVars=this.width+this.height-2;for(var o=this.width-1,a=0;a<i;a+=1){var l=t[a],h=r+a,c="min"===l.type?-1:1,d=l.varIndex,u=this.rowByVarIndex[d],f=this.matrix[h];if(-1===u){for(f[this.rhsColumn]=c*l.value,e=1;e<=o;e+=1)f[e]=0;f[this.colByVarIndex[d]]=c}else{var p=this.matrix[u];for(f[this.rhsColumn]=c*(l.value-p[this.rhsColumn]),e=1;e<=o;e+=1)f[e]=-c*p[e]}var g=this.getNewElementIndex();this.varIndexByRow[h]=g,this.rowByVarIndex[g]=h,this.colByVarIndex[g]=-1,this.variablesPerIndex[g]=new $t("s"+g,g),this.nVars+=1}},Ot.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var s=this.height;e[s]=e[s-1].slice(),this.height+=1,this.nVars+=1;var n=this.getNewElementIndex();this.varIndexByRow[s]=n,this.rowByVarIndex[n]=s,this.colByVarIndex[n]=-1,this.variablesPerIndex[n]=new $t("s"+n,n),e[s][this.rhsColumn]=Math.floor(i);for(var o=1;o<this.varIndexByCol.length;o+=1)if(this.variablesPerIndex[this.varIndexByCol[o]].isInteger){var a=e[t][o],l=Math.floor(a)+Math.max(0,a-Math.floor(a)-r)/(1-r);e[s][o]=l}else e[s][o]=Math.min(0,e[t][o]/(1-r));for(var h=0;h<this.width;h+=1)e[s][h]-=e[t][h];return!0},Ot.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var s=this.height;e[s]=e[s-1].slice(),this.height+=1,this.nVars+=1;var n=this.getNewElementIndex();this.varIndexByRow[s]=n,this.rowByVarIndex[n]=s,this.colByVarIndex[n]=-1,this.variablesPerIndex[n]=new $t("s"+n,n),e[s][this.rhsColumn]=-r;for(var o=1;o<this.varIndexByCol.length;o+=1){var a=this.variablesPerIndex[this.varIndexByCol[o]],l=e[t][o],h=l-Math.floor(l);e[s][o]=a.isInteger?h<=r?-h:-(1-h)*r/h:l>=0?-l:l*r/(1-r)}return!0},Ot.prototype.applyMIRCuts=function(){},Ot.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(-1===e){for(var i=this.colByVarIndex[t],r=1;r<this.height;r+=1){var s=this.matrix[r][i];if(s<-this.precision||this.precision<s){e=r;break}}this.pivot(e,i)}return e},Ot.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(-1===e){for(var i=this.rowByVarIndex[t],r=this.matrix[i],s=1;s<this.height;s+=1){var n=r[s];if(n<-this.precision||this.precision<n){e=s;break}}this.pivot(i,e)}return e},Ot.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),i=0;i<t;i+=1){var r=this.variables[i],s=this.rowByVarIndex[r.index];r.value=-1===s?0:Math.round((this.matrix[s][this.rhsColumn]+Number.EPSILON)*e)/e}},Ot.prototype.updateRightHandSide=function(t,e){var i=this.height-1,r=this.rowByVarIndex[t.index];if(-1===r){for(var s=this.colByVarIndex[t.index],n=0;n<=i;n+=1){var o=this.matrix[n];o[this.rhsColumn]-=e*o[s]}var a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1){var h=this.optionalObjectives[l].reducedCosts;h[this.rhsColumn]-=e*h[s]}}else this.matrix[r][this.rhsColumn]-=e},Ot.prototype.updateConstraintCoefficient=function(t,e,i){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var r=this._putInBase(t.index),s=this.colByVarIndex[e.index];if(-1===s)for(var n=this.rowByVarIndex[e.index],o=0;o<this.width;o+=1)this.matrix[r][o]+=i*this.matrix[n][o];else this.matrix[r][s]-=i},Ot.prototype.updateCost=function(t,e){var i=t.index,r=this.width-1,s=this.colByVarIndex[i];if(-1===s){var n,o=this.matrix[this.rowByVarIndex[i]];if(0===t.priority){var a=this.matrix[0];for(n=0;n<=r;n+=1)a[n]+=e*o[n]}else{var l=this.objectivesByPriority[t.priority].reducedCosts;for(n=0;n<=r;n+=1)l[n]+=e*o[n]}}else this.matrix[0][s]-=e},Ot.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,i=this.height,r=this.matrix[i];void 0===r&&(r=this.matrix[0].slice(),this.matrix[i]=r);for(var s=this.width-1,n=0;n<=s;n+=1)r[n]=0;r[this.rhsColumn]=e*t.rhs;for(var o=t.terms,a=o.length,l=0;l<a;l+=1){var h=o[l],c=h.coefficient,d=h.variable.index,u=this.rowByVarIndex[d];if(-1===u)r[this.colByVarIndex[d]]+=e*c;else{var f=this.matrix[u];for(n=0;n<=s;n+=1)r[n]-=e*c*f[n]}}var p=t.index;this.varIndexByRow[i]=p,this.rowByVarIndex[p]=i,this.colByVarIndex[p]=-1,this.height+=1},Ot.prototype.removeConstraint=function(t){var e=t.index,i=this.height-1,r=this._putInBase(e),s=this.matrix[i];this.matrix[i]=this.matrix[r],this.matrix[r]=s,this.varIndexByRow[r]=this.varIndexByRow[i],this.varIndexByRow[i]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1},Ot.prototype.addVariable=function(t){var e=this.height-1,i=this.width,r=!0===this.model.isMinimization?-t.cost:t.cost,s=t.priority,n=this.optionalObjectives.length;if(n>0)for(var o=0;o<n;o+=1)this.optionalObjectives[o].reducedCosts[i]=0;0===s?this.matrix[0][i]=r:(this.setOptionalObjective(s,i,r),this.matrix[0][i]=0);for(var a=1;a<=e;a+=1)this.matrix[a][i]=0;var l=t.index;this.varIndexByCol[i]=l,this.rowByVarIndex[l]=-1,this.colByVarIndex[l]=i,this.width+=1},Ot.prototype.removeVariable=function(t){var e=t.index,i=this._takeOutOfBase(e),r=this.width-1;if(i!==r){for(var s=this.height-1,n=0;n<=s;n+=1){var o=this.matrix[n];o[i]=o[r]}var a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1){var h=this.optionalObjectives[l].reducedCosts;h[i]=h[r]}var c=this.varIndexByCol[r];this.varIndexByCol[i]=c,this.colByVarIndex[c]=i}this.varIndexByCol[r]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1},Ot.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var i,r,s,n,o,a,l,h,c,d,u="",f=[" "];for(r=1;r<this.width;r+=1)l=" ",h="\t",(a=void 0===(n=this.variablesPerIndex[o=this.varIndexByCol[r]])?"c"+o:n.id).length>5?l+=" ":h+="\t",f[r]=l,u+=h+a;console.log(u);var p=this.matrix[this.costRowIndex],g="\t";for(i=1;i<this.width;i+=1)g+="\t",g+=f[i],g+=p[i].toFixed(5);for(g+="\t"+f[0]+p[0].toFixed(5),console.log(g+"\tZ"),s=1;s<this.height;s+=1){for(c=this.matrix[s],d="\t",r=1;r<this.width;r+=1)d+="\t"+f[r]+c[r].toFixed(5);d+="\t"+f[0]+c[0].toFixed(5),a=void 0===(n=this.variablesPerIndex[o=this.varIndexByRow[s]])?"c"+o:n.id,console.log(d+"\t"+a)}console.log("");var m=this.optionalObjectives.length;if(m>0){console.log("    Optional objectives:");for(var b=0;b<m;b+=1){var v=this.optionalObjectives[b].reducedCosts,y="";for(i=1;i<this.width;i+=1)y+=v[i]<0?"":" ",y+=f[i],y+=v[i].toFixed(5);y+=(v[0]<0?"":" ")+f[0]+v[0].toFixed(5),console.log(y+" z"+b)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this},Ot.prototype.copy=function(){var t=new Ot(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],i=0;i<this.optionalObjectives.length;i++)e[i]=this.optionalObjectives[i].copy();t.optionalObjectives=e;for(var r=this.matrix,s=new Array(this.height),n=0;n<this.height;n++)s[n]=r[n].slice();return t.matrix=s,t},Ot.prototype.save=function(){this.savedState=this.copy()},Ot.prototype.restore=function(){if(null!==this.savedState){var t,e,i=this.savedState,r=i.matrix;for(this.nVars=i.nVars,this.model=i.model,this.variables=i.variables,this.variablesPerIndex=i.variablesPerIndex,this.unrestrictedVars=i.unrestrictedVars,this.lastElementIndex=i.lastElementIndex,this.width=i.width,this.height=i.height,t=0;t<this.height;t+=1){var s=r[t],n=this.matrix[t];for(e=0;e<this.width;e+=1)n[e]=s[e]}var o=i.varIndexByRow;for(e=0;e<this.height;e+=1)this.varIndexByRow[e]=o[e];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var a=i.varIndexByCol;for(t=0;t<this.width;t+=1)this.varIndexByCol[t]=a[t];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var l=i.rowByVarIndex,h=i.colByVarIndex,c=0;c<this.nVars;c+=1)this.rowByVarIndex[c]=l[c],this.colByVarIndex[c]=h[c];if(i.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var d=0;d<i.optionalObjectives.length;d++){var u=i.optionalObjectives[d].copy();this.optionalObjectives[d]=u,this.optionalObjectivePerPriority[u.priority]=u}}}},Ot.prototype.getMostFractionalVar=function(){for(var t=0,e=null,i=null,r=this.model.integerVariables,s=r.length,n=0;n<s;n++){var o=r[n].index,a=this.rowByVarIndex[o];if(-1!==a){var l=this.matrix[a][this.rhsColumn],h=Math.abs(l-Math.round(l));t<h&&(t=h,e=o,i=l)}}return new Ht(e,i)},Ot.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,i=null,r=this.model.integerVariables,s=r.length,n=0;n<s;n++){var o=r[n],a=o.index,l=this.rowByVarIndex[a];if(-1!==l){var h=this.matrix[l][this.rhsColumn];if(Math.abs(h-Math.round(h))>this.precision){var c=o.cost;t>c&&(t=c,e=a,i=h)}}}return new Ht(e,i)},Ot.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var i=this.matrix[e][this.rhsColumn];(i-=Math.floor(i))<this.precision&&-i<this.precision&&(t+=1)}return t},Ot.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,i=0;i<e;i++){var r=this.rowByVarIndex[t[i].index];if(-1!==r){var s=this.matrix[r][this.rhsColumn];if(Math.abs(s-Math.round(s))>this.precision)return!1}}return!0},Ot.prototype.computeFractionalVolume=function(t){for(var e=-1,i=1;i<this.height;i+=1)if(this.variablesPerIndex[this.varIndexByRow[i]].isInteger){var r=this.matrix[i][this.rhsColumn];if(r=Math.abs(r),Math.min(r-Math.floor(r),Math.floor(r+1))<this.precision){if(!t)return 0}else-1===e?e=r:e*=r}return-1===e?0:e};var qt=Ot;function Jt(t,e,i){this.type=t,this.varIndex=e,this.value=i}function Yt(t,e){this.relaxedEvaluation=t,this.cuts=e}function Qt(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}Ot.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var i=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*i&&(e=!1)}},Ot.prototype.branchAndCut=function(){var t=[],e=0,i=this.model.tolerance,r=!0,s=1e99;this.model.timeout&&(s=Date.now()+this.model.timeout);for(var n=1/0,o=null,a=[],l=0;l<this.optionalObjectives.length;l+=1)a.push(1/0);var h=new Yt(-1/0,[]);for(t.push(h);t.length>0&&!0===r&&Date.now()<s;)if(i>0&&n<(this.model.isMinimization?this.bestPossibleEval*(1+i):this.bestPossibleEval*(1-i))&&(r=!1),!((h=t.pop()).relaxedEvaluation>n)){var c=h.cuts;if(this.applyCuts(c),e++,!1!==this.feasible){var d=this.evaluation;if(!(d>n)){if(d===n){for(var u=!0,f=0;f<this.optionalObjectives.length&&!(this.optionalObjectives[f].reducedCosts[0]>a[f]);f+=1)if(this.optionalObjectives[f].reducedCosts[0]<a[f]){u=!1;break}if(u)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===e)return void(this.branchAndCutIterations=e);o=h,n=d;for(var p=0;p<this.optionalObjectives.length;p+=1)a[p]=this.optionalObjectives[p].reducedCosts[0]}else{1===e&&this.save();for(var g=this.getMostFractionalVar(),m=g.index,b=[],v=[],y=c.length,x=0;x<y;x+=1){var w=c[x];w.varIndex===m?"min"===w.type?v.push(w):b.push(w):(b.push(w),v.push(w))}var S=Math.ceil(g.value),I=Math.floor(g.value),C=new Jt("min",m,S);b.push(C);var P=new Jt("max",m,I);v.push(P),t.push(new Yt(d,b)),t.push(new Yt(d,v)),t.sort(Qt)}}}}null!==o&&this.applyCuts(o.cuts),this.branchAndCutIterations=e};var Xt={},Zt=Wt.Constraint,Kt=Wt.Equality,te=Wt.Variable,ee=Wt.IntegerVariable;function ie(t,e){this.tableau=new Ot(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var re=ie;ie.prototype.minimize=function(){return this.isMinimization=!0,this},ie.prototype.maximize=function(){return this.isMinimization=!1,this},ie.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},ie.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(t)},ie.prototype.smallerThan=function(t){var e=new Zt(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},ie.prototype.greaterThan=function(t){var e=new Zt(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},ie.prototype.equal=function(t){var e=new Zt(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var i=new Zt(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(i),new Kt(e,i)},ie.prototype.addVariable=function(t,e,i,r,s){if("string"==typeof s)switch(s){case"required":s=0;break;case"strong":s=1;break;case"medium":s=2;break;case"weak":s=3;break;default:s=0}var n,o=this.tableau.getNewElementIndex();return null==e&&(e="v"+o),null==t&&(t=0),null==s&&(s=0),i?(n=new ee(e,t,o,s),this.integerVariables.push(n)):n=new te(e,t,o,s),this.variables.push(n),this.tableau.variablesPerIndex[o]=n,r&&(this.unrestrictedVariables[o]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(n),n},ie.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e?(this.constraints.splice(e,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},ie.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this},ie.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(-1!==e)return this.variables.splice(e,1),!0===this.tableauInitialized&&this.tableau.removeVariable(t),this;console.warn("[Model.removeVariable] Variable not present in model")},ie.prototype.updateRightHandSide=function(t,e){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(t,e),this},ie.prototype.updateConstraintCoefficient=function(t,e,i){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(t,e,i),this},ie.prototype.setCost=function(t,e){var i=t-e.cost;return!1===this.isMinimization&&(i=-i),e.cost=t,this.tableau.updateCost(e,i),this},ie.prototype.loadJson=function(t){this.isMinimization="max"!==t.opType;for(var e=t.variables,i=t.constraints,r={},s={},n=Object.keys(i),o=n.length,a=0;a<o;a+=1){var l,h,c=n[a],d=i[c],u=d.equal,f=d.weight,p=d.priority,g=void 0!==f||void 0!==p;if(void 0===u){var m=d.min;void 0!==m&&(l=this.greaterThan(m),r[c]=l,g&&l.relax(f,p));var b=d.max;void 0!==b&&(h=this.smallerThan(b),s[c]=h,g&&h.relax(f,p))}else{l=this.greaterThan(u),r[c]=l,h=this.smallerThan(u),s[c]=h;var v=new Kt(l,h);g&&v.relax(f,p)}}var y=Object.keys(e),x=y.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),0===this.tolerance&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),this.checkForCycles=void 0===t.options.exitOnCycles||t.options.exitOnCycles);for(var w=t.ints||{},S=t.binaries||{},I=t.unrestricted||{},C=t.optimize,P=0;P<x;P+=1){var k=y[P],A=e[k],E=!!S[k],T=this.addVariable(A[C]||0,k,!!w[k]||E,!!I[k]);E&&this.smallerThan(1).addTerm(1,T);var z=Object.keys(A);for(a=0;a<z.length;a+=1){var _=z[a];if(_!==C){var V=A[_],M=r[_];void 0!==M&&M.addTerm(V,T);var O=s[_];void 0!==O&&O.addTerm(V,T)}}}return this},ie.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},ie.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},ie.prototype.isFeasible=function(){return this.tableau.feasible},ie.prototype.save=function(){return this.tableau.save()},ie.prototype.restore=function(){return this.tableau.restore()},ie.prototype.activateMIRCuts=function(t){this.useMIRCuts=t},ie.prototype.debug=function(t){this.checkForCycles=t},ie.prototype.log=function(t){return this.tableau.log(t)};var se={CleanObjectiveAttributes:function(t){var e,i,r;if("string"==typeof t.optimize){if(t.constraints[t.optimize]){for(i in e=Math.random(),t.variables)t.variables[i][t.optimize]&&(t.variables[i][e]=t.variables[i][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}return t}for(r in t.optimize)if(t.constraints[r])if("equal"===t.constraints[r])delete t.optimize[r];else{for(i in e=Math.random(),t.variables)t.variables[i][r]&&(t.variables[i][e]=t.variables[i][r]);t.constraints[e]=t.constraints[r],delete t.constraints[r]}return t}},ne=function(t){return t.length?function(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},i={opType:"",optimize:"_obj",constraints:{},variables:{}},r={">=":"min","<=":"max","=":"equal"},s="",n=null,o="",a="",l="",h=0;"string"==typeof t&&(t=t.split("\n"));for(var c=0;c<t.length;c++)if(l="__"+c,n=null,e.is_objective.test(s=t[c]))i.opType=s.match(/(max|min)/gi)[0],(n=s.match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")})).slice(1)).forEach((function(t){o=null===(o=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:o[0],o=parseFloat(o),a=t.match(e.get_word)[0].replace(/\;$/,""),i.variables[a]=i.variables[a]||{},i.variables[a]._obj=o}));else if(e.is_int.test(s))n=s.match(e.parse_int).slice(1),i.ints=i.ints||{},n.forEach((function(t){t=t.replace(";",""),i.ints[t]=1}));else if(e.is_bin.test(s))n=s.match(e.parse_bin).slice(1),i.binaries=i.binaries||{},n.forEach((function(t){t=t.replace(";",""),i.binaries[t]=1}));else if(e.is_constraint.test(s)){var d=s.indexOf(":");(n=(-1===d?s:s.slice(d+1)).match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")}))).forEach((function(t){o=null===(o=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:o[0],o=parseFloat(o),a=t.match(e.get_word)[0],i.variables[a]=i.variables[a]||{},i.variables[a][l]=o})),h=parseFloat(s.match(e.parse_rhs)[0]),s=r[s.match(e.parse_dir)[0]],i.constraints[l]=i.constraints[l]||{},i.constraints[l][s]=h}else e.is_unrestricted.test(s)&&(n=s.match(e.parse_int).slice(1),i.unrestricted=i.unrestricted||{},n.forEach((function(t){t=t.replace(";",""),i.unrestricted[t]=1})));return i}(t):function(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",i={max:"<=",min:">=",equal:"="},r=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType)for(var s in e+=t.opType+":",t.variables)t.variables[s][s]=t.variables[s][s]?t.variables[s][s]:1,t.variables[s][t.optimize]&&(e+=" "+t.variables[s][t.optimize]+" "+s.replace(r,"_"));else e+="max:";for(var n in e+=";\n\n",t.constraints)for(var o in t.constraints[n])if(void 0!==i[o]){for(var a in t.variables)void 0!==t.variables[a][n]&&(e+=" "+t.variables[a][n]+" "+a.replace(r,"_"));e+=" "+i[o]+" "+t.constraints[n][o],e+=";\n"}if(t.ints)for(var l in e+="\n\n",t.ints)e+="int "+l.replace(r,"_")+";\n";if(t.unrestricted)for(var h in e+="\n\n",t.unrestricted)e+="unrestricted "+h.replace(r,"_")+";\n";return e}(t)};function oe(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})})),e}var ae=oe(Object.freeze({__proto__:null,default:{}}));function le(t){return(t=(t=t.replace("\\r\\n","\r\n")).split("\r\n")).filter((function(t){return!0!==new RegExp(" 0$","gi").test(t)&&!1!==new RegExp("\\d$","gi").test(t)})).map((function(t){return t.split(/\:{0,1} +(?=\d)/)})).reduce((function(t,e,i){return t[e[0]]=e[1],t}),{})}var he={lpsolve:{reformat:ne,solve:function(t){return new Promise((function(e,i){"undefined"!=typeof window&&i("Function Not Available in Browser");var r=ne(t);t.external||i("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||i("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||i("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||i("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),ae.writeFile(t.external.tempName,r,(function(r,s){if(r)i(r);else{var n=ae.execFile;t.external.args.push(t.external.tempName),n(t.external.binPath,t.external.args,(function(t,r){t?1===t.code?e(le(r)):i({code:t.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[t.code],data:r}):e(le(r))}))}}))}))}}},ce=function(t,e){var i,r,s,n,o,a=e.optimize,l=JSON.parse(JSON.stringify(e.optimize)),h=Object.keys(e.optimize),c=0,d={},u="",f={},p=[];for(delete e.optimize,r=0;r<h.length;r++)l[h[r]]=0;for(r=0;r<h.length;r++){for(o in e.optimize=h[r],e.opType=a[h[r]],i=t.Solve(e,void 0,void 0,!0),h)if(!e.variables[h[o]])for(n in i[h[o]]=i[h[o]]?i[h[o]]:0,e.variables)e.variables[n][h[o]]&&i[n]&&(i[h[o]]+=i[n]*e.variables[n][h[o]]);for(u="base",s=0;s<h.length;s++)u+=i[h[s]]?"-"+(1e3*i[h[s]]|0)/1e3:"-0";if(!d[u]){for(d[u]=1,c++,s=0;s<h.length;s++)i[h[s]]&&(l[h[s]]+=i[h[s]]);delete i.feasible,delete i.result,p.push(i)}}for(r=0;r<h.length;r++)e.constraints[h[r]]={equal:l[h[r]]/c};for(r in e.optimize="cheater-"+Math.random(),e.opType="max",e.variables)e.variables[r].cheater=1;for(r in p)for(n in p[r])f[n]=f[n]||{min:1e99,max:-1e99};for(r in f)for(n in p)p[n][r]?(p[n][r]>f[r].max&&(f[r].max=p[n][r]),p[n][r]<f[r].min&&(f[r].min=p[n][r])):(p[n][r]=0,f[r].min=0);return{midpoint:i=t.Solve(e,void 0,void 0,!0),vertices:p,ranges:f}},de=Wt.Constraint,ue=Wt.Variable,fe=Wt.Numeral,pe=Wt.Term,ge=function(){this.Model=re,this.branchAndCut=Xt,this.Constraint=de,this.Variable=ue,this.Numeral=fe,this.Term=pe,this.Tableau=qt,this.lastSolvedModel=null,this.External=he,this.Solve=function(t,e,i,r){if(r)for(var s in se)t=se[s](t);if(!t)throw new Error("Solver requires a model to operate on");if("object"==typeof t.optimize&&Object.keys(t.optimize>1))return ce(this,t);if(t.external){var n=Object.keys(he);if(n=JSON.stringify(n),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+n);if(!he[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+n);return he[t.external.solver].solve(t)}t instanceof re==0&&(t=new re(e).loadJson(t));var o=t.solve();if(this.lastSolvedModel=t,o.solutionSet=o.generateSolutionSet(),i)return o;var a={};return a.feasible=o.feasible,a.result=o.evaluation,a.bounded=o.bounded,o._tableau.__isIntegral&&(a.isIntegral=!0),Object.keys(o.solutionSet).forEach((function(t){0!==o.solutionSet[t]&&(a[t]=o.solutionSet[t])})),a},this.ReformatLP=ne,this.MultiObjective=function(t){return ce(this,t)}};"object"==typeof window?window.solver=new ge:"object"==typeof self&&(self.solver=new ge);var me=new ge;function be(){}function ve(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ye(t,e){let i;if(void 0===e)for(const r of t)null!=r&&(i<r||void 0===i&&r>=r)&&(i=r);else{let r=-1;for(let s of t)null!=(s=e(s,++r,t))&&(i<s||void 0===i&&s>=s)&&(i=s)}return i}function xe(t,e){let i;if(void 0===e)for(const r of t)null!=r&&(i>r||void 0===i&&r>=r)&&(i=r);else{let r=-1;for(let s of t)null!=(s=e(s,++r,t))&&(i>s||void 0===i&&s>=s)&&(i=s)}return i}function we(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function Se(t,e,i){if(r=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let i of t)null!=i&&(i=+i)>=i&&(yield i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(r=+r)>=r&&(yield r)}}(t,i))).length){if((e=+e)<=0||r<2)return xe(t);if(e>=1)return ye(t);var r,s=(r-1)*e,n=Math.floor(s),o=ye(function t(e,i,r=0,s=e.length-1,n=ve){for(;s>r;){if(s-r>600){const o=s-r+1,a=i-r+1,l=Math.log(o),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(o-h)/o)*(a-o/2<0?-1:1);t(e,i,Math.max(r,Math.floor(i-a*h/o+c)),Math.min(s,Math.floor(i+(o-a)*h/o+c)),n)}const o=e[i];let a=r,l=s;for(we(e,r,i),n(e[s],o)>0&&we(e,r,s);a<l;){for(we(e,a,l),++a,--l;n(e[a],o)<0;)++a;for(;n(e[l],o)>0;)--l}0===n(e[r],o)?we(e,r,l):(++l,we(e,l,s)),l<=i&&(r=l+1),i<=l&&(s=l-1)}return e}(t,n).subarray(0,n+1));return o+(xe(t.subarray(n+1))-o)*(s-n)}}function Ie(t,e){return+!(t instanceof Et)+ +!(e instanceof Et)}function Ce(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return function t(e,i,r,s,n,o,a){const[l,h]=n;function c(t){e(t);for(const e of t){const t=e.layer;if(void 0===t)throw new Error(`layering did not assign layer to node '${e.id}'`);if(t<0)throw new Error(`layering assigned a negative layer (${t}) to node '${e.id}'`)}const n=function(t){const e=[];for(const i of t.descendants()){const t=i.layer;(e[t]||(e[t]=[])).push(i),i.dataChildren=i.dataChildren.map(r=>{const s=r.child.layer;if(s<=t)throw new Error(`layering left child node "${r.child.id}" (${s}) with a greater or equal layer to parent node "${i.id}" (${t})`);let n=r.child;for(let o=s-1;o>t;o--){let t;t=a?`${i.id}->${r.child.id} (${o})`:`${i.id}\0${r.child.id}\0${o}`;const s=new Et(t);s.dataChildren.push(new ft(n,void 0)),(e[o]||(e[o]=[])).push(s),n=s}return new ft(n,r.data)})}return e}(t);if(1===n.length){const[t]=n;for(const e of t)e.y=h/2}else{const t=s?h:h/(n.length-1);for(const[e,i]of n.entries())for(const r of i)r.y=t*e}if(n.every(t=>1===t.length))for(const[e]of n)e.x=l/2;else if(1===n.length){const[t]=n;Pt(t,o);const e=t,i=s?e.length-1:1;for(const r of e)r.x*=l*i}else{i(n),r(n,o);for(const i of n)for(const t of i)if(void 0===t.x)throw new Error(`coord didn't assign an x to node '${t.id}'`);const t=n,e=s?Math.max(...n.map(t=>t.length))-1:1;for(const i of t)for(const t of i)t.x*=l*e}const c=t;return function(t){for(const e of t)e instanceof Et||(e.dataChildren=e.dataChildren.map(t=>{let i=t.child;const r=[{x:e.x,y:e.y}];for(;i instanceof Et;)r.push({x:i.x,y:i.y}),[i]=i.ichildren();return r.push({x:i.x,y:i.y}),new ft(i,t.data,r)}))}(c),c}return c.layering=function(l){return void 0===l?e:t(l,i,r,s,n,o,a)},c.decross=function(l){return void 0===l?i:t(e,l,r,s,n,o,a)},c.coord=function(l){return void 0===l?r:t(e,i,l,s,n,o,a)},c.size=function(l){return void 0!==l?t(e,i,r,!1,l,o,a):s?null:n},c.nodeSize=function(l){return void 0!==l?t(e,i,r,!0,l,o,a):s?n:null},c.separation=function(l){return void 0===l?o:t(e,i,r,s,n,l,a)},c.debug=function(l){return void 0===l?a:t(e,i,r,s,n,o,l)},c}(function(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return function t(e,i){const r=i?"":"\0",s=i?"rank: ":"\0",n=i?" -> ":"\0";function o(t){return`${r}${t.id}`}function a(t){return`${t.source.id}${n}${t.target.id}`}function l(t,e){return`${s}${t.id}${n}${e.id}`}function h(t){const i=Object.create(null),r=Object.create(null),s=Object.create(null),n=[];for(const a of t){const t=o(a);r[t]=1,i[t]={opt:a.children.length};const s=e(a);void 0!==s&&n.push([s,a])}for(const e of t.ilinks()){const t=i[o(e.source)],r=i[o(e.target)],n=a(e);s[n]={min:1},t[n]=-1,t.opt++,r[n]=1,r.opt--}let[h,...c]=n.sort(([t],[e])=>t-e);for(const e of c){const[t,r]=h,[n,a]=e,c=i[o(r)],d=i[o(a)],u=l(r,a);if(t<n)s[u]={min:1},c[u]=-1,d[u]=1;else{const t=l(a,r);s[u]={min:0},s[t]={min:0},c[u]=-1,c[t]=1,d[u]=1,d[t]=-1}h=e}const d=me.Solve({optimize:"opt",opType:"max",constraints:s,variables:i,ints:r}),{feasible:u}=d,f=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]])}return i}(d,["feasible"]);if(!u)throw n.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const e of t)e.layer=f[o(e)]||0}return h.rank=function(r){return void 0===r?e:t(r,i)},h.debug=function(r){return void 0===r?i:t(e,r)},h}(be,!1)}(),function(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return function t(e){function i(t){t.slice(0,t.length-1).forEach((i,r)=>e(i,t[r+1]))}return i.order=function(i){return void 0===i?e:t(i)},i}(function(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);return function(t,e){const i=new ut;for(const[n,o]of t.entries())for(const t of o.ichildren())i.setIfAbsent(t.id,[]).push(n);const r=new ut;let s=-1;for(const n of e){const e=Se(i.getDefault(n.id,[]),.5,void 0);void 0===e?(r.set(n.id,s),s=+!((s+1)/(t.length+1))*(t.length+1)-1):r.set(n.id,e)}e.sort((t,e)=>r.getThrow(t.id)-r.getThrow(e.id))}}())}(),function(...t){if(t.length)throw new Error(`got arguments to quad(${t}), but constructor takes no aruguments.`);return function t(e,i,r,s,n){function o(t,o,a){const l=function(t){const e=new ut;let i=0;for(const r of t)for(const t of r)e.set(t.id,i++);return e}(t),[h,c,d,u]=function(t,e,i){const r=1+Math.max(...e.values()),s=[],n=[];for(const a of t){let[t,...o]=a;for(const a of o){const o=e.getThrow(t.id),l=e.getThrow(a.id),h=new Array(r).fill(0);h[o]=1,h[l]=-1,s.push(h),n.push(-i(t,a)),t=a}}const o=new Array(r).fill(0);return[new Array(r).fill(null).map(()=>new Array(r).fill(0)),o,s,n]}(t,l,o);for(const n of t)for(const t of n){const n=l.getThrow(t.id),o=t instanceof Et?i:e;for(const a of t.ichildren()){const t=l.getThrow(a.id),c=a instanceof Et?s:r;kt(h,n,t,o+(a instanceof Et?i:e));for(const e of a.ichildren())At(h,n,t,l.getThrow(e.id),c)}}for(let[e,...i]of t)for(const t of i)a.getThrow(e.id)!==a.getThrow(t.id)&&kt(h,l.getThrow(e.id),l.getThrow(t.id),n),e=t;!function(t,e,i){const r=Math.min(...i),s=Math.max(...i)-r;if(s>0)for(const n of t)for(const t of n){const n=e.getThrow(t.id);t.x=(i[n]-r)/s}else for(const n of t)for(const t of n)t.x=.5}(t,l,function(t,e,i,r,s=0){e.pop(),t.pop(),t.forEach(t=>t.pop()),i.forEach(t=>t.pop());const n=function(t,e,i,r,s){const n=[[0]],o=[0],a=[[0]],l=[0];for(const d of t){const t=[0];t.push(...d),n.push(t)}o.push(...e),a.push(...e.map(()=>[0]));for(const d of i)for(const[t,e]of d.entries())a[t+1].push(-e);l.push(...r.map(t=>-t));const{solution:h,message:c}=Ct(n,o,a,l,s);if(c.length)throw new Error("quadprog failed with: "+c);return h.shift(),h}(t,e,i,r,s);return n.push(0),n}(h,c,d,u))}function a(t,n){if(0===e&&0===r)throw new Error("node vertical weight or node curve weight needs to be positive");if(0===i&&0===s)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const a=function(t){const e=new ut;for(const s of t.slice().reverse())for(const t of s){for(const i of t.ichildren())e.delete(i.id);e.set(t.id,t)}const i=new mt([...e.values()]).split(),r=new ut;for(const[s,n]of i.entries())for(const t of n)r.set(t.id,s);return r}(t);for(const e of function(t,e){const i=[];let r=[],s=new Set;for(const n of t){const t=new Set(n.map(t=>e.getThrow(t.id)));dt(s,t)||i.push(r=[]),r.push(n),s=t}return i}(t,a))if(e.every(t=>1===t.length))for(const[t]of e)t.x=.5;else if(1===e.length){const[t]=e;Pt(t,n)}else o(e,n,a)}return a.vertical=function(o){if(void 0===o)return[e,i];const[a,l]=o;if(a<0||l<0)throw new Error(`weights must be non-negative, but were ${a} and ${l}`);return t(a,l,r,s,n)},a.curve=function(o){if(void 0===o)return[r,s];const[a,l]=o;if(a<0||l<0)throw new Error(`weights must be non-negative, but were ${a} and ${l}`);return t(e,i,a,l,n)},a.component=function(o){if(void 0===o)return n;if(o<=0)throw new Error("weight must be positive, but was "+o);return t(e,i,r,s,o)},a}(1,0,0,1,1)}(),!1,[1,1],Ie,!1)}var Pe=function(t,e){return t<e};function ke(t){if(!(this instanceof ke))return new ke(t);this.array=[],this.size=0,this.compare=t||Pe}ke.prototype.clone=function(){var t=new ke(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},ke.prototype.add=function(t){var e,i,r=this.size;for(this.array[this.size]=t,this.size+=1;r>0&&this.compare(t,i=this.array[e=r-1>>1]);)this.array[r]=i,r=e;this.array[r]=t},ke.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},ke.prototype._percolateUp=function(t,e){for(var i,r,s=this.array[t];t>0&&(r=this.array[i=t-1>>1],e||this.compare(s,r));)this.array[t]=r,t=i;this.array[t]=s},ke.prototype._percolateDown=function(t){for(var e,i,r,s=this.size,n=this.size>>>1,o=this.array[t];t<n&&(r=this.array[e=1+(t<<1)],(i=e+1)<s&&this.compare(this.array[i],r)&&(e=i,r=this.array[i]),this.compare(r,o));)this.array[t]=r,t=e;this.array[t]=o},ke.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},ke.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},ke.prototype._batchRemove=function(t,e){var i=new Array(e||this.size),r=0;if("function"==typeof t&&this.size)for(var s=0;s<this.size&&r<i.length;)t(this.array[s])?(i[r]=this._removeAt(s),r++,s>>=1):s++;return i.length=r,i},ke.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},ke.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},ke.prototype.peek=function(){if(0!=this.size)return this.array[0]},ke.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},ke.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},ke.prototype.trim=function(){this.array=this.array.slice(0,this.size)},ke.prototype.isEmpty=function(){return 0===this.size},ke.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,i=this.clone();!i.isEmpty();)t(i.poll(),e++)},ke.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,i=this.array,r=new ke((function(t,r){return e(i[t],i[r])}));t=Math.min(this.size,t);var s=new Array(t),n=0;for(r.add(0);n<t;){var o=r.poll();s[n++]=this.array[o];var a=1+(o<<1),l=a+1;a<this.size&&r.add(a),l<this.size&&r.add(l)}return s};var Ae=i("EmTj"),Ee=i("NWgr"),Te=i("PBFl");const ze=["chart"],_e=["weightSlider"];function Ve(t,e){if(1&t){const t=o.Wb();o.Vb(0,"button",7),o.cc("click",(function(){return o.wc(t),o.gc().disconnect()})),o.Gc(1,"Disconnect"),o.Ub()}}let Me=(()=>{class t{constructor(t,e){this.bloomaResizeListenerService=t,this.dhDialogService=e,this._data=null,this.profileSelected=new o.p,this.itemWeightChanged=new o.p,this.childProfileWeightChanged=new o.p,this.addSubProfileToProfile=new o.p,this.addProfileItemToProfile=new o.p,this.addVirtualProfileItemToProfile=new o.p,this.disconnectLinkClicked=new o.p,this.treeItemDropped=new o.p,this.firstZoom=!0,this.sliderContainerStyle={width:"0",height:"0",padding:"0"},this.unsubscribe$=new l.a,this.viewInitialized=!1,this.margin={top:10,bottom:20,left:150,right:10},this.totalComponentWidth=0,this.isListening=!1,this.totalComponentHeight=0,this.nodeSquareWidth=100,this.nodeSquareHeight=60,this.draggableSquareDimension=10,this.dragStartX=0,this.dragStartY=0,this.dragX=0,this.dragY=0,this.linkColor="gray",this.selectedNodeColor="green",this.clickedLinkSource=null,this.clickedLinkTarget=null,this.weightTargetType=null,this.clickedLinkEvent=null,this.sliderElementHeight=124,this.sliderElementWidth=124,this.previousGraphAreaTransform=null,this.profileRectBorderColor="red",this.virtualProfileRectBorderColor="blue",this.profileItemRectBorderColor="black",this.profileRectBackgroundColor="rgb(235,199,199)",this.profileItemRectBackgroundColor="rgb(185,244,185)",this.virtualProfileRectBackgroundColor="rgb(199,235,243)",this.svgBackgroundColor="rgb(219,219,219)",this.getSquareIdForId=t=>"r"+t.replace(/\./g,"_");const i=new l.a;i.pipe(Object(T.a)(400),Object(a.a)(this.unsubscribe$)).subscribe(t=>this.createChart()),this.createSubject=i}get data(){return this._data}set data(t){this._data=t,this.createSubject.next()}get scores(){return this.scoresPrivate}set scores(t){this.scoresPrivate=t,this.createSubject.next()}ngOnDestroy(){this.bloomaResizeListenerService.unListenToElementResize(this.chartContainer.nativeElement),this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}listenToElementSizeChange(t){this.isListening||(this.isListening=!0,this.bloomaResizeListenerService.listenToElementResize(t).pipe(Object(a.a)(this.unsubscribe$)).subscribe(t=>{this.createSubject.next()}))}ngAfterViewInit(){this.viewInitialized=!0,this.listenToElementSizeChange(this.chartContainer.nativeElement),setTimeout(()=>{this.createSubject.next()},250)}createChart(){if(!this.viewInitialized)return;if(!this.data)return;const t=this.chartContainer.nativeElement;this.totalComponentWidth=t.offsetWidth,this.totalComponentHeight=t.offsetHeight,0!=this.totalComponentHeight&&(this.initSvg(),this.setSvgHeight(),this.drawHierarchy(),this.setUpZoomBehavior(),this.zoomFit(),setTimeout(()=>{Object(o.mb)(this)},300))}initSvg(){if(!this.svg){const t=z.m(this.chartContainer.nativeElement).append("svg");t.style("background","rgb(245,245,245)"),t.attr("class","main-svg"),this.svg=t;const e=5,i=5,r=e/2,s=i/2,n=[[0,0],[0,5],[5,2.5]];this.svg.append("defs").append("marker").attr("id","arrow").attr("viewBox",[0,0,e,i]).attr("refX",r).attr("refY",s).attr("markerWidth",e).attr("markerHeight",i).attr("orient","auto-start-reverse").append("path").attr("d",z.g()(n)).attr("stroke","black")}}setSvgHeight(){this.svg.attr("height",this.totalComponentHeight).attr("width",this.totalComponentWidth)}mouseOverProfile(t){this.dragTargetData=t}mouseLeaveProfile(t){this.dragTargetData=null}getDragBehavior(t){return z.e().clickDistance(5).container(t.node()).on("start",(t,e)=>{this.dragSourceType=e.data.itemType;const i="#"+this.getSquareIdForId(e.id),r=this.svg.select(i);if(null!=r&&0!=r.size()){this.dragSourceNode=r;try{const t=+r.attr("original-x"),e=+r.attr("original-y");this.dragX=this.dragStartX=t,this.dragY=this.dragStartY=e}catch(s){console.log(s)}t.sourceEvent.stopPropagation(),t.sourceEvent.preventDefault()}}).on("drag",(t,e)=>{if(0==this.dragStartX)return;this.dragX=t.x-t.subject.x,this.dragY=t.y-t.subject.y;const i=[[+this.dragStartX,+this.dragStartY],[this.dragStartX+this.dragX,this.dragStartY+this.dragY]],r=this.getDragLine(),s=z.g();r.attr("d",s(i))}).on("end",()=>{if(this.removeDragLine(),this.dragStartX=0,this.dragStartY=0,null!=this.dragSourceNode&&null!=this.dragTargetData&&"profile"===this.dragTargetData.data.itemType)return"profile"==this.dragSourceType?void this.connectProfiles():"virtual"==this.dragSourceType?void this.copyVirtualProfileItem():void this.copyProfileItem()})}connectProfiles(){var t;const e=null===(t=this.dragSourceNode.datum())||void 0===t?void 0:t.id,i=this.dragTargetData.id;if(e==i)return;const r=this.profileMap[i];this.changeIntroducesCycle(this.profileMap[e],i)||r.parentIds.find(t=>t==e)||this.addSubProfileToProfile.next({parentProfileId:e,subProfileId:r.id})}copyVirtualProfileItem(){var t;const e=null===(t=this.dragSourceNode.datum())||void 0===t?void 0:t.id,i=this.dragTargetData.id;if(e==i)return;const r=this.profileMap[e];this.changeIntroducesCycle(r,i)||this.addVirtualProfileItemToProfile.next({profileId:i,virtualProfileItem:r})}copyProfileItem(){var t;const e=null===(t=this.dragSourceNode.datum())||void 0===t?void 0:t.id,i=this.dragTargetData.id;if(e==i)return;const r=this.profileMap[e];this.changeIntroducesCycle(r,i)||this.addProfileItemToProfile.next({profileId:i,profileItemName:r.originalName})}getRectColorForItemType(t){switch(t){case"profile":return this.profileRectBorderColor;case"virtual":return this.virtualProfileRectBorderColor;default:return this.profileItemRectBorderColor}}getRectBackgroundColorForItemType(t){switch(t){case"profile":return this.profileRectBackgroundColor;case"virtual":return this.virtualProfileRectBackgroundColor;default:return this.profileItemRectBackgroundColor}}isProfile(t){return"profile"===t}isVirtualProfile(t){return"virtual"===t}changeIntroducesCycle(t,e){if(null==t.parentIds)return!1;if(null==t?void 0:t.parentIds.find(t=>t==e))return!0;for(const i of null==t?void 0:t.parentIds)if(1==this.changeIntroducesCycle(this.profileMap[i],e))return!0;return!1}removeDragLine(){this.svg.select(".drag-line").remove(),this.dragLine=null}getDragLine(){return this.dragLine||(this.dragLine=this.svg.select(".graph-area").append("path").attr("class","drag-line").style("stroke","red").style("fill","none")),this.dragLine}drawHierarchy(){const t=this.svg.select(".graph-area");if(this.previousGraphAreaTransform=null,t.size()>0){const e=t.node();this.previousGraphAreaTransform=z.s(e)}this.svg.select(".graph-area").remove();const e=function(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return function t(e,i,r){function s(t){if(!t.length)throw new Error("can't stratify empty data");const i=t.map((t,i)=>new gt(function(t){if("string"!=typeof t)throw new Error("id is supposed to be string but got type "+typeof t);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}(e(t,i)),t)),s=new Map;i.forEach(t=>{if(s.has(t.id))throw new Error("found a duplicate id: "+t.id);s.set(t.id,t)});const n=[];return i.forEach((t,e)=>{const i=r(t.data,e)||[];i.forEach(([e,i])=>{const r=s.get(e);if(!r)throw new Error("missing id: "+e);return r.dataChildren.push(new ft(t,i)),r}),i.length||n.push(t)}),function(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,i=new Set;let r=null;function s(t){if(e.has(t.id))return[];if(i.has(t.id))return r=t.id,[t.id];{i.add(t.id);let n=[];for(const e of t.ichildren())if(n=s(e),n.length)break;return i.delete(t.id),e.add(t.id),n.length&&null!==r&&n.push(t.id),r===t.id&&(r=null),n}}for(const n of t){const t=s(n);if(t.length)throw new Error("dag contained a cycle: "+t.reverse().join(" -> "))}for(const n of new mt(t))if(new Set(n.ichildren().map(t=>t.id)).size!==n.dataChildren.length)throw new Error(`node '${n.id}' contained duplicate children`)}(n),n.length>1?new mt(n):n[0]}return s.id=function(s){return void 0===s?e:t(s,i,r)},s.parentData=function(i){return void 0===i?r:t(e,function(t){function e(e,i){return(t(e,i)||[]).map(([t])=>t)}return e.wrapped=t,e}(i),i)},s.parentIds=function(r){return void 0===r?i:t(e,r,bt(r))},s}(vt,yt,bt(yt))}();if(!this.data||0==this.data.length)return;let i;try{i=e(this.data)}catch(h){return void this.dhDialogService.showMessage("error with local profile data. Please refresh")}const r=Ce().nodeSize([150,390])(i),s=this.svg.append("g").attr("class","graph-area"),n=r.descendants(),o=this.getDragBehavior(s),a=s.append("g").attr("class","links-group"),l=r.links();a.selectAll("line").data(l).enter().append("line").attr("class","line").attr("stroke",this.linkColor).attr("stroke-width","5").attr("marker-end","url(#arrow)").attr("data-id-source",t=>this.getSquareIdForId(t.source.id)).attr("data-id-target",t=>this.getSquareIdForId(t.target.id)).attr("x1",t=>this.margin.left+t.source.y).attr("y1",t=>this.margin.top+t.source.x).attr("y2",t=>this.margin.top+t.target.x).on("mouseover",(t,e)=>{z.m(t.srcElement).attr("stroke","red")}).on("mouseout",(t,e)=>{z.m(t.srcElement).attr("stroke",this.linkColor)}).on("click",(t,e)=>{this.isVirtualProfile(e.target.data.itemType)||(this.clickedLinkSource=e.source.id,this.clickedLinkTarget=e.target.data.originalId,this.weightTargetType="profile"===e.target.data.itemType?"childProfile":"item",this.clickedLinkEvent=t,z.m(t.srcElement).attr("stroke",this.linkColor),this.showWeightSlider())}).each((t,e,i)=>{const r=z.m(i[e]),s=this.calculateTargetBoxWidth(t.target.data.name);r.attr("x2",this.margin.left+t.target.y-s/2-5)}),s.append("g").attr("class","nodes-group").selectAll("g.node").data(n).enter().append("g").attr("class","node").attr("transform",t=>`translate(${this.margin.left+t.y},${this.margin.top+t.x})`).on("click",(t,e)=>{this.setSelectedNode(e,t)}).each((t,e,i)=>{const r=z.m(i[e]);let s=this.drawRectNode(r,t.id),{width:n,height:a}=this.drawText(r,t.data.name);this.setRectWidthAndHeight(s,n,a,t.x,t.y),this.drawDraggableCircle(r,t.id,n,o),this.setRectMouseEvents(s),this.drawScoresTextForNode(r,t.data)})}drawScoresTextForNode(t,e){var i,r,s,n,o,a,l,h,c,d;if(null!=this.scores[null===(i=this.selectedProfile)||void 0===i?void 0:i.id])if("profile"==e.itemType)if(0!=e.publicProfile||null!=e.parentIds&&0!=e.parentIds.length){const i=null===(l=null===(a=this.scores[null===(o=this.selectedProfile)||void 0===o?void 0:o.id])||void 0===a?void 0:a.map)||void 0===l?void 0:l.profileScores[e.id];this.drawScoresText(t,null==i?void 0:i.score)}else this.drawScoresText(t,null===(n=null===(s=null===(r=this.scores[e.id])||void 0===r?void 0:r.map)||void 0===s?void 0:s.rootScore)||void 0===n?void 0:n.totalScore);else if("virtual"!=e.itemType){const i=null===(d=null===(c=this.scores[null===(h=this.selectedProfile)||void 0===h?void 0:h.id])||void 0===c?void 0:c.map)||void 0===d?void 0:d.profileItemScores[e.id];this.drawScoresText(t,null==i?void 0:i.score)}}drawScoresText(t,e){null!=e&&t.append("text").attr("class","svg-text score-text").attr("dx",-40).attr("dy",-40).text(e)}setRectWidthAndHeight(t,e,i,r,s){t.attr("x",0-e/2).attr("y",-i/2).attr("width",e).attr("original-x",this.margin.left+s+e/2).attr("original-y",this.margin.top+r).attr("height",i)}setRectMouseEvents(t){t.attr("pointer-events","mouseover").on("mouseover",(t,e)=>{0!=this.dragStartX&&"profile"==e.data.itemType&&(t.target.setAttribute("stroke","red"),t.target.setAttribute("stroke-width",5),this.mouseOverProfile(e))}).on("mouseout",(t,e)=>{var i;null!=t.fromElement&&null!=t.toElement&&(t.fromElement.parentElement==t.toElement.parentElement&&"circle"!=t.toElement.tagName||(e.id!==(null===(i=this.selectedProfile)||void 0===i?void 0:i.id)&&(t.target.setAttribute("stroke-width",1),t.target.setAttribute("stroke",this.getRectColorForItemType(e.data.itemType))),this.mouseLeaveProfile(e)))})}drawRectNode(t,e){return t.append("rect").attr("id",this.getSquareIdForId(e)).attr("fill",t=>this.getRectBackgroundColorForItemType(t.data.itemType)).attr("stroke",t=>this.getRectColorForItemType(t.data.itemType)).attr("class","profile-container").attr("rx",15).classed("item-type-profile",t=>this.isProfile(t.data.itemType))}drawText(t,e){let i=t.append("text").attr("class","svg-text container-text").attr("dx",10).text(e).on("click",(t,e)=>{const i=new Event("click",{});t.srcElement.parentElement.firstChild.dispatchEvent(i)});const r=i.node().getBBox(),s=z.h([r.width+20,this.nodeSquareWidth]),n=z.h([r.height,this.nodeSquareHeight]);return i.attr("x",0-s/2),{width:s,height:n}}drawDraggableCircle(t,e,i,r){t.append("circle").attr("id","c"+e).attr("fill","purple").attr("r","8").attr("cx",i/2).attr("cy",0).attr("stroke","purple").call(r)}calculateTargetBoxWidth(t){const e=this.svg.append("text").attr("class","svg-text-to-remove").attr("dx",10).text(t),i=e.node().getBBox(),r=z.h([i.width+20,this.nodeSquareWidth]);return e.remove(),r}setSelectedNode(t,e){var i,r;this.setSelectedProfile(t),z.n(".profile-container").attr("stroke",t=>this.getRectColorForItemType(t.data.itemType)),z.m(null===(r=null===(i=null==e?void 0:e.srcElement)||void 0===i?void 0:i.parentElement)||void 0===r?void 0:r.firstElementChild).attr("stroke",this.selectedNodeColor)}saveNewWeight(){if(this.hideWeightSlider(),"item"==this.weightTargetType){const t=(new D).transform(this.clickedLinkSource,this.profileMap);this.itemWeightChanged.next({profileId:t,updateProfileItemWeightDto:{newWeight:this.selectedWeight,profileItemName:this.clickedLinkTarget}})}else this.childProfileWeightChanged.next({profileId:this.clickedLinkSource,subProfileId:this.clickedLinkTarget,updateSubProfileWeightDto:{newWeight:this.selectedWeight}})}hideWeightSlider(){z.m(this.weightSliderContainer.nativeElement).transition().duration(200).style("opacity",0),this.sliderContainerStyle={width:"0",height:"0",padding:"0"}}disconnect(){this.hideWeightSlider(),this.disconnectLinkClicked.next({profileId:this.clickedLinkSource,childProfileToDelete:this.clickedLinkTarget})}showWeightSlider(){var t;this.selectedWeight=null!==(t=this.getLinkWeight(this.clickedLinkSource,this.clickedLinkTarget))&&void 0!==t?t:0;const e=z.m(this.weightSliderContainer.nativeElement),i=this.selectTopForSlider(),r=this.selectLeftForSlider();this.sliderContainerStyle={width:"300px",left:r+"px",top:i+"px",padding:"10px"},e.transition().duration(200).style("opacity",1),Object(o.mb)(this)}selectTopForSlider(){return this.clickedLinkEvent.y+this.sliderElementHeight>=this.totalComponentHeight?this.totalComponentHeight-130:this.clickedLinkEvent.y}selectLeftForSlider(){return this.clickedLinkEvent.x+this.sliderElementWidth>=this.totalComponentWidth?this.totalComponentWidth-this.sliderElementWidth-10:this.clickedLinkEvent.x}weightChanged(t){this.selectedWeight=t.value}getLinkWeight(t,e){const i=(new D).transform(t,this.profileMap),r=this.weights[i];let s=r[e];s||(s=r[e.toUpperCase()]);const n=e.indexOf("_");return!s&&n>-1&&(s=r[e=e.substr(n+1)]),s}setUpZoomBehavior(){if(!this.data||0==this.data.length)return;const t=this.svg.select(".graph-area"),e=this.svg.select(".nodes-group").node();if(null==e)return;const i=e.getBBox(),r=[[0,0],[z.i([this.totalComponentWidth,i.width+this.margin.left+100]),z.i([this.totalComponentHeight,i.height])]],s=[[0,-100],[i.width+this.margin.left+100,i.height]],n=z.q().scaleExtent([.1,10]).extent(r).translateExtent(s).on("zoom",e=>{t.attr("transform",e.transform)});if(this.zoomBehavior=n,this.svg.call(n),this.previousGraphAreaTransform){if(1==this.previousGraphAreaTransform.k&&0==this.previousGraphAreaTransform.y&&0==this.previousGraphAreaTransform.x)return;this.svg.call(n.transform,this.previousGraphAreaTransform)}}setSelectedProfile(t){this.profileSelected.next({selectedNodeId:t.id,nodeType:t.data.itemType})}onDrop(t){if(null==t.event.target)return;const e=t.event.target.classList.contains("main-svg")?"independent":"sub",i="independent"===e?null:t.event.target.id.substring(1);this.treeItemDropped.next({dropTargetType:e,dropTargetId:i,droppedData:[t.element.data]})}allowDrop(t,e){var i,r,s;return!!(null===(i=e.target)||void 0===i?void 0:i.classList.contains("item-type-profile"))||!!(null===(s=null===(r=e.target)||void 0===r?void 0:r.previousSibling)||void 0===s?void 0:s.classList.contains("item-type-profile"))}zoomFit(){if(!this.firstZoom)return;const t=this.svg.select(".graph-area");if(!t)return;let e=t.node();if(!e)return;this.firstZoom=!1;const i=e.getBBox(),r=e.parentElement,s=r.clientWidth,n=r.clientHeight,o=i.width,a=i.height,l=i.x+o/2,h=i.y+a/2;if(0==o||0==a)return;const c=.8/Math.max(o/s,a/n),d=[s/2-c*l,n/2-c*h];this.svg.call(this.zoomBehavior.transform,z.r.translate(d[0],d[1]).scale(c))}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(_.a),o.Pb(Ae.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-hierarchy"]],viewQuery:function(t,e){if(1&t&&(o.Kc(ze,!0),o.Kc(_e,!0)),2&t){let t;o.tc(t=o.dc())&&(e.chartContainer=t.first),o.tc(t=o.dc())&&(e.weightSliderContainer=t.first)}},inputs:{data:"data",weights:"weights",profileMap:"profileMap",selectedProfile:"selectedProfile",scores:"scores"},outputs:{profileSelected:"profileSelected",itemWeightChanged:"itemWeightChanged",childProfileWeightChanged:"childProfileWeightChanged",addSubProfileToProfile:"addSubProfileToProfile",addProfileItemToProfile:"addProfileItemToProfile",addVirtualProfileItemToProfile:"addVirtualProfileItemToProfile",disconnectLinkClicked:"disconnectLinkClicked",treeItemDropped:"treeItemDropped"},decls:13,vars:5,consts:[["id","hierarchy-graph",1,"hierarchy-graph",3,"treeAllowDrop","treeDrop"],["chart",""],["id","weight-slider",1,"overflow-hidden",3,"ngStyle"],["weightSlider",""],["min","1","max","100","step","1",3,"ngModel","ngModelChange","input"],[1,"flex"],["mat-flat-button","","color","primary",1,"mx-2",3,"click"],["mat-flat-button","","color","warn",1,"mx-2",3,"click"],["class","mx-2","mat-flat-button","","color","warn",3,"click",4,"ngIf"]],template:function(t,e){1&t&&(o.Vb(0,"div",0,1),o.cc("treeDrop",(function(t){return e.onDrop(t)})),o.Ub(),o.Vb(2,"div",2,3),o.Vb(4,"div"),o.Gc(5),o.Ub(),o.Vb(6,"mat-slider",4),o.cc("ngModelChange",(function(t){return e.selectedWeight=t}))("input",(function(t){return e.weightChanged(t)})),o.Ub(),o.Vb(7,"div",5),o.Vb(8,"button",6),o.cc("click",(function(){return e.saveNewWeight()})),o.Gc(9,"Save"),o.Ub(),o.Vb(10,"button",7),o.cc("click",(function(){return e.hideWeightSlider()})),o.Gc(11,"Cancel"),o.Ub(),o.Ec(12,Ve,2,0,"button",8),o.Ub(),o.Ub()),2&t&&(o.mc("treeAllowDrop",e.allowDrop.bind(e)),o.Db(2),o.mc("ngStyle",e.sliderContainerStyle),o.Db(3),o.Ic("Weight: ",e.selectedWeight,""),o.Db(1),o.mc("ngModel",e.selectedWeight),o.Db(6),o.mc("ngIf","childProfile"==e.weightTargetType))},directives:[Ee.b,r.n,y.a,p.j,p.m,Te.b,r.m],styles:[".hierarchy-graph{height:inherit;width:inherit}.hierarchy-graph .svg-text{pointer-events:none;-webkit-user-select:none;user-select:none}.hierarchy-graph .score-text{fill:red;font-size:20px;font-weight:500;border:1px solid #000;font-style:italic}.hierarchy-graph svg{background:#d3d3d3}#weight-slider{background-color:#fff;color:#000;position:absolute;opacity:0;width:0}#weight-slider mat-slider{width:100%}"],encapsulation:2}),t})();var Oe=i("jOdJ"),Be=i("xJCX"),De=i("dgVI"),Re=i("HOZh"),Fe=i("+T6E"),je=i("qU21"),Le=i("2Bju"),Ne=i("IdLP");const Ue=["gutterEls"];function Ge(t,e){if(1&t){const t=o.Wb();o.Vb(0,"div",2,3),o.cc("mousedown",(function(e){o.wc(t);const i=o.gc().index;return o.gc().startDragging(e,2*i+1,i+1)}))("touchstart",(function(e){o.wc(t);const i=o.gc().index;return o.gc().startDragging(e,2*i+1,i+1)}))("mouseup",(function(e){o.wc(t);const i=o.gc().index;return o.gc().clickGutter(e,i+1)}))("touchend",(function(e){o.wc(t);const i=o.gc().index;return o.gc().clickGutter(e,i+1)})),o.Qb(2,"div",4),o.Ub()}if(2&t){const t=o.gc().index,e=o.gc();o.Bc("flex-basis",e.gutterSize,"px")("order",2*t+1)}}function We(t,e){1&t&&o.Ec(0,Ge,3,4,"div",1),2&t&&o.mc("ngIf",!1===e.last)}const $e=["*"];function He(t){return void 0!==t.changedTouches&&t.changedTouches.length>0?{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}:void 0!==t.clientX&&void 0!==t.clientY?{x:t.clientX,y:t.clientY}:null}function qe(t,e){const i=t.nativeElement.getBoundingClientRect();return"horizontal"===e?i.width:i.height}function Je(t){return"boolean"==typeof t?t:"false"!==t}function Ye(t,e){return null==t?e:(t=Number(t),!isNaN(t)&&t>=0?t:e)}function Qe(t,e){if("percent"===t){const t=e.reduce((t,e)=>null!==e?t+e:t,0);return e.every(t=>null!==t)&&t>99.9&&t<100.1}if("pixel"===t)return 1===e.filter(t=>null===t).length}function Xe(t){return null===t.size?null:!0===t.component.lockSize?t.size:null===t.component.minSize?null:t.component.minSize>t.size?t.size:t.component.minSize}function Ze(t){return null===t.size?null:!0===t.component.lockSize?t.size:null===t.component.maxSize?null:t.component.maxSize<t.size?t.size:t.component.maxSize}function Ke(t,e,i,r){return e.reduce((e,i)=>{const s=function(t,e,i,r){return 0===i?{areaSnapshot:e,pixelAbsorb:0,percentAfterAbsorption:e.sizePercentAtStart,pixelRemain:0}:0===e.sizePixelAtStart&&i<0?{areaSnapshot:e,pixelAbsorb:0,percentAfterAbsorption:0,pixelRemain:i}:"percent"===t?function(t,e,i){const r=(t.sizePixelAtStart+e)/i*100;if(e>0){if(null!==t.area.maxSize&&r>t.area.maxSize){const r=t.area.maxSize/100*i;return{areaSnapshot:t,pixelAbsorb:r,percentAfterAbsorption:t.area.maxSize,pixelRemain:t.sizePixelAtStart+e-r}}return{areaSnapshot:t,pixelAbsorb:e,percentAfterAbsorption:r>100?100:r,pixelRemain:0}}if(e<0){if(null!==t.area.minSize&&r<t.area.minSize){const r=t.area.minSize/100*i;return{areaSnapshot:t,pixelAbsorb:r,percentAfterAbsorption:t.area.minSize,pixelRemain:t.sizePixelAtStart+e-r}}return r<0?{areaSnapshot:t,pixelAbsorb:-t.sizePixelAtStart,percentAfterAbsorption:0,pixelRemain:e+t.sizePixelAtStart}:{areaSnapshot:t,pixelAbsorb:e,percentAfterAbsorption:r,pixelRemain:0}}}(e,i,r):"pixel"===t?function(t,e,i){const r=t.sizePixelAtStart+e;return e>0?null!==t.area.maxSize&&r>t.area.maxSize?{areaSnapshot:t,pixelAbsorb:t.area.maxSize-t.sizePixelAtStart,percentAfterAbsorption:-1,pixelRemain:r-t.area.maxSize}:{areaSnapshot:t,pixelAbsorb:e,percentAfterAbsorption:-1,pixelRemain:0}:e<0?null!==t.area.minSize&&r<t.area.minSize?{areaSnapshot:t,pixelAbsorb:t.area.minSize+e-r,percentAfterAbsorption:-1,pixelRemain:r-t.area.minSize}:r<0?{areaSnapshot:t,pixelAbsorb:-t.sizePixelAtStart,percentAfterAbsorption:-1,pixelRemain:e+t.sizePixelAtStart}:{areaSnapshot:t,pixelAbsorb:e,percentAfterAbsorption:-1,pixelRemain:0}:void 0}(e,i):void 0}(t,i,e.remain,r);return e.list.push(s),e.remain=s.pixelRemain,e},{remain:i,list:[]})}function ti(t,e){"percent"===t?e.areaSnapshot.area.size=e.percentAfterAbsorption:"pixel"===t&&null!==e.areaSnapshot.area.size&&(e.areaSnapshot.area.size=e.areaSnapshot.sizePixelAtStart+e.pixelAbsorb)}let ei=(()=>{class t{constructor(t,e,i,r){this.ngZone=t,this.elRef=e,this.cdRef=i,this.renderer=r,this._direction="horizontal",this._unit="percent",this._gutterSize=11,this._gutterStep=1,this._restrictMove=!1,this._useTransition=!1,this._disabled=!1,this._dir="ltr",this._gutterDblClickDuration=0,this.dragStart=new o.p(!1),this.dragEnd=new o.p(!1),this.gutterClick=new o.p(!1),this.gutterDblClick=new o.p(!1),this.dragProgressSubject=new l.a,this.dragProgress$=this.dragProgressSubject.asObservable(),this.isDragging=!1,this.isWaitingClear=!1,this.dragListeners=[],this.snapshot=null,this.startPoint=null,this.endPoint=null,this.displayedAreas=[],this.hidedAreas=[],this._clickTimeout=null,this.direction=this._direction}set direction(t){this._direction="vertical"===t?"vertical":"horizontal",this.renderer.addClass(this.elRef.nativeElement,"as-"+this._direction),this.renderer.removeClass(this.elRef.nativeElement,"as-"+("vertical"===this._direction?"horizontal":"vertical")),this.build(!1,!1)}get direction(){return this._direction}set unit(t){this._unit="pixel"===t?"pixel":"percent",this.renderer.addClass(this.elRef.nativeElement,"as-"+this._unit),this.renderer.removeClass(this.elRef.nativeElement,"as-"+("pixel"===this._unit?"percent":"pixel")),this.build(!1,!0)}get unit(){return this._unit}set gutterSize(t){this._gutterSize=Ye(t,11),this.build(!1,!1)}get gutterSize(){return this._gutterSize}set gutterStep(t){this._gutterStep=Ye(t,1)}get gutterStep(){return this._gutterStep}set restrictMove(t){this._restrictMove=Je(t)}get restrictMove(){return this._restrictMove}set useTransition(t){this._useTransition=Je(t),this._useTransition?this.renderer.addClass(this.elRef.nativeElement,"as-transition"):this.renderer.removeClass(this.elRef.nativeElement,"as-transition")}get useTransition(){return this._useTransition}set disabled(t){this._disabled=Je(t),this._disabled?this.renderer.addClass(this.elRef.nativeElement,"as-disabled"):this.renderer.removeClass(this.elRef.nativeElement,"as-disabled")}get disabled(){return this._disabled}set dir(t){this._dir="rtl"===t?"rtl":"ltr",this.renderer.setAttribute(this.elRef.nativeElement,"dir",this._dir)}get dir(){return this._dir}set gutterDblClickDuration(t){this._gutterDblClickDuration=Ye(t,0)}get gutterDblClickDuration(){return this._gutterDblClickDuration}get transitionEnd(){return new Ne.a(t=>this.transitionEndSubscriber=t).pipe(Object(T.a)(20))}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>this.renderer.addClass(this.elRef.nativeElement,"as-init"))})}getNbGutters(){return 0===this.displayedAreas.length?0:this.displayedAreas.length-1}addArea(t){const e={component:t,order:0,size:0,minSize:null,maxSize:null};!0===t.visible?(this.displayedAreas.push(e),this.build(!0,!0)):this.hidedAreas.push(e)}removeArea(t){if(this.displayedAreas.some(e=>e.component===t)){const e=this.displayedAreas.find(e=>e.component===t);this.displayedAreas.splice(this.displayedAreas.indexOf(e),1),this.build(!0,!0)}else if(this.hidedAreas.some(e=>e.component===t)){const e=this.hidedAreas.find(e=>e.component===t);this.hidedAreas.splice(this.hidedAreas.indexOf(e),1)}}updateArea(t,e,i){!0===t.visible&&this.build(e,i)}showArea(t){const e=this.hidedAreas.find(e=>e.component===t);if(void 0===e)return;const i=this.hidedAreas.splice(this.hidedAreas.indexOf(e),1);this.displayedAreas.push(...i),this.build(!0,!0)}hideArea(t){const e=this.displayedAreas.find(e=>e.component===t);if(void 0===e)return;const i=this.displayedAreas.splice(this.displayedAreas.indexOf(e),1);i.forEach(t=>{t.order=0,t.size=0}),this.hidedAreas.push(...i),this.build(!0,!0)}getVisibleAreaSizes(){return this.displayedAreas.map(t=>null===t.size?"*":t.size)}setVisibleAreaSizes(t){if(t.length!==this.displayedAreas.length)return!1;const e=t.map(t=>Ye(t,null));return!1!==Qe(this.unit,e)&&(this.displayedAreas.forEach((t,i)=>t.component._size=e[i]),this.build(!1,!0),!0)}build(t,e){if(this.stopDragging(),!0===t&&(this.displayedAreas.every(t=>null!==t.component.order)&&this.displayedAreas.sort((t,e)=>t.component.order-e.component.order),this.displayedAreas.forEach((t,e)=>{t.order=2*e,t.component.setStyleOrder(t.order)})),!0===e){const t=Qe(this.unit,this.displayedAreas.map(t=>t.component.size));switch(this.unit){case"percent":{const e=100/this.displayedAreas.length;this.displayedAreas.forEach(i=>{i.size=t?i.component.size:e,i.minSize=Xe(i),i.maxSize=Ze(i)});break}case"pixel":if(t)this.displayedAreas.forEach(t=>{t.size=t.component.size,t.minSize=Xe(t),t.maxSize=Ze(t)});else{const t=this.displayedAreas.filter(t=>null===t.component.size);if(0===t.length&&this.displayedAreas.length>0)this.displayedAreas.forEach((t,e)=>{t.size=0===e?null:t.component.size,t.minSize=0===e?null:Xe(t),t.maxSize=0===e?null:Ze(t)});else if(t.length>1){let t=!1;this.displayedAreas.forEach(e=>{null===e.component.size?!1===t?(e.size=null,e.minSize=null,e.maxSize=null,t=!0):(e.size=100,e.minSize=null,e.maxSize=null):(e.size=e.component.size,e.minSize=Xe(e),e.maxSize=Ze(e))})}}}}this.refreshStyleSizes(),this.cdRef.markForCheck()}refreshStyleSizes(){if("percent"===this.unit)if(1===this.displayedAreas.length)this.displayedAreas[0].component.setStyleFlex(0,0,"100%",!1,!1);else{const t=this.getNbGutters()*this.gutterSize;this.displayedAreas.forEach(e=>{e.component.setStyleFlex(0,0,`calc( ${e.size}% - ${e.size/100*t}px )`,null!==e.minSize&&e.minSize===e.size,null!==e.maxSize&&e.maxSize===e.size)})}else"pixel"===this.unit&&this.displayedAreas.forEach(t=>{null===t.size?t.component.setStyleFlex(1,1,1===this.displayedAreas.length?"100%":"auto",!1,!1):1===this.displayedAreas.length?t.component.setStyleFlex(0,0,"100%",!1,!1):t.component.setStyleFlex(0,0,t.size+"px",null!==t.minSize&&t.minSize===t.size,null!==t.maxSize&&t.maxSize===t.size)})}clickGutter(t,e){const i=He(t);this.startPoint&&this.startPoint.x===i.x&&this.startPoint.y===i.y&&(null!==this._clickTimeout?(window.clearTimeout(this._clickTimeout),this._clickTimeout=null,this.notify("dblclick",e),this.stopDragging()):this._clickTimeout=window.setTimeout(()=>{this._clickTimeout=null,this.notify("click",e),this.stopDragging()},this.gutterDblClickDuration))}startDragging(t,e,i){t.preventDefault(),t.stopPropagation(),this.startPoint=He(t),null!==this.startPoint&&!0!==this.disabled&&!0!==this.isWaitingClear&&(this.snapshot={gutterNum:i,lastSteppedOffset:0,allAreasSizePixel:qe(this.elRef,this.direction)-this.getNbGutters()*this.gutterSize,allInvolvedAreasSizePercent:100,areasBeforeGutter:[],areasAfterGutter:[]},this.displayedAreas.forEach(t=>{const i={area:t,sizePixelAtStart:qe(t.component.elRef,this.direction),sizePercentAtStart:"percent"===this.unit?t.size:-1};t.order<e?!0===this.restrictMove?this.snapshot.areasBeforeGutter=[i]:this.snapshot.areasBeforeGutter.unshift(i):t.order>e&&(!0===this.restrictMove?0===this.snapshot.areasAfterGutter.length&&(this.snapshot.areasAfterGutter=[i]):this.snapshot.areasAfterGutter.push(i))}),this.snapshot.allInvolvedAreasSizePercent=[...this.snapshot.areasBeforeGutter,...this.snapshot.areasAfterGutter].reduce((t,e)=>t+e.sizePercentAtStart,0),0!==this.snapshot.areasBeforeGutter.length&&0!==this.snapshot.areasAfterGutter.length&&(this.dragListeners.push(this.renderer.listen("document","mouseup",this.stopDragging.bind(this))),this.dragListeners.push(this.renderer.listen("document","touchend",this.stopDragging.bind(this))),this.dragListeners.push(this.renderer.listen("document","touchcancel",this.stopDragging.bind(this))),this.ngZone.runOutsideAngular(()=>{this.dragListeners.push(this.renderer.listen("document","mousemove",this.dragEvent.bind(this))),this.dragListeners.push(this.renderer.listen("document","touchmove",this.dragEvent.bind(this)))}),this.displayedAreas.forEach(t=>t.component.lockEvents()),this.isDragging=!0,this.renderer.addClass(this.elRef.nativeElement,"as-dragging"),this.renderer.addClass(this.gutterEls.toArray()[this.snapshot.gutterNum-1].nativeElement,"as-dragged"),this.notify("start",this.snapshot.gutterNum)))}dragEvent(t){if(t.preventDefault(),t.stopPropagation(),null!==this._clickTimeout&&(window.clearTimeout(this._clickTimeout),this._clickTimeout=null),!1===this.isDragging)return;if(this.endPoint=He(t),null===this.endPoint)return;let e="horizontal"===this.direction?this.startPoint.x-this.endPoint.x:this.startPoint.y-this.endPoint.y;"rtl"===this.dir&&(e=-e);const i=Math.round(e/this.gutterStep)*this.gutterStep;if(i===this.snapshot.lastSteppedOffset)return;this.snapshot.lastSteppedOffset=i;let r=Ke(this.unit,this.snapshot.areasBeforeGutter,-i,this.snapshot.allAreasSizePixel),s=Ke(this.unit,this.snapshot.areasAfterGutter,i,this.snapshot.allAreasSizePixel);if(0!==r.remain&&0!==s.remain?Math.abs(r.remain)===Math.abs(s.remain)||(Math.abs(r.remain)>Math.abs(s.remain)?s=Ke(this.unit,this.snapshot.areasAfterGutter,i+r.remain,this.snapshot.allAreasSizePixel):r=Ke(this.unit,this.snapshot.areasBeforeGutter,-(i-s.remain),this.snapshot.allAreasSizePixel)):0!==r.remain?s=Ke(this.unit,this.snapshot.areasAfterGutter,i+r.remain,this.snapshot.allAreasSizePixel):0!==s.remain&&(r=Ke(this.unit,this.snapshot.areasBeforeGutter,-(i-s.remain),this.snapshot.allAreasSizePixel)),"percent"===this.unit){const t=[...r.list,...s.list],e=t.find(t=>0!==t.percentAfterAbsorption&&t.percentAfterAbsorption!==t.areaSnapshot.area.minSize&&t.percentAfterAbsorption!==t.areaSnapshot.area.maxSize);e&&(e.percentAfterAbsorption=this.snapshot.allInvolvedAreasSizePercent-t.filter(t=>t!==e).reduce((t,e)=>t+e.percentAfterAbsorption,0))}r.list.forEach(t=>ti(this.unit,t)),s.list.forEach(t=>ti(this.unit,t)),this.refreshStyleSizes(),this.notify("progress",this.snapshot.gutterNum)}stopDragging(t){if(t&&(t.preventDefault(),t.stopPropagation()),!1!==this.isDragging){for(this.displayedAreas.forEach(t=>t.component.unlockEvents());this.dragListeners.length>0;){const t=this.dragListeners.pop();t&&t()}this.isDragging=!1,!this.endPoint||this.startPoint.x===this.endPoint.x&&this.startPoint.y===this.endPoint.y||this.notify("end",this.snapshot.gutterNum),this.renderer.removeClass(this.elRef.nativeElement,"as-dragging"),this.renderer.removeClass(this.gutterEls.toArray()[this.snapshot.gutterNum-1].nativeElement,"as-dragged"),this.snapshot=null,this.isWaitingClear=!0,this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.startPoint=null,this.endPoint=null,this.isWaitingClear=!1})})}}notify(t,e){const i=this.getVisibleAreaSizes();"start"===t?this.dragStart.emit({gutterNum:e,sizes:i}):"end"===t?this.dragEnd.emit({gutterNum:e,sizes:i}):"click"===t?this.gutterClick.emit({gutterNum:e,sizes:i}):"dblclick"===t?this.gutterDblClick.emit({gutterNum:e,sizes:i}):"transitionEnd"===t?this.transitionEndSubscriber&&this.ngZone.run(()=>this.transitionEndSubscriber.next(i)):"progress"===t&&this.dragProgressSubject.next({gutterNum:e,sizes:i})}ngOnDestroy(){this.stopDragging()}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(o.B),o.Pb(o.m),o.Pb(o.i),o.Pb(o.G))},t.\u0275cmp=o.Jb({type:t,selectors:[["as-split"]],viewQuery:function(t,e){if(1&t&&o.Kc(Ue,!0),2&t){let t;o.tc(t=o.dc())&&(e.gutterEls=t)}},inputs:{direction:"direction",unit:"unit",gutterSize:"gutterSize",gutterStep:"gutterStep",restrictMove:"restrictMove",useTransition:"useTransition",disabled:"disabled",dir:"dir",gutterDblClickDuration:"gutterDblClickDuration"},outputs:{dragStart:"dragStart",dragEnd:"dragEnd",gutterClick:"gutterClick",gutterDblClick:"gutterDblClick",transitionEnd:"transitionEnd"},exportAs:["asSplit"],ngContentSelectors:$e,decls:2,vars:1,consts:[["ngFor","",3,"ngForOf"],["class","as-split-gutter",3,"flex-basis","order","mousedown","touchstart","mouseup","touchend",4,"ngIf"],[1,"as-split-gutter",3,"mousedown","touchstart","mouseup","touchend"],["gutterEls",""],[1,"as-split-gutter-icon"]],template:function(t,e){1&t&&(o.lc(),o.kc(0),o.Ec(1,We,1,1,"ng-template",0)),2&t&&(o.Db(1),o.mc("ngForOf",e.displayedAreas))},directives:[r.l,r.m],styles:['[_nghost-%COMP%]{display:flex;flex-wrap:nowrap;justify-content:flex-start;align-items:stretch;overflow:hidden;width:100%;height:100%}[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{flex-grow:0;flex-shrink:0;background-color:#eee;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%] > .as-split-gutter-icon[_ngcontent-%COMP%]{width:100%;height:100%;background-position:center center;background-repeat:no-repeat}[_nghost-%COMP%]    >.as-split-area{flex-grow:0;flex-shrink:0;overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]    >.as-split-area.as-hidden{flex:0 1 0px!important;overflow-x:hidden;overflow-y:hidden}.as-horizontal[_nghost-%COMP%]{flex-direction:row}.as-horizontal[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{flex-direction:row;cursor:col-resize;height:100%}.as-horizontal[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%] > .as-split-gutter-icon[_ngcontent-%COMP%]{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==)}.as-horizontal[_nghost-%COMP%]    >.as-split-area{height:100%}.as-vertical[_nghost-%COMP%]{flex-direction:column}.as-vertical[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{flex-direction:column;cursor:row-resize;width:100%}.as-vertical[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]   .as-split-gutter-icon[_ngcontent-%COMP%]{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFCAMAAABl/6zIAAAABlBMVEUAAADMzMzIT8AyAAAAAXRSTlMAQObYZgAAABRJREFUeAFjYGRkwIMJSeMHlBkOABP7AEGzSuPKAAAAAElFTkSuQmCC)}.as-vertical[_nghost-%COMP%]    >.as-split-area{width:100%}.as-vertical[_nghost-%COMP%]    >.as-split-area.as-hidden{max-width:0}.as-disabled[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{cursor:default}.as-disabled[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]   .as-split-gutter-icon[_ngcontent-%COMP%]{background-image:url("")}.as-transition.as-init[_nghost-%COMP%]:not(.as-dragging)    >.as-split-area, .as-transition.as-init[_nghost-%COMP%]:not(.as-dragging) > .as-split-gutter[_ngcontent-%COMP%]{transition:flex-basis .3s}'],changeDetection:0}),t})(),ii=(()=>{class t{constructor(t,e,i,r){this.ngZone=t,this.elRef=e,this.renderer=i,this.split=r,this._order=null,this._size=null,this._minSize=null,this._maxSize=null,this._lockSize=!1,this._visible=!0,this.lockListeners=[],this.renderer.addClass(this.elRef.nativeElement,"as-split-area")}set order(t){this._order=Ye(t,null),this.split.updateArea(this,!0,!1)}get order(){return this._order}set size(t){this._size=Ye(t,null),this.split.updateArea(this,!1,!0)}get size(){return this._size}set minSize(t){this._minSize=Ye(t,null),this.split.updateArea(this,!1,!0)}get minSize(){return this._minSize}set maxSize(t){this._maxSize=Ye(t,null),this.split.updateArea(this,!1,!0)}get maxSize(){return this._maxSize}set lockSize(t){this._lockSize=Je(t),this.split.updateArea(this,!1,!0)}get lockSize(){return this._lockSize}set visible(t){this._visible=Je(t),this._visible?(this.split.showArea(this),this.renderer.removeClass(this.elRef.nativeElement,"as-hidden")):(this.split.hideArea(this),this.renderer.addClass(this.elRef.nativeElement,"as-hidden"))}get visible(){return this._visible}ngOnInit(){this.split.addArea(this),this.ngZone.runOutsideAngular(()=>{this.transitionListener=this.renderer.listen(this.elRef.nativeElement,"transitionend",t=>{"flex-basis"===t.propertyName&&this.split.notify("transitionEnd",-1)})})}setStyleOrder(t){this.renderer.setStyle(this.elRef.nativeElement,"order",t)}setStyleFlex(t,e,i,r,s){this.renderer.setStyle(this.elRef.nativeElement,"flex-grow",t),this.renderer.setStyle(this.elRef.nativeElement,"flex-shrink",e),this.renderer.setStyle(this.elRef.nativeElement,"flex-basis",i),!0===r?this.renderer.addClass(this.elRef.nativeElement,"as-min"):this.renderer.removeClass(this.elRef.nativeElement,"as-min"),!0===s?this.renderer.addClass(this.elRef.nativeElement,"as-max"):this.renderer.removeClass(this.elRef.nativeElement,"as-max")}lockEvents(){this.ngZone.runOutsideAngular(()=>{this.lockListeners.push(this.renderer.listen(this.elRef.nativeElement,"selectstart",t=>!1)),this.lockListeners.push(this.renderer.listen(this.elRef.nativeElement,"dragstart",t=>!1))})}unlockEvents(){for(;this.lockListeners.length>0;){const t=this.lockListeners.pop();t&&t()}}ngOnDestroy(){this.unlockEvents(),this.transitionListener&&this.transitionListener(),this.split.removeArea(this)}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(o.B),o.Pb(o.m),o.Pb(o.G),o.Pb(ei))},t.\u0275dir=o.Kb({type:t,selectors:[["as-split-area"],["","as-split-area",""]],inputs:{order:"order",size:"size",minSize:"minSize",maxSize:"maxSize",lockSize:"lockSize",visible:"visible"},exportAs:["asSplitArea"]}),t})(),ri=(()=>{class t{static forRoot(){return{ngModule:t,providers:[]}}static forChild(){return{ngModule:t,providers:[]}}}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},imports:[[r.c]]}),t})();var si=i("yDe4"),ni=i("6vhs"),oi=i("9DO8");let ai=(()=>{class t{constructor(t){this.store=t}setAvailableFieldsFromJsonFile(t){return Object(n.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new ni.b(t)).toPromise(),this.store.selectSnapshot(oi.a.getAvailableFieldsError)}))}setAvailableFieldsFromExcelFile(t){return Object(n.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new ni.a(t)).toPromise(),this.store.selectSnapshot(oi.a.getAvailableFieldsError)}))}}return t.\u0275fac=function(e){return new(e||t)(o.Zb(si.j))},t.\u0275prov=o.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),Object(n.b)([Object(si.f)(oi.a.getAvailableFields)],t.prototype,"availableFields$",void 0),t})();const li=["availableFileInput"];function hi(t,e){if(1&t){const t=o.Wb();o.Vb(0,"button",6),o.cc("click",(function(){o.wc(t);const e=o.gc().ngIf;return o.gc().scoreLoadedFile(e)})),o.Gc(1," Score "),o.Ub()}}function ci(t,e){if(1&t&&(o.Tb(0),o.Ec(1,hi,2,0,"button",5),o.Sb()),2&t){const t=e.ngIf;o.Db(1),o.mc("ngIf",0==(null==t.parentIds?null:t.parentIds.length)&&"profile"==t.itemType)}}let di=(()=>{class t{constructor(t,e,i,r){this.availableFieldsStateService=t,this.scoreStateService=e,this.dhDialogService=i,this.profileStateService=r,this.fileTypeToRead="none"}loadAvailableFieldsFromJson(){this.fileTypeToRead="json",this.showFileSelection()}loadAvailableFieldsFromExcel(){this.fileTypeToRead="excel",this.showFileSelection()}loadScoreFile(){this.fileTypeToRead="score",this.showFileSelection()}showFileSelection(){this.availableFileInput.nativeElement.value="",this.availableFileInput.nativeElement.click()}fileLoaded(t){return Object(n.a)(this,void 0,void 0,(function*(){const e=t.target.files[0];this.dhDialogService.showLoading(),(yield this.loadAvailableFieldsFromServer(e))&&this.dhDialogService.showErrorMessage("Could not load available fields from server"),this.dhDialogService.hideLoading()}))}loadAvailableFieldsFromServer(t){return Object(n.a)(this,void 0,void 0,(function*(){switch(this.fileTypeToRead){case"json":return yield this.loadAvailableFieldsForJsonFromServer(t);case"excel":return yield this.loadAvailableFieldsForExcelFromServer(t);case"score":return yield this.scoreFile(t)}}))}loadAvailableFieldsForJsonFromServer(t){return Object(n.a)(this,void 0,void 0,(function*(){return yield this.availableFieldsStateService.setAvailableFieldsFromJsonFile(t)}))}loadAvailableFieldsForExcelFromServer(t){return Object(n.a)(this,void 0,void 0,(function*(){return yield this.availableFieldsStateService.setAvailableFieldsFromExcelFile(t)}))}scoreLoadedFile(t){this.selectedProfile=t,this.loadScoreFile()}scoreFile(t){return Object(n.a)(this,void 0,void 0,(function*(){const e=yield this.scoreStateService.scoreExcelFile({profileId:this.selectedProfile.id,file:[t]});null!=e&&this.dhDialogService.showErrorMessage("Could not score excel file: "+e)}))}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(ai),o.Pb(Fe.a),o.Pb(Ae.a),o.Pb(c.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-load-available-button"]],viewQuery:function(t,e){if(1&t&&o.Kc(li,!0),2&t){let t;o.tc(t=o.dc())&&(e.availableFileInput=t.first)}},decls:9,vars:3,consts:[["mat-raised-button","","color","primary","matTooltip","Load Schema File",1,"mr-4","mb-2",3,"click"],["mat-raised-button","","color","primary","matTooltip","Load Excel Schema File",1,"mr-4","mb-2",3,"click"],[4,"ngIf"],["type","file","name","inputfile","id","inputfile",2,"display","none",3,"change"],["availableFileInput",""],["mat-raised-button","","color","primary","matTooltip","Score selected profile",3,"click",4,"ngIf"],["mat-raised-button","","color","primary","matTooltip","Score selected profile",3,"click"]],template:function(t,e){1&t&&(o.Vb(0,"div"),o.Vb(1,"button",0),o.cc("click",(function(){return e.loadAvailableFieldsFromJson()})),o.Gc(2," Load Json "),o.Ub(),o.Vb(3,"button",1),o.cc("click",(function(){return e.loadAvailableFieldsFromExcel()})),o.Gc(4," Load Excel "),o.Ub(),o.Ec(5,ci,2,1,"ng-container",2),o.hc(6,"async"),o.Vb(7,"input",3,4),o.cc("change",(function(t){return e.fileLoaded(t)})),o.Ub(),o.Ub()),2&t&&(o.Db(5),o.mc("ngIf",o.ic(6,1,e.profileStateService.selectedProfile$)))},directives:[Te.b,r.m],pipes:[r.b],styles:[""],changeDetection:0}),t})();function ui(t,e){if(1&t&&(o.Tb(0),o.Qb(1,"tree-root",1),o.Sb()),2&t){const t=e.ngIf,i=o.gc();o.Db(1),o.mc("nodes",t)("options",i.options)}}let fi=(()=>{class t{constructor(t){this.availableFieldsStateService=t,this.options={allowDrag:!0}}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(ai))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-available-tree"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"nodes","options"]],template:function(t,e){1&t&&(o.Ec(0,ui,2,2,"ng-container",0),o.hc(1,"async")),2&t&&o.mc("ngIf",o.ic(1,1,e.availableFieldsStateService.availableFields$))},directives:[r.m,Ee.a],pipes:[r.b],styles:[""]}),t})();var pi=i("5XID"),gi=i("cqs0"),mi=i("mFH5"),bi=i("sg/T");const vi=["button"],yi=["*"],xi=new o.s("MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS"),wi=new o.s("MatButtonToggleGroup"),Si={provide:p.h,useExisting:Object(o.V)(()=>Pi),multi:!0};let Ii=0;class Ci{constructor(t,e){this.source=t,this.value=e}}let Pi=(()=>{class t{constructor(t,e){this._changeDetector=t,this._vertical=!1,this._multiple=!1,this._disabled=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{},this._name="mat-button-toggle-group-"+Ii++,this.valueChange=new o.p,this.change=new o.p,this.appearance=e&&e.appearance?e.appearance:"standard"}get name(){return this._name}set name(t){this._name=t,this._buttonToggles&&this._buttonToggles.forEach(t=>{t.name=this._name,t._markForCheck()})}get vertical(){return this._vertical}set vertical(t){this._vertical=Object(pi.c)(t)}get value(){const t=this._selectionModel?this._selectionModel.selected:[];return this.multiple?t.map(t=>t.value):t[0]?t[0].value:void 0}set value(t){this._setSelectionByValue(t),this.valueChange.emit(this.value)}get selected(){const t=this._selectionModel?this._selectionModel.selected:[];return this.multiple?t:t[0]||null}get multiple(){return this._multiple}set multiple(t){this._multiple=Object(pi.c)(t)}get disabled(){return this._disabled}set disabled(t){this._disabled=Object(pi.c)(t),this._buttonToggles&&this._buttonToggles.forEach(t=>t._markForCheck())}ngOnInit(){this._selectionModel=new gi.c(this.multiple,void 0,!1)}ngAfterContentInit(){this._selectionModel.select(...this._buttonToggles.filter(t=>t.checked))}writeValue(t){this.value=t,this._changeDetector.markForCheck()}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t}_emitChangeEvent(){const t=this.selected,e=Array.isArray(t)?t[t.length-1]:t,i=new Ci(e,this.value);this._controlValueAccessorChangeFn(i.value),this.change.emit(i)}_syncButtonToggle(t,e,i=!1,r=!1){this.multiple||!this.selected||t.checked||(this.selected.checked=!1),this._selectionModel?e?this._selectionModel.select(t):this._selectionModel.deselect(t):r=!0,r?Promise.resolve().then(()=>this._updateModelValue(i)):this._updateModelValue(i)}_isSelected(t){return this._selectionModel&&this._selectionModel.isSelected(t)}_isPrechecked(t){return void 0!==this._rawValue&&(this.multiple&&Array.isArray(this._rawValue)?this._rawValue.some(e=>null!=t.value&&e===t.value):t.value===this._rawValue)}_setSelectionByValue(t){this._rawValue=t,this._buttonToggles&&(this.multiple&&t?(Array.isArray(t),this._clearSelection(),t.forEach(t=>this._selectValue(t))):(this._clearSelection(),this._selectValue(t)))}_clearSelection(){this._selectionModel.clear(),this._buttonToggles.forEach(t=>t.checked=!1)}_selectValue(t){const e=this._buttonToggles.find(e=>null!=e.value&&e.value===t);e&&(e.checked=!0,this._selectionModel.select(e))}_updateModelValue(t){t&&this._emitChangeEvent(),this.valueChange.emit(this.value)}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(o.i),o.Pb(xi,8))},t.\u0275dir=o.Kb({type:t,selectors:[["mat-button-toggle-group"]],contentQueries:function(t,e,i){if(1&t&&o.Ib(i,Ei,!0),2&t){let t;o.tc(t=o.dc())&&(e._buttonToggles=t)}},hostAttrs:["role","group",1,"mat-button-toggle-group"],hostVars:5,hostBindings:function(t,e){2&t&&(o.Eb("aria-disabled",e.disabled),o.Hb("mat-button-toggle-vertical",e.vertical)("mat-button-toggle-group-appearance-standard","standard"===e.appearance))},inputs:{appearance:"appearance",name:"name",vertical:"vertical",value:"value",multiple:"multiple",disabled:"disabled"},outputs:{valueChange:"valueChange",change:"change"},exportAs:["matButtonToggleGroup"],features:[o.Cb([Si,{provide:wi,useExisting:t}])]}),t})();class ki{}const Ai=Object(mi.p)(ki);let Ei=(()=>{class t extends Ai{constructor(t,e,i,r,s,n){super(),this._changeDetectorRef=e,this._elementRef=i,this._focusMonitor=r,this._isSingleSelector=!1,this._checked=!1,this.ariaLabelledby=null,this._disabled=!1,this.change=new o.p;const a=Number(s);this.tabIndex=a||0===a?a:null,this.buttonToggleGroup=t,this.appearance=n&&n.appearance?n.appearance:"standard"}get buttonId(){return this.id+"-button"}get appearance(){return this.buttonToggleGroup?this.buttonToggleGroup.appearance:this._appearance}set appearance(t){this._appearance=t}get checked(){return this.buttonToggleGroup?this.buttonToggleGroup._isSelected(this):this._checked}set checked(t){const e=Object(pi.c)(t);e!==this._checked&&(this._checked=e,this.buttonToggleGroup&&this.buttonToggleGroup._syncButtonToggle(this,this._checked),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled||this.buttonToggleGroup&&this.buttonToggleGroup.disabled}set disabled(t){this._disabled=Object(pi.c)(t)}ngOnInit(){const t=this.buttonToggleGroup;this._isSingleSelector=t&&!t.multiple,this.id=this.id||"mat-button-toggle-"+Ii++,this._isSingleSelector&&(this.name=t.name),t&&(t._isPrechecked(this)?this.checked=!0:t._isSelected(this)!==this._checked&&t._syncButtonToggle(this,this._checked))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){const t=this.buttonToggleGroup;this._focusMonitor.stopMonitoring(this._elementRef),t&&t._isSelected(this)&&t._syncButtonToggle(this,!1,!1,!0)}focus(t){this._buttonElement.nativeElement.focus(t)}_onButtonClick(){const t=!!this._isSingleSelector||!this._checked;t!==this._checked&&(this._checked=t,this.buttonToggleGroup&&(this.buttonToggleGroup._syncButtonToggle(this,this._checked,!0),this.buttonToggleGroup._onTouched())),this.change.emit(new Ci(this,this.value))}_markForCheck(){this._changeDetectorRef.markForCheck()}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(wi,8),o.Pb(o.i),o.Pb(o.m),o.Pb(bi.e),o.ac("tabindex"),o.Pb(xi,8))},t.\u0275cmp=o.Jb({type:t,selectors:[["mat-button-toggle"]],viewQuery:function(t,e){if(1&t&&o.Kc(vi,!0),2&t){let t;o.tc(t=o.dc())&&(e._buttonElement=t.first)}},hostAttrs:["role","presentation",1,"mat-button-toggle"],hostVars:12,hostBindings:function(t,e){1&t&&o.cc("focus",(function(){return e.focus()})),2&t&&(o.Eb("aria-label",null)("aria-labelledby",null)("id",e.id)("name",null),o.Hb("mat-button-toggle-standalone",!e.buttonToggleGroup)("mat-button-toggle-checked",e.checked)("mat-button-toggle-disabled",e.disabled)("mat-button-toggle-appearance-standard","standard"===e.appearance))},inputs:{disableRipple:"disableRipple",ariaLabelledby:["aria-labelledby","ariaLabelledby"],tabIndex:"tabIndex",appearance:"appearance",checked:"checked",disabled:"disabled",id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],value:"value"},outputs:{change:"change"},exportAs:["matButtonToggle"],features:[o.Ab],ngContentSelectors:yi,decls:6,vars:9,consts:[["type","button",1,"mat-button-toggle-button","mat-focus-indicator",3,"id","disabled","click"],["button",""],[1,"mat-button-toggle-label-content"],[1,"mat-button-toggle-focus-overlay"],["matRipple","",1,"mat-button-toggle-ripple",3,"matRippleTrigger","matRippleDisabled"]],template:function(t,e){if(1&t&&(o.lc(),o.Vb(0,"button",0,1),o.cc("click",(function(){return e._onButtonClick()})),o.Vb(2,"span",2),o.kc(3),o.Ub(),o.Ub(),o.Qb(4,"span",3),o.Qb(5,"span",4)),2&t){const t=o.uc(1);o.mc("id",e.buttonId)("disabled",e.disabled||null),o.Eb("tabindex",e.disabled?-1:e.tabIndex)("aria-pressed",e.checked)("name",e.name||null)("aria-label",e.ariaLabel)("aria-labelledby",e.ariaLabelledby),o.Db(5),o.mc("matRippleTrigger",t)("matRippleDisabled",e.disableRipple||e.disabled)}},directives:[mi.k],styles:[".mat-button-toggle-standalone,.mat-button-toggle-group{position:relative;display:inline-flex;flex-direction:row;white-space:nowrap;overflow:hidden;border-radius:2px;-webkit-tap-highlight-color:transparent}.cdk-high-contrast-active .mat-button-toggle-standalone,.cdk-high-contrast-active .mat-button-toggle-group{outline:solid 1px}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.mat-button-toggle-group-appearance-standard{border-radius:4px}.cdk-high-contrast-active .mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.cdk-high-contrast-active .mat-button-toggle-group-appearance-standard{outline:0}.mat-button-toggle-vertical{flex-direction:column}.mat-button-toggle-vertical .mat-button-toggle-label-content{display:block}.mat-button-toggle{white-space:nowrap;position:relative}.mat-button-toggle .mat-icon svg{vertical-align:top}.mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:1}.cdk-high-contrast-active .mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:.5}.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.04}.mat-button-toggle-appearance-standard.cdk-keyboard-focused:not(.mat-button-toggle-disabled) .mat-button-toggle-focus-overlay{opacity:.12}.cdk-high-contrast-active .mat-button-toggle-appearance-standard.cdk-keyboard-focused:not(.mat-button-toggle-disabled) .mat-button-toggle-focus-overlay{opacity:.5}@media(hover: none){.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{display:none}}.mat-button-toggle-label-content{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:inline-block;line-height:36px;padding:0 16px;position:relative}.mat-button-toggle-appearance-standard .mat-button-toggle-label-content{padding:0 12px}.mat-button-toggle-label-content>*{vertical-align:middle}.mat-button-toggle-focus-overlay{border-radius:inherit;pointer-events:none;opacity:0;top:0;left:0;right:0;bottom:0;position:absolute}.mat-button-toggle-checked .mat-button-toggle-focus-overlay{border-bottom:solid 36px}.cdk-high-contrast-active .mat-button-toggle-checked .mat-button-toggle-focus-overlay{opacity:.5;height:0}.cdk-high-contrast-active .mat-button-toggle-checked.mat-button-toggle-appearance-standard .mat-button-toggle-focus-overlay{border-bottom:solid 500px}.mat-button-toggle .mat-button-toggle-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-button-toggle-button{border:0;background:none;color:inherit;padding:0;margin:0;font:inherit;outline:none;width:100%;cursor:pointer}.mat-button-toggle-disabled .mat-button-toggle-button{cursor:default}.mat-button-toggle-button::-moz-focus-inner{border:0}\n"],encapsulation:2,changeDetection:0}),t})(),Ti=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},imports:[[mi.f,mi.l],mi.f]}),t})();var zi=i("bFHC"),_i=i("dYjB");function Vi(t,e){if(1&t){const t=o.Wb();o.Vb(0,"mat-button-toggle-group",18,19),o.cc("change",(function(){o.wc(t);const e=o.uc(1);return o.gc(4).onRightSideDisplayTypeChange(e.value)})),o.Vb(2,"mat-button-toggle",20),o.Vb(3,"mat-icon"),o.Gc(4,"insights"),o.Ub(),o.Ub(),o.Vb(5,"mat-button-toggle",21),o.Vb(6,"mat-icon"),o.Gc(7,"dehaze"),o.Ub(),o.Ub(),o.Ub()}if(2&t){const t=o.gc(4);o.mc("value",t.rightSideViewType)}}function Mi(t,e){if(1&t&&(o.Vb(0,"div",22),o.Qb(1,"dh-seed-score-breakdown-graph",23),o.Ub()),2&t){const t=o.gc().ngIf,e=o.gc().ngIf,i=o.gc().ngIf;o.Db(1),o.mc("scoreResponse",t[null==i.selectedProfile?null:i.selectedProfile.id])("weights",e.weights)("profileMap",i.profileMap)("profileId",null==i.selectedProfile?null:i.selectedProfile.id)}}function Oi(t,e){if(1&t&&o.Qb(0,"dh-profile-details",24),2&t){const t=o.gc(3).ngIf;o.mc("profile",t.selectedProfile)}}function Bi(t,e){if(1&t){const t=o.Wb();o.Tb(0),o.Vb(1,"as-split",1),o.Vb(2,"as-split-area",2),o.Vb(3,"div",3),o.Vb(4,"div",4),o.Vb(5,"span",5),o.Gc(6,"Available Fields"),o.Ub(),o.Qb(7,"dh-load-available-button"),o.Ub(),o.Vb(8,"div",6),o.Qb(9,"dh-available-tree",7),o.Ub(),o.Ub(),o.Ub(),o.Vb(10,"as-split-area",8),o.Vb(11,"div",3),o.Vb(12,"div",9),o.Vb(13,"span",5),o.Gc(14,"Profile hierarchy"),o.Ub(),o.Ub(),o.Vb(15,"div",10),o.Vb(16,"dh-hierarchy",11),o.cc("profileSelected",(function(e){o.wc(t);const i=o.gc(2).ngIf;return o.gc().selectProfile(e,i.selectedProfile)}))("itemWeightChanged",(function(e){return o.wc(t),o.gc(3).itemWeightValueChanged(e)}))("childProfileWeightChanged",(function(e){return o.wc(t),o.gc(3).childProfileWeightValueChanged(e)}))("disconnectLinkClicked",(function(e){return o.wc(t),o.gc(3).disconnectLinkClicked(e)}))("addSubProfileToProfile",(function(e){return o.wc(t),o.gc(3).addSubProfileToProfile(e)}))("addProfileItemToProfile",(function(e){return o.wc(t),o.gc(3).addProfileItemToProfile(e)}))("addVirtualProfileItemToProfile",(function(e){return o.wc(t),o.gc(3).addVirtualProfileItemToProfile(e)}))("treeItemDropped",(function(e){return o.wc(t),o.gc(3).treeItemDropped(e)})),o.Ub(),o.Ub(),o.Ub(),o.Ub(),o.Vb(17,"as-split-area",12),o.Vb(18,"div",3),o.Vb(19,"div",13),o.Vb(20,"span",5),o.Gc(21,"Item Details"),o.Ub(),o.Ub(),o.Vb(22,"div",14),o.Ec(23,Vi,8,1,"mat-button-toggle-group",15),o.hc(24,"keyvalue"),o.Ec(25,Mi,2,4,"div",16),o.Ec(26,Oi,1,1,"dh-profile-details",17),o.Ub(),o.Ub(),o.Ub(),o.Ub(),o.Sb()}if(2&t){const t=e.ngIf,i=o.gc().ngIf,r=o.gc().ngIf,s=o.gc();o.Db(1),o.mc("restrictMove",!0),o.Db(15),o.mc("data",r.profiles)("profileMap",r.profileMap)("weights",i.weights)("selectedProfile",r.selectedProfile)("scores",t),o.Db(7),o.mc("ngIf",o.ic(24,9,t).length>0),o.Db(2),o.mc("ngIf","breakdown"==s.rightSideViewType),o.Db(1),o.mc("ngIf","details"==s.rightSideViewType&&s.fairlyBigScreen&&r.selectedProfile)}}function Di(t,e){if(1&t&&(o.Tb(0),o.Ec(1,Bi,27,11,"ng-container",0),o.hc(2,"async"),o.Sb()),2&t){const t=o.gc(2);o.Db(1),o.mc("ngIf",o.ic(2,1,t.scoreStateService.scores$))}}function Ri(t,e){if(1&t&&(o.Tb(0),o.Ec(1,Di,3,3,"ng-container",0),o.hc(2,"async"),o.Sb()),2&t){const t=o.gc();o.Db(1),o.mc("ngIf",o.ic(2,1,t.profileVsService.weightState$))}}const Fi=[{path:"",component:(()=>{class t{constructor(t,e,i,r,s,n,o,a,h,c,d){this.profileVsService=t,this.weightStateService=e,this.dhDialogService=i,this.breakpointObserver=r,this.profileStateService=s,this.selectionActionStateService=n,this.dialog=o,this.scoreStateService=a,this.routerAdapterService=h,this.apiKeyStateService=c,this.activatedRoute=d,this.fairlyBigScreen=!0,this.rightSideViewType="details",this.unsubscribe$=new l.a,this.breakpointObserver.observe("(max-width: 1200px)").subscribe(t=>{this.fairlyBigScreen=0==t.matches})}ngOnInit(){return Object(n.a)(this,void 0,void 0,(function*(){yield this.loadProfile(),this.scoreStateService.profileScored$.pipe(Object(a.a)(this.unsubscribe$)).subscribe(()=>{this.rightSideViewType="breakdown"})}))}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}loadProfile(){return Object(n.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading(),this.apiKeyStateService.setAuth(this.activatedRoute.snapshot.params[Be.a.profileId]),this.scoreStateService.clearScores();const t=yield this.profileStateService.getProfiles();this.dhDialogService.hideLoading(),"error"==t&&this.dhDialogService.showMessage("error loading profile")}))}onRightSideDisplayTypeChange(t){this.rightSideViewType=t}selectProfile(t,e){return Object(n.a)(this,void 0,void 0,(function*(){t.selectedNodeId!=(null==e?void 0:e.id)&&(yield this.selectionActionStateService.clearForms(),this.scoreStateService.clearScores(),this.rightSideViewType="details",yield this.profileVsService.selectProfile(t.selectedNodeId),this.fairlyBigScreen?Object(o.mb)(this):this.showProfileDetailsModal())}))}showProfileDetailsModal(){this.dialog.open(lt,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",panelClass:"selected-dialog",data:{name:"test"}})}itemWeightValueChanged(t){return Object(n.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.weightStateService.updateItemLinkWeight(t);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error updating item weight":"Item weight updated")}))}childProfileWeightValueChanged(t){return Object(n.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.profileVsService.updateChildProfileLinkWeight(t);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error updating child profile weight":"Child profile weight updated")}))}disconnectLinkClicked(t){return Object(n.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Disconnect Sub Profile",message:"Are you sure you want to disconnect these profiles?"}).toPromise()))return;this.dhDialogService.showLoading();const e=yield this.profileVsService.disconectSubProfile(t);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error disconnecting sub profile":"Sub Profile Disconnected")}))}addSubProfileToProfile(t){return Object(n.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.profileStateService.conectSubProfile(t.parentProfileId,t.subProfileId);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error connecting sub profile":"Sub Profile Connected")}))}addProfileItemToProfile(t){return Object(n.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.profileStateService.addMultipleItems({profileId:t.profileId,multipleProfileItemCreateDto:[{name:t.profileItemName}]});this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error adding profile item to profile":"profile item added to profile")}))}addVirtualProfileItemToProfile(t){return Object(n.a)(this,void 0,void 0,(function*(){if(null==t.virtualProfileItem||null==t.profileId)return;this.dhDialogService.showLoading();const e=yield this.getProfileItemsNamesUnderVirtualProfileId(t.virtualProfileItem);if(null==e||e.length<1)return;const i=yield this.profileStateService.addMultipleItems({profileId:t.profileId,multipleProfileItemCreateDto:e});this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(i?"Error adding profile item to profile":"profile item added to profile")}))}getProfileItemsNamesUnderVirtualProfileId(t){return Object(n.a)(this,void 0,void 0,(function*(){const e=new B.a,i=yield this.profileStateService.profileMap$.pipe(Object(Oe.a)()).toPromise();return e.transform(t,i).map(t=>({name:i[t].originalName}))}))}treeItemDropped(t){return Object(n.a)(this,void 0,void 0,(function*(){const e=[];for(const r of t.droppedData)this.getMultipleItemsRequestFromData(r,e);if(0==e.length)return void this.dhDialogService.showErrorMessage("No items added.");this.dhDialogService.showLoading();const i=yield this.profileStateService.addMultipleItems({profileId:t.dropTargetId,multipleProfileItemCreateDto:e});this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(i?"Error adding multiple items.":"Multiple items added.")}))}getMultipleItemsRequestFromData(t,e){if(null!=t&&null!=e)if(t.isEdge)e.push({name:t.fullPath});else if(null!=(null==t?void 0:t.children))for(const i of null==t?void 0:t.children)this.getMultipleItemsRequestFromData(i,e)}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(De.a),o.Pb(A.a),o.Pb(Ae.a),o.Pb(Re.a),o.Pb(c.a),o.Pb(E.a),o.Pb(h.b),o.Pb(Fe.a),o.Pb(je.a),o.Pb(Le.a),o.Pb(s.a))},t.\u0275cmp=o.Jb({type:t,selectors:[["dh-profile"]],viewQuery:function(t,e){if(1&t&&o.Kc(Me,!0),2&t){let t;o.tc(t=o.dc())&&(e.hierarchyComponent=t.first)}},decls:2,vars:3,consts:[[4,"ngIf"],["unit","percent","gutterSize","10",3,"restrictMove"],["size","25","minSize","5","maxSize","40"],[1,"h-full","p-4"],[1,"flex","justify-between"],[1,"text-2xl","leading-8"],[1,"p-4","overflow-y-auto",2,"height","calc( 100% - 50px)"],[1,"block","h-auto"],["size","50","minSize","10","maxSize","90"],[2,"height","30px"],[1,"p-4",2,"height","calc( 100% - 30px)"],[1,"block","flex-1","overflow-hidden","h-full",3,"data","profileMap","weights","selectedProfile","scores","profileSelected","itemWeightChanged","childProfileWeightChanged","disconnectLinkClicked","addSubProfileToProfile","addProfileItemToProfile","addVirtualProfileItemToProfile","treeItemDropped"],["size","25","minSize","5","maxSize","40","id","uuuu"],[1,"flex","justify-between",2,"height","30px"],[1,"p-4","overflow-y-auto",2,"height","calc( 100% - 30px)"],[3,"value","change",4,"ngIf"],["class","mt-20",4,"ngIf"],["class","block px-4 text-base",3,"profile",4,"ngIf"],[3,"value","change"],["group","matButtonToggleGroup"],["value","breakdown","aria-label","Score breakdown"],["value","details","aria-label","Profile details"],[1,"mt-20"],[2,"height","300px",3,"scoreResponse","weights","profileMap","profileId"],[1,"block","px-4","text-base",3,"profile"]],template:function(t,e){1&t&&(o.Ec(0,Ri,3,3,"ng-container",0),o.hc(1,"async")),2&t&&o.mc("ngIf",o.ic(1,1,e.profileVsService.profileState$))},directives:[r.m,ei,ii,di,fi,Me,Pi,Ei,zi.a,_i.a,ot],pipes:[r.b,r.g],styles:[".full-height-without-top-bar[_ngcontent-%COMP%]{height:calc(100vh - 76px)}"]}),t})()}];let ji=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},imports:[[s.d.forChild(Fi)],s.d]}),t})();var Li=i("R7+U"),Ni=i("W1gw");i("9bRT"),i("C05f"),i("ROBh"),i("J+dc"),i("xVbo"),i("E5oP");let Ui=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)}}),t})();i("g6G6"),i("YtkY");let Gi=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},imports:[[Ui,mi.f],mi.f]}),t})();var Wi=i("evil"),$i=i("Yclt"),Hi=i("lQ7A"),qi=i("aYrn");let Ji=(()=>{class t{}return t.\u0275mod=o.Nb({type:t}),t.\u0275inj=o.Mb({factory:function(e){return new(e||t)},providers:[Ae.a],imports:[[g.a,r.c,ji,p.g,p.o,y.b,Te.c,b.d,v.b,Ni.b,Gi,zi.b,h.f,Wi.a,Li.b,$i.a,Ee.c,Hi.d,m.c,ri,qi.a,Ti]]}),t})()}}]);