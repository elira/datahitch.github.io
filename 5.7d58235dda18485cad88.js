(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"723k":function(t,e,i){"use strict";i.r(e),i.d(e,"ProfileModule",(function(){return Qe}));var r=i("2kYt"),n=i("sEIs"),o=i("D57K"),s=i("EM62"),a=i("kuMc"),l=i("ZTXN"),h=i("OZ4H"),c=i("yD3o"),d=i("cxBW"),f=i("LaE4"),u=i("zjL5"),p=i("nIj0"),g=i("P/uR"),b=i("Meci"),v=i("29Wa"),m=i("Cd2c"),y=i("v9BS");const w={provide:p.h,useExisting:Object(s.U)(()=>x),multi:!0};let x=(()=>{class t{constructor(){this.isDisabled=!1,this.max=100,this.propagateChange=t=>{},this.propagateTouched=t=>{}}writeValue(t){void 0!==t&&(this.value=t,this.propagateChange(this.value),this.propagateTouched(this.value))}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){this.propagateTouched=t}changeMade(t){this.propagateChange(t.value)}setDisabledState(t){this.isDisabled=t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-slider-control"]],inputs:{value:"value",max:"max"},features:[s.Bb([w])],decls:1,vars:3,consts:[["thumbLabel","","tickInterval","1","min","1",3,"max","ngModel","disabled","ngModelChange","change"]],template:function(t,e){1&t&&(s.Tb(0,"mat-slider",0),s.ac("ngModelChange",(function(t){return e.value=t}))("change",(function(t){return e.changeMade(t)})),s.Sb()),2&t&&s.ic("max",e.max)("ngModel",e.value)("disabled",e.isDisabled)},directives:[y.a,p.j,p.m],styles:[""]}),t})();var I=i("J+dc");let C=(()=>{class t{constructor(t){this.profileStateService=t}transform(t){return Object(o.a)(this,void 0,void 0,(function*(){return null==t?null:(yield this.profileStateService.profileMap$.pipe(Object(I.a)(1)).toPromise())[t]}))}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(c.a))},t.\u0275pipe=s.Mb({name:"getProfileElementById",type:t,pure:!0}),t})();function S(t,e){if(1&t&&(s.Rb(0),s.Tb(1,"div"),s.xc(2),s.Sb(),s.Qb()),2&t){const t=e.ngIf;s.Cb(2),s.yc(t.name)}}function k(t,e){if(1&t&&(s.Tb(0,"div",4),s.Tb(1,"mat-card"),s.Rb(2,5),s.vc(3,S,3,1,"ng-container",6),s.ec(4,"async"),s.ec(5,"getProfileElementById"),s.Tb(6,"mat-card-content"),s.Tb(7,"mat-form-field"),s.Tb(8,"mat-label"),s.xc(9,"Weight"),s.Sb(),s.Ob(10,"input",7),s.Sb(),s.Ob(11,"dh-slider-control",8),s.Sb(),s.Qb(),s.Sb(),s.Sb()),2&t){const t=e.index,i=s.dc();s.Cb(2),s.ic("formGroupName",t),s.Cb(1),s.ic("ngIf",s.fc(4,6,s.fc(5,8,i.subProfiles.controls[t].get("id").value))),s.Cb(7),s.jc("max",i.max),s.ic("value",i.subProfiles.controls[t].value.weight),s.Cb(1),s.ic("max",i.max)("value",i.subProfiles.controls[t].value.weight)}}let B=(()=>{class t{constructor(t){this.formBuilder=t,this.max=100,this.removeParentIdFromSubProfile=new u.a}ngOnInit(){this.form=this.formBuilder.group({subProfiles:this.formBuilder.array(this.getFormGroupsForIds())})}get subProfiles(){return this.form.get("subProfiles")}getFormGroupsForIds(){return this.ids.map(t=>{const e=this.removeParentIdFromSubProfile.transform(t,this.parentProfileId);return this.formBuilder.group({id:[t,[]],weight:[this.weights[e],[]],isItem:[e!==t]})})}getChanges(){const t=this.subProfiles.controls.map(t=>t.value).reduce((t,e)=>(t[e.id]=e.weight,t),{});return this.ids.reduce((e,i)=>{const r=this.removeParentIdFromSubProfile.transform(i,this.parentProfileId),n=t[i];return n!=this.weights[r]&&e.push({newWeight:n,id:i}),e},[])}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(p.c))},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-sub-profiles-edit"]],inputs:{ids:"ids",parentProfileId:"parentProfileId",weights:"weights"},decls:5,vars:2,consts:[[1,"mt-10"],["ngxsForm","selectionActions.subProfileWeightForm",3,"formGroup"],["formArrayName","subProfiles",1,"mt-10"],["class","mb-10",4,"ngFor","ngForOf"],[1,"mb-10"],[3,"formGroupName"],[4,"ngIf"],["type","number","min","1","matInput","","placeholder","Name","formControlName","weight","matInput","","placeholder","element weight",3,"max","value"],["formControlName","weight",3,"max","value"]],template:function(t,e){1&t&&(s.Tb(0,"h3",0),s.xc(1,"Sub Element names:"),s.Sb(),s.Rb(2,1),s.Tb(3,"div",2),s.vc(4,k,12,10,"div",3),s.Sb(),s.Qb()),2&t&&(s.Cb(2),s.ic("formGroup",e.form),s.Cb(2),s.ic("ngForOf",e.subProfiles.controls))},directives:[g.d,p.k,p.e,p.b,r.j,b.a,p.f,r.k,b.b,v.b,v.e,p.n,m.a,p.a,p.j,p.d,x],pipes:[r.b,C],styles:[""]}),t})();var T=i("pg5I"),P=i("yzyx"),E=i("J+IH");function O(t,e){1&t&&(s.Tb(0,"span"),s.xc(1,"Item "),s.Sb())}function M(t,e){if(1&t){const t=s.Ub();s.Rb(0),s.Tb(1,"dh-profile-item-score-chart",5),s.ac("insertNewValueScore",(function(e){return s.nc(t),s.dc(3).insertNewValueScore(e)})),s.Sb(),s.Qb()}if(2&t){const t=e.ngIf;s.Cb(1),s.ic("scores",t)}}function V(t,e){if(1&t&&(s.Rb(0),s.vc(1,M,2,1,"ng-container",2),s.ec(2,"async"),s.Qb()),2&t){const t=s.dc(2);s.Cb(1),s.ic("ngIf",s.fc(2,1,t.selectionActionStateService.scores$))}}function R(t,e){if(1&t&&(s.Rb(0),s.Ob(1,"dh-profile-item-form",4),s.vc(2,V,3,3,"ng-container",2),s.Qb()),2&t){const t=s.dc();s.Cb(1),s.ic("profile",t.profile),s.Cb(1),s.ic("ngIf",t.showGraph)}}function j(t,e){if(1&t&&(s.Rb(0),s.Ob(1,"dh-sub-profiles-edit",6),s.Qb()),2&t){const t=e.ngIf,i=s.dc(2);s.Cb(1),s.ic("ids",null==i.profile?null:i.profile.childrenIds)("parentProfileId",null==i.profile?null:i.profile.id)("weights",t.weights[null==i.profile?null:i.profile.id])}}function z(t,e){if(1&t&&(s.Rb(0),s.vc(1,j,2,3,"ng-container",2),s.ec(2,"async"),s.Qb()),2&t){const t=s.dc();s.Cb(1),s.ic("ngIf",s.fc(2,1,t.weightStateService.weightState$))}}let _=(()=>{class t{constructor(t,e,i,r){this.formBuilder=t,this.weightStateService=e,this.profileStateService=i,this.selectionActionStateService=r,this.showGraph=!1}ngAfterViewInit(){this.showGraph=!0}ngOnInit(){this.form=this.formBuilder.group({name:this.profile.name})}getProfileName(){return this.form.value.name}insertNewValueScore(t){this.profileItemFormComponent.insertRow(t.index,t.score)}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(p.c),s.Nb(T.a),s.Nb(c.a),s.Nb(P.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-profile-details-edit"]],viewQuery:function(t,e){var i;1&t&&(s.Bc(B,!0),s.Bc(f.a,!0)),2&t&&(s.kc(i=s.bc())&&(e.subProfilesEditComponent=i.first),s.kc(i=s.bc())&&(e.profileItemFormComponent=i.first))},inputs:{profile:"profile"},decls:9,vars:4,consts:[["ngxsForm","selectionActions.profileNameForm",3,"formGroup"],[1,"w-full"],[4,"ngIf"],["matInput","","placeholder","Name","formControlName","name","matInput","","placeholder","element name"],[3,"profile"],[2,"height","600px",3,"scores","insertNewValueScore"],[3,"ids","parentProfileId","weights"]],template:function(t,e){1&t&&(s.Tb(0,"form",0),s.Tb(1,"mat-form-field",1),s.Tb(2,"mat-label"),s.xc(3,"Profile "),s.vc(4,O,2,0,"span",2),s.xc(5,"Name"),s.Sb(),s.Ob(6,"input",3),s.Sb(),s.Sb(),s.vc(7,R,3,2,"ng-container",2),s.vc(8,z,3,3,"ng-container",2)),2&t&&(s.ic("formGroup",e.form),s.Cb(4),s.ic("ngIf","profile"!==e.profile.itemType),s.Cb(3),s.ic("ngIf",(null==e.profile||null==e.profile.scores?null:e.profile.scores.length)>0),s.Cb(1),s.ic("ngIf",(null==e.profile||null==e.profile.childrenIds?null:e.profile.childrenIds.length)>0))},directives:[p.q,p.k,g.d,p.e,v.b,v.e,r.k,m.a,p.a,p.j,p.d,f.a,E.a,B],pipes:[r.b],styles:[""]}),t})();function N(t,e){if(1&t&&(s.Rb(0),s.Tb(1,"div"),s.xc(2),s.Sb(),s.Qb()),2&t){const t=e.ngIf,i=s.dc(2);s.Cb(2),s.Ac(" ",t.name," ( weight: ",i.weights[t.originalId]||"1",") ")}}function L(t,e){if(1&t&&(s.Tb(0,"li"),s.vc(1,N,3,2,"ng-container",1),s.ec(2,"async"),s.ec(3,"getProfileElementById"),s.Sb()),2&t){const t=e.$implicit;s.Cb(1),s.ic("ngIf",s.fc(2,1,s.fc(3,3,t)))}}let W=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-sub-profiles"]],inputs:{ids:"ids",parentProfileId:"parentProfileId",weights:"weights"},decls:4,vars:1,consts:[[4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(t,e){1&t&&(s.Tb(0,"h3"),s.xc(1,"Sub-Profiles:"),s.Sb(),s.Tb(2,"ul"),s.vc(3,L,4,5,"li",0),s.Sb()),2&t&&(s.Cb(3),s.ic("ngForOf",e.ids))},directives:[r.j,r.k],pipes:[r.b,C],styles:[""]}),t})();function D(t,e){if(1&t&&(s.Tb(0,"div",4),s.xc(1),s.Sb()),2&t){const t=s.dc();s.Cb(1),s.zc("Id: ",(null==t.profile?null:t.profile.id)||"No Type","")}}function F(t,e){if(1&t&&(s.Tb(0,"tr"),s.Tb(1,"th",6),s.xc(2),s.Sb(),s.Tb(3,"th",6),s.xc(4),s.Sb(),s.Sb()),2&t){const t=e.$implicit;s.Cb(2),s.yc(t.name),s.Cb(2),s.yc(t.score)}}function $(t,e){if(1&t&&(s.Rb(0),s.Tb(1,"div",5),s.Tb(2,"table",4),s.Tb(3,"thead"),s.Tb(4,"tr"),s.Tb(5,"th",6),s.xc(6,"Value"),s.Sb(),s.Tb(7,"th",6),s.xc(8,"Score"),s.Sb(),s.Sb(),s.Sb(),s.Tb(9,"tbody"),s.vc(10,F,5,2,"tr",7),s.Sb(),s.Sb(),s.Ob(11,"dh-profile-item-score-chart",8),s.Sb(),s.Qb()),2&t){const t=s.dc();s.Cb(10),s.ic("ngForOf",null==t.profile?null:t.profile.scores),s.Cb(1),s.ic("scores",t.profile.scores)("readOnly",!0)}}function A(t,e){if(1&t&&(s.Rb(0),s.Ob(1,"dh-sub-profiles",9),s.Qb()),2&t){const t=e.ngIf,i=s.dc(2);s.Cb(1),s.ic("ids",null==i.profile?null:i.profile.childrenIds)("parentProfileId",null==i.profile?null:i.profile.id)("weights",t.weights[null==i.profile?null:i.profile.id])}}function H(t,e){if(1&t&&(s.Rb(0),s.vc(1,A,2,3,"ng-container",3),s.ec(2,"async"),s.Qb()),2&t){const t=s.dc();s.Cb(1),s.ic("ngIf",s.fc(2,1,t.weightStateService.weightState$))}}let q=(()=>{class t{constructor(t){this.weightStateService=t}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(T.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-profile-details-view"]],inputs:{profile:"profile"},decls:7,vars:5,consts:[[1,"mb-10","truncate"],[1,"mb-5","truncate"],["class","mb-5",4,"ngIf"],[4,"ngIf"],[1,"mb-5"],[1,"overflow-y-auto","limit-height"],[1,"px-4","py-2"],[4,"ngFor","ngForOf"],[2,"height","600px",3,"scores","readOnly"],[3,"ids","parentProfileId","weights"]],template:function(t,e){1&t&&(s.Tb(0,"h2",0),s.xc(1),s.Sb(),s.Tb(2,"div",1),s.xc(3),s.Sb(),s.vc(4,D,2,1,"div",2),s.vc(5,$,12,3,"ng-container",3),s.vc(6,H,3,3,"ng-container",3)),2&t&&(s.Cb(1),s.yc(null==e.profile?null:e.profile.name),s.Cb(2),s.zc("Item Type: ",(null==e.profile?null:e.profile.itemType)||"No Type",""),s.Cb(1),s.ic("ngIf",!((null==e.profile||null==e.profile.scores?null:e.profile.scores.length)>0)),s.Cb(1),s.ic("ngIf",(null==e.profile||null==e.profile.scores?null:e.profile.scores.length)>0),s.Cb(1),s.ic("ngIf",(null==e.profile||null==e.profile.childrenIds?null:e.profile.childrenIds.length)>0))},directives:[r.k,r.j,E.a,W],pipes:[r.b],styles:[".limit-height[_ngcontent-%COMP%]{height:calc(100vh - 400px);max-height:calc(100vh - 400px)}"]}),t})();function U(t,e){if(1&t&&s.Ob(0,"dh-profile-details-view",5),2&t){const t=s.dc(3);s.ic("profile",t.profile)}}function Q(t,e){if(1&t&&s.Ob(0,"dh-profile-details-edit",5),2&t){const t=s.dc(3);s.ic("profile",t.profile)}}function G(t,e){if(1&t&&(s.Rb(0),s.vc(1,U,1,1,"dh-profile-details-view",4),s.vc(2,Q,1,1,"dh-profile-details-edit",4),s.Qb()),2&t){const t=e.ngIf;s.Cb(1),s.ic("ngIf","none"==t),s.Cb(1),s.ic("ngIf","edit"==t)}}function X(t,e){if(1&t&&(s.Rb(0),s.Ob(1,"div",2),s.vc(2,G,3,2,"ng-container",3),s.ec(3,"async"),s.Qb()),2&t){const t=s.dc();s.Cb(2),s.ic("ngIf",s.fc(3,1,t.selectionActionStateService.action$))}}function Y(t,e){1&t&&s.xc(0," No selected profile.\n")}let J=(()=>{class t{constructor(t){this.selectionActionStateService=t}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(P.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-profile-details"]],viewQuery:function(t,e){var i;1&t&&s.Bc(_,!0),2&t&&s.kc(i=s.bc())&&(e.profileDetailsEdit=i.first)},inputs:{profile:"profile"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noProfile",""],[1,"flex","justify-end","mb-16","mt-3"],[4,"ngIf"],[3,"profile",4,"ngIf"],[3,"profile"]],template:function(t,e){if(1&t&&(s.vc(0,X,4,3,"ng-container",0),s.vc(1,Y,1,0,"ng-template",null,1,s.wc)),2&t){const t=s.lc(2);s.ic("ngIf",e.profile)("ngIfElse",t)}},directives:[r.k,q,_],pipes:[r.b],styles:[""]}),t})();function Z(t,e){if(1&t){const t=s.Ub();s.Rb(0),s.Tb(1,"dh-top-bar-selection",1),s.ac("exiting",(function(){return s.nc(t),s.dc().close()})),s.Sb(),s.Tb(2,"div",2),s.Ob(3,"dh-profile-details",3),s.Sb(),s.Qb()}if(2&t){const t=e.ngIf;s.Cb(3),s.ic("profile",t)}}let K=(()=>{class t{constructor(t,e){this.dialogRef=t,this.profileStateService=e,this.unsubscribe$=new l.a,e.selectionCleared$.pipe(Object(a.a)(this.unsubscribe$)).subscribe(()=>{this.close()})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}close(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(h.g),s.Nb(c.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-profile-details-modal"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"exiting"],["mat-dialog-content","",1,"p-10"],[1,"block","text-base",2,"width","100%",3,"profile"]],template:function(t,e){1&t&&(s.vc(0,Z,4,1,"ng-container",0),s.ec(1,"async")),2&t&&s.ic("ngIf",s.fc(1,1,e.profileStateService.selectedProfile$))},directives:[r.k,d.a,h.e,J],pipes:[r.b],styles:[""]}),t})();class tt{constructor(t){this.base=t}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...t){return et(function*(t){for(const e of t)yield*e}([this,...t.map(et)]))}entries(){return et(function*(t){let e=0;for(const i of t)yield[e++,i]}(this))}every(t){return!this.some((e,i)=>!t(e,i))}fill(t){return this.map(()=>t)}filter(t){return et(function*(e){for(const[i,r]of e)t(r,i)&&(yield r)}(this.entries()))}find(t){for(const[e,i]of this.entries())if(t(i,e))return i}findIndex(t){for(const[e,i]of this.entries())if(t(i,e))return e;return-1}flatMap(t){return et(function*(e){for(const[i,r]of e)yield*et(t(r,i))}(this.entries()))}forEach(t){for(const[e,i]of this.entries())t(i,e)}includes(t,e=0){return this.indexOf(t,e)>=0}indexOf(t,e=0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[i,r]of this.entries())if(i>=e&&r===t)return i;return-1}join(t=","){return[...this].join(t)}keys(){return et(function*(t){let e=0;for(const i of t)yield e++}(this))}lastIndexOf(t,e=1/0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let i=-1;for(const[r,n]of this.entries())r<=e&&n===t&&(i=r);return i}get length(){return this.reduce(t=>t+1,0)}map(t){return et(function*(e){for(const[i,r]of e)yield t(r,i)}(this.entries()))}reduce(t,e){if(void 0===e){const e=t;let i=!0,r=void 0;for(const[t,n]of this.entries())i?(r=n,i=!1):r=e(r,n,t);if(i)throw new TypeError("Reduce of empty iterable with no initial value");return r}{const i=t;let r=e;for(const[t,e]of this.entries())r=i(r,e,t);return r}}reverse(){return et([...this].reverse())}slice(t=0,e=1/0){return et(function*(i){for(const[r,n]of i)if(r<t);else{if(!(r<e))break;yield n}}(this.entries()))}some(t){for(const[e,i]of this.entries())if(t(i,e))return!0;return!1}sort(t){return et([...this].sort(t))}splice(t,e=0,...i){return et(function*(r){for(const[n,o]of r)n===t&&(yield*i),(n<t||n>=t+e)&&(yield o)}(this.entries()))}values(){return this}}function et(t){return function(t){return"function"==typeof t[Symbol.iterator]}(t)?new tt(t):new tt({[Symbol.iterator]:()=>t})}function it(t,e){e.size<t.size&&([e,t]=[t,e]);for(const i of t)if(e.has(i))return!0;return!1}class rt extends Map{getThrow(t){const e=this.get(t);if(void 0===e)throw new Error("map doesn't contain key: "+t);return e}getDefault(t,e){const i=this.get(t);return void 0===i?e:i}setIfAbsent(t,e){const i=this.get(t);return void 0===i?(this.set(t,e),e):i}}class nt{constructor(t,e,i=[]){this.child=t,this.data=e,this.points=i}}class ot{constructor(t,e,i,r){this.source=t,this.target=e,this.data=i,this.points=r}}class st{constructor(t,e){this.id=t,this.data=e,this.dataChildren=[]}iroots(){return et([this])}roots(){return[this]}*iterChildren(){for(const{child:t}of this.dataChildren)yield t}ichildren(){return et(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:t,data:e,points:i}of this.dataChildren)yield new ot(this,t,e,i)}ichildLinks(){return et(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new at([this])[Symbol.iterator]()}idescendants(t="depth"){return new at([this]).idescendants(t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return new at([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new at([this]).size()}sum(t){return new at([this]).sum(t),this}count(){return new at([this]).count(),this}height(){return new at([this]).height(),this}depth(){return new at([this]).depth(),this}split(){return[this]}connected(){return!0}}class at{constructor(t){this.dagRoots=t}[Symbol.iterator](){return this.idepth()}iroots(){return et(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const t=this.roots(),e=new Set;let i;for(;i=t.pop();)e.has(i.id)||(e.add(i.id),yield i,t.push(...i.ichildren()))}*ibreadth(){const t=new Set;let e=this.roots(),i=[];do{let r;for(i=e.reverse(),e=[];r=i.pop();)t.has(r.id)||(t.add(r.id),yield r,e.push(...r.ichildren()))}while(e.length)}*ibefore(){const t=new rt;for(const r of this)for(const e of r.ichildren())t.set(e.id,t.getDefault(e.id,0)+1);const e=this.roots();let i;for(;i=e.pop();){yield i;for(const r of i.ichildren()){const i=t.getThrow(r.id);i>1?t.set(r.id,i-1):e.push(r)}}}*iafter(){const t=this.roots(),e=new Set;let i;for(;i=t.pop();)e.has(i.id)||(i.ichildren().every(t=>e.has(t.id))?(e.add(i.id),yield i):(t.push(i),t.push(...i.ichildren())))}idescendants(t="depth"){if("depth"===t)return et(this.idepth());if("breadth"===t)return et(this.ibreadth());if("before"===t)return et(this.ibefore());if("after"===t)return et(this.iafter());throw new Error("unknown iteration style: "+t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return this.idescendants().flatMap(t=>t.ichildLinks())}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce(t=>t+1,0)}sum(t){const e=new rt;for(const[i,r]of this.idescendants("after").entries()){const n=t(r,i),o=new rt;o.set(r.id,n);for(const t of r.ichildren()){const i=e.getThrow(t.id);for(const[t,e]of i.entries())o.set(t,e)}r.value=et(o.entries()).map(([,t])=>t).reduce((t,e)=>t+e),e.set(r.id,o)}return this}count(){const t=new rt;for(const e of this.idescendants("after"))if(e.ichildren()[Symbol.iterator]().next().done)t.set(e.id,new Set([e.id])),e.value=1;else{const i=new Set;for(const r of e.ichildren()){const e=t.getThrow(r.id);for(const t of e)i.add(t)}t.set(e.id,i),e.value=i.size}return this}height(){for(const t of this.idescendants("after"))t.value=Math.max(0,...t.ichildren().map(t=>{if(void 0===t.value)throw new Error("`after` iteration didn't iterate in after order");return t.value+1}));return this}depth(){const t=new rt;for(const e of this)for(const i of e.ichildren())t.setIfAbsent(i.id,[]).push(e);for(const e of this.idescendants("before"))e.value=Math.max(0,...t.getDefault(e.id,[]).map(t=>{if(void 0===t.value)throw new Error("`before` iteration didn't iterate in before order");return t.value+1}));return this}split(){const t=new rt,e=new rt;for(const n of this.iroots())t.set(n.id,[]),e.set(n.id,new Set(n.idescendants().map(t=>t.id)));for(const[n,o]of this.iroots().entries()){const i=e.getThrow(o.id);for(const r of this.iroots().slice(n+1))it(i,e.getThrow(r.id))&&(t.getThrow(o.id).push(r),t.getThrow(r.id).push(o))}const i=[],r=new Set;for(const n of this.iroots())if(!r.has(n.id)){r.add(n.id);const e=[n];i.push(e);const o=t.getThrow(n.id).slice();let s;for(;s=o.pop();)r.has(s.id)||(r.add(s.id),e.push(s),o.push(...t.getThrow(s.id)))}return i.map(t=>t.length>1?new at(t):t[0])}connected(){return 1===this.split().length}}function lt(t){function e(e,i){return(t(e,i)||[]).map(t=>[t,void 0])}return e.wrapped=t,e}function ht(t){if(function(t){try{return"string"==typeof t.id}catch(e){return!1}}(t))return t.id;throw new Error("default id function expected datum to have an id field but got: "+t)}function ct(t){if(function(t){try{const e=t.parentIds;return void 0===e||e instanceof Array&&e.every(t=>"string"==typeof t)}catch(e){return!1}}(t))return t.parentIds;throw new Error("default parentIds function expected datum to have a parentIds field but got: "+t)}let dt,ft,ut=1e-60;do{ut+=ut,dt=1+.1*ut,ft=1+.2*ut}while(dt<=1||ft<=1);var pt=ut,gt=function(t,e,i,r=[],n=0,o=[0,0]){const s=[],a=[],l=[],h=[],c=[],d=[];let f="";const u=t.length-1,p=i[1].length-1;if(!r)for(let b=1;b<=p;b+=1)r[b]=0;if(u!==t[1].length-1&&(f="Dmat is not symmetric!"),u!==e.length-1&&(f="Dmat and dvec are incompatible!"),u!==i.length-1&&(f="Amat and dvec are incompatible!"),p!==r.length-1&&(f="Amat and bvec are incompatible!"),(n>p||n<0)&&(f="Value of meq is invalid!"),""!==f)return{message:f};for(let b=1;b<=p;b+=1)a[b]=0,h[b]=0;const g=Math.min(u,p);for(let b=1;b<=u;b+=1)l[b]=0;s[1]=0;for(let b=1;b<=2*u+g*(g+5)/2+2*p+1;b+=1)c[b]=0;for(let b=1;b<=2;b+=1)d[b]=0;return function(t,e,i,r,n,o,s,a,l,h,c,d,f,u=0,p,g,b){let v,m,y,w,x,I,C,S,k,B,T,P,E,O;const M=Math.min(r,c);let V=2*r+M*(M+5)/2+2*c+1;for(let q=1;q<=r;q+=1)g[q]=e[q];for(let q=r+1;q<=V;q+=1)g[q]=0;for(let q=1;q<=c;q+=1)f[q]=0,o[q]=0;const R=[];if(0===b[1]){if(function(t,e,i,r){let n,o,s;for(let a=1;a<=i;a+=1){if(r[1]=a,s=0,n=a-1,n<1){if(s=t[a][a]-s,s<=0)break;t[a][a]=Math.sqrt(s)}else{for(let e=1;e<=n;e+=1){o=t[e][a];for(let i=1;i<e;i+=1)o-=t[i][a]*t[i][e];o/=t[e][e],t[e][a]=o,s+=o*o}if(s=t[a][a]-s,s<=0)break;t[a][a]=Math.sqrt(s)}r[1]=0}}(t,0,r,R),0!==R[1])return void(b[1]=2);(function(t,e,i,r){let n,o;for(n=1;n<=i;n+=1){o=0;for(let e=1;e<n;e+=1)o+=t[e][n]*r[e];r[n]=(r[n]-o)/t[n][n]}for(let s=1;s<=i;s+=1){n=i+1-s,r[n]/=t[n][n],o=-r[n];for(let e=1;e<n;e+=1)r[e]+=o*t[e][n]}})(t,0,r,e),function(t,e,i){let r,n;for(let o=1;o<=i;o+=1){t[o][o]=1/t[o][o],n=-t[o][o];for(let e=1;e<o;e+=1)t[e][o]*=n;if(r=o+1,i<r)break;for(let e=r;e<=i;e+=1){n=t[o][e],t[o][e]=0;for(let i=1;i<=o;i+=1)t[i][e]+=n*t[i][o]}}}(t,0,r)}else{for(let i=1;i<=r;i+=1){n[i]=0;for(let r=1;r<=i;r+=1)n[i]+=t[r][i]*e[r]}for(let i=1;i<=r;i+=1){e[i]=0;for(let o=i;o<=r;o+=1)e[i]+=t[i][o]*n[o]}}s[1]=0;for(let q=1;q<=r;q+=1){n[q]=e[q],s[1]+=g[q]*n[q],g[q]=0;for(let e=q+1;e<=r;e+=1)t[e][q]=0}s[1]=-s[1]/2,b[1]=0;const j=r,z=j+r,_=z+M,N=_+M+1,L=N+M*(M+1)/2,W=L+c;for(let q=1;q<=c;q+=1){I=0;for(let t=1;t<=r;t+=1)I+=a[t][q]*a[t][q];g[W+q]=Math.sqrt(I)}function D(){p[1]+=1,V=L;for(let t=1;t<=c;t+=1){V+=1,I=-l[t];for(let e=1;e<=r;e+=1)I+=a[e][t]*n[e];if(Math.abs(I)<pt&&(I=0),t>d)g[V]=I;else if(g[V]=-Math.abs(I),I>0){for(let e=1;e<=r;e+=1)a[e][t]=-a[e][t];l[t]=-l[t]}}for(let t=1;t<=w;t+=1)g[L+f[t]]=0;y=0,x=0;for(let t=1;t<=c;t+=1)g[L+t]<x*g[W+t]&&(y=t,x=g[L+t]/g[W+t]);if(0===y){for(let t=1;t<=w;t+=1)o[f[t]]=g[_+t];return 999}return 0}function F(){for(let e=1;e<=r;e+=1){I=0;for(let i=1;i<=r;i+=1)I+=t[i][e]*a[i][y];g[e]=I}v=j;for(let t=1;t<=r;t+=1)g[v+t]=0;for(let e=w+1;e<=r;e+=1)for(let i=1;i<=r;i+=1)g[v+i]=g[v+i]+t[i][e]*g[e];P=!0;for(let t=w;t>=1;t-=1){I=g[t],V=N+t*(t+3)/2,v=V-t;for(let e=t+1;e<=w;e+=1)I-=g[V]*g[z+e],V+=e;I/=g[v],g[z+t]=I,f[t]<=d||I<=0||(P=!1,m=t)}if(!P){C=g[_+m]/g[z+m];for(let t=1;t<=w;t+=1)f[t]<=d||g[z+t]<=0||(x=g[_+t]/g[z+t],x<C&&(C=x,m=t))}I=0;for(let t=j+1;t<=j+r;t+=1)I+=g[t]*g[t];if(Math.abs(I)<=pt){if(P)return b[1]=1,999;for(let t=1;t<=w;t+=1)g[_+t]=g[_+t]-C*g[z+t];return g[_+w+1]=g[_+w+1]+C,700}I=0;for(let t=1;t<=r;t+=1)I+=g[j+t]*a[t][y];S=-g[L+y]/I,E=!0,P||C<S&&(S=C,E=!1);for(let t=1;t<=r;t+=1)n[t]+=S*g[j+t],Math.abs(n[t])<pt&&(n[t]=0);s[1]+=S*I*(S/2+g[_+w+1]);for(let t=1;t<=w;t+=1)g[_+t]=g[_+t]-S*g[z+t];if(g[_+w+1]=g[_+w+1]+S,!E){I=-l[y];for(let t=1;t<=r;t+=1)I+=n[t]*a[t][y];if(y>d)g[L+y]=I;else if(g[L+y]=-Math.abs(I),I>0){for(let t=1;t<=r;t+=1)a[t][y]=-a[t][y];l[y]=-l[y]}return 700}w+=1,f[w]=y,V=N+(w-1)*w/2+1;for(let t=1;t<=w-1;t+=1)g[V]=g[t],V+=1;if(w===r)g[V]=g[r];else{for(let e=r;e>=w+1;e-=1)if(0!==g[e]&&(k=Math.max(Math.abs(g[e-1]),Math.abs(g[e])),B=Math.min(Math.abs(g[e-1]),Math.abs(g[e])),x=g[e-1]>=0?Math.abs(k*Math.sqrt(1+B*B/(k*k))):-Math.abs(k*Math.sqrt(1+B*B/(k*k))),k=g[e-1]/x,B=g[e]/x,1!==k))if(0===k){g[e-1]=B*x;for(let i=1;i<=r;i+=1)x=t[i][e-1],t[i][e-1]=t[i][e],t[i][e]=x}else{g[e-1]=x,T=B/(1+k);for(let i=1;i<=r;i+=1)x=k*t[i][e-1]+B*t[i][e],t[i][e]=T*(t[i][e-1]+x)-t[i][e],t[i][e-1]=x}g[V]=g[w]}return 0}function $(){if(V=N+m*(m+1)/2+1,v=V+m,0===g[v])return 798;if(k=Math.max(Math.abs(g[v-1]),Math.abs(g[v])),B=Math.min(Math.abs(g[v-1]),Math.abs(g[v])),x=g[v-1]>=0?Math.abs(k*Math.sqrt(1+B*B/(k*k))):-Math.abs(k*Math.sqrt(1+B*B/(k*k))),k=g[v-1]/x,B=g[v]/x,1===k)return 798;if(0===k){for(let t=m+1;t<=w;t+=1)x=g[v-1],g[v-1]=g[v],g[v]=x,v+=t;for(let e=1;e<=r;e+=1)x=t[e][m],t[e][m]=t[e][m+1],t[e][m+1]=x}else{T=B/(1+k);for(let t=m+1;t<=w;t+=1)x=k*g[v-1]+B*g[v],g[v]=T*(g[v-1]+x)-g[v],g[v-1]=x,v+=t;for(let e=1;e<=r;e+=1)x=k*t[e][m]+B*t[e][m+1],t[e][m+1]=T*(t[e][m]+x)-t[e][m+1],t[e][m]=x}return 0}function A(){v=V-m;for(let t=1;t<=m;t+=1)g[v]=g[V],V+=1,v+=1;return g[_+m]=g[_+m+1],f[m]=f[m+1],m+=1,m<w?797:0}function H(){return g[_+w]=g[_+w+1],g[_+w+1]=0,f[w]=0,w-=1,p[2]+=1,0}for(w=u,p[1]=0,p[2]=0,O=0;;){if(O=D(),999===O)return;for(;O=F(),0!==O;){if(999===O)return;if(700===O)if(m===w)H();else{for(;$(),O=A(),797===O;);H()}}}}(t,e,0,u,l,h,s,i,r,0,p,n,a,0,d,c,o),1===o[1]&&(f="constraints are inconsistent, no solution!"),2===o[1]&&(f="matrix D in quadratic function is not positive definite!"),{solution:l,Lagrangian:h,value:s,unconstrained_solution:e,iterations:d,iact:a,message:f}};function bt(t,e){let[i,...r]=t,n=i.x=0;for(const o of r)n=o.x=n+e(i,o),i=o;if(n>0)for(const o of t)o.x/=n;else for(const o of t)o.x=.5}function vt(t,e,i,r){t[i][i]+=r,t[i][e]-=r,t[e][i]-=r,t[e][e]+=r}function mt(t,e,i,r,n){t[r][r]+=n,t[r][i]-=2*n,t[r][e]+=n,t[i][r]-=2*n,t[i][i]+=4*n,t[i][e]-=2*n,t[e][r]+=n,t[e][i]-=2*n,t[e][e]+=n}class yt extends st{constructor(t){super(t,void 0)}}function wt(t,e,i,r){this.feasible=i,this.evaluation=e,this.bounded=r,this._tableau=t}var xt=wt;function It(t,e,i,r,n){xt.call(this,t,e,i,r),this.iter=n}wt.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,i=e.varIndexByRow,r=e.variablesPerIndex,n=e.matrix,o=e.rhsColumn,s=e.height-1,a=Math.round(1/e.precision),l=1;l<=s;l+=1){var h=r[i[l]];void 0!==h&&!0!==h.isSlack&&(t[h.id]=Math.round((Number.EPSILON+n[l][o])*a)/a)}return t};var Ct=It;function St(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}It.prototype=Object.create(xt.prototype),It.constructor=It;var kt=St;function Bt(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var i=0;i<e;i+=1)this.reducedCosts[i]=0}St.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},Bt.prototype.copy=function(){var t=new Bt(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t},St.prototype.setOptionalObjective=function(t,e,i){var r=this.objectivesByPriority[t];void 0===r&&(r=new Bt(t,Math.max(this.width,e+1)),this.objectivesByPriority[t]=r,this.optionalObjectives.push(r),this.optionalObjectives.sort((function(t,e){return t.priority-e.priority}))),r.reducedCosts[e]=i},St.prototype.initialize=function(t,e,i,r){this.variables=i,this.unrestrictedVars=r,this.width=t,this.height=e;for(var n=new Array(t),o=0;o<t;o++)n[o]=0;this.matrix=new Array(e);for(var s=0;s<e;s++)this.matrix[s]=n.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},St.prototype._resetMatrix=function(){var t,e,i=this.model.variables,r=this.model.constraints,n=i.length,o=r.length,s=this.matrix[0],a=!0===this.model.isMinimization?-1:1;for(t=0;t<n;t+=1){var l=i[t],h=l.priority,c=a*l.cost;0===h?s[t+1]=c:this.setOptionalObjective(h,t+1,c),this.rowByVarIndex[e=i[t].index]=-1,this.colByVarIndex[e]=t+1,this.varIndexByCol[t+1]=e}for(var d=1,f=0;f<o;f+=1){var u,p,g=r[f],b=g.index;this.rowByVarIndex[b]=d,this.colByVarIndex[b]=-1,this.varIndexByRow[d]=b;var v=g.terms,m=v.length,y=this.matrix[d++];if(g.isUpperBound){for(u=0;u<m;u+=1)y[this.colByVarIndex[(p=v[u]).variable.index]]=p.coefficient;y[0]=g.rhs}else{for(u=0;u<m;u+=1)y[this.colByVarIndex[(p=v[u]).variable.index]]=-p.coefficient;y[0]=-g.rhs}}},St.prototype.setModel=function(t){return this.model=t,this.initialize(t.nVariables+1,t.nConstraints+1,t.variables,t.unrestrictedVariables),this._resetMatrix(),this},St.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},St.prototype.density=function(){for(var t=0,e=this.matrix,i=0;i<this.height;i++)for(var r=e[i],n=0;n<this.width;n++)0!==r[n]&&(t+=1);return t/(this.height*this.width)},St.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=Math.round((Number.EPSILON+this.matrix[this.costRowIndex][this.rhsColumn])*t)/t;this.evaluation=e,0===this.simplexIters&&(this.bestPossibleEval=e)},St.prototype.getSolution=function(){var t=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new Ct(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new xt(this,t,this.feasible,this.bounded)},kt.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},kt.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],i=this.matrix,r=this.rhsColumn,n=this.width-1,o=this.height-1,s=0;;){for(var a=0,l=-this.precision,h=1;h<=o;h++){var c=i[h][r];c<l&&(l=c,a=h)}if(0===a)return this.feasible=!0,s;for(var d=0,f=-1/0,u=i[0],p=i[a],g=1;g<=n;g++){var b=p[g];if(!0===this.unrestrictedVars[this.varIndexByCol[g]]||b<-this.precision){var v=-u[g]/b;f<v&&(f=v,d=g)}}if(0===d)return this.feasible=!1,s;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[d]]);var m=this.checkForCycles(e);if(m.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+m[0]),this.model.messages.push("Length :"+m[1]),this.feasible=!1,s}this.pivot(a,d),s+=1}},kt.prototype.phase2=function(){for(var t,e,i=this.model.checkForCycles,r=[],n=this.matrix,o=this.rhsColumn,s=this.width-1,a=this.height-1,l=this.precision,h=this.optionalObjectives.length,c=null,d=0;;){var f=n[this.costRowIndex];h>0&&(c=[]);for(var u=0,p=l,g=!1,b=1;b<=s;b++)t=f[b],e=!0===this.unrestrictedVars[this.varIndexByCol[b]],h>0&&-l<t&&t<l?c.push(b):e&&t<0?-t>p&&(p=-t,u=b,g=!0):t>p&&(p=t,u=b,g=!1);if(h>0)for(var v=0;0===u&&c.length>0&&v<h;){var m=[],y=this.optionalObjectives[v].reducedCosts;p=l;for(var w=0;w<c.length;w++)e=!0===this.unrestrictedVars[this.varIndexByCol[b=c[w]]],-l<(t=y[b])&&t<l?m.push(b):e&&t<0?-t>p&&(p=-t,u=b,g=!0):t>p&&(p=t,u=b,g=!1);c=m,v+=1}if(0===u)return this.setEvaluation(),this.simplexIters+=1,d;for(var x=0,I=1/0,C=1;C<=a;C++){var S=n[C],k=S[o],B=S[u];if(!(-l<B&&B<l)){if(B>0&&l>k&&k>-l){I=0,x=C;break}var T=g?-k/B:k/B;T>l&&I>T&&(I=T,x=C)}}if(I===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[u],d;if(i){r.push([this.varIndexByRow[x],this.varIndexByCol[u]]);var P=this.checkForCycles(r);if(P.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+P[0]),this.model.messages.push("Length :"+P[1]),this.feasible=!1,d}this.pivot(x,u,!0),d+=1}};var Tt=[];function Pt(t,e,i,r){this.id=t,this.cost=e,this.index=i,this.value=0,this.priority=r}function Et(t,e,i,r){Pt.call(this,t,e,i,r)}function Ot(t,e){Pt.call(this,t,0,e,0)}function Mt(t,e){this.variable=t,this.coefficient=e}function Vt(t,e,i){return 0===i||"required"===i?null:(e=e||1,i=i||1,!1===t.isMinimization&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,i))}function Rt(t,e,i,r){this.slack=new Ot("s"+i,i),this.index=i,this.model=r,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function jt(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}kt.prototype.pivot=function(t,e){var i=this.matrix,r=i[t][e],n=this.height-1,o=this.width-1,s=this.varIndexByRow[t],a=this.varIndexByCol[e];this.varIndexByRow[t]=a,this.varIndexByCol[e]=s,this.rowByVarIndex[a]=t,this.rowByVarIndex[s]=-1,this.colByVarIndex[a]=-1,this.colByVarIndex[s]=e;for(var l,h,c,d=i[t],f=0,u=0;u<=o;u++)d[u]>=-1e-16&&d[u]<=1e-16?d[u]=0:(d[u]/=r,Tt[f]=u,f+=1);d[e]=1/r;for(var p=0;p<=n;p++)if(p!==t&&!(i[p][e]>=-1e-16&&i[p][e]<=1e-16)){var g=i[p];if((l=g[e])>=-1e-16&&l<=1e-16)0!==l&&(g[e]=0);else{for(h=0;h<f;h++)(c=d[u=Tt[h]])>=-1e-16&&c<=1e-16?0!==c&&(d[u]=0):g[u]=g[u]-l*c;g[e]=-l/r}}var b=this.optionalObjectives.length;if(b>0)for(var v=0;v<b;v+=1){var m=this.optionalObjectives[v].reducedCosts;if(0!==(l=m[e])){for(h=0;h<f;h++)0!==(c=d[u=Tt[h]])&&(m[u]=m[u]-l*c);m[e]=-l/r}}},kt.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var i=e+1;i<t.length;i++){var r=t[e],n=t[i];if(r[0]===n[0]&&r[1]===n[1]){if(i-e>t.length-i)break;for(var o=!0,s=1;s<i-e;s++){var a=t[e+s],l=t[i+s];if(a[0]!==l[0]||a[1]!==l[1]){o=!1;break}}if(o)return[e,i-e]}}return[]},Et.prototype.isInteger=!0,Ot.prototype.isSlack=!0,Rt.prototype.addTerm=function(t,e){var i=e.index,r=this.termsByVarIndex[i];return void 0===r?(r=new Mt(e,t),this.termsByVarIndex[i]=r,this.terms.push(r),!0===this.isUpperBound&&(t=-t),this.model.updateConstraintCoefficient(this,e,t)):this.setVariableCoefficient(r.coefficient+t,e),this},Rt.prototype.removeTerm=function(t){return this},Rt.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;!0===this.isUpperBound&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this},Rt.prototype.setVariableCoefficient=function(t,e){var i=e.index;if(-1!==i){var r=this.termsByVarIndex[i];if(void 0===r)this.addTerm(t,e);else if(t!==r.coefficient){var n=t-r.coefficient;!0===this.isUpperBound&&(n=-n),r.coefficient=t,this.model.updateConstraintCoefficient(this,e,n)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},Rt.prototype.relax=function(t,e){this.relaxation=Vt(this.model,t,e),this._relax(this.relaxation)},Rt.prototype._relax=function(t){null!==t&&this.setVariableCoefficient(this.isUpperBound?-1:1,t)},jt.prototype.isEquality=!0,jt.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this},jt.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this},jt.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t},jt.prototype.relax=function(t,e){this.relaxation=Vt(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var zt={Constraint:Rt,Variable:Pt,IntegerVariable:Et,SlackVariable:Ot,Equality:jt,Term:Mt},_t=zt.SlackVariable;function Nt(t,e){this.index=t,this.value=e}kt.prototype.addCutConstraints=function(t){for(var e,i=t.length,r=this.height,n=r+i,o=r;o<n;o+=1)void 0===this.matrix[o]&&(this.matrix[o]=this.matrix[o-1].slice());this.height=n,this.nVars=this.width+this.height-2;for(var s=this.width-1,a=0;a<i;a+=1){var l=t[a],h=r+a,c="min"===l.type?-1:1,d=l.varIndex,f=this.rowByVarIndex[d],u=this.matrix[h];if(-1===f){for(u[this.rhsColumn]=c*l.value,e=1;e<=s;e+=1)u[e]=0;u[this.colByVarIndex[d]]=c}else{var p=this.matrix[f];for(u[this.rhsColumn]=c*(l.value-p[this.rhsColumn]),e=1;e<=s;e+=1)u[e]=-c*p[e]}var g=this.getNewElementIndex();this.varIndexByRow[h]=g,this.rowByVarIndex[g]=h,this.colByVarIndex[g]=-1,this.variablesPerIndex[g]=new _t("s"+g,g),this.nVars+=1}},kt.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var n=this.height;e[n]=e[n-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[n]=o,this.rowByVarIndex[o]=n,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new _t("s"+o,o),e[n][this.rhsColumn]=Math.floor(i);for(var s=1;s<this.varIndexByCol.length;s+=1)if(this.variablesPerIndex[this.varIndexByCol[s]].isInteger){var a=e[t][s],l=Math.floor(a)+Math.max(0,a-Math.floor(a)-r)/(1-r);e[n][s]=l}else e[n][s]=Math.min(0,e[t][s]/(1-r));for(var h=0;h<this.width;h+=1)e[n][h]-=e[t][h];return!0},kt.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var n=this.height;e[n]=e[n-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[n]=o,this.rowByVarIndex[o]=n,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new _t("s"+o,o),e[n][this.rhsColumn]=-r;for(var s=1;s<this.varIndexByCol.length;s+=1){var a=this.variablesPerIndex[this.varIndexByCol[s]],l=e[t][s],h=l-Math.floor(l);e[n][s]=a.isInteger?h<=r?-h:-(1-h)*r/h:l>=0?-l:l*r/(1-r)}return!0},kt.prototype.applyMIRCuts=function(){},kt.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(-1===e){for(var i=this.colByVarIndex[t],r=1;r<this.height;r+=1){var n=this.matrix[r][i];if(n<-this.precision||this.precision<n){e=r;break}}this.pivot(e,i)}return e},kt.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(-1===e){for(var i=this.rowByVarIndex[t],r=this.matrix[i],n=1;n<this.height;n+=1){var o=r[n];if(o<-this.precision||this.precision<o){e=n;break}}this.pivot(i,e)}return e},kt.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),i=0;i<t;i+=1){var r=this.variables[i],n=this.rowByVarIndex[r.index];r.value=-1===n?0:Math.round((this.matrix[n][this.rhsColumn]+Number.EPSILON)*e)/e}},kt.prototype.updateRightHandSide=function(t,e){var i=this.height-1,r=this.rowByVarIndex[t.index];if(-1===r){for(var n=this.colByVarIndex[t.index],o=0;o<=i;o+=1){var s=this.matrix[o];s[this.rhsColumn]-=e*s[n]}var a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1){var h=this.optionalObjectives[l].reducedCosts;h[this.rhsColumn]-=e*h[n]}}else this.matrix[r][this.rhsColumn]-=e},kt.prototype.updateConstraintCoefficient=function(t,e,i){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var r=this._putInBase(t.index),n=this.colByVarIndex[e.index];if(-1===n)for(var o=this.rowByVarIndex[e.index],s=0;s<this.width;s+=1)this.matrix[r][s]+=i*this.matrix[o][s];else this.matrix[r][n]-=i},kt.prototype.updateCost=function(t,e){var i=t.index,r=this.width-1,n=this.colByVarIndex[i];if(-1===n){var o,s=this.matrix[this.rowByVarIndex[i]];if(0===t.priority){var a=this.matrix[0];for(o=0;o<=r;o+=1)a[o]+=e*s[o]}else{var l=this.objectivesByPriority[t.priority].reducedCosts;for(o=0;o<=r;o+=1)l[o]+=e*s[o]}}else this.matrix[0][n]-=e},kt.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,i=this.height,r=this.matrix[i];void 0===r&&(r=this.matrix[0].slice(),this.matrix[i]=r);for(var n=this.width-1,o=0;o<=n;o+=1)r[o]=0;r[this.rhsColumn]=e*t.rhs;for(var s=t.terms,a=s.length,l=0;l<a;l+=1){var h=s[l],c=h.coefficient,d=h.variable.index,f=this.rowByVarIndex[d];if(-1===f)r[this.colByVarIndex[d]]+=e*c;else{var u=this.matrix[f];for(o=0;o<=n;o+=1)r[o]-=e*c*u[o]}}var p=t.index;this.varIndexByRow[i]=p,this.rowByVarIndex[p]=i,this.colByVarIndex[p]=-1,this.height+=1},kt.prototype.removeConstraint=function(t){var e=t.index,i=this.height-1,r=this._putInBase(e),n=this.matrix[i];this.matrix[i]=this.matrix[r],this.matrix[r]=n,this.varIndexByRow[r]=this.varIndexByRow[i],this.varIndexByRow[i]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1},kt.prototype.addVariable=function(t){var e=this.height-1,i=this.width,r=!0===this.model.isMinimization?-t.cost:t.cost,n=t.priority,o=this.optionalObjectives.length;if(o>0)for(var s=0;s<o;s+=1)this.optionalObjectives[s].reducedCosts[i]=0;0===n?this.matrix[0][i]=r:(this.setOptionalObjective(n,i,r),this.matrix[0][i]=0);for(var a=1;a<=e;a+=1)this.matrix[a][i]=0;var l=t.index;this.varIndexByCol[i]=l,this.rowByVarIndex[l]=-1,this.colByVarIndex[l]=i,this.width+=1},kt.prototype.removeVariable=function(t){var e=t.index,i=this._takeOutOfBase(e),r=this.width-1;if(i!==r){for(var n=this.height-1,o=0;o<=n;o+=1){var s=this.matrix[o];s[i]=s[r]}var a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1){var h=this.optionalObjectives[l].reducedCosts;h[i]=h[r]}var c=this.varIndexByCol[r];this.varIndexByCol[i]=c,this.colByVarIndex[c]=i}this.varIndexByCol[r]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1},kt.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var i,r,n,o,s,a,l,h,c,d,f="",u=[" "];for(r=1;r<this.width;r+=1)l=" ",h="\t",(a=void 0===(o=this.variablesPerIndex[s=this.varIndexByCol[r]])?"c"+s:o.id).length>5?l+=" ":h+="\t",u[r]=l,f+=h+a;console.log(f);var p=this.matrix[this.costRowIndex],g="\t";for(i=1;i<this.width;i+=1)g+="\t",g+=u[i],g+=p[i].toFixed(5);for(g+="\t"+u[0]+p[0].toFixed(5),console.log(g+"\tZ"),n=1;n<this.height;n+=1){for(c=this.matrix[n],d="\t",r=1;r<this.width;r+=1)d+="\t"+u[r]+c[r].toFixed(5);d+="\t"+u[0]+c[0].toFixed(5),a=void 0===(o=this.variablesPerIndex[s=this.varIndexByRow[n]])?"c"+s:o.id,console.log(d+"\t"+a)}console.log("");var b=this.optionalObjectives.length;if(b>0){console.log("    Optional objectives:");for(var v=0;v<b;v+=1){var m=this.optionalObjectives[v].reducedCosts,y="";for(i=1;i<this.width;i+=1)y+=m[i]<0?"":" ",y+=u[i],y+=m[i].toFixed(5);y+=(m[0]<0?"":" ")+u[0]+m[0].toFixed(5),console.log(y+" z"+v)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this},kt.prototype.copy=function(){var t=new kt(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],i=0;i<this.optionalObjectives.length;i++)e[i]=this.optionalObjectives[i].copy();t.optionalObjectives=e;for(var r=this.matrix,n=new Array(this.height),o=0;o<this.height;o++)n[o]=r[o].slice();return t.matrix=n,t},kt.prototype.save=function(){this.savedState=this.copy()},kt.prototype.restore=function(){if(null!==this.savedState){var t,e,i=this.savedState,r=i.matrix;for(this.nVars=i.nVars,this.model=i.model,this.variables=i.variables,this.variablesPerIndex=i.variablesPerIndex,this.unrestrictedVars=i.unrestrictedVars,this.lastElementIndex=i.lastElementIndex,this.width=i.width,this.height=i.height,t=0;t<this.height;t+=1){var n=r[t],o=this.matrix[t];for(e=0;e<this.width;e+=1)o[e]=n[e]}var s=i.varIndexByRow;for(e=0;e<this.height;e+=1)this.varIndexByRow[e]=s[e];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var a=i.varIndexByCol;for(t=0;t<this.width;t+=1)this.varIndexByCol[t]=a[t];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var l=i.rowByVarIndex,h=i.colByVarIndex,c=0;c<this.nVars;c+=1)this.rowByVarIndex[c]=l[c],this.colByVarIndex[c]=h[c];if(i.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var d=0;d<i.optionalObjectives.length;d++){var f=i.optionalObjectives[d].copy();this.optionalObjectives[d]=f,this.optionalObjectivePerPriority[f.priority]=f}}}},kt.prototype.getMostFractionalVar=function(){for(var t=0,e=null,i=null,r=this.model.integerVariables,n=r.length,o=0;o<n;o++){var s=r[o].index,a=this.rowByVarIndex[s];if(-1!==a){var l=this.matrix[a][this.rhsColumn],h=Math.abs(l-Math.round(l));t<h&&(t=h,e=s,i=l)}}return new Nt(e,i)},kt.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,i=null,r=this.model.integerVariables,n=r.length,o=0;o<n;o++){var s=r[o],a=s.index,l=this.rowByVarIndex[a];if(-1!==l){var h=this.matrix[l][this.rhsColumn];if(Math.abs(h-Math.round(h))>this.precision){var c=s.cost;t>c&&(t=c,e=a,i=h)}}}return new Nt(e,i)},kt.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var i=this.matrix[e][this.rhsColumn];(i-=Math.floor(i))<this.precision&&-i<this.precision&&(t+=1)}return t},kt.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,i=0;i<e;i++){var r=this.rowByVarIndex[t[i].index];if(-1!==r){var n=this.matrix[r][this.rhsColumn];if(Math.abs(n-Math.round(n))>this.precision)return!1}}return!0},kt.prototype.computeFractionalVolume=function(t){for(var e=-1,i=1;i<this.height;i+=1)if(this.variablesPerIndex[this.varIndexByRow[i]].isInteger){var r=this.matrix[i][this.rhsColumn];if(r=Math.abs(r),Math.min(r-Math.floor(r),Math.floor(r+1))<this.precision){if(!t)return 0}else-1===e?e=r:e*=r}return-1===e?0:e};var Lt=kt;function Wt(t,e,i){this.type=t,this.varIndex=e,this.value=i}function Dt(t,e){this.relaxedEvaluation=t,this.cuts=e}function Ft(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}kt.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var i=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*i&&(e=!1)}},kt.prototype.branchAndCut=function(){var t=[],e=0,i=this.model.tolerance,r=!0,n=1e99;this.model.timeout&&(n=Date.now()+this.model.timeout);for(var o=1/0,s=null,a=[],l=0;l<this.optionalObjectives.length;l+=1)a.push(1/0);var h=new Dt(-1/0,[]);for(t.push(h);t.length>0&&!0===r&&Date.now()<n;)if(i>0&&o<(this.model.isMinimization?this.bestPossibleEval*(1+i):this.bestPossibleEval*(1-i))&&(r=!1),!((h=t.pop()).relaxedEvaluation>o)){var c=h.cuts;if(this.applyCuts(c),e++,!1!==this.feasible){var d=this.evaluation;if(!(d>o)){if(d===o){for(var f=!0,u=0;u<this.optionalObjectives.length&&!(this.optionalObjectives[u].reducedCosts[0]>a[u]);u+=1)if(this.optionalObjectives[u].reducedCosts[0]<a[u]){f=!1;break}if(f)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===e)return void(this.branchAndCutIterations=e);s=h,o=d;for(var p=0;p<this.optionalObjectives.length;p+=1)a[p]=this.optionalObjectives[p].reducedCosts[0]}else{1===e&&this.save();for(var g=this.getMostFractionalVar(),b=g.index,v=[],m=[],y=c.length,w=0;w<y;w+=1){var x=c[w];x.varIndex===b?"min"===x.type?m.push(x):v.push(x):(v.push(x),m.push(x))}var I=Math.ceil(g.value),C=Math.floor(g.value),S=new Wt("min",b,I);v.push(S);var k=new Wt("max",b,C);m.push(k),t.push(new Dt(d,v)),t.push(new Dt(d,m)),t.sort(Ft)}}}}null!==s&&this.applyCuts(s.cuts),this.branchAndCutIterations=e};var $t={},At=zt.Constraint,Ht=zt.Equality,qt=zt.Variable,Ut=zt.IntegerVariable;function Qt(t,e){this.tableau=new kt(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var Gt=Qt;Qt.prototype.minimize=function(){return this.isMinimization=!0,this},Qt.prototype.maximize=function(){return this.isMinimization=!1,this},Qt.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},Qt.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(t)},Qt.prototype.smallerThan=function(t){var e=new At(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},Qt.prototype.greaterThan=function(t){var e=new At(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},Qt.prototype.equal=function(t){var e=new At(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var i=new At(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(i),new Ht(e,i)},Qt.prototype.addVariable=function(t,e,i,r,n){if("string"==typeof n)switch(n){case"required":n=0;break;case"strong":n=1;break;case"medium":n=2;break;case"weak":n=3;break;default:n=0}var o,s=this.tableau.getNewElementIndex();return null==e&&(e="v"+s),null==t&&(t=0),null==n&&(n=0),i?(o=new Ut(e,t,s,n),this.integerVariables.push(o)):o=new qt(e,t,s,n),this.variables.push(o),this.tableau.variablesPerIndex[s]=o,r&&(this.unrestrictedVariables[s]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(o),o},Qt.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e?(this.constraints.splice(e,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},Qt.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this},Qt.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(-1!==e)return this.variables.splice(e,1),!0===this.tableauInitialized&&this.tableau.removeVariable(t),this;console.warn("[Model.removeVariable] Variable not present in model")},Qt.prototype.updateRightHandSide=function(t,e){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(t,e),this},Qt.prototype.updateConstraintCoefficient=function(t,e,i){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(t,e,i),this},Qt.prototype.setCost=function(t,e){var i=t-e.cost;return!1===this.isMinimization&&(i=-i),e.cost=t,this.tableau.updateCost(e,i),this},Qt.prototype.loadJson=function(t){this.isMinimization="max"!==t.opType;for(var e=t.variables,i=t.constraints,r={},n={},o=Object.keys(i),s=o.length,a=0;a<s;a+=1){var l,h,c=o[a],d=i[c],f=d.equal,u=d.weight,p=d.priority,g=void 0!==u||void 0!==p;if(void 0===f){var b=d.min;void 0!==b&&(l=this.greaterThan(b),r[c]=l,g&&l.relax(u,p));var v=d.max;void 0!==v&&(h=this.smallerThan(v),n[c]=h,g&&h.relax(u,p))}else{l=this.greaterThan(f),r[c]=l,h=this.smallerThan(f),n[c]=h;var m=new Ht(l,h);g&&m.relax(u,p)}}var y=Object.keys(e),w=y.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),0===this.tolerance&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),this.checkForCycles=void 0===t.options.exitOnCycles||t.options.exitOnCycles);for(var x=t.ints||{},I=t.binaries||{},C=t.unrestricted||{},S=t.optimize,k=0;k<w;k+=1){var B=y[k],T=e[B],P=!!I[B],E=this.addVariable(T[S]||0,B,!!x[B]||P,!!C[B]);P&&this.smallerThan(1).addTerm(1,E);var O=Object.keys(T);for(a=0;a<O.length;a+=1){var M=O[a];if(M!==S){var V=T[M],R=r[M];void 0!==R&&R.addTerm(V,E);var j=n[M];void 0!==j&&j.addTerm(V,E)}}}return this},Qt.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},Qt.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},Qt.prototype.isFeasible=function(){return this.tableau.feasible},Qt.prototype.save=function(){return this.tableau.save()},Qt.prototype.restore=function(){return this.tableau.restore()},Qt.prototype.activateMIRCuts=function(t){this.useMIRCuts=t},Qt.prototype.debug=function(t){this.checkForCycles=t},Qt.prototype.log=function(t){return this.tableau.log(t)};var Xt={CleanObjectiveAttributes:function(t){var e,i,r;if("string"==typeof t.optimize){if(t.constraints[t.optimize]){for(i in e=Math.random(),t.variables)t.variables[i][t.optimize]&&(t.variables[i][e]=t.variables[i][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}return t}for(r in t.optimize)if(t.constraints[r])if("equal"===t.constraints[r])delete t.optimize[r];else{for(i in e=Math.random(),t.variables)t.variables[i][r]&&(t.variables[i][e]=t.variables[i][r]);t.constraints[e]=t.constraints[r],delete t.constraints[r]}return t}},Yt=function(t){return t.length?function(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},i={opType:"",optimize:"_obj",constraints:{},variables:{}},r={">=":"min","<=":"max","=":"equal"},n="",o=null,s="",a="",l="",h=0;"string"==typeof t&&(t=t.split("\n"));for(var c=0;c<t.length;c++)if(l="__"+c,o=null,e.is_objective.test(n=t[c]))i.opType=n.match(/(max|min)/gi)[0],(o=n.match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")})).slice(1)).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0].replace(/\;$/,""),i.variables[a]=i.variables[a]||{},i.variables[a]._obj=s}));else if(e.is_int.test(n))o=n.match(e.parse_int).slice(1),i.ints=i.ints||{},o.forEach((function(t){t=t.replace(";",""),i.ints[t]=1}));else if(e.is_bin.test(n))o=n.match(e.parse_bin).slice(1),i.binaries=i.binaries||{},o.forEach((function(t){t=t.replace(";",""),i.binaries[t]=1}));else if(e.is_constraint.test(n)){var d=n.indexOf(":");(o=(-1===d?n:n.slice(d+1)).match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")}))).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0],i.variables[a]=i.variables[a]||{},i.variables[a][l]=s})),h=parseFloat(n.match(e.parse_rhs)[0]),n=r[n.match(e.parse_dir)[0]],i.constraints[l]=i.constraints[l]||{},i.constraints[l][n]=h}else e.is_unrestricted.test(n)&&(o=n.match(e.parse_int).slice(1),i.unrestricted=i.unrestricted||{},o.forEach((function(t){t=t.replace(";",""),i.unrestricted[t]=1})));return i}(t):function(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",i={max:"<=",min:">=",equal:"="},r=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType)for(var n in e+=t.opType+":",t.variables)t.variables[n][n]=t.variables[n][n]?t.variables[n][n]:1,t.variables[n][t.optimize]&&(e+=" "+t.variables[n][t.optimize]+" "+n.replace(r,"_"));else e+="max:";for(var o in e+=";\n\n",t.constraints)for(var s in t.constraints[o])if(void 0!==i[s]){for(var a in t.variables)void 0!==t.variables[a][o]&&(e+=" "+t.variables[a][o]+" "+a.replace(r,"_"));e+=" "+i[s]+" "+t.constraints[o][s],e+=";\n"}if(t.ints)for(var l in e+="\n\n",t.ints)e+="int "+l.replace(r,"_")+";\n";if(t.unrestricted)for(var h in e+="\n\n",t.unrestricted)e+="unrestricted "+h.replace(r,"_")+";\n";return e}(t)};function Jt(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})})),e}var Zt=Jt(Object.freeze({__proto__:null,default:{}}));function Kt(t){return(t=(t=t.replace("\\r\\n","\r\n")).split("\r\n")).filter((function(t){return!0!==new RegExp(" 0$","gi").test(t)&&!1!==new RegExp("\\d$","gi").test(t)})).map((function(t){return t.split(/\:{0,1} +(?=\d)/)})).reduce((function(t,e,i){return t[e[0]]=e[1],t}),{})}var te={lpsolve:{reformat:Yt,solve:function(t){return new Promise((function(e,i){"undefined"!=typeof window&&i("Function Not Available in Browser");var r=Yt(t);t.external||i("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||i("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||i("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||i("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),Zt.writeFile(t.external.tempName,r,(function(r,n){if(r)i(r);else{var o=Zt.execFile;t.external.args.push(t.external.tempName),o(t.external.binPath,t.external.args,(function(t,r){t?1===t.code?e(Kt(r)):i({code:t.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[t.code],data:r}):e(Kt(r))}))}}))}))}}},ee=function(t,e){var i,r,n,o,s,a=e.optimize,l=JSON.parse(JSON.stringify(e.optimize)),h=Object.keys(e.optimize),c=0,d={},f="",u={},p=[];for(delete e.optimize,r=0;r<h.length;r++)l[h[r]]=0;for(r=0;r<h.length;r++){for(s in e.optimize=h[r],e.opType=a[h[r]],i=t.Solve(e,void 0,void 0,!0),h)if(!e.variables[h[s]])for(o in i[h[s]]=i[h[s]]?i[h[s]]:0,e.variables)e.variables[o][h[s]]&&i[o]&&(i[h[s]]+=i[o]*e.variables[o][h[s]]);for(f="base",n=0;n<h.length;n++)f+=i[h[n]]?"-"+(1e3*i[h[n]]|0)/1e3:"-0";if(!d[f]){for(d[f]=1,c++,n=0;n<h.length;n++)i[h[n]]&&(l[h[n]]+=i[h[n]]);delete i.feasible,delete i.result,p.push(i)}}for(r=0;r<h.length;r++)e.constraints[h[r]]={equal:l[h[r]]/c};for(r in e.optimize="cheater-"+Math.random(),e.opType="max",e.variables)e.variables[r].cheater=1;for(r in p)for(o in p[r])u[o]=u[o]||{min:1e99,max:-1e99};for(r in u)for(o in p)p[o][r]?(p[o][r]>u[r].max&&(u[r].max=p[o][r]),p[o][r]<u[r].min&&(u[r].min=p[o][r])):(p[o][r]=0,u[r].min=0);return{midpoint:i=t.Solve(e,void 0,void 0,!0),vertices:p,ranges:u}},ie=zt.Constraint,re=zt.Variable,ne=zt.Numeral,oe=zt.Term,se=function(){this.Model=Gt,this.branchAndCut=$t,this.Constraint=ie,this.Variable=re,this.Numeral=ne,this.Term=oe,this.Tableau=Lt,this.lastSolvedModel=null,this.External=te,this.Solve=function(t,e,i,r){if(r)for(var n in Xt)t=Xt[n](t);if(!t)throw new Error("Solver requires a model to operate on");if("object"==typeof t.optimize&&Object.keys(t.optimize>1))return ee(this,t);if(t.external){var o=Object.keys(te);if(o=JSON.stringify(o),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+o);if(!te[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+o);return te[t.external.solver].solve(t)}t instanceof Gt==0&&(t=new Gt(e).loadJson(t));var s=t.solve();if(this.lastSolvedModel=t,s.solutionSet=s.generateSolutionSet(),i)return s;var a={};return a.feasible=s.feasible,a.result=s.evaluation,a.bounded=s.bounded,s._tableau.__isIntegral&&(a.isIntegral=!0),Object.keys(s.solutionSet).forEach((function(t){0!==s.solutionSet[t]&&(a[t]=s.solutionSet[t])})),a},this.ReformatLP=Yt,this.MultiObjective=function(t){return ee(this,t)}};"object"==typeof window?window.solver=new se:"object"==typeof self&&(self.solver=new se);var ae=new se;function le(){}function he(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ce(t,e){let i;if(void 0===e)for(const r of t)null!=r&&(i<r||void 0===i&&r>=r)&&(i=r);else{let r=-1;for(let n of t)null!=(n=e(n,++r,t))&&(i<n||void 0===i&&n>=n)&&(i=n)}return i}function de(t,e){let i;if(void 0===e)for(const r of t)null!=r&&(i>r||void 0===i&&r>=r)&&(i=r);else{let r=-1;for(let n of t)null!=(n=e(n,++r,t))&&(i>n||void 0===i&&n>=n)&&(i=n)}return i}function fe(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function ue(t,e,i){if(r=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let i of t)null!=i&&(i=+i)>=i&&(yield i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(r=+r)>=r&&(yield r)}}(t,i))).length){if((e=+e)<=0||r<2)return de(t);if(e>=1)return ce(t);var r,n=(r-1)*e,o=Math.floor(n),s=ce(function t(e,i,r=0,n=e.length-1,o=he){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(s-h)/s)*(a-s/2<0?-1:1);t(e,i,Math.max(r,Math.floor(i-a*h/s+c)),Math.min(n,Math.floor(i+(s-a)*h/s+c)),o)}const s=e[i];let a=r,l=n;for(fe(e,r,i),o(e[n],s)>0&&fe(e,r,n);a<l;){for(fe(e,a,l),++a,--l;o(e[a],s)<0;)++a;for(;o(e[l],s)>0;)--l}0===o(e[r],s)?fe(e,r,l):(++l,fe(e,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}return e}(t,o).subarray(0,o+1));return s+(de(t.subarray(o+1))-s)*(n-o)}}function pe(t,e){return+!(t instanceof yt)+ +!(e instanceof yt)}function ge(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return function t(e,i,r,n,o,s,a){const[l,h]=o;function c(t){e(t);for(const e of t){const t=e.layer;if(void 0===t)throw new Error(`layering did not assign layer to node '${e.id}'`);if(t<0)throw new Error(`layering assigned a negative layer (${t}) to node '${e.id}'`)}const o=function(t){const e=[];for(const i of t.descendants()){const t=i.layer;(e[t]||(e[t]=[])).push(i),i.dataChildren=i.dataChildren.map(r=>{const n=r.child.layer;if(n<=t)throw new Error(`layering left child node "${r.child.id}" (${n}) with a greater or equal layer to parent node "${i.id}" (${t})`);let o=r.child;for(let s=n-1;s>t;s--){let t;t=a?`${i.id}->${r.child.id} (${s})`:`${i.id}\0${r.child.id}\0${s}`;const n=new yt(t);n.dataChildren.push(new nt(o,void 0)),(e[s]||(e[s]=[])).push(n),o=n}return new nt(o,r.data)})}return e}(t);if(1===o.length){const[t]=o;for(const e of t)e.y=h/2}else{const t=n?h:h/(o.length-1);for(const[e,i]of o.entries())for(const r of i)r.y=t*e}if(o.every(t=>1===t.length))for(const[e]of o)e.x=l/2;else if(1===o.length){const[t]=o;bt(t,s);const e=t,i=n?e.length-1:1;for(const r of e)r.x*=l*i}else{i(o),r(o,s);for(const i of o)for(const t of i)if(void 0===t.x)throw new Error(`coord didn't assign an x to node '${t.id}'`);const t=o,e=n?Math.max(...o.map(t=>t.length))-1:1;for(const i of t)for(const t of i)t.x*=l*e}const c=t;return function(t){for(const e of t)e instanceof yt||(e.dataChildren=e.dataChildren.map(t=>{let i=t.child;const r=[{x:e.x,y:e.y}];for(;i instanceof yt;)r.push({x:i.x,y:i.y}),[i]=i.ichildren();return r.push({x:i.x,y:i.y}),new nt(i,t.data,r)}))}(c),c}return c.layering=function(l){return void 0===l?e:t(l,i,r,n,o,s,a)},c.decross=function(l){return void 0===l?i:t(e,l,r,n,o,s,a)},c.coord=function(l){return void 0===l?r:t(e,i,l,n,o,s,a)},c.size=function(l){return void 0!==l?t(e,i,r,!1,l,s,a):n?null:o},c.nodeSize=function(l){return void 0!==l?t(e,i,r,!0,l,s,a):n?o:null},c.separation=function(l){return void 0===l?s:t(e,i,r,n,o,l,a)},c.debug=function(l){return void 0===l?a:t(e,i,r,n,o,s,l)},c}(function(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return function t(e,i){const r=i?"":"\0",n=i?"rank: ":"\0",o=i?" -> ":"\0";function s(t){return`${r}${t.id}`}function a(t){return`${t.source.id}${o}${t.target.id}`}function l(t,e){return`${n}${t.id}${o}${e.id}`}function h(t){const i=Object.create(null),r=Object.create(null),n=Object.create(null),o=[];for(const a of t){const t=s(a);r[t]=1,i[t]={opt:a.children.length};const n=e(a);void 0!==n&&o.push([n,a])}for(const e of t.ilinks()){const t=i[s(e.source)],r=i[s(e.target)],o=a(e);n[o]={min:1},t[o]=-1,t.opt++,r[o]=1,r.opt--}let[h,...c]=o.sort(([t],[e])=>t-e);for(const e of c){const[t,r]=h,[o,a]=e,c=i[s(r)],d=i[s(a)],f=l(r,a);if(t<o)n[f]={min:1},c[f]=-1,d[f]=1;else{const t=l(a,r);n[f]={min:0},n[t]={min:0},c[f]=-1,c[t]=1,d[f]=1,d[t]=-1}h=e}const d=ae.Solve({optimize:"opt",opType:"max",constraints:n,variables:i,ints:r}),{feasible:f}=d,u=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i}(d,["feasible"]);if(!f)throw o.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const e of t)e.layer=u[s(e)]||0}return h.rank=function(r){return void 0===r?e:t(r,i)},h.debug=function(r){return void 0===r?i:t(e,r)},h}(le,!1)}(),function(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return function t(e){function i(t){t.slice(0,t.length-1).forEach((i,r)=>e(i,t[r+1]))}return i.order=function(i){return void 0===i?e:t(i)},i}(function(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);return function(t,e){const i=new rt;for(const[o,s]of t.entries())for(const t of s.ichildren())i.setIfAbsent(t.id,[]).push(o);const r=new rt;let n=-1;for(const o of e){const e=ue(i.getDefault(o.id,[]),.5,void 0);void 0===e?(r.set(o.id,n),n=+!((n+1)/(t.length+1))*(t.length+1)-1):r.set(o.id,e)}e.sort((t,e)=>r.getThrow(t.id)-r.getThrow(e.id))}}())}(),function(...t){if(t.length)throw new Error(`got arguments to quad(${t}), but constructor takes no aruguments.`);return function t(e,i,r,n,o){function s(t,s,a){const l=function(t){const e=new rt;let i=0;for(const r of t)for(const t of r)e.set(t.id,i++);return e}(t),[h,c,d,f]=function(t,e,i){const r=1+Math.max(...e.values()),n=[],o=[];for(const a of t){let[t,...s]=a;for(const a of s){const s=e.getThrow(t.id),l=e.getThrow(a.id),h=new Array(r).fill(0);h[s]=1,h[l]=-1,n.push(h),o.push(-i(t,a)),t=a}}const s=new Array(r).fill(0);return[new Array(r).fill(null).map(()=>new Array(r).fill(0)),s,n,o]}(t,l,s);for(const o of t)for(const t of o){const o=l.getThrow(t.id),s=t instanceof yt?i:e;for(const a of t.ichildren()){const t=l.getThrow(a.id),c=a instanceof yt?n:r;vt(h,o,t,s+(a instanceof yt?i:e));for(const e of a.ichildren())mt(h,o,t,l.getThrow(e.id),c)}}for(let[e,...i]of t)for(const t of i)a.getThrow(e.id)!==a.getThrow(t.id)&&vt(h,l.getThrow(e.id),l.getThrow(t.id),o),e=t;!function(t,e,i){const r=Math.min(...i),n=Math.max(...i)-r;if(n>0)for(const o of t)for(const t of o){const o=e.getThrow(t.id);t.x=(i[o]-r)/n}else for(const o of t)for(const t of o)t.x=.5}(t,l,function(t,e,i,r,n=0){e.pop(),t.pop(),t.forEach(t=>t.pop()),i.forEach(t=>t.pop());const o=function(t,e,i,r,n){const o=[[0]],s=[0],a=[[0]],l=[0];for(const d of t){const t=[0];t.push(...d),o.push(t)}s.push(...e),a.push(...e.map(()=>[0]));for(const d of i)for(const[t,e]of d.entries())a[t+1].push(-e);l.push(...r.map(t=>-t));const{solution:h,message:c}=gt(o,s,a,l,n);if(c.length)throw new Error("quadprog failed with: "+c);return h.shift(),h}(t,e,i,r,n);return o.push(0),o}(h,c,d,f))}function a(t,o){if(0===e&&0===r)throw new Error("node vertical weight or node curve weight needs to be positive");if(0===i&&0===n)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const a=function(t){const e=new rt;for(const n of t.slice().reverse())for(const t of n){for(const i of t.ichildren())e.delete(i.id);e.set(t.id,t)}const i=new at([...e.values()]).split(),r=new rt;for(const[n,o]of i.entries())for(const t of o)r.set(t.id,n);return r}(t);for(const e of function(t,e){const i=[];let r=[],n=new Set;for(const o of t){const t=new Set(o.map(t=>e.getThrow(t.id)));it(n,t)||i.push(r=[]),r.push(o),n=t}return i}(t,a))if(e.every(t=>1===t.length))for(const[t]of e)t.x=.5;else if(1===e.length){const[t]=e;bt(t,o)}else s(e,o,a)}return a.vertical=function(s){if(void 0===s)return[e,i];const[a,l]=s;if(a<0||l<0)throw new Error(`weights must be non-negative, but were ${a} and ${l}`);return t(a,l,r,n,o)},a.curve=function(s){if(void 0===s)return[r,n];const[a,l]=s;if(a<0||l<0)throw new Error(`weights must be non-negative, but were ${a} and ${l}`);return t(e,i,a,l,o)},a.component=function(s){if(void 0===s)return o;if(s<=0)throw new Error("weight must be positive, but was "+s);return t(e,i,r,n,s)},a}(1,0,0,1,1)}(),!1,[1,1],pe,!1)}var be=function(t,e){return t<e};function ve(t){if(!(this instanceof ve))return new ve(t);this.array=[],this.size=0,this.compare=t||be}ve.prototype.clone=function(){var t=new ve(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},ve.prototype.add=function(t){var e,i,r=this.size;for(this.array[this.size]=t,this.size+=1;r>0&&this.compare(t,i=this.array[e=r-1>>1]);)this.array[r]=i,r=e;this.array[r]=t},ve.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},ve.prototype._percolateUp=function(t,e){for(var i,r,n=this.array[t];t>0&&(r=this.array[i=t-1>>1],e||this.compare(n,r));)this.array[t]=r,t=i;this.array[t]=n},ve.prototype._percolateDown=function(t){for(var e,i,r,n=this.size,o=this.size>>>1,s=this.array[t];t<o&&(r=this.array[e=1+(t<<1)],(i=e+1)<n&&this.compare(this.array[i],r)&&(e=i,r=this.array[i]),this.compare(r,s));)this.array[t]=r,t=e;this.array[t]=s},ve.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},ve.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},ve.prototype._batchRemove=function(t,e){var i=new Array(e||this.size),r=0;if("function"==typeof t&&this.size)for(var n=0;n<this.size&&r<i.length;)t(this.array[n])?(i[r]=this._removeAt(n),r++,n>>=1):n++;return i.length=r,i},ve.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},ve.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},ve.prototype.peek=function(){if(0!=this.size)return this.array[0]},ve.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},ve.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},ve.prototype.trim=function(){this.array=this.array.slice(0,this.size)},ve.prototype.isEmpty=function(){return 0===this.size},ve.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,i=this.clone();!i.isEmpty();)t(i.poll(),e++)},ve.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,i=this.array,r=new ve((function(t,r){return e(i[t],i[r])}));t=Math.min(this.size,t);var n=new Array(t),o=0;for(r.add(0);o<t;){var s=r.poll();n[o++]=this.array[s];var a=1+(s<<1),l=a+1;a<this.size&&r.add(a),l<this.size&&r.add(l)}return n};var me=i("mWib"),ye=i("Bou+"),we=i("RwDx"),xe=i("EmTj"),Ie=i("PBFl");const Ce=["chart"],Se=["weightSlider"];let ke=(()=>{class t{constructor(t,e){this.bloomaResizeListenerService=t,this.dhDialogService=e,this.profileSelected=new s.o,this.itemWeightChanged=new s.o,this.childProfileWeightChanged=new s.o,this.linkClicked=new s.o,this.addSubProfileToProfile=new s.o,this.disconnectLinkClicked=new s.o,this._data=null,this.sliderContainerStyle={width:"0",height:"0",padding:"0"},this.unsubscribe$=new l.a,this.viewInitialized=!1,this.margin={top:10,bottom:20,left:150,right:10},this.totalComponentWidth=0,this.isListening=!1,this.totalComponentHeight=0,this.nodeSquareWidth=100,this.nodeSquareHeight=60,this.draggableSquareDimension=10,this.dragStartX=0,this.dragStartY=0,this.dragX=0,this.dragY=0,this.linkColor="gray",this.selectedNodeColor="green",this.clickedLinkSource=null,this.clickedLinkTarget=null,this.weightTargetType=null,this.clickedLinkEvent=null,this.sliderElementHeight=124,this.sliderElementWidth=124,this.previousGraphAreaTransform=null,this.profileRectBorderColor="blue",this.profileItemRectBorderColor="black",this.profileRectBackgroundColor="rgb(199,235,243)",this.profileItemRectBackgroundColor="rgb(185,244,185)",this.svgBackgroundColor="rgb(219,219,219)";const i=new l.a;i.pipe(Object(me.a)(400),Object(a.a)(this.unsubscribe$)).subscribe(t=>this.createChart()),this.createSubject=i}get data(){return this._data}set data(t){this._data=t,this.createSubject.next()}ngOnDestroy(){this.bloomaResizeListenerService.unListenToElementResize(this.chartContainer.nativeElement),this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}listenToElementSizeChange(t){this.isListening||(this.isListening=!0,this.bloomaResizeListenerService.listenToElementResize(t).pipe(Object(a.a)(this.unsubscribe$)).subscribe(t=>{this.createSubject.next()}))}ngAfterViewInit(){this.viewInitialized=!0,this.listenToElementSizeChange(this.chartContainer.nativeElement),setTimeout(()=>{this.createSubject.next()},800)}createChart(){if(!this.viewInitialized)return;if(!this.data)return;const t=this.chartContainer.nativeElement;this.totalComponentWidth=t.offsetWidth,this.totalComponentHeight=t.offsetHeight,0!=this.totalComponentHeight&&(this.initSvg(),this.setSvgHeight(),this.drawHierarchy(),this.setUpZoomBehavior(),setTimeout(()=>{Object(s.lb)(this)},50))}initSvg(){if(!this.svg){const t=ye.k(this.chartContainer.nativeElement).append("svg");t.style("background","lightgray"),this.svg=t;const e=5,i=5,r=e/2,n=i/2,o=[[0,0],[0,5],[5,2.5]];this.svg.append("defs").append("marker").attr("id","arrow").attr("viewBox",[0,0,e,i]).attr("refX",r).attr("refY",n).attr("markerWidth",e).attr("markerHeight",i).attr("orient","auto-start-reverse").append("path").attr("d",ye.f()(o)).attr("stroke","black")}}setSvgHeight(){this.svg.attr("height",this.totalComponentHeight).attr("width",this.totalComponentWidth)}mouseOverProfile(t){this.dragTargetData=t}mouseLeaveProfile(t){this.dragTargetData=null}getDragBehavior(t){return ye.e().clickDistance(5).container(t).on("start",(t,e)=>{const i=this.svg.select("rect#r"+e.id);if(null!=i&&0!=i.size()){this.dragSourceNode=i;try{const t=+i.attr("original-x"),e=+i.attr("original-y");this.dragX=this.dragStartX=t,this.dragY=this.dragStartY=e}catch(r){}t.sourceEvent.stopPropagation(),t.sourceEvent.preventDefault()}}).on("drag",(t,e)=>{if(this.svg.select("rect#r"+e.id),0==this.dragStartX)return;this.dragX+=t.dx,this.dragY+=t.dy;const i=[[+this.dragStartX,+this.dragStartY],[this.dragX,this.dragY]],r=this.getDragLine(),n=ye.f();r.attr("d",n(i))}).on("end",()=>{if(this.removeDragLine(),this.dragStartX=0,this.dragStartY=0,null==this.dragSourceNode||null==this.dragTargetData)return;const t=this.dragSourceNode.attr("id").substr(1),e=this.dragTargetData.id;if(t==e)return;const i=this.profileMap[e];this.changeIntroducesCycle(this.profileMap[t],e)||i.parentIds.find(e=>e==t)||this.addSubProfileToProfile.next({parentProfileId:t,subProfileId:i.id})})}getRectColorForItemType(t){return"profile"===t?this.profileRectBorderColor:this.profileItemRectBorderColor}getRectBackgroundColorForItemType(t){return"profile"===t?this.profileRectBackgroundColor:this.profileItemRectBackgroundColor}changeIntroducesCycle(t,e){if(null==t.parentIds)return!1;if(null==t?void 0:t.parentIds.find(t=>t==e))return!0;for(const i of null==t?void 0:t.parentIds)return this.changeIntroducesCycle(this.profileMap[i],e)}removeDragLine(){this.svg.select(".drag-line").remove(),this.dragLine=null}getDragLine(){return this.dragLine||(this.dragLine=this.svg.select(".graph-area").append("path").attr("class","drag-line").style("stroke","red").style("fill","none")),this.dragLine}drawHierarchy(){const t=this.svg.select(".graph-area");if(this.previousGraphAreaTransform=null,t.size()>0){const e=t.node();this.previousGraphAreaTransform=ye.o(e)}this.svg.select(".graph-area").remove();const e=function(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return function t(e,i,r){function n(t){if(!t.length)throw new Error("can't stratify empty data");const i=t.map((t,i)=>new st(function(t){if("string"!=typeof t)throw new Error("id is supposed to be string but got type "+typeof t);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}(e(t,i)),t)),n=new Map;i.forEach(t=>{if(n.has(t.id))throw new Error("found a duplicate id: "+t.id);n.set(t.id,t)});const o=[];return i.forEach((t,e)=>{const i=r(t.data,e)||[];i.forEach(([e,i])=>{const r=n.get(e);if(!r)throw new Error("missing id: "+e);return r.dataChildren.push(new nt(t,i)),r}),i.length||o.push(t)}),function(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,i=new Set;let r=null;function n(t){if(e.has(t.id))return[];if(i.has(t.id))return r=t.id,[t.id];{i.add(t.id);let o=[];for(const e of t.ichildren())if(o=n(e),o.length)break;return i.delete(t.id),e.add(t.id),o.length&&null!==r&&o.push(t.id),r===t.id&&(r=null),o}}for(const o of t){const t=n(o);if(t.length)throw new Error("dag contained a cycle: "+t.reverse().join(" -> "))}for(const o of new at(t))if(new Set(o.ichildren().map(t=>t.id)).size!==o.dataChildren.length)throw new Error(`node '${o.id}' contained duplicate children`)}(o),o.length>1?new at(o):o[0]}return n.id=function(n){return void 0===n?e:t(n,i,r)},n.parentData=function(i){return void 0===i?r:t(e,function(t){function e(e,i){return(t(e,i)||[]).map(([t])=>t)}return e.wrapped=t,e}(i),i)},n.parentIds=function(r){return void 0===r?i:t(e,r,lt(r))},n}(ht,ct,lt(ct))}();if(!this.data||0==this.data.length)return;let i;try{i=e(this.data)}catch(h){return void this.dhDialogService.showMessage("error with local profile data. Please refresh")}const r=ge().nodeSize([150,390])(i),n=this.svg.append("g").attr("class","graph-area"),o=r.descendants(),s=this.getDragBehavior(n),a=n.append("g").attr("class","links-group"),l=r.links();a.selectAll("line").data(l).enter().append("line").attr("class","line").attr("stroke",this.linkColor).attr("stroke-width","5").attr("marker-end","url(#arrow)").attr("data-id-source",t=>"r"+t.source.id).attr("data-id-target",t=>"r"+t.target.id).attr("x1",t=>this.margin.left+t.source.y).attr("y1",t=>this.margin.top+t.source.x).attr("y2",t=>this.margin.top+t.target.x).on("mouseover",(t,e)=>{ye.k(t.srcElement).attr("stroke","red")}).on("mouseout",(t,e)=>{ye.k(t.srcElement).attr("stroke",this.linkColor)}).on("click",(t,e)=>{this.clickedLinkSource=e.source.id,this.clickedLinkTarget=e.target.data.originalId,this.weightTargetType=e.target.data.scores?"item":"childProfile",this.clickedLinkEvent=t,ye.k(t.srcElement).attr("stroke",this.linkColor),this.linkClicked.next(this.clickedLinkSource)}).each((t,e,i)=>{var r=ye.k(i[e]),n=this.calculateTargetBoxWidth(t.target.data.name);r.attr("x2",this.margin.left+t.target.y-n/2-5)}),n.append("g").attr("class","nodes-group").selectAll("g.node").data(o).enter().append("g").attr("class","node").attr("transform",t=>`translate(${this.margin.left+t.y},${this.margin.top+t.x})`).each((t,e,i)=>{const r=ye.k(i[e]),n=r.append("rect").attr("id","r"+t.id).attr("fill",t=>this.getRectBackgroundColorForItemType(t.data.itemType)).attr("original-x",this.margin.left+t.y).attr("original-y",this.margin.top+t.x).attr("stroke",t=>this.getRectColorForItemType(t.data.itemType)).call(s).on("click",(t,e)=>{this.setSelectedNode(e,t)}),o=r.append("text").attr("class","svg-text").attr("dx",10).text(t.data.name).on("click",(t,e)=>{const i=new Event("click",{});t.srcElement.parentElement.firstChild.dispatchEvent(i)}),a=o.node().getBBox(),l=ye.g([a.width+20,this.nodeSquareWidth]),h=ye.g([a.height,this.nodeSquareHeight]);n.attr("x",0-l/2).attr("class","profile-container").attr("y",-h/2).attr("width",l).attr("height",h),o.attr("x",0-l/2),n.attr("pointer-events","mouseover").on("mouseover",(t,e)=>{0!=this.dragStartX&&"profile"==e.data.itemType&&(t.target.setAttribute("stroke","red"),this.mouseOverProfile(e))}).on("mouseout",(t,e)=>{var i;null!=t.fromElement&&null!=t.toElement&&t.fromElement.parentElement!=t.toElement.parentElement&&(e.id!==(null===(i=this.selectedProfile)||void 0===i?void 0:i.id)&&t.target.setAttribute("stroke",this.getRectColorForItemType(e.data.itemType)),this.mouseLeaveProfile(e))})})}calculateTargetBoxWidth(t){const e=this.svg.append("text").attr("class","svg-text-to-remove").attr("dx",10).text(t),i=e.node().getBBox(),r=ye.g([i.width+20,this.nodeSquareWidth]);return e.remove(),r}setSelectedNode(t,e){this.setSelectedProfile(t),ye.l(".profile-container").attr("stroke",t=>this.getRectColorForItemType(t.data.itemType)),ye.k(e.srcElement).attr("stroke",this.selectedNodeColor)}saveNewWeight(){this.hideWeightSlider(),"item"==this.weightTargetType?this.itemWeightChanged.next({profileId:this.clickedLinkSource,updateProfileItemWeightDto:{newWeight:this.selectedWeight,profileItemName:this.clickedLinkTarget}}):this.childProfileWeightChanged.next({profileId:this.clickedLinkSource,subProfileId:this.clickedLinkTarget,updateSubProfileWeightDto:{newWeight:this.selectedWeight}})}hideWeightSlider(){ye.k(this.weightSliderContainer.nativeElement).transition().duration(200).style("opacity",0),this.sliderContainerStyle={width:"0",height:"0",padding:"0"}}disconnect(){this.hideWeightSlider(),this.disconnectLinkClicked.next({profileId:this.clickedLinkSource,childProfileToDelete:this.clickedLinkTarget})}showWeightSlider(){var t;this.selectedWeight=null!==(t=this.getLinkWeight(this.clickedLinkSource,this.clickedLinkTarget))&&void 0!==t?t:0;const e=ye.k(this.weightSliderContainer.nativeElement),i=this.selectTopForSlider(),r=this.selectLeftForSlider();this.sliderContainerStyle={width:"300px",left:r+"px",top:i+"px",padding:"10px"},e.transition().duration(200).style("opacity",1),Object(s.lb)(this)}selectTopForSlider(){return this.clickedLinkEvent.y+this.sliderElementHeight>=this.totalComponentHeight?this.totalComponentHeight-130:this.clickedLinkEvent.y}selectLeftForSlider(){return this.clickedLinkEvent.x+this.sliderElementWidth>=this.totalComponentWidth?this.totalComponentWidth-this.sliderElementWidth-10:this.clickedLinkEvent.x}weightChanged(t){this.selectedWeight=t.value}getLinkWeight(t,e){const i=this.weights[t];let r=i[e];r||(r=i[e.toUpperCase()]);const n=e.indexOf("_");return!r&&n>-1&&(r=i[e=e.substr(n+1)]),r}setUpZoomBehavior(){if(!this.data||0==this.data.length)return;const t=this.svg.select(".graph-area");var e=this.svg.select(".nodes-group").node();if(null==e)return;const i=e.getBBox(),r=[[0,0],[this.totalComponentWidth,this.totalComponentHeight]],n=[[0,-100],[i.width+this.margin.left+100,i.height]],o=ye.m().scaleExtent([.1,10]).extent(r).translateExtent(n).on("zoom",e=>{t.attr("transform",e.transform)});this.svg.call(o,ye.n.translate(0,this.totalComponentHeight/2).scale(.3)),this.previousGraphAreaTransform&&this.svg.call(o.transform,this.previousGraphAreaTransform)}setSelectedProfile(t){this.profileSelected.next({selectedNodeId:t.id,nodeType:t.data.itemType})}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(we.a),s.Nb(xe.a))},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-hierarchy"]],viewQuery:function(t,e){var i;1&t&&(s.Bc(Ce,!0),s.Bc(Se,!0)),2&t&&(s.kc(i=s.bc())&&(e.chartContainer=i.first),s.kc(i=s.bc())&&(e.weightSliderContainer=i.first))},inputs:{data:"data",weights:"weights",profileMap:"profileMap",selectedProfile:"selectedProfile"},outputs:{profileSelected:"profileSelected",itemWeightChanged:"itemWeightChanged",childProfileWeightChanged:"childProfileWeightChanged",linkClicked:"linkClicked",addSubProfileToProfile:"addSubProfileToProfile",disconnectLinkClicked:"disconnectLinkClicked"},decls:14,vars:3,consts:[["id","rent-comparable-graph",1,"rent-comparable-graph"],["chart",""],["id","weight-slider",1,"bg-yellow-200","overflow-hidden",3,"ngStyle"],["weightSlider",""],["min","1","max","100","step","1",3,"ngModel","ngModelChange","input"],[1,"flex"],["mat-flat-button","","color","primary",1,"mx-2",3,"click"],["mat-flat-button","","color","warn",1,"mx-2",3,"click"]],template:function(t,e){1&t&&(s.Ob(0,"div",0,1),s.Tb(2,"div",2,3),s.Tb(4,"div"),s.xc(5),s.Sb(),s.Tb(6,"mat-slider",4),s.ac("ngModelChange",(function(t){return e.selectedWeight=t}))("input",(function(t){return e.weightChanged(t)})),s.Sb(),s.Tb(7,"div",5),s.Tb(8,"button",6),s.ac("click",(function(){return e.saveNewWeight()})),s.xc(9,"Save"),s.Sb(),s.Tb(10,"button",7),s.ac("click",(function(){return e.hideWeightSlider()})),s.xc(11,"Cancel"),s.Sb(),s.Tb(12,"button",7),s.ac("click",(function(){return e.disconnect()})),s.xc(13,"Disconnect"),s.Sb(),s.Sb(),s.Sb()),2&t&&(s.Cb(2),s.ic("ngStyle",e.sliderContainerStyle),s.Cb(3),s.zc("Weight: ",e.selectedWeight,""),s.Cb(1),s.ic("ngModel",e.selectedWeight))},directives:[r.l,y.a,p.j,p.m,Ie.a],styles:[".rent-comparable-graph[_ngcontent-%COMP%]{height:inherit;width:inherit}#weight-slider[_ngcontent-%COMP%]{background-color:#fff;color:#000;position:absolute;opacity:0;width:0}#weight-slider[_ngcontent-%COMP%]   mat-slider[_ngcontent-%COMP%]{width:100%}.svg-text[_ngcontent-%COMP%]{pointer-events:none;-webkit-user-select:none;user-select:none}svg[_ngcontent-%COMP%]{background:#d3d3d3}"]}),t})();var Be=i("yDe4"),Te=i("C9XJ"),Pe=i("rxR5"),Ee=i("PC4E"),Oe=i("oYEq"),Me=i("pLgK");const Ve={selectionActions:{action:"none",profileNameForm:{dirty:!1,status:"",errors:{}},profileItemForm:{dirty:!1,status:"",errors:{}},subProfileWeightForm:{dirty:!1,status:"",errors:{}}},weights:{weights:{"d9ea040f-ed73-494f-a5eb-0e4350841f8f":{"57362726-9afd-4ca4-b92b-bf2d774827d7":1,"dealextract.grossloan":46,"dealextract.loanType":6},"ea6f12ea-b138-4166-a3b1-82a9ec1d6773":{222:89,"80948af3-6977-4dde-8c2d-0999db3dd0c8":1,"82fb9832-fc5c-4331-b37b-d535b7e5a0ae":1,"928815d6-07f7-4112-8aa9-a7e05027acf4":80,"9b96b645-9fcd-44e2-9acc-fa94e5c6e532":77,"b61e27a3-1d89-4d60-a978-bd4d3011f206":1,"bd6e8f08-57d7-4277-96d9-55e4c15dd305":25,"d9ea040f-ed73-494f-a5eb-0e4350841f8f":1},"b61e27a3-1d89-4d60-a978-bd4d3011f206":{"66768088-6045-4d22-b5ef-4900427337ed":1}},updateSubChildWeightStatus:null,updateItemWeightStatus:null,updateChildWeightStatus:null},auth:{key:"7d16daf3-6c6d-4c34-9e04-7231db4c4dd7"},profiles:{profiles:[{id:"d9ea040f-ed73-494f-a5eb-0e4350841f8f",originalId:"d9ea040f-ed73-494f-a5eb-0e4350841f8f",name:"Asset33333333333333333333333333333",owner:"9a12842b-939b-46cb-8a9d-d07c289fb825",publicProfile:!1,parentIds:["ea6f12ea-b138-4166-a3b1-82a9ec1d6773"],childrenIds:["d9ea040f-ed73-494f-a5eb-0e4350841f8f_dealextract.grossloan","d9ea040f-ed73-494f-a5eb-0e4350841f8f_dealextract.loanType"],itemType:"profile",scores:null},{id:"66768088-6045-4d22-b5ef-4900427337ed",originalId:"66768088-6045-4d22-b5ef-4900427337ed",name:"2222221",owner:"9a12842b-939b-46cb-8a9d-d07c289fb825",publicProfile:!1,parentIds:["b61e27a3-1d89-4d60-a978-bd4d3011f206"],childrenIds:[],itemType:"profile",scores:null},{id:"ea6f12ea-b138-4166-a3b1-82a9ec1d6773",originalId:"ea6f12ea-b138-4166-a3b1-82a9ec1d6773",name:"Main1222",owner:"9a12842b-939b-46cb-8a9d-d07c289fb825",publicProfile:!1,parentIds:[],childrenIds:["b61e27a3-1d89-4d60-a978-bd4d3011f206","d9ea040f-ed73-494f-a5eb-0e4350841f8f"],itemType:"profile",scores:null},{id:"b61e27a3-1d89-4d60-a978-bd4d3011f206",originalId:"b61e27a3-1d89-4d60-a978-bd4d3011f206",name:"22222",owner:"9a12842b-939b-46cb-8a9d-d07c289fb825",publicProfile:!1,parentIds:["ea6f12ea-b138-4166-a3b1-82a9ec1d6773"],childrenIds:["66768088-6045-4d22-b5ef-4900427337ed"],itemType:"profile",scores:null},{id:"d9ea040f-ed73-494f-a5eb-0e4350841f8f_dealextract.grossloan",originalId:"dealextract.grossloan",name:"dealextract.grossloan",owner:null,publicProfile:!0,parentIds:["d9ea040f-ed73-494f-a5eb-0e4350841f8f"],childrenIds:null,itemType:"numeric",scores:[{name:"1000000",score:80},{name:"10000000",score:50}]},{id:"d9ea040f-ed73-494f-a5eb-0e4350841f8f_dealextract.loanType",originalId:"dealextract.loanType",name:"dealextract.loanType",owner:null,publicProfile:!0,parentIds:["d9ea040f-ed73-494f-a5eb-0e4350841f8f"],childrenIds:null,itemType:"list",scores:[{name:"Eli Rabinovitz",score:100}]}],selectedProfile:null,errorGettingProfileData:null,errorDeletingProfile:null,errorCreatingRootProfile:null,errorCreatingSubProfile:null,errorRemovingSubProfile:null,errorUpdatingProfileName:null,errorCreatingProfileItem:null,errorUpdatingProfileItem:null,errorAddingExistingProfileAsSubProfile:null}};let Re=(()=>{class t{constructor(t,e){this.store=t,this.actions$=e,this.keyChanged$=new l.a,this.actions$.pipe(Object(Be.l)(Te.b)).subscribe(()=>{this.keyChanged$.next()})}selectProfile(t){return Object(o.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new Pe.m(t)).toPromise()}))}updateChildProfileLinkWeight(t){return Object(o.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new Oe.h(t)).toPromise(),!!this.store.selectSnapshot(Me.a.getUpdateSubChildWeightStatus)}))}disconectSubProfile(t){return Object(o.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new Pe.l(t)).toPromise(),!!this.store.selectSnapshot(Ee.a.getDisconnectSubProfileError)}))}setState(){this.store.reset(Ve)}}return t.\u0275fac=function(e){return new(e||t)(s.Xb(Be.h),s.Xb(Be.b))},t.\u0275prov=s.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),Object(o.b)([Object(Be.e)(Ee.a.getState)],t.prototype,"profileState$",void 0),Object(o.b)([Object(Be.e)(Me.a.getState)],t.prototype,"weightState$",void 0),t})();var je=i("HOZh");function ze(t,e){if(1&t&&s.Ob(0,"dh-profile-details",4),2&t){const t=s.dc(2).ngIf;s.ic("profile",t.selectedProfile)}}function _e(t,e){if(1&t){const t=s.Ub();s.Rb(0),s.Tb(1,"dh-hierarchy",2),s.ac("profileSelected",(function(e){return s.nc(t),s.dc(2).selectProfile(e)}))("linkClicked",(function(e){return s.nc(t),s.dc(2).linkClicked(e)}))("itemWeightChanged",(function(e){return s.nc(t),s.dc(2).itemWeightValueChanged(e)}))("childProfileWeightChanged",(function(e){return s.nc(t),s.dc(2).childProfileWeightValueChanged(e)}))("disconnectLinkClicked",(function(e){return s.nc(t),s.dc(2).disconnectLinkClicked(e)}))("addSubProfileToProfile",(function(e){return s.nc(t),s.dc(2).addSubProfileToProfile(e)})),s.Sb(),s.vc(2,ze,1,1,"dh-profile-details",3),s.Qb()}if(2&t){const t=e.ngIf,i=s.dc().ngIf,r=s.dc();s.Cb(1),s.ic("data",i.profiles)("profileMap",i.profileMap)("weights",t.weights)("selectedProfile",i.selectedProfile),s.Cb(1),s.ic("ngIf",r.fairlyBigScreen&&i.selectedProfile)}}function Ne(t,e){if(1&t&&(s.Rb(0),s.vc(1,_e,3,5,"ng-container",1),s.ec(2,"async"),s.Qb()),2&t){const t=s.dc();s.Cb(1),s.ic("ngIf",s.fc(2,1,t.profileVsService.weightState$))}}const Le=[{path:"",component:(()=>{class t{constructor(t,e,i,r,n,o,s){this.profileVsService=t,this.weightStateService=e,this.dhDialogService=i,this.breakpointObserver=r,this.profileStateService=n,this.selectionActionStateService=o,this.dialog=s,this.fairlyBigScreen=!0,this.breakpointObserver.observe("(max-width: 1200px)").subscribe(t=>{this.fairlyBigScreen=0==t.matches})}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){this.profileVsService.keyChanged$.subscribe(()=>Object(o.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const t=yield this.profileStateService.getProfiles();this.dhDialogService.hideLoading(),"error"==t&&this.dhDialogService.showMessage("error loading profile")})))}))}selectProfile(t){return Object(o.a)(this,void 0,void 0,(function*(){yield this.selectionActionStateService.clearForms(),yield this.profileVsService.selectProfile(t.selectedNodeId),this.fairlyBigScreen?Object(s.lb)(this):this.showProfileDetailsModal()}))}showProfileDetailsModal(){this.dialog.open(K,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",panelClass:"selected-dialog",data:{name:"test"}})}linkClicked(t){return Object(o.a)(this,void 0,void 0,(function*(){this.hierarchyComponent.showWeightSlider()}))}itemWeightValueChanged(t){return Object(o.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.weightStateService.updateItemLinkWeight(t);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error updating item weight":"Item weight updated")}))}childProfileWeightValueChanged(t){return Object(o.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.profileVsService.updateChildProfileLinkWeight(t);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error updating child profile weight":"Child profile weight updated")}))}disconnectLinkClicked(t){return Object(o.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Disconnect Sub Profile",message:"Are you sure you want to disconnect these profiles?"}).toPromise()))return;this.dhDialogService.showLoading();const e=yield this.profileVsService.disconectSubProfile(t);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error disconnecting sub profile":"Sub Profile Disconnected")}))}addSubProfileToProfile(t){return Object(o.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.profileStateService.conectSubProfile(t.parentProfileId,t.subProfileId);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(e?"Error connecting sub profile":"Sub Profile Connected")}))}}return t.\u0275fac=function(e){return new(e||t)(s.Nb(Re),s.Nb(T.a),s.Nb(xe.a),s.Nb(je.a),s.Nb(c.a),s.Nb(P.a),s.Nb(h.b))},t.\u0275cmp=s.Hb({type:t,selectors:[["dh-profile"]],viewQuery:function(t,e){var i;1&t&&s.Bc(ke,!0),2&t&&s.kc(i=s.bc())&&(e.hierarchyComponent=i.first)},decls:3,vars:3,consts:[[1,"flex"],[4,"ngIf"],[1,"block","flex-1","overflow-hidden",3,"data","profileMap","weights","selectedProfile","profileSelected","linkClicked","itemWeightChanged","childProfileWeightChanged","disconnectLinkClicked","addSubProfileToProfile"],["class","block border-l-4 px-10 text-base","style","width: 500px",3,"profile",4,"ngIf"],[1,"block","border-l-4","px-10","text-base",2,"width","500px",3,"profile"]],template:function(t,e){1&t&&(s.Tb(0,"div",0),s.vc(1,Ne,3,3,"ng-container",1),s.ec(2,"async"),s.Sb()),2&t&&(s.Cb(1),s.ic("ngIf",s.fc(2,1,e.profileVsService.profileState$)))},directives:[r.k,ke,J],pipes:[r.b],styles:["dh-hierarchy[_ngcontent-%COMP%]{height:calc(100vh - 76px)}"]}),t})()}];let We=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)},imports:[[n.a.forChild(Le)],n.a]}),t})();var De=i("R7+U"),Fe=i("W1gw");i("cqs0"),i("9bRT"),i("C05f"),i("ROBh"),i("xVbo"),i("5XID"),i("E5oP");let $e=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)}}),t})();var Ae=i("mFH5");i("g6G6"),i("YtkY");let He=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)},imports:[[$e,Ae.e],Ae.e]}),t})();var qe=i("bFHC"),Ue=i("evil");let Qe=(()=>{class t{}return t.\u0275mod=s.Lb({type:t}),t.\u0275inj=s.Kb({factory:function(e){return new(e||t)},providers:[xe.a],imports:[[g.a,r.c,We,p.g,p.o,y.b,Ie.b,v.d,m.b,Fe.b,He,qe.b,h.f,Ue.a,De.b]]}),t})()}}]);