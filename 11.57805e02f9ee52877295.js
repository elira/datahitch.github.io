(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"723k":function(e,t,i){"use strict";i.r(t),i.d(t,"ProfileModule",(function(){return ir}));var r=i("2kYt"),o=i("sEIs"),s=i("D57K"),n=i("EM62"),a=i("kuMc"),l=i("ZTXN"),c=i("OZ4H"),h=i("yD3o"),d=i("jOdJ");let u=(()=>{class e{transform(e,t){var i;if(null==e||(null===(i=null==e?void 0:e.childrenIds)||void 0===i?void 0:i.length)<1)return null;if(null==t)return null;var r=[];for(const o of null==e?void 0:e.childrenIds)this.addVirtualNodesToSubElements(r,o,t);return r}addVirtualNodesToSubElements(e,t,i){var r=i[t];if(null!=r)if("virtual"==(null==r?void 0:r.itemType))for(const o of null==r?void 0:r.childrenIds)this.addVirtualNodesToSubElements(e,o,i);else e.push(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Ob({name:"getRealSubItems",type:e,pure:!0}),e})(),f=(()=>{class e{transform(e,t){return null==e||null==t?null:0!=e.indexOf(t)?e:e.substr(t.length+1)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Ob({name:"removeParentIdFromSubProfile",type:e,pure:!0}),e})();var p=i("nIj0"),g=i("P/uR"),m=i("29Wa"),b=i("R7+U"),v=i("PBFl"),y=i("bFHC"),w=i("mFH5"),S=i("Cd2c");function x(e,t){if(1&e&&(n.Vb(0,"mat-option",9),n.Gc(1),n.Ub()),2&e){const e=t.$implicit;n.mc("value",e.value),n.Db(1),n.Ic(" ",e.viewValue," ")}}function I(e,t){if(1&e){const e=n.Wb();n.Tb(0),n.Tb(1,12),n.Vb(2,"tr"),n.Vb(3,"td",13),n.Vb(4,"mat-form-field",14),n.Vb(5,"mat-label"),n.Gc(6,"Name"),n.Ub(),n.Qb(7,"input",15),n.Ub(),n.Ub(),n.Vb(8,"td",16),n.Vb(9,"mat-form-field",14),n.Vb(10,"mat-label"),n.Gc(11,"Score"),n.Ub(),n.Qb(12,"input",17),n.Ub(),n.Ub(),n.Vb(13,"td",16),n.Vb(14,"button",18),n.cc("click",(function(){n.wc(e);const i=t.index;return n.gc(2).removeItem(i)})),n.Vb(15,"mat-icon"),n.Gc(16,"clear"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Sb(),n.Sb()}if(2&e){const e=t.index;n.Db(1),n.mc("formGroupName",e)}}function P(e,t){if(1&e&&(n.Tb(0,10),n.Ec(1,I,17,1,"ng-container",11),n.Sb()),2&e){const e=n.gc();n.Db(1),n.mc("ngForOf",e.valueScores.controls)}}let C=(()=>{class e{constructor(e){this.formBuilder=e,this.profileItemTypes=[{value:"geo",viewValue:"geo"},{value:"list",viewValue:"list"},{value:"numeric",viewValue:"numeric"},{value:"diff",viewValue:"diff"},{value:"diffpercentage",viewValue:"diffpercentage"}],this.newScoreIndex=1}ngOnInit(){this.profile&&(this.form=this.formBuilder.group({itemType:this.profile.itemType,valueScores:this.formBuilder.array(this.getFormGroupsForValueScores())}))}getFormGroupsForValueScores(){return this.profile.scores.map(e=>this.createFormGroupForRow(e.name,e.score))}removeItem(e){this.valueScores.removeAt(e)}createFormGroupForRow(e,t){return this.formBuilder.group({score:[t,[p.p.required]],name:[e,[p.p.required]]})}get valueScores(){return this.form.get("valueScores")}getProfileItemData(){return{itemType:this.form.value.itemType,valueScores:this.getValueScores()}}getValueScores(){return this.valueScores.controls.map(e=>e.value).map(e=>({name:e.name,score:e.score}))}addRow(){this.valueScores.push(this.createFormGroupForRow(null,0))}insertRow(e,t){this.valueScores.insert(e,this.createFormGroupForRow(this.getNewName(),t))}getNewName(){let e=null;do{e="new"+this.newScoreIndex++}while(this.nameAlreadyExists(e));return e}nameAlreadyExists(e){return this.valueScores.controls.find(t=>t.value.name==e)}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(p.c))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile-item-form"]],inputs:{profile:"profile"},decls:17,vars:3,consts:[["ngxsForm","selectionActions.profileItemForm",3,"formGroup"],["appearance","fill"],["formControlName","itemType","name","itemType"],[3,"value",4,"ngFor","ngForOf"],[1,"mb-5","w-full"],[1,"sm:block"],["formArrayName","valueScores","class","mt-10",4,"ngIf"],[1,"flex","justify-center","align-middle"],["mat-icon-button","","aria-label","Add new value/score pairs",3,"click"],[3,"value"],["formArrayName","valueScores",1,"mt-10"],[4,"ngFor","ngForOf"],[3,"formGroupName"],[1,"py-2","inline-block"],["appearance","standard"],["matInput","","placeholder","Name","formControlName","name"],[1,"py-2"],["matInput","","placeholder","Score","formControlName","score","type","number"],["mat-icon-button","","aria-label","Delete score",3,"click"]],template:function(e,t){1&e&&(n.Vb(0,"form",0),n.Vb(1,"div"),n.Vb(2,"mat-form-field",1),n.Vb(3,"mat-label"),n.Gc(4,"Profile Item Type"),n.Ub(),n.Vb(5,"mat-select",2),n.Ec(6,x,2,2,"mat-option",3),n.Ub(),n.Ub(),n.Ub(),n.Vb(7,"h2"),n.Gc(8,"Value/Scores"),n.Ub(),n.Vb(9,"div"),n.Vb(10,"table",4),n.Vb(11,"tbody",5),n.Ec(12,P,2,1,"ng-container",6),n.Ub(),n.Ub(),n.Ub(),n.Vb(13,"div",7),n.Vb(14,"button",8),n.cc("click",(function(){return t.addRow()})),n.Vb(15,"mat-icon"),n.Gc(16,"add"),n.Ub(),n.Ub(),n.Ub(),n.Ub()),2&e&&(n.mc("formGroup",t.form),n.Db(6),n.mc("ngForOf",t.profileItemTypes),n.Db(6),n.mc("ngIf",t.valueScores))},directives:[p.q,p.k,g.d,p.e,m.b,m.e,b.a,p.j,p.d,r.l,r.m,v.b,y.a,w.i,p.b,p.f,S.a,p.a,p.n],styles:[""]}),e})();var k=i("EmTj");let A=(()=>{class e{constructor(e,t,i){this.dialogRef=e,this.dhDialogService=t,this.formBuilder=i,this.profile={scores:[{name:"",score:null}],childrenIds:[],id:"",itemType:"",name:"",originalId:"",parentIds:[]}}onNoClick(){this.dialogRef.close()}ok(){if(!this.form.invalid&&!this.profileItemForm.form.invalid){var e=this.profileItemForm.getProfileItemData();if(!e.valueScores||e.valueScores.length<0)this.dhDialogService.showMessage("Add some value scores. At least one.");else{var t=Number(this.form.value.weight);isNaN(t)&&(t=1),this.dialogRef.close(Object.assign({name:this.form.value.name,weight:t},e))}}}ngOnInit(){this.form=this.formBuilder.group({name:"",weight:1})}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(c.g),n.Pb(k.a),n.Pb(p.c))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-new-profile-item-dialog"]],viewQuery:function(e,t){if(1&e&&n.Jc(C,!0),2&e){let e;n.tc(e=n.dc())&&(t.profileItemForm=e.first)}},decls:20,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"w-full"],["matInput","","placeholder","Name","formControlName","name","matInput",""],["matInput","","placeholder","Weight","formControlName","weight","matInput",""],[3,"profile"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"click"]],template:function(e,t){1&e&&(n.Vb(0,"h1",0),n.Gc(1,"Create New Profile Item"),n.Ub(),n.Vb(2,"div",1),n.Vb(3,"p"),n.Gc(4,"Enter New Profile Item Data"),n.Ub(),n.Vb(5,"form",2),n.Vb(6,"mat-form-field",3),n.Vb(7,"mat-label"),n.Gc(8,"Profile Item Name"),n.Ub(),n.Qb(9,"input",4),n.Ub(),n.Vb(10,"mat-form-field",3),n.Vb(11,"mat-label"),n.Gc(12,"Profile Item Weight"),n.Ub(),n.Qb(13,"input",5),n.Ub(),n.Ub(),n.Qb(14,"dh-profile-item-form",6),n.Ub(),n.Vb(15,"div",7),n.Vb(16,"button",8),n.cc("click",(function(){return t.onNoClick()})),n.Gc(17,"Cancel"),n.Ub(),n.Vb(18,"button",9),n.cc("click",(function(){return t.ok()})),n.Gc(19,"Create"),n.Ub(),n.Ub()),2&e&&(n.Db(5),n.mc("formGroup",t.form),n.Db(9),n.mc("profile",t.profile))},directives:[c.h,c.e,p.q,p.k,p.e,m.b,m.e,S.a,p.a,p.j,p.d,C,c.c,v.b],styles:[""]}),e})(),V=(()=>{class e{constructor(e,t){this.dialogRef=e,this.data=t}onNoClick(){this.dialogRef.close()}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(c.g),n.Pb(c.a))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-prompt"]],decls:12,vars:4,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"w-full"],["matInput","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(e,t){1&e&&(n.Vb(0,"h1",0),n.Gc(1),n.Ub(),n.Vb(2,"div",1),n.Vb(3,"mat-form-field",2),n.Vb(4,"mat-label"),n.Gc(5),n.Ub(),n.Vb(6,"input",3),n.cc("ngModelChange",(function(e){return t.data.inputValue=e})),n.Ub(),n.Ub(),n.Ub(),n.Vb(7,"div",4),n.Vb(8,"button",5),n.cc("click",(function(){return t.onNoClick()})),n.Gc(9,"Cancel"),n.Ub(),n.Vb(10,"button",6),n.Gc(11,"Create"),n.Ub(),n.Ub()),2&e&&(n.Db(1),n.Hc(t.data.title),n.Db(4),n.Hc(t.data.label),n.Db(1),n.mc("ngModel",t.data.inputValue),n.Db(4),n.mc("mat-dialog-close",t.data.inputValue))},directives:[c.h,c.e,m.b,m.e,S.a,p.a,p.j,p.m,c.c,v.b,c.d],styles:[""]}),e})();var E=i("SVGO"),T=i("yDe4"),D=i("1Ups");let _=(()=>{class e{constructor(e){this.store=e}getForms(){return this.store.selectSnapshot(D.a.getForms)}clearForms(){return Object(s.a)(this,void 0,void 0,(function*(){yield this.store.dispatch(new g.b({path:"selectionActions.profileNameForm"})).toPromise(),yield this.store.dispatch(new g.b({path:"selectionActions.profileItemForm"})).toPromise(),yield this.store.dispatch(new g.b({path:"selectionActions.subProfileWeightForm"})).toPromise()}))}updateScoreItems(e){return Object(s.a)(this,void 0,void 0,(function*(){yield this.store.dispatch(new g.c({path:"selectionActions.profileItemForm",value:e,propertyPath:"valueScores"})).toPromise()}))}}return e.\u0275fac=function(t){return new(t||e)(n.Zb(T.j))},e.\u0275prov=n.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),Object(s.b)([Object(T.f)(D.a.getAction)],e.prototype,"action$",void 0),Object(s.b)([Object(T.f)(D.a.getScores)],e.prototype,"scores$",void 0),e})();var z=i("oYEq"),O=i("pLgK");let M=(()=>{class e{constructor(e){this.store=e}updateItemLinkWeight(e){return Object(s.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new z.i(e)).toPromise(),!!this.store.selectSnapshot(O.a.getUpdateItemWeightStatus)}))}updateSubElementsWeights(e){return Object(s.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new z.h(e)).toPromise(),!!this.store.selectSnapshot(O.a.getUpdateChildWeightStatus)}))}getProfileWeights(e){return this.store.selectSnapshot(O.a.getState).weights[e]}}return e.\u0275fac=function(t){return new(t||e)(n.Zb(T.j))},e.\u0275prov=n.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),Object(s.b)([Object(T.f)(O.a.getState)],e.prototype,"weightState$",void 0),e})();var B=i("A7yd");function R(e,t){if(1&e){const e=n.Wb();n.Vb(0,"button",11),n.cc("click",(function(){return n.wc(e),n.gc(4).addProfileItem()})),n.Vb(1,"mat-icon"),n.Gc(2,"post_add"),n.Ub(),n.Ub()}}function F(e,t){if(1&e){const e=n.Wb();n.Vb(0,"button",12),n.cc("click",(function(){return n.wc(e),n.gc(4).addSubProfile()})),n.Vb(1,"mat-icon"),n.Gc(2,"create_new_folder"),n.Ub(),n.Ub()}}function j(e,t){if(1&e){const e=n.Wb();n.Vb(0,"mat-toolbar",2),n.Vb(1,"mat-toolbar-row",3),n.Vb(2,"button",4),n.cc("click",(function(){return n.wc(e),n.gc(3).exitSelection()})),n.Vb(3,"mat-icon"),n.Gc(4,"arrow_back"),n.Ub(),n.Ub(),n.Vb(5,"span",5),n.Gc(6),n.Ub(),n.Ec(7,R,3,0,"button",6),n.Ec(8,F,3,0,"button",7),n.Vb(9,"button",8),n.cc("click",(function(){return n.wc(e),n.gc(3).edit()})),n.Vb(10,"mat-icon"),n.Gc(11,"edit"),n.Ub(),n.Ub(),n.Vb(12,"button",9),n.cc("click",(function(){return n.wc(e),n.gc(3).deleteProfileOrProfileItem()})),n.Vb(13,"mat-icon",10),n.Gc(14,"delete"),n.Ub(),n.Ub(),n.Ub(),n.Ub()}if(2&e){const e=n.gc(2).ngIf;n.Db(6),n.Hc(e.name),n.Db(1),n.mc("ngIf","profile"==e.itemType),n.Db(1),n.mc("ngIf","profile"==e.itemType)}}function N(e,t){if(1&e){const e=n.Wb();n.Vb(0,"mat-toolbar",2),n.Vb(1,"mat-toolbar-row",3),n.Vb(2,"button",4),n.cc("click",(function(){return n.wc(e),n.gc(3).cancelEdit()})),n.Vb(3,"mat-icon"),n.Gc(4,"arrow_back"),n.Ub(),n.Ub(),n.Vb(5,"span",5),n.Gc(6),n.Ub(),n.Vb(7,"button",13),n.cc("click",(function(){return n.wc(e),n.gc(3).saveEdit()})),n.Vb(8,"mat-icon"),n.Gc(9,"save"),n.Ub(),n.Ub(),n.Vb(10,"button",14),n.cc("click",(function(){return n.wc(e),n.gc(3).cancelEdit()})),n.Vb(11,"mat-icon"),n.Gc(12,"clear"),n.Ub(),n.Ub(),n.Ub(),n.Ub()}if(2&e){const e=n.gc(2).ngIf;n.Db(6),n.Ic("",e.name," (Edit)")}}function U(e,t){if(1&e&&(n.Tb(0),n.Ec(1,j,15,3,"mat-toolbar",1),n.Ec(2,N,13,1,"mat-toolbar",1),n.Sb()),2&e){const e=t.ngIf;n.Db(1),n.mc("ngIf","none"==e),n.Db(1),n.mc("ngIf","edit"==e)}}function L(e,t){if(1&e&&(n.Tb(0),n.Ec(1,U,3,2,"ng-container",0),n.hc(2,"async"),n.Sb()),2&e){const e=n.gc();n.Db(1),n.mc("ngIf",n.ic(2,1,e.selectionActionStateService.action$))}}let G=(()=>{class e{constructor(e,t,i,r,o){this.dhDialogService=e,this.authStateService=t,this.profileStateService=i,this.selectionActionStateService=r,this.weightStateService=o,this.exiting=new n.p}ngOnInit(){}exitSelection(){this.exiting.next(),this.profileStateService.clearSelection()}addSubProfile(){return Object(s.a)(this,void 0,void 0,(function*(){const e=yield this.dhDialogService.openDialog(V,400,{title:"Enter new Sub Profile Name",label:"Profile Name",inputValue:""}).toPromise();if(null==e)return;this.dhDialogService.showLoading();const t=yield this.profileStateService.addSubProfile(null,e);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(null==t?"Sub Profile Added.":"Error adding Sub Profile.")}))}addProfileItem(){return Object(s.a)(this,void 0,void 0,(function*(){const e=yield this.dhDialogService.openDialog(A,700,null).toPromise();if(null==e)return;this.dhDialogService.showLoading();const t=yield this.profileStateService.addProfileItem({profileId:null,profileItemCreateDto:{name:e.name,itemType:e.itemType,values:e.valueScores}},e.weight);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(null==t?"Profile Item Added.":"Error adding Profile Item.")}))}edit(){}cancelEdit(){}saveEdit(){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=this.selectionActionStateService.getForms(),t=this.profileStateService.getSelectedProfile(),i=e.profileNameForm.model.name;"profile"==t.itemType&&i!=t.name&&null!=(yield this.profileStateService.updateName(t.id,i))&&this.dhDialogService.showMessage("Failed updating profile name"),"profile"==t.itemType?yield this.updateProfile(e.subProfileWeightForm,t):"virtual"==t.itemType?yield this.updateVirtualProfile(e.profileItemForm,t,i):yield this.updateProfileItem(e.profileItemForm,t,i),this.dhDialogService.hideLoading()}))}updateVirtualProfile(e,t,i){return Object(s.a)(this,void 0,void 0,(function*(){null!=(yield this.profileStateService.updateVirtualProfile({profileId:t.originalParentId,virtualProfileNameUpdateDto:{newName:i,prefix:t.originalName}}))&&this.dhDialogService.showMessage("Failed updating profile item path")}))}updateProfileItem(e,t,i){return Object(s.a)(this,void 0,void 0,(function*(){const r=e.model,o=this.getNewName(t.originalName,i);null!=(yield this.profileStateService.updateProfileItem({profileId:t.originalParentId,profileItemUpdateDto:{itemType:r.itemType,name:t.originalName,values:r.valueScores,newName:o}},t.id,i))&&this.dhDialogService.showMessage("Failed updating profile item")}))}getNewName(e,t){const i=e.lastIndexOf(".");return-1==i?t:e.substring(0,i+1)+t}updateProfile(e,t){return Object(s.a)(this,void 0,void 0,(function*(){const i=yield this.getWeightChanges(e,t);null!=i&&(yield this.weightStateService.updateSubElementsWeights({newWeights:i,profileId:t.id}))&&this.dhDialogService.showMessage("Failed updating sub elements weights")}))}getWeightChanges(e,t){return Object(s.a)(this,void 0,void 0,(function*(){if(null==e.model.subProfiles)return null;const i=e.model.subProfiles.reduce((e,t)=>(e[t.id]=t.weight,e),{}),r=new f,o=this.weightStateService.getProfileWeights(t.id);var s=new u,n=yield this.profileStateService.profileMap$.pipe(Object(d.a)()).toPromise();return s.transform(t,n).reduce((e,s)=>{const n=r.transform(s,t.id),a=i[s];return a!=o[n]&&e.push({newWeight:a,id:s}),e},[])}))}deleteProfileOrProfileItem(){const e=this.profileStateService.getSelectedProfile();"profile"==e.itemType?this.deleteProfile(e.id):"virtual"==e.itemType?this.deleteVirtualProfileItem(e):this.deleteProfileItem(e)}deleteProfile(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Confirm Delete",message:"Are you sure you want to delete this profile?"}).toPromise()))return;this.dhDialogService.showLoading();const t=yield this.profileStateService.deleteProfile(e);this.dhDialogService.hideLoading(),t?this.dhDialogService.showMessage("Error deleting profile."):(this.dhDialogService.showMessage("Profile Deleted."),this.exiting.next())}))}deleteProfileItem(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Confirm Delete",message:"Are you sure you want to delete this Profile Item?"}).toPromise()))return;this.dhDialogService.showLoading();const t=yield this.profileStateService.deleteProfileItem(e.originalParentId,e.originalName,e.originalId);this.dhDialogService.hideLoading(),t?this.dhDialogService.showMessage("Error deleting profile."):(this.dhDialogService.showMessage("Profile Deleted."),this.exiting.next())}))}deleteVirtualProfileItem(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Confirm Delete",message:"Are you sure you want to delete this Virtual Profile Item? All sub items will be deleted too."}).toPromise()))return;this.dhDialogService.showLoading();const t=yield this.profileStateService.deleteVirtualProfileItem(e.originalParentId,e.originalName,e.id);this.dhDialogService.hideLoading(),t?this.dhDialogService.showMessage("Error deleting virtual profile."):(this.dhDialogService.showMessage("Virtual Profile Deleted."),this.exiting.next())}))}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(k.a),n.Pb(E.a),n.Pb(h.a),n.Pb(_),n.Pb(M))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-top-bar-selection"]],outputs:{exiting:"exiting"},decls:2,vars:3,consts:[[4,"ngIf"],["class","bg-black",4,"ngIf"],[1,"bg-black"],[1,"text-white"],["mat-icon-button","","aria-label","menu icon","matTooltip","Clear Selection",1,"example-icon",3,"click"],[1,"flex-1","truncate"],["mat-icon-button","","matTooltip","Add Profile Item",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Add New Sub-Profile To Selected Profile",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Edit Selected Profile",3,"click"],["mat-icon-button","","matTooltip","Delete",3,"click"],["color","danger"],["mat-icon-button","","matTooltip","Add Profile Item",3,"click"],["mat-icon-button","","matTooltip","Add New Sub-Profile To Selected Profile",3,"click"],["mat-icon-button","","matTooltip","Save edit",3,"click"],["mat-icon-button","","matTooltip","Cancel edit",3,"click"]],template:function(e,t){1&e&&(n.Ec(0,L,3,3,"ng-container",0),n.hc(1,"async")),2&e&&n.mc("ngIf",n.ic(1,1,t.profileStateService.selectedProfile$))},directives:[r.m,B.a,B.c,v.b,y.a],pipes:[r.b],styles:[""]}),e})();var W=i("Meci"),$=i("v9BS");const q={provide:p.h,useExisting:Object(n.V)(()=>H),multi:!0};let H=(()=>{class e{constructor(){this.isDisabled=!1,this.max=100,this.propagateChange=e=>{},this.propagateTouched=e=>{}}writeValue(e){void 0!==e&&(this.value=e,this.propagateChange(this.value),this.propagateTouched(this.value))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){this.propagateTouched=e}changeMade(e){this.propagateChange(e.value)}setDisabledState(e){this.isDisabled=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-slider-control"]],inputs:{value:"value",max:"max"},features:[n.Cb([q])],decls:1,vars:3,consts:[["thumbLabel","","tickInterval","1","min","1",3,"max","ngModel","disabled","ngModelChange","change"]],template:function(e,t){1&e&&(n.Vb(0,"mat-slider",0),n.cc("ngModelChange",(function(e){return t.value=e}))("change",(function(e){return t.changeMade(e)})),n.Ub()),2&e&&n.mc("max",t.max)("ngModel",t.value)("disabled",t.isDisabled)},directives:[$.a,p.j,p.m],styles:[""]}),e})(),J=(()=>{class e{constructor(e){this.profileStateService=e}transform(e){return Object(s.a)(this,void 0,void 0,(function*(){return null==e?null:(yield this.profileStateService.getProfileMapInState())[e]}))}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(h.a))},e.\u0275pipe=n.Ob({name:"getProfileElementById",type:e,pure:!0}),e})(),Q=(()=>{class e{transform(e){return null==e?null:"profile"==e.itemType||"virtual"==e.itemType?e.name:e.originalName}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Ob({name:"getOriginalElementName",type:e,pure:!0}),e})();function Y(e,t){if(1&e&&(n.Tb(0),n.Vb(1,"div"),n.Gc(2),n.hc(3,"getOriginalElementName"),n.Ub(),n.Sb()),2&e){const e=t.ngIf;n.Db(2),n.Hc(n.ic(3,1,e))}}function X(e,t){if(1&e&&(n.Vb(0,"div",4),n.Vb(1,"mat-card"),n.Tb(2,5),n.Ec(3,Y,4,3,"ng-container",6),n.hc(4,"async"),n.hc(5,"getProfileElementById"),n.Vb(6,"mat-card-content"),n.Vb(7,"mat-form-field"),n.Vb(8,"mat-label"),n.Gc(9,"Weight"),n.Ub(),n.Qb(10,"input",7),n.Ub(),n.Qb(11,"dh-slider-control",8),n.Ub(),n.Sb(),n.Ub(),n.Ub()),2&e){const e=t.index,i=n.gc();n.Db(2),n.mc("formGroupName",e),n.Db(1),n.mc("ngIf",n.ic(4,6,n.ic(5,8,i.subProfiles.controls[e].get("id").value))),n.Db(7),n.nc("max",i.max),n.mc("value",i.subProfiles.controls[e].value.weight),n.Db(1),n.mc("max",i.max)("value",i.subProfiles.controls[e].value.weight)}}let Z=(()=>{class e{constructor(e){this.formBuilder=e,this.max=100,this.removeParentIdFromSubProfile=new f}ngOnInit(){this.form=this.formBuilder.group({subProfiles:this.formBuilder.array(this.getFormGroupsForIds())})}get subProfiles(){return this.form.get("subProfiles")}getFormGroupsForIds(){return this.ids.map(e=>{const t=this.removeParentIdFromSubProfile.transform(e,this.parentProfileId);return this.formBuilder.group({id:[e,[]],weight:[this.weights[t],[]],isItem:[t!==e]})})}getChanges(){const e=this.subProfiles.controls.map(e=>e.value).reduce((e,t)=>(e[t.id]=t.weight,e),{});return this.ids.reduce((t,i)=>{const r=this.removeParentIdFromSubProfile.transform(i,this.parentProfileId),o=e[i];return o!=this.weights[r]&&t.push({newWeight:o,id:i}),t},[])}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(p.c))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-sub-profiles-edit"]],inputs:{ids:"ids",parentProfileId:"parentProfileId",weights:"weights"},decls:5,vars:2,consts:[[1,"mt-10"],["ngxsForm","selectionActions.subProfileWeightForm",3,"formGroup"],["formArrayName","subProfiles",1,"mt-10"],["class","mb-10",4,"ngFor","ngForOf"],[1,"mb-10"],[3,"formGroupName"],[4,"ngIf"],["type","number","min","1","matInput","","placeholder","Name","formControlName","weight","matInput","","placeholder","element weight",3,"max","value"],["formControlName","weight",3,"max","value"]],template:function(e,t){1&e&&(n.Vb(0,"h3",0),n.Gc(1,"Sub Element names:"),n.Ub(),n.Tb(2,1),n.Vb(3,"div",2),n.Ec(4,X,12,10,"div",3),n.Ub(),n.Sb()),2&e&&(n.Db(2),n.mc("formGroup",t.form),n.Db(2),n.mc("ngForOf",t.subProfiles.controls))},directives:[g.d,p.k,p.e,p.b,r.l,W.a,p.f,r.m,W.b,m.b,m.e,p.n,S.a,p.a,p.j,p.d,H],pipes:[r.b,J,Q],styles:[""]}),e})();var K=i("mWib"),ee=i("Bou+"),te=i("RwDx"),ie=i("s9Hp");const re=["chart"];let oe=(()=>{class e{constructor(e,t,i){this.bloomaResizeListenerService=e,this.sharedUtilitiesService=t,this.selectionActionStateService=i,this._scores=null,this.readOnly=!1,this.insertNewValueScore=new n.p,this.unsubscribe$=new l.a,this.viewInitialized=!1,this.margin={top:10,bottom:100,left:30,right:10},this.totalComponentWidth=0,this.isListening=!1,this.totalComponentHeight=0,this.widthOfBarChart=0,this.yAxisWidth=30;const r=new l.a;r.pipe(Object(K.a)(300),Object(a.a)(this.unsubscribe$)).subscribe(e=>this.createChart()),this.createSubject=r}get scores(){return this._scores}set scores(e){const t=this.normalizeData(e);this.isDataUpdated(this.scores,t)&&(this._scores=t,this.createSubject.next())}ngOnDestroy(){this.bloomaResizeListenerService.unListenToElementResize(this.chartContainer.nativeElement),this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}listenToElementSizeChange(e){this.isListening||(this.isListening=!0,this.bloomaResizeListenerService.listenToElementResize(e).pipe(Object(a.a)(this.unsubscribe$)).subscribe(e=>{this.createSubject.next()}))}isDataUpdated(e,t){if(null==e&&null!=t)return!0;if(e.length!=t.length)return!0;for(let i=0;i<e.length;i++){if(e[i].name!=t[i].name)return!0;if(e[i].score!=t[i].score)return!0}return!1}ngAfterViewInit(){this.viewInitialized=!0,this.listenToElementSizeChange(this.chartContainer.nativeElement),setTimeout(()=>{this.createSubject.next()},300)}createChart(){if(!this.viewInitialized)return;const e=this.chartContainer.nativeElement;this.totalComponentWidth=e.offsetWidth,this.totalComponentHeight=e.offsetHeight,0!=this.totalComponentHeight&&(this.initSvg(),this.setSvgHeight(),this.widthOfBarChart=this.totalComponentWidth-this.yAxisWidth-this.margin.left-this.margin.right,this.createScales(),this.drawAxes(),this.drawScoresLines(),this.drawScoresArea(),this.drawCircles(),setTimeout(()=>{Object(n.mb)(this)},50))}normalizeData(e){return null==e?null:e.map(e=>({name:e.name,score:ee.i([e.score,100])}))}initSvg(){if(!this.svg){const e=ee.m(this.chartContainer.nativeElement).append("svg");this.svg=e}}setSvgHeight(){this.svg.attr("height",this.totalComponentHeight).attr("width",this.totalComponentWidth)}createScales(){const e=this.sharedUtilitiesService.pluck(this.scores,"name"),t=this.margin.left;this.scaleX=ee.l().domain(e).range([t,t+this.widthOfBarChart]),this.scaleY=ee.k().domain([0,100]).range([this.totalComponentHeight-this.margin.bottom,this.margin.top]).nice()}drawAxes(){const e=ee.c(this.scaleY).tickSize(-this.widthOfBarChart).tickValues(ee.j(0,100.5,10)),t=ee.b(this.scaleX),i=this.getAxes();i.yAxis.transition().call(e),i.yAxis.selectAll(".tick text").attr("dx","-0.5em"),i.xAxis.transition().call(t).selectAll(".tick text").style("font-size",this.totalComponentWidth>686?"18px":"14px"),i.xAxis.style("text-anchor","start"),i.xAxis.selectAll(".tick text").attr("dy","0.5em").attr("dx",8).attr("transform","rotate(90)")}getAxes(){this.svg.select(".axes").remove();const e=this.svg.insert("g").attr("class","axes");return{yAxis:e.append("g").attr("class","axis-y axis").attr("transform","translate("+[this.margin.left,0]+")"),xAxis:e.append("g").attr("class","axis-x axis").attr("transform",`translate(0, ${this.totalComponentHeight-this.margin.bottom})`)}}drawScoresLines(){this.svg.select(".line").remove();const e=this.svg.append("g").attr("class","line");this.line=ee.g().x(e=>this.scaleX(e.name)).y(e=>this.scaleY(e.score)).curve(ee.d),e.append("path").datum(this.scores).attr("class","data-line").attr("d",this.line)}drawClickableArea(){this.svg.select(".clickable-area").remove(),this.svg.append("g").attr("class","clickable-area").append("rect").attr("x",this.margin.left).attr("y",this.margin.top).attr("fill","white").attr("fill-opacity",.01).attr("width",this.widthOfBarChart).attr("height",this.totalComponentHeight-this.margin.top-this.margin.bottom).on("click",e=>this.addNewValueScore(e))}drawCircles(){this.readOnly||this.drawClickableArea(),this.svg.select(".dots").remove();const e=this.svg.append("g").attr("class","dots").selectAll("circle").data(this.scores).enter().append("circle").attr("class","circle").attr("r",5).attr("id",e=>"c"+e.name).attr("cx",e=>this.scaleX(e.name)).attr("cy",e=>this.scaleY(e.score));if(!this.readOnly){const t=this.createDragBehavior();e.style("cursor","pointer").call(t)}}drawScoresArea(){this.svg.select(".area").remove();const e=this.svg.append("g").attr("class","area");this.area=ee.a().x(e=>this.scaleX(e.name)).y(e=>this.scaleY(e.score)).y1(this.scaleY(0)).curve(ee.d),e.append("path").datum(this.scores).attr("class","data-area").attr("d",this.area).attr("fill","rgb(161,195,214)").attr("fill-opacity",.5)}createDragBehavior(){return ee.e().on("start",e=>this.dragstarted(e)).on("drag",(e,t,i)=>this.dragged(e,t)).on("end",e=>this.dragended(e))}dragstarted(e){ee.m(e.sourceEvent.target).raise().classed("active",!0)}dragged(e,t){const i=this.scaleY.invert(e.y),r=this.svg.select("circle#c"+t.name),o=this.scaleY.range();e.y>o[0]||e.y<o[1]||(r.attr("cy",e.y),this.updateValueScore(t.name,i),this.refreshLineAndArea())}dragended(e){ee.m(e.sourceEvent.target).classed("active",!1),this.updateRestOfApp()}updateRestOfApp(){this.selectionActionStateService.updateScoreItems(this.scores)}updateValueScore(e,t){null!=this.scores&&(this.scores.find(t=>t.name==e).score=Math.ceil(t))}refreshLineAndArea(){this.svg.select(".data-line").attr("d",this.line),this.svg.select(".data-area").attr("d",this.area)}refreshLineAndCircles(){this.refreshLineAndArea(),this.drawCircles()}addNewValueScore(e){var t=Math.ceil(this.scaleY.invert(e.offsetY)),i=e.offsetX,r=0;0!==this.scores.length&&(r=this.scores.findIndex(e=>{var t=this.scaleX(e.name);return i<t})),this.insertNewValueScore.next({index:r,score:t})}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(te.a),n.Pb(ie.a),n.Pb(_))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile-item-score-chart"]],viewQuery:function(e,t){if(1&e&&n.Jc(re,!0),2&e){let e;n.tc(e=n.dc())&&(t.chartContainer=e.first)}},inputs:{scores:"scores",readOnly:"readOnly"},outputs:{insertNewValueScore:"insertNewValueScore"},decls:2,vars:0,consts:[["id","profile-item-score-graph",1,"profile-item-score-graph"],["chart",""]],template:function(e,t){1&e&&n.Qb(0,"div",0,1)},styles:["#profile-item-score-graph{height:inherit;width:inherit}#profile-item-score-graph .axis-y path{stroke:none}#profile-item-score-graph .axis-y .tick line,#profile-item-score-graph .axis-y line{stroke:#cccced}#profile-item-score-graph .data-line{stroke:#000;stroke-width:2px;fill:none}#profile-item-score-graph .circle{fill:#4682b4;stroke:#000;stroke-width:2px}"],encapsulation:2}),e})(),se=(()=>{class e{transform(e,t){if(null==e)return null;if(null==t)return null;for(var i=e;i;){var r=t[i];if("virtual"!=r.itemType)return r.id;i=r.parentIds[0]}return null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Ob({name:"getFirstRealParentId",type:e,pure:!0}),e})();function ne(e,t){1&e&&(n.Vb(0,"span"),n.Gc(1,"Item "),n.Ub())}function ae(e,t){if(1&e){const e=n.Wb();n.Tb(0),n.Vb(1,"dh-profile-item-score-chart",5),n.cc("insertNewValueScore",(function(t){return n.wc(e),n.gc(3).insertNewValueScore(t)})),n.Ub(),n.Sb()}if(2&e){const e=t.ngIf;n.Db(1),n.mc("scores",e)}}function le(e,t){if(1&e&&(n.Tb(0),n.Ec(1,ae,2,1,"ng-container",2),n.hc(2,"async"),n.Sb()),2&e){const e=n.gc(2);n.Db(1),n.mc("ngIf",n.ic(2,1,e.selectionActionStateService.scores$))}}function ce(e,t){if(1&e&&(n.Tb(0),n.Qb(1,"dh-profile-item-form",4),n.Ec(2,le,3,3,"ng-container",2),n.Sb()),2&e){const e=n.gc();n.Db(1),n.mc("profile",e.profile),n.Db(1),n.mc("ngIf",e.showGraph)}}function he(e,t){if(1&e&&(n.Tb(0),n.Qb(1,"dh-sub-profiles-edit",6),n.hc(2,"getRealSubItems"),n.hc(3,"getFirstRealParentId"),n.Sb()),2&e){const e=t.ngIf,i=n.gc().ngIf,r=n.gc(2);n.Db(1),n.mc("ids",n.jc(2,3,r.profile,e))("parentProfileId",null==r.profile?null:r.profile.id)("weights",i.weights[n.jc(3,6,null==r.profile?null:r.profile.id,e)])}}function de(e,t){if(1&e&&(n.Tb(0),n.Ec(1,he,4,9,"ng-container",2),n.hc(2,"async"),n.Sb()),2&e){const e=n.gc(2);n.Db(1),n.mc("ngIf",n.ic(2,1,e.profileStateService.profileMap$))}}function ue(e,t){if(1&e&&(n.Tb(0),n.Ec(1,de,3,3,"ng-container",2),n.hc(2,"async"),n.Sb()),2&e){const e=n.gc();n.Db(1),n.mc("ngIf",n.ic(2,1,e.weightStateService.weightState$))}}let fe=(()=>{class e{constructor(e,t,i,r){this.formBuilder=e,this.weightStateService=t,this.profileStateService=i,this.selectionActionStateService=r,this.showGraph=!1}get profile(){return this._profile}set profile(e){this._profile=e,this.updateForm()}ngAfterViewInit(){setTimeout(()=>{this.showGraph=!0},1)}ngOnInit(){this.form=this.formBuilder.group({name:this.profile.name})}updateForm(){var e;null!=this.form&&(null===(e=this.form)||void 0===e||e.patchValue({name:this.profile.name}))}getProfileName(){return this.form.value.name}insertNewValueScore(e){this.profileItemFormComponent.insertRow(e.index,e.score)}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(p.c),n.Pb(M),n.Pb(h.a),n.Pb(_))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile-details-edit"]],viewQuery:function(e,t){if(1&e&&(n.Jc(Z,!0),n.Jc(C,!0)),2&e){let e;n.tc(e=n.dc())&&(t.subProfilesEditComponent=e.first),n.tc(e=n.dc())&&(t.profileItemFormComponent=e.first)}},inputs:{profile:"profile"},decls:9,vars:4,consts:[["ngxsForm","selectionActions.profileNameForm",3,"formGroup"],[1,"w-full"],[4,"ngIf"],["matInput","","placeholder","Name","formControlName","name","matInput","","placeholder","element name"],[3,"profile"],[2,"height","600px",3,"scores","insertNewValueScore"],[3,"ids","parentProfileId","weights"]],template:function(e,t){1&e&&(n.Vb(0,"form",0),n.Vb(1,"mat-form-field",1),n.Vb(2,"mat-label"),n.Gc(3,"Profile "),n.Ec(4,ne,2,0,"span",2),n.Gc(5,"Name"),n.Ub(),n.Qb(6,"input",3),n.Ub(),n.Ub(),n.Ec(7,ce,3,2,"ng-container",2),n.Ec(8,ue,3,3,"ng-container",2)),2&e&&(n.mc("formGroup",t.form),n.Db(4),n.mc("ngIf","profile"!==t.profile.itemType),n.Db(3),n.mc("ngIf",(null==t.profile||null==t.profile.scores?null:t.profile.scores.length)>0),n.Db(1),n.mc("ngIf","virtual"!=t.profile.itemType&&(null==t.profile||null==t.profile.childrenIds?null:t.profile.childrenIds.length)>0))},directives:[p.q,p.k,g.d,p.e,m.b,m.e,r.m,S.a,p.a,p.j,p.d,C,oe,Z],pipes:[r.b,u,se],styles:[""]}),e})();function pe(e,t){if(1&e&&(n.Tb(0),n.Qb(1,"div",2),n.Qb(2,"dh-profile-details-edit",3),n.Sb()),2&e){const e=n.gc();n.Db(2),n.mc("profile",e.profile)}}function ge(e,t){1&e&&n.Gc(0," No selected profile.\n")}let me=(()=>{class e{constructor(e){this.selectionActionStateService=e}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(_))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile-details"]],viewQuery:function(e,t){if(1&e&&n.Jc(fe,!0),2&e){let e;n.tc(e=n.dc())&&(t.profileDetailsEdit=e.first)}},inputs:{profile:"profile"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noProfile",""],[1,"flex","justify-end","mb-16","mt-3"],[3,"profile"]],template:function(e,t){if(1&e&&(n.Ec(0,pe,3,1,"ng-container",0),n.Ec(1,ge,1,0,"ng-template",null,1,n.Fc)),2&e){const e=n.uc(2);n.mc("ngIf",t.profile)("ngIfElse",e)}},directives:[r.m,fe],styles:[""]}),e})();function be(e,t){if(1&e){const e=n.Wb();n.Tb(0),n.Vb(1,"dh-top-bar-selection",1),n.cc("exiting",(function(){return n.wc(e),n.gc().close()})),n.Ub(),n.Vb(2,"div",2),n.Qb(3,"dh-profile-details",3),n.Ub(),n.Sb()}if(2&e){const e=t.ngIf;n.Db(3),n.mc("profile",e)}}let ve=(()=>{class e{constructor(e,t){this.dialogRef=e,this.profileStateService=t,this.unsubscribe$=new l.a,t.selectionCleared$.pipe(Object(a.a)(this.unsubscribe$)).subscribe(()=>{this.close()})}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}close(){this.dialogRef.close()}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(c.g),n.Pb(h.a))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile-details-modal"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"exiting"],["mat-dialog-content","",1,"p-10"],[1,"block","text-base",2,"width","100%",3,"profile"]],template:function(e,t){1&e&&(n.Ec(0,be,4,1,"ng-container",0),n.hc(1,"async")),2&e&&n.mc("ngIf",n.ic(1,1,t.profileStateService.selectedProfile$))},directives:[r.m,G,c.e,me],pipes:[r.b],styles:[""]}),e})();class ye{constructor(e){this.base=e}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...e){return we(function*(e){for(const t of e)yield*t}([this,...e.map(we)]))}entries(){return we(function*(e){let t=0;for(const i of e)yield[t++,i]}(this))}every(e){return!this.some((t,i)=>!e(t,i))}fill(e){return this.map(()=>e)}filter(e){return we(function*(t){for(const[i,r]of t)e(r,i)&&(yield r)}(this.entries()))}find(e){for(const[t,i]of this.entries())if(e(i,t))return i}findIndex(e){for(const[t,i]of this.entries())if(e(i,t))return t;return-1}flatMap(e){return we(function*(t){for(const[i,r]of t)yield*we(e(r,i))}(this.entries()))}forEach(e){for(const[t,i]of this.entries())e(i,t)}includes(e,t=0){return this.indexOf(e,t)>=0}indexOf(e,t=0){if(t<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[i,r]of this.entries())if(i>=t&&r===e)return i;return-1}join(e=","){return[...this].join(e)}keys(){return we(function*(e){let t=0;for(const i of e)yield t++}(this))}lastIndexOf(e,t=1/0){if(t<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let i=-1;for(const[r,o]of this.entries())r<=t&&o===e&&(i=r);return i}get length(){return this.reduce(e=>e+1,0)}map(e){return we(function*(t){for(const[i,r]of t)yield e(r,i)}(this.entries()))}reduce(e,t){if(void 0===t){const t=e;let i=!0,r=void 0;for(const[e,o]of this.entries())i?(r=o,i=!1):r=t(r,o,e);if(i)throw new TypeError("Reduce of empty iterable with no initial value");return r}{const i=e;let r=t;for(const[e,t]of this.entries())r=i(r,t,e);return r}}reverse(){return we([...this].reverse())}slice(e=0,t=1/0){return we(function*(i){for(const[r,o]of i)if(r<e);else{if(!(r<t))break;yield o}}(this.entries()))}some(e){for(const[t,i]of this.entries())if(e(i,t))return!0;return!1}sort(e){return we([...this].sort(e))}splice(e,t=0,...i){return we(function*(r){for(const[o,s]of r)o===e&&(yield*i),(o<e||o>=e+t)&&(yield s)}(this.entries()))}values(){return this}}function we(e){return function(e){return"function"==typeof e[Symbol.iterator]}(e)?new ye(e):new ye({[Symbol.iterator]:()=>e})}function Se(e,t){t.size<e.size&&([t,e]=[e,t]);for(const i of e)if(t.has(i))return!0;return!1}class xe extends Map{getThrow(e){const t=this.get(e);if(void 0===t)throw new Error("map doesn't contain key: "+e);return t}getDefault(e,t){const i=this.get(e);return void 0===i?t:i}setIfAbsent(e,t){const i=this.get(e);return void 0===i?(this.set(e,t),t):i}}class Ie{constructor(e,t,i=[]){this.child=e,this.data=t,this.points=i}}class Pe{constructor(e,t,i,r){this.source=e,this.target=t,this.data=i,this.points=r}}class Ce{constructor(e,t){this.id=e,this.data=t,this.dataChildren=[]}iroots(){return we([this])}roots(){return[this]}*iterChildren(){for(const{child:e}of this.dataChildren)yield e}ichildren(){return we(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:e,data:t,points:i}of this.dataChildren)yield new Pe(this,e,t,i)}ichildLinks(){return we(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new ke([this])[Symbol.iterator]()}idescendants(e="depth"){return new ke([this]).idescendants(e)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return new ke([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new ke([this]).size()}sum(e){return new ke([this]).sum(e),this}count(){return new ke([this]).count(),this}height(){return new ke([this]).height(),this}depth(){return new ke([this]).depth(),this}split(){return[this]}connected(){return!0}}class ke{constructor(e){this.dagRoots=e}[Symbol.iterator](){return this.idepth()}iroots(){return we(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const e=this.roots(),t=new Set;let i;for(;i=e.pop();)t.has(i.id)||(t.add(i.id),yield i,e.push(...i.ichildren()))}*ibreadth(){const e=new Set;let t=this.roots(),i=[];do{let r;for(i=t.reverse(),t=[];r=i.pop();)e.has(r.id)||(e.add(r.id),yield r,t.push(...r.ichildren()))}while(t.length)}*ibefore(){const e=new xe;for(const r of this)for(const t of r.ichildren())e.set(t.id,e.getDefault(t.id,0)+1);const t=this.roots();let i;for(;i=t.pop();){yield i;for(const r of i.ichildren()){const i=e.getThrow(r.id);i>1?e.set(r.id,i-1):t.push(r)}}}*iafter(){const e=this.roots(),t=new Set;let i;for(;i=e.pop();)t.has(i.id)||(i.ichildren().every(e=>t.has(e.id))?(t.add(i.id),yield i):(e.push(i),e.push(...i.ichildren())))}idescendants(e="depth"){if("depth"===e)return we(this.idepth());if("breadth"===e)return we(this.ibreadth());if("before"===e)return we(this.ibefore());if("after"===e)return we(this.iafter());throw new Error("unknown iteration style: "+e)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return this.idescendants().flatMap(e=>e.ichildLinks())}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce(e=>e+1,0)}sum(e){const t=new xe;for(const[i,r]of this.idescendants("after").entries()){const o=e(r,i),s=new xe;s.set(r.id,o);for(const e of r.ichildren()){const i=t.getThrow(e.id);for(const[e,t]of i.entries())s.set(e,t)}r.value=we(s.entries()).map(([,e])=>e).reduce((e,t)=>e+t),t.set(r.id,s)}return this}count(){const e=new xe;for(const t of this.idescendants("after"))if(t.ichildren()[Symbol.iterator]().next().done)e.set(t.id,new Set([t.id])),t.value=1;else{const i=new Set;for(const r of t.ichildren()){const t=e.getThrow(r.id);for(const e of t)i.add(e)}e.set(t.id,i),t.value=i.size}return this}height(){for(const e of this.idescendants("after"))e.value=Math.max(0,...e.ichildren().map(e=>{if(void 0===e.value)throw new Error("`after` iteration didn't iterate in after order");return e.value+1}));return this}depth(){const e=new xe;for(const t of this)for(const i of t.ichildren())e.setIfAbsent(i.id,[]).push(t);for(const t of this.idescendants("before"))t.value=Math.max(0,...e.getDefault(t.id,[]).map(e=>{if(void 0===e.value)throw new Error("`before` iteration didn't iterate in before order");return e.value+1}));return this}split(){const e=new xe,t=new xe;for(const o of this.iroots())e.set(o.id,[]),t.set(o.id,new Set(o.idescendants().map(e=>e.id)));for(const[o,s]of this.iroots().entries()){const i=t.getThrow(s.id);for(const r of this.iroots().slice(o+1))Se(i,t.getThrow(r.id))&&(e.getThrow(s.id).push(r),e.getThrow(r.id).push(s))}const i=[],r=new Set;for(const o of this.iroots())if(!r.has(o.id)){r.add(o.id);const t=[o];i.push(t);const s=e.getThrow(o.id).slice();let n;for(;n=s.pop();)r.has(n.id)||(r.add(n.id),t.push(n),s.push(...e.getThrow(n.id)))}return i.map(e=>e.length>1?new ke(e):e[0])}connected(){return 1===this.split().length}}function Ae(e){function t(t,i){return(e(t,i)||[]).map(e=>[e,void 0])}return t.wrapped=e,t}function Ve(e){if(function(e){try{return"string"==typeof e.id}catch(t){return!1}}(e))return e.id;throw new Error("default id function expected datum to have an id field but got: "+e)}function Ee(e){if(function(e){try{const t=e.parentIds;return void 0===t||t instanceof Array&&t.every(e=>"string"==typeof e)}catch(t){return!1}}(e))return e.parentIds;throw new Error("default parentIds function expected datum to have a parentIds field but got: "+e)}let Te,De,_e=1e-60;do{_e+=_e,Te=1+.1*_e,De=1+.2*_e}while(Te<=1||De<=1);var ze=_e,Oe=function(e,t,i,r=[],o=0,s=[0,0]){const n=[],a=[],l=[],c=[],h=[],d=[];let u="";const f=e.length-1,p=i[1].length-1;if(!r)for(let m=1;m<=p;m+=1)r[m]=0;if(f!==e[1].length-1&&(u="Dmat is not symmetric!"),f!==t.length-1&&(u="Dmat and dvec are incompatible!"),f!==i.length-1&&(u="Amat and dvec are incompatible!"),p!==r.length-1&&(u="Amat and bvec are incompatible!"),(o>p||o<0)&&(u="Value of meq is invalid!"),""!==u)return{message:u};for(let m=1;m<=p;m+=1)a[m]=0,c[m]=0;const g=Math.min(f,p);for(let m=1;m<=f;m+=1)l[m]=0;n[1]=0;for(let m=1;m<=2*f+g*(g+5)/2+2*p+1;m+=1)h[m]=0;for(let m=1;m<=2;m+=1)d[m]=0;return function(e,t,i,r,o,s,n,a,l,c,h,d,u,f=0,p,g,m){let b,v,y,w,S,x,I,P,C,k,A,V,E,T;const D=Math.min(r,h);let _=2*r+D*(D+5)/2+2*h+1;for(let $=1;$<=r;$+=1)g[$]=t[$];for(let $=r+1;$<=_;$+=1)g[$]=0;for(let $=1;$<=h;$+=1)u[$]=0,s[$]=0;const z=[];if(0===m[1]){if(function(e,t,i,r){let o,s,n;for(let a=1;a<=i;a+=1){if(r[1]=a,n=0,o=a-1,o<1){if(n=e[a][a]-n,n<=0)break;e[a][a]=Math.sqrt(n)}else{for(let t=1;t<=o;t+=1){s=e[t][a];for(let i=1;i<t;i+=1)s-=e[i][a]*e[i][t];s/=e[t][t],e[t][a]=s,n+=s*s}if(n=e[a][a]-n,n<=0)break;e[a][a]=Math.sqrt(n)}r[1]=0}}(e,0,r,z),0!==z[1])return void(m[1]=2);(function(e,t,i,r){let o,s;for(o=1;o<=i;o+=1){s=0;for(let t=1;t<o;t+=1)s+=e[t][o]*r[t];r[o]=(r[o]-s)/e[o][o]}for(let n=1;n<=i;n+=1){o=i+1-n,r[o]/=e[o][o],s=-r[o];for(let t=1;t<o;t+=1)r[t]+=s*e[t][o]}})(e,0,r,t),function(e,t,i){let r,o;for(let s=1;s<=i;s+=1){e[s][s]=1/e[s][s],o=-e[s][s];for(let t=1;t<s;t+=1)e[t][s]*=o;if(r=s+1,i<r)break;for(let t=r;t<=i;t+=1){o=e[s][t],e[s][t]=0;for(let i=1;i<=s;i+=1)e[i][t]+=o*e[i][s]}}}(e,0,r)}else{for(let i=1;i<=r;i+=1){o[i]=0;for(let r=1;r<=i;r+=1)o[i]+=e[r][i]*t[r]}for(let i=1;i<=r;i+=1){t[i]=0;for(let s=i;s<=r;s+=1)t[i]+=e[i][s]*o[s]}}n[1]=0;for(let $=1;$<=r;$+=1){o[$]=t[$],n[1]+=g[$]*o[$],g[$]=0;for(let t=$+1;t<=r;t+=1)e[t][$]=0}n[1]=-n[1]/2,m[1]=0;const O=r,M=O+r,B=M+D,R=B+D+1,F=R+D*(D+1)/2,j=F+h;for(let $=1;$<=h;$+=1){x=0;for(let e=1;e<=r;e+=1)x+=a[e][$]*a[e][$];g[j+$]=Math.sqrt(x)}function N(){p[1]+=1,_=F;for(let e=1;e<=h;e+=1){_+=1,x=-l[e];for(let t=1;t<=r;t+=1)x+=a[t][e]*o[t];if(Math.abs(x)<ze&&(x=0),e>d)g[_]=x;else if(g[_]=-Math.abs(x),x>0){for(let t=1;t<=r;t+=1)a[t][e]=-a[t][e];l[e]=-l[e]}}for(let e=1;e<=w;e+=1)g[F+u[e]]=0;y=0,S=0;for(let e=1;e<=h;e+=1)g[F+e]<S*g[j+e]&&(y=e,S=g[F+e]/g[j+e]);if(0===y){for(let e=1;e<=w;e+=1)s[u[e]]=g[B+e];return 999}return 0}function U(){for(let t=1;t<=r;t+=1){x=0;for(let i=1;i<=r;i+=1)x+=e[i][t]*a[i][y];g[t]=x}b=O;for(let e=1;e<=r;e+=1)g[b+e]=0;for(let t=w+1;t<=r;t+=1)for(let i=1;i<=r;i+=1)g[b+i]=g[b+i]+e[i][t]*g[t];V=!0;for(let e=w;e>=1;e-=1){x=g[e],_=R+e*(e+3)/2,b=_-e;for(let t=e+1;t<=w;t+=1)x-=g[_]*g[M+t],_+=t;x/=g[b],g[M+e]=x,u[e]<=d||x<=0||(V=!1,v=e)}if(!V){I=g[B+v]/g[M+v];for(let e=1;e<=w;e+=1)u[e]<=d||g[M+e]<=0||(S=g[B+e]/g[M+e],S<I&&(I=S,v=e))}x=0;for(let e=O+1;e<=O+r;e+=1)x+=g[e]*g[e];if(Math.abs(x)<=ze){if(V)return m[1]=1,999;for(let e=1;e<=w;e+=1)g[B+e]=g[B+e]-I*g[M+e];return g[B+w+1]=g[B+w+1]+I,700}x=0;for(let e=1;e<=r;e+=1)x+=g[O+e]*a[e][y];P=-g[F+y]/x,E=!0,V||I<P&&(P=I,E=!1);for(let e=1;e<=r;e+=1)o[e]+=P*g[O+e],Math.abs(o[e])<ze&&(o[e]=0);n[1]+=P*x*(P/2+g[B+w+1]);for(let e=1;e<=w;e+=1)g[B+e]=g[B+e]-P*g[M+e];if(g[B+w+1]=g[B+w+1]+P,!E){x=-l[y];for(let e=1;e<=r;e+=1)x+=o[e]*a[e][y];if(y>d)g[F+y]=x;else if(g[F+y]=-Math.abs(x),x>0){for(let e=1;e<=r;e+=1)a[e][y]=-a[e][y];l[y]=-l[y]}return 700}w+=1,u[w]=y,_=R+(w-1)*w/2+1;for(let e=1;e<=w-1;e+=1)g[_]=g[e],_+=1;if(w===r)g[_]=g[r];else{for(let t=r;t>=w+1;t-=1)if(0!==g[t]&&(C=Math.max(Math.abs(g[t-1]),Math.abs(g[t])),k=Math.min(Math.abs(g[t-1]),Math.abs(g[t])),S=g[t-1]>=0?Math.abs(C*Math.sqrt(1+k*k/(C*C))):-Math.abs(C*Math.sqrt(1+k*k/(C*C))),C=g[t-1]/S,k=g[t]/S,1!==C))if(0===C){g[t-1]=k*S;for(let i=1;i<=r;i+=1)S=e[i][t-1],e[i][t-1]=e[i][t],e[i][t]=S}else{g[t-1]=S,A=k/(1+C);for(let i=1;i<=r;i+=1)S=C*e[i][t-1]+k*e[i][t],e[i][t]=A*(e[i][t-1]+S)-e[i][t],e[i][t-1]=S}g[_]=g[w]}return 0}function L(){if(_=R+v*(v+1)/2+1,b=_+v,0===g[b])return 798;if(C=Math.max(Math.abs(g[b-1]),Math.abs(g[b])),k=Math.min(Math.abs(g[b-1]),Math.abs(g[b])),S=g[b-1]>=0?Math.abs(C*Math.sqrt(1+k*k/(C*C))):-Math.abs(C*Math.sqrt(1+k*k/(C*C))),C=g[b-1]/S,k=g[b]/S,1===C)return 798;if(0===C){for(let e=v+1;e<=w;e+=1)S=g[b-1],g[b-1]=g[b],g[b]=S,b+=e;for(let t=1;t<=r;t+=1)S=e[t][v],e[t][v]=e[t][v+1],e[t][v+1]=S}else{A=k/(1+C);for(let e=v+1;e<=w;e+=1)S=C*g[b-1]+k*g[b],g[b]=A*(g[b-1]+S)-g[b],g[b-1]=S,b+=e;for(let t=1;t<=r;t+=1)S=C*e[t][v]+k*e[t][v+1],e[t][v+1]=A*(e[t][v]+S)-e[t][v+1],e[t][v]=S}return 0}function G(){b=_-v;for(let e=1;e<=v;e+=1)g[b]=g[_],_+=1,b+=1;return g[B+v]=g[B+v+1],u[v]=u[v+1],v+=1,v<w?797:0}function W(){return g[B+w]=g[B+w+1],g[B+w+1]=0,u[w]=0,w-=1,p[2]+=1,0}for(w=f,p[1]=0,p[2]=0,T=0;;){if(T=N(),999===T)return;for(;T=U(),0!==T;){if(999===T)return;if(700===T)if(v===w)W();else{for(;L(),T=G(),797===T;);W()}}}}(e,t,0,f,l,c,n,i,r,0,p,o,a,0,d,h,s),1===s[1]&&(u="constraints are inconsistent, no solution!"),2===s[1]&&(u="matrix D in quadratic function is not positive definite!"),{solution:l,Lagrangian:c,value:n,unconstrained_solution:t,iterations:d,iact:a,message:u}};function Me(e,t){let[i,...r]=e,o=i.x=0;for(const s of r)o=s.x=o+t(i,s),i=s;if(o>0)for(const s of e)s.x/=o;else for(const s of e)s.x=.5}function Be(e,t,i,r){e[i][i]+=r,e[i][t]-=r,e[t][i]-=r,e[t][t]+=r}function Re(e,t,i,r,o){e[r][r]+=o,e[r][i]-=2*o,e[r][t]+=o,e[i][r]-=2*o,e[i][i]+=4*o,e[i][t]-=2*o,e[t][r]+=o,e[t][i]-=2*o,e[t][t]+=o}class Fe extends Ce{constructor(e){super(e,void 0)}}function je(e,t,i,r){this.feasible=i,this.evaluation=t,this.bounded=r,this._tableau=e}var Ne=je;function Ue(e,t,i,r,o){Ne.call(this,e,t,i,r),this.iter=o}je.prototype.generateSolutionSet=function(){for(var e={},t=this._tableau,i=t.varIndexByRow,r=t.variablesPerIndex,o=t.matrix,s=t.rhsColumn,n=t.height-1,a=Math.round(1/t.precision),l=1;l<=n;l+=1){var c=r[i[l]];void 0!==c&&!0!==c.isSlack&&(e[c.id]=Math.round((Number.EPSILON+o[l][s])*a)/a)}return e};var Le=Ue;function Ge(e){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=e||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}Ue.prototype=Object.create(Ne.prototype),Ue.constructor=Ue;var We=Ge;function $e(e,t){this.priority=e,this.reducedCosts=new Array(t);for(var i=0;i<t;i+=1)this.reducedCosts[i]=0}Ge.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},$e.prototype.copy=function(){var e=new $e(this.priority,this.reducedCosts.length);return e.reducedCosts=this.reducedCosts.slice(),e},Ge.prototype.setOptionalObjective=function(e,t,i){var r=this.objectivesByPriority[e];void 0===r&&(r=new $e(e,Math.max(this.width,t+1)),this.objectivesByPriority[e]=r,this.optionalObjectives.push(r),this.optionalObjectives.sort((function(e,t){return e.priority-t.priority}))),r.reducedCosts[t]=i},Ge.prototype.initialize=function(e,t,i,r){this.variables=i,this.unrestrictedVars=r,this.width=e,this.height=t;for(var o=new Array(e),s=0;s<e;s++)o[s]=0;this.matrix=new Array(t);for(var n=0;n<t;n++)this.matrix[n]=o.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=e+t-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},Ge.prototype._resetMatrix=function(){var e,t,i=this.model.variables,r=this.model.constraints,o=i.length,s=r.length,n=this.matrix[0],a=!0===this.model.isMinimization?-1:1;for(e=0;e<o;e+=1){var l=i[e],c=l.priority,h=a*l.cost;0===c?n[e+1]=h:this.setOptionalObjective(c,e+1,h),this.rowByVarIndex[t=i[e].index]=-1,this.colByVarIndex[t]=e+1,this.varIndexByCol[e+1]=t}for(var d=1,u=0;u<s;u+=1){var f,p,g=r[u],m=g.index;this.rowByVarIndex[m]=d,this.colByVarIndex[m]=-1,this.varIndexByRow[d]=m;var b=g.terms,v=b.length,y=this.matrix[d++];if(g.isUpperBound){for(f=0;f<v;f+=1)y[this.colByVarIndex[(p=b[f]).variable.index]]=p.coefficient;y[0]=g.rhs}else{for(f=0;f<v;f+=1)y[this.colByVarIndex[(p=b[f]).variable.index]]=-p.coefficient;y[0]=-g.rhs}}},Ge.prototype.setModel=function(e){return this.model=e,this.initialize(e.nVariables+1,e.nConstraints+1,e.variables,e.unrestrictedVariables),this._resetMatrix(),this},Ge.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var e=this.lastElementIndex;return this.lastElementIndex+=1,e},Ge.prototype.density=function(){for(var e=0,t=this.matrix,i=0;i<this.height;i++)for(var r=t[i],o=0;o<this.width;o++)0!==r[o]&&(e+=1);return e/(this.height*this.width)},Ge.prototype.setEvaluation=function(){var e=Math.round(1/this.precision),t=Math.round((Number.EPSILON+this.matrix[this.costRowIndex][this.rhsColumn])*e)/e;this.evaluation=t,0===this.simplexIters&&(this.bestPossibleEval=t)},Ge.prototype.getSolution=function(){var e=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new Le(this,e,this.feasible,this.bounded,this.branchAndCutIterations):new Ne(this,e,this.feasible,this.bounded)},We.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},We.prototype.phase1=function(){for(var e=this.model.checkForCycles,t=[],i=this.matrix,r=this.rhsColumn,o=this.width-1,s=this.height-1,n=0;;){for(var a=0,l=-this.precision,c=1;c<=s;c++){var h=i[c][r];h<l&&(l=h,a=c)}if(0===a)return this.feasible=!0,n;for(var d=0,u=-1/0,f=i[0],p=i[a],g=1;g<=o;g++){var m=p[g];if(!0===this.unrestrictedVars[this.varIndexByCol[g]]||m<-this.precision){var b=-f[g]/m;u<b&&(u=b,d=g)}}if(0===d)return this.feasible=!1,n;if(e){t.push([this.varIndexByRow[a],this.varIndexByCol[d]]);var v=this.checkForCycles(t);if(v.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+v[0]),this.model.messages.push("Length :"+v[1]),this.feasible=!1,n}this.pivot(a,d),n+=1}},We.prototype.phase2=function(){for(var e,t,i=this.model.checkForCycles,r=[],o=this.matrix,s=this.rhsColumn,n=this.width-1,a=this.height-1,l=this.precision,c=this.optionalObjectives.length,h=null,d=0;;){var u=o[this.costRowIndex];c>0&&(h=[]);for(var f=0,p=l,g=!1,m=1;m<=n;m++)e=u[m],t=!0===this.unrestrictedVars[this.varIndexByCol[m]],c>0&&-l<e&&e<l?h.push(m):t&&e<0?-e>p&&(p=-e,f=m,g=!0):e>p&&(p=e,f=m,g=!1);if(c>0)for(var b=0;0===f&&h.length>0&&b<c;){var v=[],y=this.optionalObjectives[b].reducedCosts;p=l;for(var w=0;w<h.length;w++)t=!0===this.unrestrictedVars[this.varIndexByCol[m=h[w]]],-l<(e=y[m])&&e<l?v.push(m):t&&e<0?-e>p&&(p=-e,f=m,g=!0):e>p&&(p=e,f=m,g=!1);h=v,b+=1}if(0===f)return this.setEvaluation(),this.simplexIters+=1,d;for(var S=0,x=1/0,I=1;I<=a;I++){var P=o[I],C=P[s],k=P[f];if(!(-l<k&&k<l)){if(k>0&&l>C&&C>-l){x=0,S=I;break}var A=g?-C/k:C/k;A>l&&x>A&&(x=A,S=I)}}if(x===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[f],d;if(i){r.push([this.varIndexByRow[S],this.varIndexByCol[f]]);var V=this.checkForCycles(r);if(V.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+V[0]),this.model.messages.push("Length :"+V[1]),this.feasible=!1,d}this.pivot(S,f,!0),d+=1}};var qe=[];function He(e,t,i,r){this.id=e,this.cost=t,this.index=i,this.value=0,this.priority=r}function Je(e,t,i,r){He.call(this,e,t,i,r)}function Qe(e,t){He.call(this,e,0,t,0)}function Ye(e,t){this.variable=e,this.coefficient=t}function Xe(e,t,i){return 0===i||"required"===i?null:(t=t||1,i=i||1,!1===e.isMinimization&&(t=-t),e.addVariable(t,"r"+e.relaxationIndex++,!1,!1,i))}function Ze(e,t,i,r){this.slack=new Qe("s"+i,i),this.index=i,this.model=r,this.rhs=e,this.isUpperBound=t,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function Ke(e,t){this.upperBound=e,this.lowerBound=t,this.model=e.model,this.rhs=e.rhs,this.relaxation=null}We.prototype.pivot=function(e,t){var i=this.matrix,r=i[e][t],o=this.height-1,s=this.width-1,n=this.varIndexByRow[e],a=this.varIndexByCol[t];this.varIndexByRow[e]=a,this.varIndexByCol[t]=n,this.rowByVarIndex[a]=e,this.rowByVarIndex[n]=-1,this.colByVarIndex[a]=-1,this.colByVarIndex[n]=t;for(var l,c,h,d=i[e],u=0,f=0;f<=s;f++)d[f]>=-1e-16&&d[f]<=1e-16?d[f]=0:(d[f]/=r,qe[u]=f,u+=1);d[t]=1/r;for(var p=0;p<=o;p++)if(p!==e&&!(i[p][t]>=-1e-16&&i[p][t]<=1e-16)){var g=i[p];if((l=g[t])>=-1e-16&&l<=1e-16)0!==l&&(g[t]=0);else{for(c=0;c<u;c++)(h=d[f=qe[c]])>=-1e-16&&h<=1e-16?0!==h&&(d[f]=0):g[f]=g[f]-l*h;g[t]=-l/r}}var m=this.optionalObjectives.length;if(m>0)for(var b=0;b<m;b+=1){var v=this.optionalObjectives[b].reducedCosts;if(0!==(l=v[t])){for(c=0;c<u;c++)0!==(h=d[f=qe[c]])&&(v[f]=v[f]-l*h);v[t]=-l/r}}},We.prototype.checkForCycles=function(e){for(var t=0;t<e.length-1;t++)for(var i=t+1;i<e.length;i++){var r=e[t],o=e[i];if(r[0]===o[0]&&r[1]===o[1]){if(i-t>e.length-i)break;for(var s=!0,n=1;n<i-t;n++){var a=e[t+n],l=e[i+n];if(a[0]!==l[0]||a[1]!==l[1]){s=!1;break}}if(s)return[t,i-t]}}return[]},Je.prototype.isInteger=!0,Qe.prototype.isSlack=!0,Ze.prototype.addTerm=function(e,t){var i=t.index,r=this.termsByVarIndex[i];return void 0===r?(r=new Ye(t,e),this.termsByVarIndex[i]=r,this.terms.push(r),!0===this.isUpperBound&&(e=-e),this.model.updateConstraintCoefficient(this,t,e)):this.setVariableCoefficient(r.coefficient+e,t),this},Ze.prototype.removeTerm=function(e){return this},Ze.prototype.setRightHandSide=function(e){if(e!==this.rhs){var t=e-this.rhs;!0===this.isUpperBound&&(t=-t),this.rhs=e,this.model.updateRightHandSide(this,t)}return this},Ze.prototype.setVariableCoefficient=function(e,t){var i=t.index;if(-1!==i){var r=this.termsByVarIndex[i];if(void 0===r)this.addTerm(e,t);else if(e!==r.coefficient){var o=e-r.coefficient;!0===this.isUpperBound&&(o=-o),r.coefficient=e,this.model.updateConstraintCoefficient(this,t,o)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},Ze.prototype.relax=function(e,t){this.relaxation=Xe(this.model,e,t),this._relax(this.relaxation)},Ze.prototype._relax=function(e){null!==e&&this.setVariableCoefficient(this.isUpperBound?-1:1,e)},Ke.prototype.isEquality=!0,Ke.prototype.addTerm=function(e,t){return this.upperBound.addTerm(e,t),this.lowerBound.addTerm(e,t),this},Ke.prototype.removeTerm=function(e){return this.upperBound.removeTerm(e),this.lowerBound.removeTerm(e),this},Ke.prototype.setRightHandSide=function(e){this.upperBound.setRightHandSide(e),this.lowerBound.setRightHandSide(e),this.rhs=e},Ke.prototype.relax=function(e,t){this.relaxation=Xe(this.model,e,t),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var et={Constraint:Ze,Variable:He,IntegerVariable:Je,SlackVariable:Qe,Equality:Ke,Term:Ye},tt=et.SlackVariable;function it(e,t){this.index=e,this.value=t}We.prototype.addCutConstraints=function(e){for(var t,i=e.length,r=this.height,o=r+i,s=r;s<o;s+=1)void 0===this.matrix[s]&&(this.matrix[s]=this.matrix[s-1].slice());this.height=o,this.nVars=this.width+this.height-2;for(var n=this.width-1,a=0;a<i;a+=1){var l=e[a],c=r+a,h="min"===l.type?-1:1,d=l.varIndex,u=this.rowByVarIndex[d],f=this.matrix[c];if(-1===u){for(f[this.rhsColumn]=h*l.value,t=1;t<=n;t+=1)f[t]=0;f[this.colByVarIndex[d]]=h}else{var p=this.matrix[u];for(f[this.rhsColumn]=h*(l.value-p[this.rhsColumn]),t=1;t<=n;t+=1)f[t]=-h*p[t]}var g=this.getNewElementIndex();this.varIndexByRow[c]=g,this.rowByVarIndex[g]=c,this.colByVarIndex[g]=-1,this.variablesPerIndex[g]=new tt("s"+g,g),this.nVars+=1}},We.prototype._addLowerBoundMIRCut=function(e){if(e===this.costRowIndex)return!1;var t=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[e]].isInteger)return!1;var i=t[e][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var o=this.height;t[o]=t[o-1].slice(),this.height+=1,this.nVars+=1;var s=this.getNewElementIndex();this.varIndexByRow[o]=s,this.rowByVarIndex[s]=o,this.colByVarIndex[s]=-1,this.variablesPerIndex[s]=new tt("s"+s,s),t[o][this.rhsColumn]=Math.floor(i);for(var n=1;n<this.varIndexByCol.length;n+=1)if(this.variablesPerIndex[this.varIndexByCol[n]].isInteger){var a=t[e][n],l=Math.floor(a)+Math.max(0,a-Math.floor(a)-r)/(1-r);t[o][n]=l}else t[o][n]=Math.min(0,t[e][n]/(1-r));for(var c=0;c<this.width;c+=1)t[o][c]-=t[e][c];return!0},We.prototype._addUpperBoundMIRCut=function(e){if(e===this.costRowIndex)return!1;var t=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[e]].isInteger)return!1;var i=t[e][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var o=this.height;t[o]=t[o-1].slice(),this.height+=1,this.nVars+=1;var s=this.getNewElementIndex();this.varIndexByRow[o]=s,this.rowByVarIndex[s]=o,this.colByVarIndex[s]=-1,this.variablesPerIndex[s]=new tt("s"+s,s),t[o][this.rhsColumn]=-r;for(var n=1;n<this.varIndexByCol.length;n+=1){var a=this.variablesPerIndex[this.varIndexByCol[n]],l=t[e][n],c=l-Math.floor(l);t[o][n]=a.isInteger?c<=r?-c:-(1-c)*r/c:l>=0?-l:l*r/(1-r)}return!0},We.prototype.applyMIRCuts=function(){},We.prototype._putInBase=function(e){var t=this.rowByVarIndex[e];if(-1===t){for(var i=this.colByVarIndex[e],r=1;r<this.height;r+=1){var o=this.matrix[r][i];if(o<-this.precision||this.precision<o){t=r;break}}this.pivot(t,i)}return t},We.prototype._takeOutOfBase=function(e){var t=this.colByVarIndex[e];if(-1===t){for(var i=this.rowByVarIndex[e],r=this.matrix[i],o=1;o<this.height;o+=1){var s=r[o];if(s<-this.precision||this.precision<s){t=o;break}}this.pivot(i,t)}return t},We.prototype.updateVariableValues=function(){for(var e=this.variables.length,t=Math.round(1/this.precision),i=0;i<e;i+=1){var r=this.variables[i],o=this.rowByVarIndex[r.index];r.value=-1===o?0:Math.round((this.matrix[o][this.rhsColumn]+Number.EPSILON)*t)/t}},We.prototype.updateRightHandSide=function(e,t){var i=this.height-1,r=this.rowByVarIndex[e.index];if(-1===r){for(var o=this.colByVarIndex[e.index],s=0;s<=i;s+=1){var n=this.matrix[s];n[this.rhsColumn]-=t*n[o]}var a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1){var c=this.optionalObjectives[l].reducedCosts;c[this.rhsColumn]-=t*c[o]}}else this.matrix[r][this.rhsColumn]-=t},We.prototype.updateConstraintCoefficient=function(e,t,i){if(e.index===t.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var r=this._putInBase(e.index),o=this.colByVarIndex[t.index];if(-1===o)for(var s=this.rowByVarIndex[t.index],n=0;n<this.width;n+=1)this.matrix[r][n]+=i*this.matrix[s][n];else this.matrix[r][o]-=i},We.prototype.updateCost=function(e,t){var i=e.index,r=this.width-1,o=this.colByVarIndex[i];if(-1===o){var s,n=this.matrix[this.rowByVarIndex[i]];if(0===e.priority){var a=this.matrix[0];for(s=0;s<=r;s+=1)a[s]+=t*n[s]}else{var l=this.objectivesByPriority[e.priority].reducedCosts;for(s=0;s<=r;s+=1)l[s]+=t*n[s]}}else this.matrix[0][o]-=t},We.prototype.addConstraint=function(e){var t=e.isUpperBound?1:-1,i=this.height,r=this.matrix[i];void 0===r&&(r=this.matrix[0].slice(),this.matrix[i]=r);for(var o=this.width-1,s=0;s<=o;s+=1)r[s]=0;r[this.rhsColumn]=t*e.rhs;for(var n=e.terms,a=n.length,l=0;l<a;l+=1){var c=n[l],h=c.coefficient,d=c.variable.index,u=this.rowByVarIndex[d];if(-1===u)r[this.colByVarIndex[d]]+=t*h;else{var f=this.matrix[u];for(s=0;s<=o;s+=1)r[s]-=t*h*f[s]}}var p=e.index;this.varIndexByRow[i]=p,this.rowByVarIndex[p]=i,this.colByVarIndex[p]=-1,this.height+=1},We.prototype.removeConstraint=function(e){var t=e.index,i=this.height-1,r=this._putInBase(t),o=this.matrix[i];this.matrix[i]=this.matrix[r],this.matrix[r]=o,this.varIndexByRow[r]=this.varIndexByRow[i],this.varIndexByRow[i]=-1,this.rowByVarIndex[t]=-1,this.availableIndexes[this.availableIndexes.length]=t,e.slack.index=-1,this.height-=1},We.prototype.addVariable=function(e){var t=this.height-1,i=this.width,r=!0===this.model.isMinimization?-e.cost:e.cost,o=e.priority,s=this.optionalObjectives.length;if(s>0)for(var n=0;n<s;n+=1)this.optionalObjectives[n].reducedCosts[i]=0;0===o?this.matrix[0][i]=r:(this.setOptionalObjective(o,i,r),this.matrix[0][i]=0);for(var a=1;a<=t;a+=1)this.matrix[a][i]=0;var l=e.index;this.varIndexByCol[i]=l,this.rowByVarIndex[l]=-1,this.colByVarIndex[l]=i,this.width+=1},We.prototype.removeVariable=function(e){var t=e.index,i=this._takeOutOfBase(t),r=this.width-1;if(i!==r){for(var o=this.height-1,s=0;s<=o;s+=1){var n=this.matrix[s];n[i]=n[r]}var a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1){var c=this.optionalObjectives[l].reducedCosts;c[i]=c[r]}var h=this.varIndexByCol[r];this.varIndexByCol[i]=h,this.colByVarIndex[h]=i}this.varIndexByCol[r]=-1,this.colByVarIndex[t]=-1,this.availableIndexes[this.availableIndexes.length]=t,e.index=-1,this.width-=1},We.prototype.log=function(e,t){console.log("****",e,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var i,r,o,s,n,a,l,c,h,d,u="",f=[" "];for(r=1;r<this.width;r+=1)l=" ",c="\t",(a=void 0===(s=this.variablesPerIndex[n=this.varIndexByCol[r]])?"c"+n:s.id).length>5?l+=" ":c+="\t",f[r]=l,u+=c+a;console.log(u);var p=this.matrix[this.costRowIndex],g="\t";for(i=1;i<this.width;i+=1)g+="\t",g+=f[i],g+=p[i].toFixed(5);for(g+="\t"+f[0]+p[0].toFixed(5),console.log(g+"\tZ"),o=1;o<this.height;o+=1){for(h=this.matrix[o],d="\t",r=1;r<this.width;r+=1)d+="\t"+f[r]+h[r].toFixed(5);d+="\t"+f[0]+h[0].toFixed(5),a=void 0===(s=this.variablesPerIndex[n=this.varIndexByRow[o]])?"c"+n:s.id,console.log(d+"\t"+a)}console.log("");var m=this.optionalObjectives.length;if(m>0){console.log("    Optional objectives:");for(var b=0;b<m;b+=1){var v=this.optionalObjectives[b].reducedCosts,y="";for(i=1;i<this.width;i+=1)y+=v[i]<0?"":" ",y+=f[i],y+=v[i].toFixed(5);y+=(v[0]<0?"":" ")+f[0]+v[0].toFixed(5),console.log(y+" z"+b)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this},We.prototype.copy=function(){var e=new We(this.precision);e.width=this.width,e.height=this.height,e.nVars=this.nVars,e.model=this.model,e.variables=this.variables,e.variablesPerIndex=this.variablesPerIndex,e.unrestrictedVars=this.unrestrictedVars,e.lastElementIndex=this.lastElementIndex,e.varIndexByRow=this.varIndexByRow.slice(),e.varIndexByCol=this.varIndexByCol.slice(),e.rowByVarIndex=this.rowByVarIndex.slice(),e.colByVarIndex=this.colByVarIndex.slice(),e.availableIndexes=this.availableIndexes.slice();for(var t=[],i=0;i<this.optionalObjectives.length;i++)t[i]=this.optionalObjectives[i].copy();e.optionalObjectives=t;for(var r=this.matrix,o=new Array(this.height),s=0;s<this.height;s++)o[s]=r[s].slice();return e.matrix=o,e},We.prototype.save=function(){this.savedState=this.copy()},We.prototype.restore=function(){if(null!==this.savedState){var e,t,i=this.savedState,r=i.matrix;for(this.nVars=i.nVars,this.model=i.model,this.variables=i.variables,this.variablesPerIndex=i.variablesPerIndex,this.unrestrictedVars=i.unrestrictedVars,this.lastElementIndex=i.lastElementIndex,this.width=i.width,this.height=i.height,e=0;e<this.height;e+=1){var o=r[e],s=this.matrix[e];for(t=0;t<this.width;t+=1)s[t]=o[t]}var n=i.varIndexByRow;for(t=0;t<this.height;t+=1)this.varIndexByRow[t]=n[t];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var a=i.varIndexByCol;for(e=0;e<this.width;e+=1)this.varIndexByCol[e]=a[e];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var l=i.rowByVarIndex,c=i.colByVarIndex,h=0;h<this.nVars;h+=1)this.rowByVarIndex[h]=l[h],this.colByVarIndex[h]=c[h];if(i.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var d=0;d<i.optionalObjectives.length;d++){var u=i.optionalObjectives[d].copy();this.optionalObjectives[d]=u,this.optionalObjectivePerPriority[u.priority]=u}}}},We.prototype.getMostFractionalVar=function(){for(var e=0,t=null,i=null,r=this.model.integerVariables,o=r.length,s=0;s<o;s++){var n=r[s].index,a=this.rowByVarIndex[n];if(-1!==a){var l=this.matrix[a][this.rhsColumn],c=Math.abs(l-Math.round(l));e<c&&(e=c,t=n,i=l)}}return new it(t,i)},We.prototype.getFractionalVarWithLowestCost=function(){for(var e=1/0,t=null,i=null,r=this.model.integerVariables,o=r.length,s=0;s<o;s++){var n=r[s],a=n.index,l=this.rowByVarIndex[a];if(-1!==l){var c=this.matrix[l][this.rhsColumn];if(Math.abs(c-Math.round(c))>this.precision){var h=n.cost;e>h&&(e=h,t=a,i=c)}}}return new it(t,i)},We.prototype.countIntegerValues=function(){for(var e=0,t=1;t<this.height;t+=1)if(this.variablesPerIndex[this.varIndexByRow[t]].isInteger){var i=this.matrix[t][this.rhsColumn];(i-=Math.floor(i))<this.precision&&-i<this.precision&&(e+=1)}return e},We.prototype.isIntegral=function(){for(var e=this.model.integerVariables,t=e.length,i=0;i<t;i++){var r=this.rowByVarIndex[e[i].index];if(-1!==r){var o=this.matrix[r][this.rhsColumn];if(Math.abs(o-Math.round(o))>this.precision)return!1}}return!0},We.prototype.computeFractionalVolume=function(e){for(var t=-1,i=1;i<this.height;i+=1)if(this.variablesPerIndex[this.varIndexByRow[i]].isInteger){var r=this.matrix[i][this.rhsColumn];if(r=Math.abs(r),Math.min(r-Math.floor(r),Math.floor(r+1))<this.precision){if(!e)return 0}else-1===t?t=r:t*=r}return-1===t?0:t};var rt=We;function ot(e,t,i){this.type=e,this.varIndex=t,this.value=i}function st(e,t){this.relaxedEvaluation=e,this.cuts=t}function nt(e,t){return t.relaxedEvaluation-e.relaxedEvaluation}We.prototype.applyCuts=function(e){if(this.restore(),this.addCutConstraints(e),this.simplex(),this.model.useMIRCuts)for(var t=!0;t;){var i=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*i&&(t=!1)}},We.prototype.branchAndCut=function(){var e=[],t=0,i=this.model.tolerance,r=!0,o=1e99;this.model.timeout&&(o=Date.now()+this.model.timeout);for(var s=1/0,n=null,a=[],l=0;l<this.optionalObjectives.length;l+=1)a.push(1/0);var c=new st(-1/0,[]);for(e.push(c);e.length>0&&!0===r&&Date.now()<o;)if(i>0&&s<(this.model.isMinimization?this.bestPossibleEval*(1+i):this.bestPossibleEval*(1-i))&&(r=!1),!((c=e.pop()).relaxedEvaluation>s)){var h=c.cuts;if(this.applyCuts(h),t++,!1!==this.feasible){var d=this.evaluation;if(!(d>s)){if(d===s){for(var u=!0,f=0;f<this.optionalObjectives.length&&!(this.optionalObjectives[f].reducedCosts[0]>a[f]);f+=1)if(this.optionalObjectives[f].reducedCosts[0]<a[f]){u=!1;break}if(u)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===t)return void(this.branchAndCutIterations=t);n=c,s=d;for(var p=0;p<this.optionalObjectives.length;p+=1)a[p]=this.optionalObjectives[p].reducedCosts[0]}else{1===t&&this.save();for(var g=this.getMostFractionalVar(),m=g.index,b=[],v=[],y=h.length,w=0;w<y;w+=1){var S=h[w];S.varIndex===m?"min"===S.type?v.push(S):b.push(S):(b.push(S),v.push(S))}var x=Math.ceil(g.value),I=Math.floor(g.value),P=new ot("min",m,x);b.push(P);var C=new ot("max",m,I);v.push(C),e.push(new st(d,b)),e.push(new st(d,v)),e.sort(nt)}}}}null!==n&&this.applyCuts(n.cuts),this.branchAndCutIterations=t};var at={},lt=et.Constraint,ct=et.Equality,ht=et.Variable,dt=et.IntegerVariable;function ut(e,t){this.tableau=new We(e),this.name=t,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var ft=ut;ut.prototype.minimize=function(){return this.isMinimization=!0,this},ut.prototype.maximize=function(){return this.isMinimization=!1,this},ut.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var e=this.lastElementIndex;return this.lastElementIndex+=1,e},ut.prototype._addConstraint=function(e){var t=e.slack;this.tableau.variablesPerIndex[t.index]=t,this.constraints.push(e),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(e)},ut.prototype.smallerThan=function(e){var t=new lt(e,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(t),t},ut.prototype.greaterThan=function(e){var t=new lt(e,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(t),t},ut.prototype.equal=function(e){var t=new lt(e,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(t);var i=new lt(e,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(i),new ct(t,i)},ut.prototype.addVariable=function(e,t,i,r,o){if("string"==typeof o)switch(o){case"required":o=0;break;case"strong":o=1;break;case"medium":o=2;break;case"weak":o=3;break;default:o=0}var s,n=this.tableau.getNewElementIndex();return null==t&&(t="v"+n),null==e&&(e=0),null==o&&(o=0),i?(s=new dt(t,e,n,o),this.integerVariables.push(s)):s=new ht(t,e,n,o),this.variables.push(s),this.tableau.variablesPerIndex[n]=s,r&&(this.unrestrictedVariables[n]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(s),s},ut.prototype._removeConstraint=function(e){var t=this.constraints.indexOf(e);-1!==t?(this.constraints.splice(t,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(e),e.relaxation&&this.removeVariable(e.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},ut.prototype.removeConstraint=function(e){return e.isEquality?(this._removeConstraint(e.upperBound),this._removeConstraint(e.lowerBound)):this._removeConstraint(e),this},ut.prototype.removeVariable=function(e){var t=this.variables.indexOf(e);if(-1!==t)return this.variables.splice(t,1),!0===this.tableauInitialized&&this.tableau.removeVariable(e),this;console.warn("[Model.removeVariable] Variable not present in model")},ut.prototype.updateRightHandSide=function(e,t){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(e,t),this},ut.prototype.updateConstraintCoefficient=function(e,t,i){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(e,t,i),this},ut.prototype.setCost=function(e,t){var i=e-t.cost;return!1===this.isMinimization&&(i=-i),t.cost=e,this.tableau.updateCost(t,i),this},ut.prototype.loadJson=function(e){this.isMinimization="max"!==e.opType;for(var t=e.variables,i=e.constraints,r={},o={},s=Object.keys(i),n=s.length,a=0;a<n;a+=1){var l,c,h=s[a],d=i[h],u=d.equal,f=d.weight,p=d.priority,g=void 0!==f||void 0!==p;if(void 0===u){var m=d.min;void 0!==m&&(l=this.greaterThan(m),r[h]=l,g&&l.relax(f,p));var b=d.max;void 0!==b&&(c=this.smallerThan(b),o[h]=c,g&&c.relax(f,p))}else{l=this.greaterThan(u),r[h]=l,c=this.smallerThan(u),o[h]=c;var v=new ct(l,c);g&&v.relax(f,p)}}var y=Object.keys(t),w=y.length;this.tolerance=e.tolerance||0,e.timeout&&(this.timeout=e.timeout),e.options&&(e.options.timeout&&(this.timeout=e.options.timeout),0===this.tolerance&&(this.tolerance=e.options.tolerance||0),e.options.useMIRCuts&&(this.useMIRCuts=e.options.useMIRCuts),this.checkForCycles=void 0===e.options.exitOnCycles||e.options.exitOnCycles);for(var S=e.ints||{},x=e.binaries||{},I=e.unrestricted||{},P=e.optimize,C=0;C<w;C+=1){var k=y[C],A=t[k],V=!!x[k],E=this.addVariable(A[P]||0,k,!!S[k]||V,!!I[k]);V&&this.smallerThan(1).addTerm(1,E);var T=Object.keys(A);for(a=0;a<T.length;a+=1){var D=T[a];if(D!==P){var _=A[D],z=r[D];void 0!==z&&z.addTerm(_,E);var O=o[D];void 0!==O&&O.addTerm(_,E)}}}return this},ut.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},ut.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},ut.prototype.isFeasible=function(){return this.tableau.feasible},ut.prototype.save=function(){return this.tableau.save()},ut.prototype.restore=function(){return this.tableau.restore()},ut.prototype.activateMIRCuts=function(e){this.useMIRCuts=e},ut.prototype.debug=function(e){this.checkForCycles=e},ut.prototype.log=function(e){return this.tableau.log(e)};var pt={CleanObjectiveAttributes:function(e){var t,i,r;if("string"==typeof e.optimize){if(e.constraints[e.optimize]){for(i in t=Math.random(),e.variables)e.variables[i][e.optimize]&&(e.variables[i][t]=e.variables[i][e.optimize]);return e.constraints[t]=e.constraints[e.optimize],delete e.constraints[e.optimize],e}return e}for(r in e.optimize)if(e.constraints[r])if("equal"===e.constraints[r])delete e.optimize[r];else{for(i in t=Math.random(),e.variables)e.variables[i][r]&&(e.variables[i][t]=e.variables[i][r]);e.constraints[t]=e.constraints[r],delete e.constraints[r]}return e}},gt=function(e){return e.length?function(e){var t={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},i={opType:"",optimize:"_obj",constraints:{},variables:{}},r={">=":"min","<=":"max","=":"equal"},o="",s=null,n="",a="",l="",c=0;"string"==typeof e&&(e=e.split("\n"));for(var h=0;h<e.length;h++)if(l="__"+h,s=null,t.is_objective.test(o=e[h]))i.opType=o.match(/(max|min)/gi)[0],(s=o.match(t.parse_lhs).map((function(e){return e.replace(/\s+/,"")})).slice(1)).forEach((function(e){n=null===(n=e.match(t.get_num))?"-"===e.substr(0,1)?-1:1:n[0],n=parseFloat(n),a=e.match(t.get_word)[0].replace(/\;$/,""),i.variables[a]=i.variables[a]||{},i.variables[a]._obj=n}));else if(t.is_int.test(o))s=o.match(t.parse_int).slice(1),i.ints=i.ints||{},s.forEach((function(e){e=e.replace(";",""),i.ints[e]=1}));else if(t.is_bin.test(o))s=o.match(t.parse_bin).slice(1),i.binaries=i.binaries||{},s.forEach((function(e){e=e.replace(";",""),i.binaries[e]=1}));else if(t.is_constraint.test(o)){var d=o.indexOf(":");(s=(-1===d?o:o.slice(d+1)).match(t.parse_lhs).map((function(e){return e.replace(/\s+/,"")}))).forEach((function(e){n=null===(n=e.match(t.get_num))?"-"===e.substr(0,1)?-1:1:n[0],n=parseFloat(n),a=e.match(t.get_word)[0],i.variables[a]=i.variables[a]||{},i.variables[a][l]=n})),c=parseFloat(o.match(t.parse_rhs)[0]),o=r[o.match(t.parse_dir)[0]],i.constraints[l]=i.constraints[l]||{},i.constraints[l][o]=c}else t.is_unrestricted.test(o)&&(s=o.match(t.parse_int).slice(1),i.unrestricted=i.unrestricted||{},s.forEach((function(e){e=e.replace(";",""),i.unrestricted[e]=1})));return i}(e):function(e){if(!e)throw new Error("Solver requires a model to operate on");var t="",i={max:"<=",min:">=",equal:"="},r=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(e.opType)for(var o in t+=e.opType+":",e.variables)e.variables[o][o]=e.variables[o][o]?e.variables[o][o]:1,e.variables[o][e.optimize]&&(t+=" "+e.variables[o][e.optimize]+" "+o.replace(r,"_"));else t+="max:";for(var s in t+=";\n\n",e.constraints)for(var n in e.constraints[s])if(void 0!==i[n]){for(var a in e.variables)void 0!==e.variables[a][s]&&(t+=" "+e.variables[a][s]+" "+a.replace(r,"_"));t+=" "+i[n]+" "+e.constraints[s][n],t+=";\n"}if(e.ints)for(var l in t+="\n\n",e.ints)t+="int "+l.replace(r,"_")+";\n";if(e.unrestricted)for(var c in t+="\n\n",e.unrestricted)t+="unrestricted "+c.replace(r,"_")+";\n";return t}(e)};function mt(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})})),t}var bt=mt(Object.freeze({__proto__:null,default:{}}));function vt(e){return(e=(e=e.replace("\\r\\n","\r\n")).split("\r\n")).filter((function(e){return!0!==new RegExp(" 0$","gi").test(e)&&!1!==new RegExp("\\d$","gi").test(e)})).map((function(e){return e.split(/\:{0,1} +(?=\d)/)})).reduce((function(e,t,i){return e[t[0]]=t[1],e}),{})}var yt={lpsolve:{reformat:gt,solve:function(e){return new Promise((function(t,i){"undefined"!=typeof window&&i("Function Not Available in Browser");var r=gt(e);e.external||i("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),e.external.binPath||i("No Executable | Binary path provided in arguments as 'binPath'"),e.external.args||i("No arguments array for cli | bash provided on 'args' attribute"),e.external.tempName||i("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),bt.writeFile(e.external.tempName,r,(function(r,o){if(r)i(r);else{var s=bt.execFile;e.external.args.push(e.external.tempName),s(e.external.binPath,e.external.args,(function(e,r){e?1===e.code?t(vt(r)):i({code:e.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[e.code],data:r}):t(vt(r))}))}}))}))}}},wt=function(e,t){var i,r,o,s,n,a=t.optimize,l=JSON.parse(JSON.stringify(t.optimize)),c=Object.keys(t.optimize),h=0,d={},u="",f={},p=[];for(delete t.optimize,r=0;r<c.length;r++)l[c[r]]=0;for(r=0;r<c.length;r++){for(n in t.optimize=c[r],t.opType=a[c[r]],i=e.Solve(t,void 0,void 0,!0),c)if(!t.variables[c[n]])for(s in i[c[n]]=i[c[n]]?i[c[n]]:0,t.variables)t.variables[s][c[n]]&&i[s]&&(i[c[n]]+=i[s]*t.variables[s][c[n]]);for(u="base",o=0;o<c.length;o++)u+=i[c[o]]?"-"+(1e3*i[c[o]]|0)/1e3:"-0";if(!d[u]){for(d[u]=1,h++,o=0;o<c.length;o++)i[c[o]]&&(l[c[o]]+=i[c[o]]);delete i.feasible,delete i.result,p.push(i)}}for(r=0;r<c.length;r++)t.constraints[c[r]]={equal:l[c[r]]/h};for(r in t.optimize="cheater-"+Math.random(),t.opType="max",t.variables)t.variables[r].cheater=1;for(r in p)for(s in p[r])f[s]=f[s]||{min:1e99,max:-1e99};for(r in f)for(s in p)p[s][r]?(p[s][r]>f[r].max&&(f[r].max=p[s][r]),p[s][r]<f[r].min&&(f[r].min=p[s][r])):(p[s][r]=0,f[r].min=0);return{midpoint:i=e.Solve(t,void 0,void 0,!0),vertices:p,ranges:f}},St=et.Constraint,xt=et.Variable,It=et.Numeral,Pt=et.Term,Ct=function(){this.Model=ft,this.branchAndCut=at,this.Constraint=St,this.Variable=xt,this.Numeral=It,this.Term=Pt,this.Tableau=rt,this.lastSolvedModel=null,this.External=yt,this.Solve=function(e,t,i,r){if(r)for(var o in pt)e=pt[o](e);if(!e)throw new Error("Solver requires a model to operate on");if("object"==typeof e.optimize&&Object.keys(e.optimize>1))return wt(this,e);if(e.external){var s=Object.keys(yt);if(s=JSON.stringify(s),!e.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+s);if(!yt[e.external.solver])throw new Error("No support (yet) for "+e.external.solver+". Please use one of these instead:"+s);return yt[e.external.solver].solve(e)}e instanceof ft==0&&(e=new ft(t).loadJson(e));var n=e.solve();if(this.lastSolvedModel=e,n.solutionSet=n.generateSolutionSet(),i)return n;var a={};return a.feasible=n.feasible,a.result=n.evaluation,a.bounded=n.bounded,n._tableau.__isIntegral&&(a.isIntegral=!0),Object.keys(n.solutionSet).forEach((function(e){0!==n.solutionSet[e]&&(a[e]=n.solutionSet[e])})),a},this.ReformatLP=gt,this.MultiObjective=function(e){return wt(this,e)}};"object"==typeof window?window.solver=new Ct:"object"==typeof self&&(self.solver=new Ct);var kt=new Ct;function At(){}function Vt(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Et(e,t){let i;if(void 0===t)for(const r of e)null!=r&&(i<r||void 0===i&&r>=r)&&(i=r);else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(i<o||void 0===i&&o>=o)&&(i=o)}return i}function Tt(e,t){let i;if(void 0===t)for(const r of e)null!=r&&(i>r||void 0===i&&r>=r)&&(i=r);else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(i>o||void 0===i&&o>=o)&&(i=o)}return i}function Dt(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function _t(e,t,i){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&(yield i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(r=+r)>=r&&(yield r)}}(e,i))).length){if((t=+t)<=0||r<2)return Tt(e);if(t>=1)return Et(e);var r,o=(r-1)*t,s=Math.floor(o),n=Et(function e(t,i,r=0,o=t.length-1,s=Vt){for(;o>r;){if(o-r>600){const n=o-r+1,a=i-r+1,l=Math.log(n),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(n-c)/n)*(a-n/2<0?-1:1);e(t,i,Math.max(r,Math.floor(i-a*c/n+h)),Math.min(o,Math.floor(i+(n-a)*c/n+h)),s)}const n=t[i];let a=r,l=o;for(Dt(t,r,i),s(t[o],n)>0&&Dt(t,r,o);a<l;){for(Dt(t,a,l),++a,--l;s(t[a],n)<0;)++a;for(;s(t[l],n)>0;)--l}0===s(t[r],n)?Dt(t,r,l):(++l,Dt(t,l,o)),l<=i&&(r=l+1),i<=l&&(o=l-1)}return t}(e,s).subarray(0,s+1));return n+(Tt(e.subarray(s+1))-n)*(o-s)}}function zt(e,t){return+!(e instanceof Fe)+ +!(t instanceof Fe)}function Ot(...e){if(e.length)throw new Error(`got arguments to sugiyama(${e}), but constructor takes no aruguments.`);return function e(t,i,r,o,s,n,a){const[l,c]=s;function h(e){t(e);for(const t of e){const e=t.layer;if(void 0===e)throw new Error(`layering did not assign layer to node '${t.id}'`);if(e<0)throw new Error(`layering assigned a negative layer (${e}) to node '${t.id}'`)}const s=function(e){const t=[];for(const i of e.descendants()){const e=i.layer;(t[e]||(t[e]=[])).push(i),i.dataChildren=i.dataChildren.map(r=>{const o=r.child.layer;if(o<=e)throw new Error(`layering left child node "${r.child.id}" (${o}) with a greater or equal layer to parent node "${i.id}" (${e})`);let s=r.child;for(let n=o-1;n>e;n--){let e;e=a?`${i.id}->${r.child.id} (${n})`:`${i.id}\0${r.child.id}\0${n}`;const o=new Fe(e);o.dataChildren.push(new Ie(s,void 0)),(t[n]||(t[n]=[])).push(o),s=o}return new Ie(s,r.data)})}return t}(e);if(1===s.length){const[e]=s;for(const t of e)t.y=c/2}else{const e=o?c:c/(s.length-1);for(const[t,i]of s.entries())for(const r of i)r.y=e*t}if(s.every(e=>1===e.length))for(const[t]of s)t.x=l/2;else if(1===s.length){const[e]=s;Me(e,n);const t=e,i=o?t.length-1:1;for(const r of t)r.x*=l*i}else{i(s),r(s,n);for(const i of s)for(const e of i)if(void 0===e.x)throw new Error(`coord didn't assign an x to node '${e.id}'`);const e=s,t=o?Math.max(...s.map(e=>e.length))-1:1;for(const i of e)for(const e of i)e.x*=l*t}const h=e;return function(e){for(const t of e)t instanceof Fe||(t.dataChildren=t.dataChildren.map(e=>{let i=e.child;const r=[{x:t.x,y:t.y}];for(;i instanceof Fe;)r.push({x:i.x,y:i.y}),[i]=i.ichildren();return r.push({x:i.x,y:i.y}),new Ie(i,e.data,r)}))}(h),h}return h.layering=function(l){return void 0===l?t:e(l,i,r,o,s,n,a)},h.decross=function(l){return void 0===l?i:e(t,l,r,o,s,n,a)},h.coord=function(l){return void 0===l?r:e(t,i,l,o,s,n,a)},h.size=function(l){return void 0!==l?e(t,i,r,!1,l,n,a):o?null:s},h.nodeSize=function(l){return void 0!==l?e(t,i,r,!0,l,n,a):o?s:null},h.separation=function(l){return void 0===l?n:e(t,i,r,o,s,l,a)},h.debug=function(l){return void 0===l?a:e(t,i,r,o,s,n,l)},h}(function(...e){if(e.length)throw new Error(`got arguments to simplex(${e}), but constructor takes no aruguments.`);return function e(t,i){const r=i?"":"\0",o=i?"rank: ":"\0",s=i?" -> ":"\0";function n(e){return`${r}${e.id}`}function a(e){return`${e.source.id}${s}${e.target.id}`}function l(e,t){return`${o}${e.id}${s}${t.id}`}function c(e){const i=Object.create(null),r=Object.create(null),o=Object.create(null),s=[];for(const a of e){const e=n(a);r[e]=1,i[e]={opt:a.children.length};const o=t(a);void 0!==o&&s.push([o,a])}for(const t of e.ilinks()){const e=i[n(t.source)],r=i[n(t.target)],s=a(t);o[s]={min:1},e[s]=-1,e.opt++,r[s]=1,r.opt--}let[c,...h]=s.sort(([e],[t])=>e-t);for(const t of h){const[e,r]=c,[s,a]=t,h=i[n(r)],d=i[n(a)],u=l(r,a);if(e<s)o[u]={min:1},h[u]=-1,d[u]=1;else{const e=l(a,r);o[u]={min:0},o[e]={min:0},h[u]=-1,h[e]=1,d[u]=1,d[e]=-1}c=t}const d=kt.Solve({optimize:"opt",opType:"max",constraints:o,variables:i,ints:r}),{feasible:u}=d,f=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(i[r[o]]=e[r[o]])}return i}(d,["feasible"]);if(!u)throw s.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const t of e)t.layer=f[n(t)]||0}return c.rank=function(r){return void 0===r?t:e(r,i)},c.debug=function(r){return void 0===r?i:e(t,r)},c}(At,!1)}(),function(...e){if(e.length)throw new Error(`got arguments to twoLayer(${e}), but constructor takes no aruguments.`);return function e(t){function i(e){e.slice(0,e.length-1).forEach((i,r)=>t(i,e[r+1]))}return i.order=function(i){return void 0===i?t:e(i)},i}(function(...e){if(e.length)throw new Error(`got arguments to median(${e}), but constructor takes no aruguments.`);return function(e,t){const i=new xe;for(const[s,n]of e.entries())for(const e of n.ichildren())i.setIfAbsent(e.id,[]).push(s);const r=new xe;let o=-1;for(const s of t){const t=_t(i.getDefault(s.id,[]),.5,void 0);void 0===t?(r.set(s.id,o),o=+!((o+1)/(e.length+1))*(e.length+1)-1):r.set(s.id,t)}t.sort((e,t)=>r.getThrow(e.id)-r.getThrow(t.id))}}())}(),function(...e){if(e.length)throw new Error(`got arguments to quad(${e}), but constructor takes no aruguments.`);return function e(t,i,r,o,s){function n(e,n,a){const l=function(e){const t=new xe;let i=0;for(const r of e)for(const e of r)t.set(e.id,i++);return t}(e),[c,h,d,u]=function(e,t,i){const r=1+Math.max(...t.values()),o=[],s=[];for(const a of e){let[e,...n]=a;for(const a of n){const n=t.getThrow(e.id),l=t.getThrow(a.id),c=new Array(r).fill(0);c[n]=1,c[l]=-1,o.push(c),s.push(-i(e,a)),e=a}}const n=new Array(r).fill(0);return[new Array(r).fill(null).map(()=>new Array(r).fill(0)),n,o,s]}(e,l,n);for(const s of e)for(const e of s){const s=l.getThrow(e.id),n=e instanceof Fe?i:t;for(const a of e.ichildren()){const e=l.getThrow(a.id),h=a instanceof Fe?o:r;Be(c,s,e,n+(a instanceof Fe?i:t));for(const t of a.ichildren())Re(c,s,e,l.getThrow(t.id),h)}}for(let[t,...i]of e)for(const e of i)a.getThrow(t.id)!==a.getThrow(e.id)&&Be(c,l.getThrow(t.id),l.getThrow(e.id),s),t=e;!function(e,t,i){const r=Math.min(...i),o=Math.max(...i)-r;if(o>0)for(const s of e)for(const e of s){const s=t.getThrow(e.id);e.x=(i[s]-r)/o}else for(const s of e)for(const e of s)e.x=.5}(e,l,function(e,t,i,r,o=0){t.pop(),e.pop(),e.forEach(e=>e.pop()),i.forEach(e=>e.pop());const s=function(e,t,i,r,o){const s=[[0]],n=[0],a=[[0]],l=[0];for(const d of e){const e=[0];e.push(...d),s.push(e)}n.push(...t),a.push(...t.map(()=>[0]));for(const d of i)for(const[e,t]of d.entries())a[e+1].push(-t);l.push(...r.map(e=>-e));const{solution:c,message:h}=Oe(s,n,a,l,o);if(h.length)throw new Error("quadprog failed with: "+h);return c.shift(),c}(e,t,i,r,o);return s.push(0),s}(c,h,d,u))}function a(e,s){if(0===t&&0===r)throw new Error("node vertical weight or node curve weight needs to be positive");if(0===i&&0===o)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const a=function(e){const t=new xe;for(const o of e.slice().reverse())for(const e of o){for(const i of e.ichildren())t.delete(i.id);t.set(e.id,e)}const i=new ke([...t.values()]).split(),r=new xe;for(const[o,s]of i.entries())for(const e of s)r.set(e.id,o);return r}(e);for(const t of function(e,t){const i=[];let r=[],o=new Set;for(const s of e){const e=new Set(s.map(e=>t.getThrow(e.id)));Se(o,e)||i.push(r=[]),r.push(s),o=e}return i}(e,a))if(t.every(e=>1===e.length))for(const[e]of t)e.x=.5;else if(1===t.length){const[e]=t;Me(e,s)}else n(t,s,a)}return a.vertical=function(n){if(void 0===n)return[t,i];const[a,l]=n;if(a<0||l<0)throw new Error(`weights must be non-negative, but were ${a} and ${l}`);return e(a,l,r,o,s)},a.curve=function(n){if(void 0===n)return[r,o];const[a,l]=n;if(a<0||l<0)throw new Error(`weights must be non-negative, but were ${a} and ${l}`);return e(t,i,a,l,s)},a.component=function(n){if(void 0===n)return s;if(n<=0)throw new Error("weight must be positive, but was "+n);return e(t,i,r,o,n)},a}(1,0,0,1,1)}(),!1,[1,1],zt,!1)}var Mt=function(e,t){return e<t};function Bt(e){if(!(this instanceof Bt))return new Bt(e);this.array=[],this.size=0,this.compare=e||Mt}Bt.prototype.clone=function(){var e=new Bt(this.compare);e.size=this.size;for(var t=0;t<this.size;t++)e.array.push(this.array[t]);return e},Bt.prototype.add=function(e){var t,i,r=this.size;for(this.array[this.size]=e,this.size+=1;r>0&&this.compare(e,i=this.array[t=r-1>>1]);)this.array[r]=i,r=t;this.array[r]=e},Bt.prototype.heapify=function(e){var t;for(this.array=e,this.size=e.length,t=this.size>>1;t>=0;t--)this._percolateDown(t)},Bt.prototype._percolateUp=function(e,t){for(var i,r,o=this.array[e];e>0&&(r=this.array[i=e-1>>1],t||this.compare(o,r));)this.array[e]=r,e=i;this.array[e]=o},Bt.prototype._percolateDown=function(e){for(var t,i,r,o=this.size,s=this.size>>>1,n=this.array[e];e<s&&(r=this.array[t=1+(e<<1)],(i=t+1)<o&&this.compare(this.array[i],r)&&(t=i,r=this.array[i]),this.compare(r,n));)this.array[e]=r,e=t;this.array[e]=n},Bt.prototype._removeAt=function(e){if(!(e>this.size-1||e<0))return this._percolateUp(e,!0),this.poll()},Bt.prototype.remove=function(e){for(var t=0;t<this.size;t++)if(!this.compare(this.array[t],e)&&!this.compare(e,this.array[t]))return this._removeAt(t),!0;return!1},Bt.prototype._batchRemove=function(e,t){var i=new Array(t||this.size),r=0;if("function"==typeof e&&this.size)for(var o=0;o<this.size&&r<i.length;)e(this.array[o])?(i[r]=this._removeAt(o),r++,o>>=1):o++;return i.length=r,i},Bt.prototype.removeOne=function(e){var t=this._batchRemove(e,1);return t.length>0?t[0]:void 0},Bt.prototype.removeMany=function(e,t){return this._batchRemove(e,t)},Bt.prototype.peek=function(){if(0!=this.size)return this.array[0]},Bt.prototype.poll=function(){if(0!=this.size){var e=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,e}},Bt.prototype.replaceTop=function(e){if(0!=this.size){var t=this.array[0];return this.array[0]=e,this._percolateDown(0),t}},Bt.prototype.trim=function(){this.array=this.array.slice(0,this.size)},Bt.prototype.isEmpty=function(){return 0===this.size},Bt.prototype.forEach=function(e){if(!this.isEmpty()&&"function"==typeof e)for(var t=0,i=this.clone();!i.isEmpty();)e(i.poll(),t++)},Bt.prototype.kSmallest=function(e){if(0==this.size)return[];var t=this.compare,i=this.array,r=new Bt((function(e,r){return t(i[e],i[r])}));e=Math.min(this.size,e);var o=new Array(e),s=0;for(r.add(0);s<e;){var n=r.poll();o[s++]=this.array[n];var a=1+(n<<1),l=a+1;a<this.size&&r.add(a),l<this.size&&r.add(l)}return o};var Rt=i("NWgr");const Ft=["chart"],jt=["weightSlider"];function Nt(e,t){if(1&e){const e=n.Wb();n.Vb(0,"button",7),n.cc("click",(function(){return n.wc(e),n.gc().disconnect()})),n.Gc(1,"Disconnect"),n.Ub()}}let Ut=(()=>{class e{constructor(e,t){this.bloomaResizeListenerService=e,this.dhDialogService=t,this._data=null,this.profileSelected=new n.p,this.itemWeightChanged=new n.p,this.childProfileWeightChanged=new n.p,this.addSubProfileToProfile=new n.p,this.addProfileItemToProfile=new n.p,this.addVirtualProfileItemToProfile=new n.p,this.disconnectLinkClicked=new n.p,this.treeItemDropped=new n.p,this.firstZoom=!0,this.sliderContainerStyle={width:"0",height:"0",padding:"0"},this.unsubscribe$=new l.a,this.viewInitialized=!1,this.margin={top:10,bottom:20,left:150,right:10},this.totalComponentWidth=0,this.isListening=!1,this.totalComponentHeight=0,this.nodeSquareWidth=100,this.nodeSquareHeight=60,this.draggableSquareDimension=10,this.dragStartX=0,this.dragStartY=0,this.dragX=0,this.dragY=0,this.linkColor="gray",this.selectedNodeColor="green",this.clickedLinkSource=null,this.clickedLinkTarget=null,this.weightTargetType=null,this.clickedLinkEvent=null,this.sliderElementHeight=124,this.sliderElementWidth=124,this.previousGraphAreaTransform=null,this.profileRectBorderColor="red",this.virtualProfileRectBorderColor="blue",this.profileItemRectBorderColor="black",this.profileRectBackgroundColor="rgb(235,199,199)",this.profileItemRectBackgroundColor="rgb(185,244,185)",this.virtualProfileRectBackgroundColor="rgb(199,235,243)",this.svgBackgroundColor="rgb(219,219,219)",this.getSquareIdForId=e=>"r"+e.replace(/\./g,"_");const i=new l.a;i.pipe(Object(K.a)(400),Object(a.a)(this.unsubscribe$)).subscribe(e=>this.createChart()),this.createSubject=i}get data(){return this._data}set data(e){this._data=e,this.createSubject.next()}get scores(){return this.scoresPrivate}set scores(e){this.scoresPrivate=e,this.createSubject.next()}ngOnDestroy(){this.bloomaResizeListenerService.unListenToElementResize(this.chartContainer.nativeElement),this.unsubscribe$.next(),this.unsubscribe$.complete()}ngOnInit(){}listenToElementSizeChange(e){this.isListening||(this.isListening=!0,this.bloomaResizeListenerService.listenToElementResize(e).pipe(Object(a.a)(this.unsubscribe$)).subscribe(e=>{this.createSubject.next()}))}ngAfterViewInit(){this.viewInitialized=!0,this.listenToElementSizeChange(this.chartContainer.nativeElement),setTimeout(()=>{this.createSubject.next()},250)}createChart(){if(!this.viewInitialized)return;if(!this.data)return;const e=this.chartContainer.nativeElement;this.totalComponentWidth=e.offsetWidth,this.totalComponentHeight=e.offsetHeight,0!=this.totalComponentHeight&&(this.initSvg(),this.setSvgHeight(),this.drawHierarchy(),this.setUpZoomBehavior(),this.zoomFit(),setTimeout(()=>{Object(n.mb)(this)},300))}initSvg(){if(!this.svg){const e=ee.m(this.chartContainer.nativeElement).append("svg");e.style("background","rgb(245,245,245)"),e.attr("class","main-svg"),this.svg=e;const t=5,i=5,r=t/2,o=i/2,s=[[0,0],[0,5],[5,2.5]];this.svg.append("defs").append("marker").attr("id","arrow").attr("viewBox",[0,0,t,i]).attr("refX",r).attr("refY",o).attr("markerWidth",t).attr("markerHeight",i).attr("orient","auto-start-reverse").append("path").attr("d",ee.g()(s)).attr("stroke","black")}}setSvgHeight(){this.svg.attr("height",this.totalComponentHeight).attr("width",this.totalComponentWidth)}mouseOverProfile(e){this.dragTargetData=e}mouseLeaveProfile(e){this.dragTargetData=null}getDragBehavior(e){return ee.e().clickDistance(15).container(e.node()).on("start",(e,t)=>{this.dragSourceType=t.data.itemType;const i="#"+this.getSquareIdForId(t.id),r=this.svg.select(i);if(null!=r&&0!=r.size()){this.dragSourceNode=r;try{const e=+r.attr("original-x"),t=+r.attr("original-y");this.dragX=this.dragStartX=e,this.dragY=this.dragStartY=t}catch(o){console.log(o)}e.sourceEvent.stopPropagation(),e.sourceEvent.preventDefault()}}).on("drag",(e,t)=>{if(0==this.dragStartX)return;this.dragX=e.x-e.subject.x,this.dragY=e.y-e.subject.y;const i=[[+this.dragStartX,+this.dragStartY],[this.dragStartX+this.dragX,this.dragStartY+this.dragY]],r=this.getDragLine(),o=ee.g();r.attr("d",o(i))}).on("end",()=>{if(this.removeDragLine(),this.dragStartX=0,this.dragStartY=0,null!=this.dragSourceNode&&null!=this.dragTargetData&&"profile"===this.dragTargetData.data.itemType)return"profile"==this.dragSourceType?void this.connectProfiles():"virtual"==this.dragSourceType?void this.copyVirtualProfileItem():void this.copyProfileItem()})}connectProfiles(){var e;const t=null===(e=this.dragSourceNode.datum())||void 0===e?void 0:e.id,i=this.dragTargetData.id;if(t==i)return;const r=this.profileMap[i];this.changeIntroducesCycle(this.profileMap[t],i)||r.parentIds.find(e=>e==t)||this.addSubProfileToProfile.next({parentProfileId:t,subProfileId:r.id})}copyVirtualProfileItem(){var e;const t=null===(e=this.dragSourceNode.datum())||void 0===e?void 0:e.id,i=this.dragTargetData.id;if(t==i)return;const r=this.profileMap[t];this.changeIntroducesCycle(r,i)||this.addVirtualProfileItemToProfile.next({profileId:i,virtualProfileItem:r})}copyProfileItem(){var e;const t=null===(e=this.dragSourceNode.datum())||void 0===e?void 0:e.id,i=this.dragTargetData.id;if(t==i)return;const r=this.profileMap[t];this.changeIntroducesCycle(r,i)||this.addProfileItemToProfile.next({profileId:i,profileItemName:r.originalName})}getRectColorForItemType(e){switch(e){case"profile":return this.profileRectBorderColor;case"virtual":return this.virtualProfileRectBorderColor;default:return this.profileItemRectBorderColor}}getRectBackgroundColorForItemType(e){switch(e){case"profile":return this.profileRectBackgroundColor;case"virtual":return this.virtualProfileRectBackgroundColor;default:return this.profileItemRectBackgroundColor}}isProfile(e){return"profile"===e}isVirtualProfile(e){return"virtual"===e}changeIntroducesCycle(e,t){if(null==e.parentIds)return!1;if(null==e?void 0:e.parentIds.find(e=>e==t))return!0;for(const i of null==e?void 0:e.parentIds)if(1==this.changeIntroducesCycle(this.profileMap[i],t))return!0;return!1}removeDragLine(){this.svg.select(".drag-line").remove(),this.dragLine=null}getDragLine(){return this.dragLine||(this.dragLine=this.svg.select(".graph-area").append("path").attr("class","drag-line").style("stroke","red").style("fill","none")),this.dragLine}drawHierarchy(){const e=this.svg.select(".graph-area");if(this.previousGraphAreaTransform=null,e.size()>0){const t=e.node();this.previousGraphAreaTransform=ee.s(t)}this.svg.select(".graph-area").remove();const t=function(...e){if(e.length)throw Error(`got arguments to dagStratify(${e}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return function e(t,i,r){function o(e){if(!e.length)throw new Error("can't stratify empty data");const i=e.map((e,i)=>new Ce(function(e){if("string"!=typeof e)throw new Error("id is supposed to be string but got type "+typeof e);if(e.indexOf("\0")>=0)throw new Error(`node id ${e} contained null character`);return e}(t(e,i)),e)),o=new Map;i.forEach(e=>{if(o.has(e.id))throw new Error("found a duplicate id: "+e.id);o.set(e.id,e)});const s=[];return i.forEach((e,t)=>{const i=r(e.data,t)||[];i.forEach(([t,i])=>{const r=o.get(t);if(!r)throw new Error("missing id: "+t);return r.dataChildren.push(new Ie(e,i)),r}),i.length||s.push(e)}),function(e){if(!e.length)throw new Error("dag contained no roots");const t=new Set,i=new Set;let r=null;function o(e){if(t.has(e.id))return[];if(i.has(e.id))return r=e.id,[e.id];{i.add(e.id);let s=[];for(const t of e.ichildren())if(s=o(t),s.length)break;return i.delete(e.id),t.add(e.id),s.length&&null!==r&&s.push(e.id),r===e.id&&(r=null),s}}for(const s of e){const e=o(s);if(e.length)throw new Error("dag contained a cycle: "+e.reverse().join(" -> "))}for(const s of new ke(e))if(new Set(s.ichildren().map(e=>e.id)).size!==s.dataChildren.length)throw new Error(`node '${s.id}' contained duplicate children`)}(s),s.length>1?new ke(s):s[0]}return o.id=function(o){return void 0===o?t:e(o,i,r)},o.parentData=function(i){return void 0===i?r:e(t,function(e){function t(t,i){return(e(t,i)||[]).map(([e])=>e)}return t.wrapped=e,t}(i),i)},o.parentIds=function(r){return void 0===r?i:e(t,r,Ae(r))},o}(Ve,Ee,Ae(Ee))}();if(!this.data||0==this.data.length)return;let i;try{i=t(this.data)}catch(c){return void this.dhDialogService.showMessage("error with local profile data. Please refresh")}const r=Ot().nodeSize([150,390])(i),o=this.svg.append("g").attr("class","graph-area"),s=r.descendants(),n=this.getDragBehavior(o),a=o.append("g").attr("class","links-group"),l=r.links();a.selectAll("line").data(l).enter().append("line").attr("class","line").attr("stroke",this.linkColor).attr("stroke-width","5").attr("marker-end","url(#arrow)").attr("data-id-source",e=>this.getSquareIdForId(e.source.id)).attr("data-id-target",e=>this.getSquareIdForId(e.target.id)).attr("x1",e=>this.margin.left+e.source.y).attr("y1",e=>this.margin.top+e.source.x).attr("y2",e=>this.margin.top+e.target.x).on("mouseover",(e,t)=>{ee.m(e.srcElement).attr("stroke","red")}).on("mouseout",(e,t)=>{ee.m(e.srcElement).attr("stroke",this.linkColor)}).on("click",(e,t)=>{this.isVirtualProfile(t.target.data.itemType)||(this.clickedLinkSource=t.source.id,this.clickedLinkTarget=t.target.data.originalId,this.weightTargetType="profile"===t.target.data.itemType?"childProfile":"item",this.clickedLinkEvent=e,ee.m(e.srcElement).attr("stroke",this.linkColor),this.showWeightSlider())}).each((e,t,i)=>{const r=ee.m(i[t]),o=this.calculateTargetBoxWidth(e.target.data.name);r.attr("x2",this.margin.left+e.target.y-o/2-5)}),o.append("g").attr("class","nodes-group").selectAll("g.node").data(s).enter().append("g").attr("class","node").attr("transform",e=>`translate(${this.margin.left+e.y},${this.margin.top+e.x})`).on("click",(e,t)=>{this.setSelectedNode(t,e)}).each((e,t,i)=>{const r=ee.m(i[t]);let o=this.drawRectNode(r,e.id),{width:s,height:a}=this.drawText(r,e.data.name);this.setRectWidthAndHeight(o,s,a,e.x,e.y),this.drawDraggableCircle(r,e.id,s,n),this.setRectMouseEvents(o),this.drawScoresTextForNode(r,e.data)})}drawScoresTextForNode(e,t){var i,r,o,s,n,a,l,c,h,d;if(null!=this.scores[null===(i=this.selectedProfile)||void 0===i?void 0:i.id])if("profile"==t.itemType)if(0!=t.publicProfile||null!=t.parentIds&&0!=t.parentIds.length){const i=null===(l=null===(a=this.scores[null===(n=this.selectedProfile)||void 0===n?void 0:n.id])||void 0===a?void 0:a.map)||void 0===l?void 0:l.profileScores[t.id];this.drawScoresText(e,null==i?void 0:i.score)}else this.drawScoresText(e,null===(s=null===(o=null===(r=this.scores[t.id])||void 0===r?void 0:r.map)||void 0===o?void 0:o.rootScore)||void 0===s?void 0:s.totalScore);else if("virtual"!=t.itemType){const i=null===(d=null===(h=this.scores[null===(c=this.selectedProfile)||void 0===c?void 0:c.id])||void 0===h?void 0:h.map)||void 0===d?void 0:d.profileItemScores[t.id];this.drawScoresText(e,null==i?void 0:i.score)}}drawScoresText(e,t){null!=t&&e.append("text").attr("class","svg-text score-text").attr("dx",-40).attr("dy",-40).text(t)}setRectWidthAndHeight(e,t,i,r,o){e.attr("x",0-t/2).attr("y",-i/2).attr("width",t).attr("original-x",this.margin.left+o+t/2).attr("original-y",this.margin.top+r).attr("height",i)}setRectMouseEvents(e){e.attr("pointer-events","mouseover").on("mouseover",(e,t)=>{0!=this.dragStartX&&"profile"==t.data.itemType&&(e.target.setAttribute("stroke","red"),e.target.setAttribute("stroke-width",5),this.mouseOverProfile(t))}).on("mouseout",(e,t)=>{var i;null!=e.fromElement&&null!=e.toElement&&(e.fromElement.parentElement==e.toElement.parentElement&&"circle"!=e.toElement.tagName||(t.id!==(null===(i=this.selectedProfile)||void 0===i?void 0:i.id)&&(e.target.setAttribute("stroke-width",1),e.target.setAttribute("stroke",this.getRectColorForItemType(t.data.itemType))),this.mouseLeaveProfile(t)))})}drawRectNode(e,t){return e.append("rect").attr("id",this.getSquareIdForId(t)).attr("fill",e=>this.getRectBackgroundColorForItemType(e.data.itemType)).attr("stroke",e=>this.getRectColorForItemType(e.data.itemType)).attr("class","profile-container").attr("rx",15).classed("item-type-profile",e=>this.isProfile(e.data.itemType))}drawText(e,t){let i=e.append("text").attr("class","svg-text container-text").attr("dx",10).text(t).on("click",(e,t)=>{const i=new Event("click",{});e.srcElement.parentElement.firstChild.dispatchEvent(i)});const r=i.node().getBBox(),o=ee.h([r.width+20,this.nodeSquareWidth]),s=ee.h([r.height,this.nodeSquareHeight]);return i.attr("x",0-o/2),{width:o,height:s}}drawDraggableCircle(e,t,i,r){e.append("circle").attr("id","c"+t).attr("fill","purple").attr("r","8").attr("cx",i/2).attr("cy",0).attr("stroke","purple").call(r)}calculateTargetBoxWidth(e){const t=this.svg.append("text").attr("class","svg-text-to-remove").attr("dx",10).text(e),i=t.node().getBBox(),r=ee.h([i.width+20,this.nodeSquareWidth]);return t.remove(),r}setSelectedNode(e,t){var i,r;this.setSelectedProfile(e),ee.n(".profile-container").attr("stroke",e=>this.getRectColorForItemType(e.data.itemType)),ee.m(null===(r=null===(i=null==t?void 0:t.srcElement)||void 0===i?void 0:i.parentElement)||void 0===r?void 0:r.firstElementChild).attr("stroke",this.selectedNodeColor)}saveNewWeight(){if(this.hideWeightSlider(),"item"==this.weightTargetType){const e=(new se).transform(this.clickedLinkSource,this.profileMap);this.itemWeightChanged.next({profileId:e,updateProfileItemWeightDto:{newWeight:this.selectedWeight,profileItemName:this.clickedLinkTarget}})}else this.childProfileWeightChanged.next({profileId:this.clickedLinkSource,subProfileId:this.clickedLinkTarget,updateSubProfileWeightDto:{newWeight:this.selectedWeight}})}hideWeightSlider(){ee.m(this.weightSliderContainer.nativeElement).transition().duration(200).style("opacity",0),this.sliderContainerStyle={width:"0",height:"0",padding:"0"}}disconnect(){this.hideWeightSlider(),this.disconnectLinkClicked.next({profileId:this.clickedLinkSource,childProfileToDelete:this.clickedLinkTarget})}showWeightSlider(){var e;this.selectedWeight=null!==(e=this.getLinkWeight(this.clickedLinkSource,this.clickedLinkTarget))&&void 0!==e?e:0;const t=ee.m(this.weightSliderContainer.nativeElement),i=this.selectTopForSlider(),r=this.selectLeftForSlider();this.sliderContainerStyle={width:"300px",left:r+"px",top:i+"px",padding:"10px"},t.transition().duration(200).style("opacity",1),Object(n.mb)(this)}selectTopForSlider(){return this.clickedLinkEvent.y+this.sliderElementHeight>=this.totalComponentHeight?this.totalComponentHeight-130:this.clickedLinkEvent.y}selectLeftForSlider(){return this.clickedLinkEvent.x+this.sliderElementWidth>=this.totalComponentWidth?this.totalComponentWidth-this.sliderElementWidth-10:this.clickedLinkEvent.x}weightChanged(e){this.selectedWeight=e.value}getLinkWeight(e,t){const i=(new se).transform(e,this.profileMap),r=this.weights[i];let o=r[t];o||(o=r[t.toUpperCase()]);const s=t.indexOf("_");return!o&&s>-1&&(o=r[t=t.substr(s+1)]),o}setUpZoomBehavior(){if(!this.data||0==this.data.length)return;const e=this.svg.select(".graph-area"),t=this.svg.select(".nodes-group").node();if(null==t)return;const i=t.getBBox(),r=[[0,0],[ee.i([this.totalComponentWidth,i.width+this.margin.left+100]),ee.i([this.totalComponentHeight,i.height])]],o=[[0,-100],[i.width+this.margin.left+100,i.height]],s=ee.q().scaleExtent([.1,10]).extent(r).translateExtent(o).on("zoom",t=>{e.attr("transform",t.transform)});if(this.zoomBehavior=s,this.svg.call(s),this.previousGraphAreaTransform){if(1==this.previousGraphAreaTransform.k&&0==this.previousGraphAreaTransform.y&&0==this.previousGraphAreaTransform.x)return;this.svg.call(s.transform,this.previousGraphAreaTransform)}}setSelectedProfile(e){this.profileSelected.next({selectedNodeId:e.id,nodeType:e.data.itemType})}onDrop(e){if(null==e.event.target)return;const t=e.event.target.classList.contains("main-svg")?"independent":"sub",i="independent"===t?null:e.event.target.id.substring(1);this.treeItemDropped.next({dropTargetType:t,dropTargetId:i,droppedData:[e.element.data]})}allowDrop(e,t){var i,r,o;return!!(null===(i=t.target)||void 0===i?void 0:i.classList.contains("item-type-profile"))||!!(null===(o=null===(r=t.target)||void 0===r?void 0:r.previousSibling)||void 0===o?void 0:o.classList.contains("item-type-profile"))}zoomFit(){if(!this.firstZoom)return;const e=this.svg.select(".graph-area");if(!e)return;let t=e.node();if(!t)return;this.firstZoom=!1;const i=t.getBBox(),r=t.parentElement,o=r.clientWidth,s=r.clientHeight,n=i.width,a=i.height,l=i.x+n/2,c=i.y+a/2;if(0==n||0==a)return;const h=.8/Math.max(n/o,a/s),d=[o/2-h*l,s/2-h*c];this.svg.call(this.zoomBehavior.transform,ee.r.translate(d[0],d[1]).scale(h))}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(te.a),n.Pb(k.a))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-hierarchy"]],viewQuery:function(e,t){if(1&e&&(n.Jc(Ft,!0),n.Jc(jt,!0)),2&e){let e;n.tc(e=n.dc())&&(t.chartContainer=e.first),n.tc(e=n.dc())&&(t.weightSliderContainer=e.first)}},inputs:{data:"data",weights:"weights",profileMap:"profileMap",selectedProfile:"selectedProfile",scores:"scores"},outputs:{profileSelected:"profileSelected",itemWeightChanged:"itemWeightChanged",childProfileWeightChanged:"childProfileWeightChanged",addSubProfileToProfile:"addSubProfileToProfile",addProfileItemToProfile:"addProfileItemToProfile",addVirtualProfileItemToProfile:"addVirtualProfileItemToProfile",disconnectLinkClicked:"disconnectLinkClicked",treeItemDropped:"treeItemDropped"},decls:13,vars:5,consts:[["id","hierarchy-graph",1,"hierarchy-graph",3,"treeAllowDrop","treeDrop"],["chart",""],["id","weight-slider",1,"overflow-hidden",3,"ngStyle"],["weightSlider",""],["min","1","max","100","step","1",3,"ngModel","ngModelChange","input"],[1,"flex"],["mat-flat-button","","color","primary",1,"mx-2",3,"click"],["mat-flat-button","","color","warn",1,"mx-2",3,"click"],["class","mx-2","mat-flat-button","","color","warn",3,"click",4,"ngIf"]],template:function(e,t){1&e&&(n.Vb(0,"div",0,1),n.cc("treeDrop",(function(e){return t.onDrop(e)})),n.Ub(),n.Vb(2,"div",2,3),n.Vb(4,"div"),n.Gc(5),n.Ub(),n.Vb(6,"mat-slider",4),n.cc("ngModelChange",(function(e){return t.selectedWeight=e}))("input",(function(e){return t.weightChanged(e)})),n.Ub(),n.Vb(7,"div",5),n.Vb(8,"button",6),n.cc("click",(function(){return t.saveNewWeight()})),n.Gc(9,"Save"),n.Ub(),n.Vb(10,"button",7),n.cc("click",(function(){return t.hideWeightSlider()})),n.Gc(11,"Cancel"),n.Ub(),n.Ec(12,Nt,2,0,"button",8),n.Ub(),n.Ub()),2&e&&(n.mc("treeAllowDrop",t.allowDrop.bind(t)),n.Db(2),n.mc("ngStyle",t.sliderContainerStyle),n.Db(3),n.Ic("Weight: ",t.selectedWeight,""),n.Db(1),n.mc("ngModel",t.selectedWeight),n.Db(6),n.mc("ngIf","childProfile"==t.weightTargetType))},directives:[Rt.b,r.n,$.a,p.j,p.m,v.b,r.m],styles:[".hierarchy-graph{height:inherit;width:inherit}.hierarchy-graph .svg-text{pointer-events:none;-webkit-user-select:none;user-select:none}.hierarchy-graph .score-text{fill:red;font-size:20px;font-weight:500;border:1px solid #000;font-style:italic}.hierarchy-graph svg{background:#d3d3d3}#weight-slider{background-color:#fff;color:#000;position:absolute;opacity:0;width:0}#weight-slider mat-slider{width:100%}"],encapsulation:2}),e})();var Lt=i("xJCX"),Gt=i("dgVI"),Wt=i("HOZh"),$t=i("+T6E"),qt=i("qU21"),Ht=i("2Bju"),Jt=i("IdLP");const Qt=["gutterEls"];function Yt(e,t){if(1&e){const e=n.Wb();n.Vb(0,"div",2,3),n.cc("mousedown",(function(t){n.wc(e);const i=n.gc().index;return n.gc().startDragging(t,2*i+1,i+1)}))("touchstart",(function(t){n.wc(e);const i=n.gc().index;return n.gc().startDragging(t,2*i+1,i+1)}))("mouseup",(function(t){n.wc(e);const i=n.gc().index;return n.gc().clickGutter(t,i+1)}))("touchend",(function(t){n.wc(e);const i=n.gc().index;return n.gc().clickGutter(t,i+1)})),n.Qb(2,"div",4),n.Ub()}if(2&e){const e=n.gc().index,t=n.gc();n.Bc("flex-basis",t.gutterSize,"px")("order",2*e+1)}}function Xt(e,t){1&e&&n.Ec(0,Yt,3,4,"div",1),2&e&&n.mc("ngIf",!1===t.last)}const Zt=["*"];function Kt(e){return void 0!==e.changedTouches&&e.changedTouches.length>0?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:void 0!==e.clientX&&void 0!==e.clientY?{x:e.clientX,y:e.clientY}:null}function ei(e,t){const i=e.nativeElement.getBoundingClientRect();return"horizontal"===t?i.width:i.height}function ti(e){return"boolean"==typeof e?e:"false"!==e}function ii(e,t){return null==e?t:(e=Number(e),!isNaN(e)&&e>=0?e:t)}function ri(e,t){if("percent"===e){const e=t.reduce((e,t)=>null!==t?e+t:e,0);return t.every(e=>null!==e)&&e>99.9&&e<100.1}if("pixel"===e)return 1===t.filter(e=>null===e).length}function oi(e){return null===e.size?null:!0===e.component.lockSize?e.size:null===e.component.minSize?null:e.component.minSize>e.size?e.size:e.component.minSize}function si(e){return null===e.size?null:!0===e.component.lockSize?e.size:null===e.component.maxSize?null:e.component.maxSize<e.size?e.size:e.component.maxSize}function ni(e,t,i,r){return t.reduce((t,i)=>{const o=function(e,t,i,r){return 0===i?{areaSnapshot:t,pixelAbsorb:0,percentAfterAbsorption:t.sizePercentAtStart,pixelRemain:0}:0===t.sizePixelAtStart&&i<0?{areaSnapshot:t,pixelAbsorb:0,percentAfterAbsorption:0,pixelRemain:i}:"percent"===e?function(e,t,i){const r=(e.sizePixelAtStart+t)/i*100;if(t>0){if(null!==e.area.maxSize&&r>e.area.maxSize){const r=e.area.maxSize/100*i;return{areaSnapshot:e,pixelAbsorb:r,percentAfterAbsorption:e.area.maxSize,pixelRemain:e.sizePixelAtStart+t-r}}return{areaSnapshot:e,pixelAbsorb:t,percentAfterAbsorption:r>100?100:r,pixelRemain:0}}if(t<0){if(null!==e.area.minSize&&r<e.area.minSize){const r=e.area.minSize/100*i;return{areaSnapshot:e,pixelAbsorb:r,percentAfterAbsorption:e.area.minSize,pixelRemain:e.sizePixelAtStart+t-r}}return r<0?{areaSnapshot:e,pixelAbsorb:-e.sizePixelAtStart,percentAfterAbsorption:0,pixelRemain:t+e.sizePixelAtStart}:{areaSnapshot:e,pixelAbsorb:t,percentAfterAbsorption:r,pixelRemain:0}}}(t,i,r):"pixel"===e?function(e,t,i){const r=e.sizePixelAtStart+t;return t>0?null!==e.area.maxSize&&r>e.area.maxSize?{areaSnapshot:e,pixelAbsorb:e.area.maxSize-e.sizePixelAtStart,percentAfterAbsorption:-1,pixelRemain:r-e.area.maxSize}:{areaSnapshot:e,pixelAbsorb:t,percentAfterAbsorption:-1,pixelRemain:0}:t<0?null!==e.area.minSize&&r<e.area.minSize?{areaSnapshot:e,pixelAbsorb:e.area.minSize+t-r,percentAfterAbsorption:-1,pixelRemain:r-e.area.minSize}:r<0?{areaSnapshot:e,pixelAbsorb:-e.sizePixelAtStart,percentAfterAbsorption:-1,pixelRemain:t+e.sizePixelAtStart}:{areaSnapshot:e,pixelAbsorb:t,percentAfterAbsorption:-1,pixelRemain:0}:void 0}(t,i):void 0}(e,i,t.remain,r);return t.list.push(o),t.remain=o.pixelRemain,t},{remain:i,list:[]})}function ai(e,t){"percent"===e?t.areaSnapshot.area.size=t.percentAfterAbsorption:"pixel"===e&&null!==t.areaSnapshot.area.size&&(t.areaSnapshot.area.size=t.areaSnapshot.sizePixelAtStart+t.pixelAbsorb)}let li=(()=>{class e{constructor(e,t,i,r){this.ngZone=e,this.elRef=t,this.cdRef=i,this.renderer=r,this._direction="horizontal",this._unit="percent",this._gutterSize=11,this._gutterStep=1,this._restrictMove=!1,this._useTransition=!1,this._disabled=!1,this._dir="ltr",this._gutterDblClickDuration=0,this.dragStart=new n.p(!1),this.dragEnd=new n.p(!1),this.gutterClick=new n.p(!1),this.gutterDblClick=new n.p(!1),this.dragProgressSubject=new l.a,this.dragProgress$=this.dragProgressSubject.asObservable(),this.isDragging=!1,this.isWaitingClear=!1,this.dragListeners=[],this.snapshot=null,this.startPoint=null,this.endPoint=null,this.displayedAreas=[],this.hidedAreas=[],this._clickTimeout=null,this.direction=this._direction}set direction(e){this._direction="vertical"===e?"vertical":"horizontal",this.renderer.addClass(this.elRef.nativeElement,"as-"+this._direction),this.renderer.removeClass(this.elRef.nativeElement,"as-"+("vertical"===this._direction?"horizontal":"vertical")),this.build(!1,!1)}get direction(){return this._direction}set unit(e){this._unit="pixel"===e?"pixel":"percent",this.renderer.addClass(this.elRef.nativeElement,"as-"+this._unit),this.renderer.removeClass(this.elRef.nativeElement,"as-"+("pixel"===this._unit?"percent":"pixel")),this.build(!1,!0)}get unit(){return this._unit}set gutterSize(e){this._gutterSize=ii(e,11),this.build(!1,!1)}get gutterSize(){return this._gutterSize}set gutterStep(e){this._gutterStep=ii(e,1)}get gutterStep(){return this._gutterStep}set restrictMove(e){this._restrictMove=ti(e)}get restrictMove(){return this._restrictMove}set useTransition(e){this._useTransition=ti(e),this._useTransition?this.renderer.addClass(this.elRef.nativeElement,"as-transition"):this.renderer.removeClass(this.elRef.nativeElement,"as-transition")}get useTransition(){return this._useTransition}set disabled(e){this._disabled=ti(e),this._disabled?this.renderer.addClass(this.elRef.nativeElement,"as-disabled"):this.renderer.removeClass(this.elRef.nativeElement,"as-disabled")}get disabled(){return this._disabled}set dir(e){this._dir="rtl"===e?"rtl":"ltr",this.renderer.setAttribute(this.elRef.nativeElement,"dir",this._dir)}get dir(){return this._dir}set gutterDblClickDuration(e){this._gutterDblClickDuration=ii(e,0)}get gutterDblClickDuration(){return this._gutterDblClickDuration}get transitionEnd(){return new Jt.a(e=>this.transitionEndSubscriber=e).pipe(Object(K.a)(20))}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>this.renderer.addClass(this.elRef.nativeElement,"as-init"))})}getNbGutters(){return 0===this.displayedAreas.length?0:this.displayedAreas.length-1}addArea(e){const t={component:e,order:0,size:0,minSize:null,maxSize:null};!0===e.visible?(this.displayedAreas.push(t),this.build(!0,!0)):this.hidedAreas.push(t)}removeArea(e){if(this.displayedAreas.some(t=>t.component===e)){const t=this.displayedAreas.find(t=>t.component===e);this.displayedAreas.splice(this.displayedAreas.indexOf(t),1),this.build(!0,!0)}else if(this.hidedAreas.some(t=>t.component===e)){const t=this.hidedAreas.find(t=>t.component===e);this.hidedAreas.splice(this.hidedAreas.indexOf(t),1)}}updateArea(e,t,i){!0===e.visible&&this.build(t,i)}showArea(e){const t=this.hidedAreas.find(t=>t.component===e);if(void 0===t)return;const i=this.hidedAreas.splice(this.hidedAreas.indexOf(t),1);this.displayedAreas.push(...i),this.build(!0,!0)}hideArea(e){const t=this.displayedAreas.find(t=>t.component===e);if(void 0===t)return;const i=this.displayedAreas.splice(this.displayedAreas.indexOf(t),1);i.forEach(e=>{e.order=0,e.size=0}),this.hidedAreas.push(...i),this.build(!0,!0)}getVisibleAreaSizes(){return this.displayedAreas.map(e=>null===e.size?"*":e.size)}setVisibleAreaSizes(e){if(e.length!==this.displayedAreas.length)return!1;const t=e.map(e=>ii(e,null));return!1!==ri(this.unit,t)&&(this.displayedAreas.forEach((e,i)=>e.component._size=t[i]),this.build(!1,!0),!0)}build(e,t){if(this.stopDragging(),!0===e&&(this.displayedAreas.every(e=>null!==e.component.order)&&this.displayedAreas.sort((e,t)=>e.component.order-t.component.order),this.displayedAreas.forEach((e,t)=>{e.order=2*t,e.component.setStyleOrder(e.order)})),!0===t){const e=ri(this.unit,this.displayedAreas.map(e=>e.component.size));switch(this.unit){case"percent":{const t=100/this.displayedAreas.length;this.displayedAreas.forEach(i=>{i.size=e?i.component.size:t,i.minSize=oi(i),i.maxSize=si(i)});break}case"pixel":if(e)this.displayedAreas.forEach(e=>{e.size=e.component.size,e.minSize=oi(e),e.maxSize=si(e)});else{const e=this.displayedAreas.filter(e=>null===e.component.size);if(0===e.length&&this.displayedAreas.length>0)this.displayedAreas.forEach((e,t)=>{e.size=0===t?null:e.component.size,e.minSize=0===t?null:oi(e),e.maxSize=0===t?null:si(e)});else if(e.length>1){let e=!1;this.displayedAreas.forEach(t=>{null===t.component.size?!1===e?(t.size=null,t.minSize=null,t.maxSize=null,e=!0):(t.size=100,t.minSize=null,t.maxSize=null):(t.size=t.component.size,t.minSize=oi(t),t.maxSize=si(t))})}}}}this.refreshStyleSizes(),this.cdRef.markForCheck()}refreshStyleSizes(){if("percent"===this.unit)if(1===this.displayedAreas.length)this.displayedAreas[0].component.setStyleFlex(0,0,"100%",!1,!1);else{const e=this.getNbGutters()*this.gutterSize;this.displayedAreas.forEach(t=>{t.component.setStyleFlex(0,0,`calc( ${t.size}% - ${t.size/100*e}px )`,null!==t.minSize&&t.minSize===t.size,null!==t.maxSize&&t.maxSize===t.size)})}else"pixel"===this.unit&&this.displayedAreas.forEach(e=>{null===e.size?e.component.setStyleFlex(1,1,1===this.displayedAreas.length?"100%":"auto",!1,!1):1===this.displayedAreas.length?e.component.setStyleFlex(0,0,"100%",!1,!1):e.component.setStyleFlex(0,0,e.size+"px",null!==e.minSize&&e.minSize===e.size,null!==e.maxSize&&e.maxSize===e.size)})}clickGutter(e,t){const i=Kt(e);this.startPoint&&this.startPoint.x===i.x&&this.startPoint.y===i.y&&(null!==this._clickTimeout?(window.clearTimeout(this._clickTimeout),this._clickTimeout=null,this.notify("dblclick",t),this.stopDragging()):this._clickTimeout=window.setTimeout(()=>{this._clickTimeout=null,this.notify("click",t),this.stopDragging()},this.gutterDblClickDuration))}startDragging(e,t,i){e.preventDefault(),e.stopPropagation(),this.startPoint=Kt(e),null!==this.startPoint&&!0!==this.disabled&&!0!==this.isWaitingClear&&(this.snapshot={gutterNum:i,lastSteppedOffset:0,allAreasSizePixel:ei(this.elRef,this.direction)-this.getNbGutters()*this.gutterSize,allInvolvedAreasSizePercent:100,areasBeforeGutter:[],areasAfterGutter:[]},this.displayedAreas.forEach(e=>{const i={area:e,sizePixelAtStart:ei(e.component.elRef,this.direction),sizePercentAtStart:"percent"===this.unit?e.size:-1};e.order<t?!0===this.restrictMove?this.snapshot.areasBeforeGutter=[i]:this.snapshot.areasBeforeGutter.unshift(i):e.order>t&&(!0===this.restrictMove?0===this.snapshot.areasAfterGutter.length&&(this.snapshot.areasAfterGutter=[i]):this.snapshot.areasAfterGutter.push(i))}),this.snapshot.allInvolvedAreasSizePercent=[...this.snapshot.areasBeforeGutter,...this.snapshot.areasAfterGutter].reduce((e,t)=>e+t.sizePercentAtStart,0),0!==this.snapshot.areasBeforeGutter.length&&0!==this.snapshot.areasAfterGutter.length&&(this.dragListeners.push(this.renderer.listen("document","mouseup",this.stopDragging.bind(this))),this.dragListeners.push(this.renderer.listen("document","touchend",this.stopDragging.bind(this))),this.dragListeners.push(this.renderer.listen("document","touchcancel",this.stopDragging.bind(this))),this.ngZone.runOutsideAngular(()=>{this.dragListeners.push(this.renderer.listen("document","mousemove",this.dragEvent.bind(this))),this.dragListeners.push(this.renderer.listen("document","touchmove",this.dragEvent.bind(this)))}),this.displayedAreas.forEach(e=>e.component.lockEvents()),this.isDragging=!0,this.renderer.addClass(this.elRef.nativeElement,"as-dragging"),this.renderer.addClass(this.gutterEls.toArray()[this.snapshot.gutterNum-1].nativeElement,"as-dragged"),this.notify("start",this.snapshot.gutterNum)))}dragEvent(e){if(e.preventDefault(),e.stopPropagation(),null!==this._clickTimeout&&(window.clearTimeout(this._clickTimeout),this._clickTimeout=null),!1===this.isDragging)return;if(this.endPoint=Kt(e),null===this.endPoint)return;let t="horizontal"===this.direction?this.startPoint.x-this.endPoint.x:this.startPoint.y-this.endPoint.y;"rtl"===this.dir&&(t=-t);const i=Math.round(t/this.gutterStep)*this.gutterStep;if(i===this.snapshot.lastSteppedOffset)return;this.snapshot.lastSteppedOffset=i;let r=ni(this.unit,this.snapshot.areasBeforeGutter,-i,this.snapshot.allAreasSizePixel),o=ni(this.unit,this.snapshot.areasAfterGutter,i,this.snapshot.allAreasSizePixel);if(0!==r.remain&&0!==o.remain?Math.abs(r.remain)===Math.abs(o.remain)||(Math.abs(r.remain)>Math.abs(o.remain)?o=ni(this.unit,this.snapshot.areasAfterGutter,i+r.remain,this.snapshot.allAreasSizePixel):r=ni(this.unit,this.snapshot.areasBeforeGutter,-(i-o.remain),this.snapshot.allAreasSizePixel)):0!==r.remain?o=ni(this.unit,this.snapshot.areasAfterGutter,i+r.remain,this.snapshot.allAreasSizePixel):0!==o.remain&&(r=ni(this.unit,this.snapshot.areasBeforeGutter,-(i-o.remain),this.snapshot.allAreasSizePixel)),"percent"===this.unit){const e=[...r.list,...o.list],t=e.find(e=>0!==e.percentAfterAbsorption&&e.percentAfterAbsorption!==e.areaSnapshot.area.minSize&&e.percentAfterAbsorption!==e.areaSnapshot.area.maxSize);t&&(t.percentAfterAbsorption=this.snapshot.allInvolvedAreasSizePercent-e.filter(e=>e!==t).reduce((e,t)=>e+t.percentAfterAbsorption,0))}r.list.forEach(e=>ai(this.unit,e)),o.list.forEach(e=>ai(this.unit,e)),this.refreshStyleSizes(),this.notify("progress",this.snapshot.gutterNum)}stopDragging(e){if(e&&(e.preventDefault(),e.stopPropagation()),!1!==this.isDragging){for(this.displayedAreas.forEach(e=>e.component.unlockEvents());this.dragListeners.length>0;){const e=this.dragListeners.pop();e&&e()}this.isDragging=!1,!this.endPoint||this.startPoint.x===this.endPoint.x&&this.startPoint.y===this.endPoint.y||this.notify("end",this.snapshot.gutterNum),this.renderer.removeClass(this.elRef.nativeElement,"as-dragging"),this.renderer.removeClass(this.gutterEls.toArray()[this.snapshot.gutterNum-1].nativeElement,"as-dragged"),this.snapshot=null,this.isWaitingClear=!0,this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.startPoint=null,this.endPoint=null,this.isWaitingClear=!1})})}}notify(e,t){const i=this.getVisibleAreaSizes();"start"===e?this.dragStart.emit({gutterNum:t,sizes:i}):"end"===e?this.dragEnd.emit({gutterNum:t,sizes:i}):"click"===e?this.gutterClick.emit({gutterNum:t,sizes:i}):"dblclick"===e?this.gutterDblClick.emit({gutterNum:t,sizes:i}):"transitionEnd"===e?this.transitionEndSubscriber&&this.ngZone.run(()=>this.transitionEndSubscriber.next(i)):"progress"===e&&this.dragProgressSubject.next({gutterNum:t,sizes:i})}ngOnDestroy(){this.stopDragging()}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.B),n.Pb(n.m),n.Pb(n.i),n.Pb(n.G))},e.\u0275cmp=n.Jb({type:e,selectors:[["as-split"]],viewQuery:function(e,t){if(1&e&&n.Jc(Qt,!0),2&e){let e;n.tc(e=n.dc())&&(t.gutterEls=e)}},inputs:{direction:"direction",unit:"unit",gutterSize:"gutterSize",gutterStep:"gutterStep",restrictMove:"restrictMove",useTransition:"useTransition",disabled:"disabled",dir:"dir",gutterDblClickDuration:"gutterDblClickDuration"},outputs:{dragStart:"dragStart",dragEnd:"dragEnd",gutterClick:"gutterClick",gutterDblClick:"gutterDblClick",transitionEnd:"transitionEnd"},exportAs:["asSplit"],ngContentSelectors:Zt,decls:2,vars:1,consts:[["ngFor","",3,"ngForOf"],["class","as-split-gutter",3,"flex-basis","order","mousedown","touchstart","mouseup","touchend",4,"ngIf"],[1,"as-split-gutter",3,"mousedown","touchstart","mouseup","touchend"],["gutterEls",""],[1,"as-split-gutter-icon"]],template:function(e,t){1&e&&(n.lc(),n.kc(0),n.Ec(1,Xt,1,1,"ng-template",0)),2&e&&(n.Db(1),n.mc("ngForOf",t.displayedAreas))},directives:[r.l,r.m],styles:['[_nghost-%COMP%]{display:flex;flex-wrap:nowrap;justify-content:flex-start;align-items:stretch;overflow:hidden;width:100%;height:100%}[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{flex-grow:0;flex-shrink:0;background-color:#eee;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%] > .as-split-gutter-icon[_ngcontent-%COMP%]{width:100%;height:100%;background-position:center center;background-repeat:no-repeat}[_nghost-%COMP%]    >.as-split-area{flex-grow:0;flex-shrink:0;overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]    >.as-split-area.as-hidden{flex:0 1 0px!important;overflow-x:hidden;overflow-y:hidden}.as-horizontal[_nghost-%COMP%]{flex-direction:row}.as-horizontal[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{flex-direction:row;cursor:col-resize;height:100%}.as-horizontal[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%] > .as-split-gutter-icon[_ngcontent-%COMP%]{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==)}.as-horizontal[_nghost-%COMP%]    >.as-split-area{height:100%}.as-vertical[_nghost-%COMP%]{flex-direction:column}.as-vertical[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{flex-direction:column;cursor:row-resize;width:100%}.as-vertical[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]   .as-split-gutter-icon[_ngcontent-%COMP%]{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFCAMAAABl/6zIAAAABlBMVEUAAADMzMzIT8AyAAAAAXRSTlMAQObYZgAAABRJREFUeAFjYGRkwIMJSeMHlBkOABP7AEGzSuPKAAAAAElFTkSuQmCC)}.as-vertical[_nghost-%COMP%]    >.as-split-area{width:100%}.as-vertical[_nghost-%COMP%]    >.as-split-area.as-hidden{max-width:0}.as-disabled[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]{cursor:default}.as-disabled[_nghost-%COMP%] > .as-split-gutter[_ngcontent-%COMP%]   .as-split-gutter-icon[_ngcontent-%COMP%]{background-image:url("")}.as-transition.as-init[_nghost-%COMP%]:not(.as-dragging)    >.as-split-area, .as-transition.as-init[_nghost-%COMP%]:not(.as-dragging) > .as-split-gutter[_ngcontent-%COMP%]{transition:flex-basis .3s}'],changeDetection:0}),e})(),ci=(()=>{class e{constructor(e,t,i,r){this.ngZone=e,this.elRef=t,this.renderer=i,this.split=r,this._order=null,this._size=null,this._minSize=null,this._maxSize=null,this._lockSize=!1,this._visible=!0,this.lockListeners=[],this.renderer.addClass(this.elRef.nativeElement,"as-split-area")}set order(e){this._order=ii(e,null),this.split.updateArea(this,!0,!1)}get order(){return this._order}set size(e){this._size=ii(e,null),this.split.updateArea(this,!1,!0)}get size(){return this._size}set minSize(e){this._minSize=ii(e,null),this.split.updateArea(this,!1,!0)}get minSize(){return this._minSize}set maxSize(e){this._maxSize=ii(e,null),this.split.updateArea(this,!1,!0)}get maxSize(){return this._maxSize}set lockSize(e){this._lockSize=ti(e),this.split.updateArea(this,!1,!0)}get lockSize(){return this._lockSize}set visible(e){this._visible=ti(e),this._visible?(this.split.showArea(this),this.renderer.removeClass(this.elRef.nativeElement,"as-hidden")):(this.split.hideArea(this),this.renderer.addClass(this.elRef.nativeElement,"as-hidden"))}get visible(){return this._visible}ngOnInit(){this.split.addArea(this),this.ngZone.runOutsideAngular(()=>{this.transitionListener=this.renderer.listen(this.elRef.nativeElement,"transitionend",e=>{"flex-basis"===e.propertyName&&this.split.notify("transitionEnd",-1)})})}setStyleOrder(e){this.renderer.setStyle(this.elRef.nativeElement,"order",e)}setStyleFlex(e,t,i,r,o){this.renderer.setStyle(this.elRef.nativeElement,"flex-grow",e),this.renderer.setStyle(this.elRef.nativeElement,"flex-shrink",t),this.renderer.setStyle(this.elRef.nativeElement,"flex-basis",i),!0===r?this.renderer.addClass(this.elRef.nativeElement,"as-min"):this.renderer.removeClass(this.elRef.nativeElement,"as-min"),!0===o?this.renderer.addClass(this.elRef.nativeElement,"as-max"):this.renderer.removeClass(this.elRef.nativeElement,"as-max")}lockEvents(){this.ngZone.runOutsideAngular(()=>{this.lockListeners.push(this.renderer.listen(this.elRef.nativeElement,"selectstart",e=>!1)),this.lockListeners.push(this.renderer.listen(this.elRef.nativeElement,"dragstart",e=>!1))})}unlockEvents(){for(;this.lockListeners.length>0;){const e=this.lockListeners.pop();e&&e()}}ngOnDestroy(){this.unlockEvents(),this.transitionListener&&this.transitionListener(),this.split.removeArea(this)}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.B),n.Pb(n.m),n.Pb(n.G),n.Pb(li))},e.\u0275dir=n.Kb({type:e,selectors:[["as-split-area"],["","as-split-area",""]],inputs:{order:"order",size:"size",minSize:"minSize",maxSize:"maxSize",lockSize:"lockSize",visible:"visible"},exportAs:["asSplitArea"]}),e})(),hi=(()=>{class e{static forRoot(){return{ngModule:e,providers:[]}}static forChild(){return{ngModule:e,providers:[]}}}return e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({factory:function(t){return new(t||e)},imports:[[r.c]]}),e})();var di=i("6vhs"),ui=i("9DO8");let fi=(()=>{class e{constructor(e){this.store=e}setAvailableFieldsFromJsonFile(e){return Object(s.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new di.b(e)).toPromise(),this.store.selectSnapshot(ui.a.getAvailableFieldsError)}))}setAvailableFieldsFromExcelFile(e){return Object(s.a)(this,void 0,void 0,(function*(){return yield this.store.dispatch(new di.a(e)).toPromise(),this.store.selectSnapshot(ui.a.getAvailableFieldsError)}))}}return e.\u0275fac=function(t){return new(t||e)(n.Zb(T.j))},e.\u0275prov=n.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),Object(s.b)([Object(T.f)(ui.a.getAvailableFields)],e.prototype,"availableFields$",void 0),e})();const pi=["availableFileInput"];function gi(e,t){if(1&e){const e=n.Wb();n.Vb(0,"button",6),n.cc("click",(function(){n.wc(e);const t=n.gc().ngIf;return n.gc().scoreLoadedFile(t)})),n.Gc(1," Score "),n.Ub()}}function mi(e,t){if(1&e&&(n.Tb(0),n.Ec(1,gi,2,0,"button",5),n.Sb()),2&e){const e=t.ngIf;n.Db(1),n.mc("ngIf",0==(null==e.parentIds?null:e.parentIds.length)&&"profile"==e.itemType)}}let bi=(()=>{class e{constructor(e,t,i,r){this.availableFieldsStateService=e,this.scoreStateService=t,this.dhDialogService=i,this.profileStateService=r,this.fileTypeToRead="none"}loadAvailableFieldsFromJson(){this.fileTypeToRead="json",this.showFileSelection()}loadAvailableFieldsFromExcel(){this.fileTypeToRead="excel",this.showFileSelection()}loadScoreFile(){this.fileTypeToRead="score",this.showFileSelection()}showFileSelection(){this.availableFileInput.nativeElement.value="",this.availableFileInput.nativeElement.click()}fileLoaded(e){return Object(s.a)(this,void 0,void 0,(function*(){const t=e.target.files[0];this.dhDialogService.showLoading(),(yield this.loadAvailableFieldsFromServer(t))&&this.dhDialogService.showErrorMessage("Could not load available fields from server"),this.dhDialogService.hideLoading()}))}loadAvailableFieldsFromServer(e){return Object(s.a)(this,void 0,void 0,(function*(){switch(this.fileTypeToRead){case"json":return yield this.loadAvailableFieldsForJsonFromServer(e);case"excel":return yield this.loadAvailableFieldsForExcelFromServer(e);case"score":return yield this.scoreFile(e)}}))}loadAvailableFieldsForJsonFromServer(e){return Object(s.a)(this,void 0,void 0,(function*(){return yield this.availableFieldsStateService.setAvailableFieldsFromJsonFile(e)}))}loadAvailableFieldsForExcelFromServer(e){return Object(s.a)(this,void 0,void 0,(function*(){return yield this.availableFieldsStateService.setAvailableFieldsFromExcelFile(e)}))}scoreLoadedFile(e){this.selectedProfile=e,this.loadScoreFile()}scoreFile(e){return Object(s.a)(this,void 0,void 0,(function*(){const t=yield this.scoreStateService.scoreExcelFile({profileId:this.selectedProfile.id,file:[e]});null!=t&&this.dhDialogService.showErrorMessage("Could not score excel file: "+t)}))}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(fi),n.Pb($t.a),n.Pb(k.a),n.Pb(h.a))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-load-available-button"]],viewQuery:function(e,t){if(1&e&&n.Jc(pi,!0),2&e){let e;n.tc(e=n.dc())&&(t.availableFileInput=e.first)}},decls:9,vars:3,consts:[["mat-raised-button","","color","primary","matTooltip","Load Schema File",1,"mr-4","mb-2",3,"click"],["mat-raised-button","","color","primary","matTooltip","Load Excel Schema File",1,"mr-4","mb-2",3,"click"],[4,"ngIf"],["type","file","name","inputfile","id","inputfile",2,"display","none",3,"change"],["availableFileInput",""],["mat-raised-button","","color","primary","matTooltip","Score selected profile",3,"click",4,"ngIf"],["mat-raised-button","","color","primary","matTooltip","Score selected profile",3,"click"]],template:function(e,t){1&e&&(n.Vb(0,"div"),n.Vb(1,"button",0),n.cc("click",(function(){return t.loadAvailableFieldsFromJson()})),n.Gc(2," Load Json "),n.Ub(),n.Vb(3,"button",1),n.cc("click",(function(){return t.loadAvailableFieldsFromExcel()})),n.Gc(4," Load Excel "),n.Ub(),n.Ec(5,mi,2,1,"ng-container",2),n.hc(6,"async"),n.Vb(7,"input",3,4),n.cc("change",(function(e){return t.fileLoaded(e)})),n.Ub(),n.Ub()),2&e&&(n.Db(5),n.mc("ngIf",n.ic(6,1,t.profileStateService.selectedProfile$)))},directives:[v.b,r.m],pipes:[r.b],styles:[""],changeDetection:0}),e})();function vi(e,t){if(1&e&&(n.Tb(0),n.Qb(1,"tree-root",1),n.Sb()),2&e){const e=t.ngIf,i=n.gc();n.Db(1),n.mc("nodes",e)("options",i.options)}}let yi=(()=>{class e{constructor(e){this.availableFieldsStateService=e,this.options={allowDrag:!0}}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(fi))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-available-tree"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"nodes","options"]],template:function(e,t){1&e&&(n.Ec(0,vi,2,2,"ng-container",0),n.hc(1,"async")),2&e&&n.mc("ngIf",n.ic(1,1,t.availableFieldsStateService.availableFields$))},directives:[r.m,Rt.a],pipes:[r.b],styles:[""]}),e})();var wi=i("Y2X+");let Si=(()=>{class e{constructor(e,t,i){this.dhDialogService=e,this.authStateService=t,this.profileStateService=i}ngOnInit(){}refresh(){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=yield this.profileStateService.getProfiles();this.dhDialogService.hideLoading(),"error"==e&&this.dhDialogService.showMessage("error loading profile")}))}addRootProfile(){return Object(s.a)(this,void 0,void 0,(function*(){const e=yield this.dhDialogService.openDialog(V,300,{title:"Enter new Root Profile data",label:"Profile Name",inputValue:""}).toPromise();if(null==e)return;this.dhDialogService.showLoading();const t=yield this.profileStateService.addRootProfile(e);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(null==t?"Root Profile Added.":"Error adding Root Profile.")}))}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(k.a),n.Pb(E.a),n.Pb(h.a))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile-buttons"]],decls:6,vars:0,consts:[["mat-icon-button","","matTooltip","Refresh data from server",3,"click"],["mat-icon-button","","matTooltip","Create root profile",3,"click"]],template:function(e,t){1&e&&(n.Vb(0,"button",0),n.cc("click",(function(){return t.refresh()})),n.Vb(1,"mat-icon"),n.Gc(2,"refresh"),n.Ub(),n.Ub(),n.Vb(3,"button",1),n.cc("click",(function(){return t.addRootProfile()})),n.Vb(4,"mat-icon"),n.Gc(5,"add"),n.Ub(),n.Ub())},directives:[v.b,wi.a,y.a],styles:[""]}),e})();function xi(e,t){if(1&e){const e=n.Wb();n.Vb(0,"button",5),n.cc("click",(function(){return n.wc(e),n.gc().addProfileItem()})),n.Vb(1,"mat-icon"),n.Gc(2,"post_add"),n.Ub(),n.Ub()}}function Ii(e,t){if(1&e){const e=n.Wb();n.Vb(0,"button",6),n.cc("click",(function(){return n.wc(e),n.gc().addSubProfile()})),n.Vb(1,"mat-icon"),n.Gc(2,"create_new_folder"),n.Ub(),n.Ub()}}let Pi=(()=>{class e{constructor(e,t,i,r){this.dhDialogService=e,this.selectionActionStateService=t,this.profileStateService=i,this.weightStateService=r}ngOnInit(){}saveEdit(){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const e=this.selectionActionStateService.getForms(),t=this.profileStateService.getSelectedProfile(),i=e.profileNameForm.model.name;"profile"==t.itemType?(i!=t.name&&null!=(yield this.profileStateService.updateName(t.id,i))&&this.dhDialogService.showMessage("Failed updating profile name"),yield this.updateProfile(e.subProfileWeightForm,t)):"virtual"==t.itemType?yield this.updateVirtualProfile(t,i):yield this.updateProfileItem(e.profileItemForm,t,i),this.dhDialogService.hideLoading()}))}updateVirtualProfile(e,t){return Object(s.a)(this,void 0,void 0,(function*(){null!=(yield this.profileStateService.updateVirtualProfile({profileId:e.originalParentId,virtualProfileNameUpdateDto:{newName:t,prefix:e.originalName}}))&&this.dhDialogService.showMessage("Failed updating profile item path")}))}updateProfileItem(e,t,i){return Object(s.a)(this,void 0,void 0,(function*(){const r=e.model,o=this.getNewName(t.originalName,i);null!=(yield this.profileStateService.updateProfileItem({profileId:t.originalParentId,profileItemUpdateDto:{itemType:r.itemType,name:t.originalName,values:r.valueScores,newName:o}},t.id,i))&&this.dhDialogService.showMessage("Failed updating profile item")}))}getNewName(e,t){const i=e.lastIndexOf(".");return-1==i?t:e.substring(0,i+1)+t}updateProfile(e,t){return Object(s.a)(this,void 0,void 0,(function*(){const i=yield this.getWeightChanges(e,t);null!=i&&(yield this.weightStateService.updateSubElementsWeights({newWeights:i,profileId:t.id}))&&this.dhDialogService.showMessage("Failed updating sub elements weights")}))}getWeightChanges(e,t){return Object(s.a)(this,void 0,void 0,(function*(){if(null==e.model.subProfiles)return null;const i=e.model.subProfiles.reduce((e,t)=>(e[t.id]=t.weight,e),{}),r=new f,o=this.weightStateService.getProfileWeights(t.id);var s=new u,n=yield this.profileStateService.profileMap$.pipe(Object(d.a)()).toPromise();const a=s.transform(t,n);return null==a?null:a.reduce((e,s)=>{const n=r.transform(s,t.id),a=i[s];return a!=o[n]&&e.push({newWeight:a,id:s}),e},[])}))}addProfileItem(){return Object(s.a)(this,void 0,void 0,(function*(){const e=yield this.dhDialogService.openDialog(A,700,null).toPromise();if(null==e)return;this.dhDialogService.showLoading();const t=yield this.profileStateService.addProfileItem({profileId:null,profileItemCreateDto:{name:e.name,itemType:e.itemType,values:e.valueScores}},e.weight);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(null==t?"Profile Item Added.":"Error adding Profile Item.")}))}deleteProfileOrProfileItem(){const e=this.profileStateService.getSelectedProfile();"profile"==e.itemType?this.deleteProfile(e.id):"virtual"==e.itemType?this.deleteVirtualProfileItem(e):this.deleteProfileItem(e)}deleteProfile(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Confirm Delete",message:"Are you sure you want to delete this profile?"}).toPromise()))return;this.dhDialogService.showLoading();const t=yield this.profileStateService.deleteProfile(e);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error deleting profile.":"Profile Deleted.")}))}deleteProfileItem(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Confirm Delete",message:"Are you sure you want to delete this Profile Item?"}).toPromise()))return;this.dhDialogService.showLoading();const t=yield this.profileStateService.deleteProfileItem(e.originalParentId,e.originalName,e.originalId);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error deleting profile.":"Profile Deleted.")}))}deleteVirtualProfileItem(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Confirm Delete",message:"Are you sure you want to delete this Virtual Profile Item? All sub items will be deleted too."}).toPromise()))return;this.dhDialogService.showLoading();const t=yield this.profileStateService.deleteVirtualProfileItem(e.originalParentId,e.originalName,e.id);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error deleting virtual profile.":"Virtual Profile Deleted.")}))}addSubProfile(){return Object(s.a)(this,void 0,void 0,(function*(){const e=yield this.dhDialogService.openDialog(V,400,{title:"Enter new Sub Profile Name",label:"Profile Name",inputValue:""}).toPromise();if(null==e)return;this.dhDialogService.showLoading();const t=yield this.profileStateService.addSubProfile(null,e);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(null==t?"Sub Profile Added.":"Error adding Sub Profile.")}))}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(k.a),n.Pb(_),n.Pb(h.a),n.Pb(M))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile-details-buttons"]],inputs:{selectedProfile:"selectedProfile"},decls:8,vars:3,consts:[["mat-icon-button","","matTooltip","Add Profile Item",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Delete",3,"click"],["color","danger"],["mat-icon-button","","matTooltip","Add New Sub-Profile To Selected Profile",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Save edit",3,"disabled","click"],["mat-icon-button","","matTooltip","Add Profile Item",3,"click"],["mat-icon-button","","matTooltip","Add New Sub-Profile To Selected Profile",3,"click"]],template:function(e,t){1&e&&(n.Ec(0,xi,3,0,"button",0),n.Vb(1,"button",1),n.cc("click",(function(){return t.deleteProfileOrProfileItem()})),n.Vb(2,"mat-icon",2),n.Gc(3,"delete"),n.Ub(),n.Ub(),n.Ec(4,Ii,3,0,"button",3),n.Vb(5,"button",4),n.cc("click",(function(){return t.saveEdit()})),n.Vb(6,"mat-icon"),n.Gc(7,"save"),n.Ub(),n.Ub()),2&e&&(n.mc("ngIf","profile"==(null==t.selectedProfile?null:t.selectedProfile.itemType)),n.Db(4),n.mc("ngIf","profile"==(null==t.selectedProfile?null:t.selectedProfile.itemType)),n.Db(1),n.mc("disabled",null==t.selectedProfile))},directives:[r.m,v.b,wi.a,y.a],styles:[""]}),e})();var Ci=i("5XID"),ki=i("cqs0"),Ai=i("sg/T");const Vi=["button"],Ei=["*"],Ti=new n.s("MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS"),Di=new n.s("MatButtonToggleGroup"),_i={provide:p.h,useExisting:Object(n.V)(()=>Mi),multi:!0};let zi=0;class Oi{constructor(e,t){this.source=e,this.value=t}}let Mi=(()=>{class e{constructor(e,t){this._changeDetector=e,this._vertical=!1,this._multiple=!1,this._disabled=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{},this._name="mat-button-toggle-group-"+zi++,this.valueChange=new n.p,this.change=new n.p,this.appearance=t&&t.appearance?t.appearance:"standard"}get name(){return this._name}set name(e){this._name=e,this._buttonToggles&&this._buttonToggles.forEach(e=>{e.name=this._name,e._markForCheck()})}get vertical(){return this._vertical}set vertical(e){this._vertical=Object(Ci.c)(e)}get value(){const e=this._selectionModel?this._selectionModel.selected:[];return this.multiple?e.map(e=>e.value):e[0]?e[0].value:void 0}set value(e){this._setSelectionByValue(e),this.valueChange.emit(this.value)}get selected(){const e=this._selectionModel?this._selectionModel.selected:[];return this.multiple?e:e[0]||null}get multiple(){return this._multiple}set multiple(e){this._multiple=Object(Ci.c)(e)}get disabled(){return this._disabled}set disabled(e){this._disabled=Object(Ci.c)(e),this._buttonToggles&&this._buttonToggles.forEach(e=>e._markForCheck())}ngOnInit(){this._selectionModel=new ki.c(this.multiple,void 0,!1)}ngAfterContentInit(){this._selectionModel.select(...this._buttonToggles.filter(e=>e.checked))}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_emitChangeEvent(){const e=this.selected,t=Array.isArray(e)?e[e.length-1]:e,i=new Oi(t,this.value);this._controlValueAccessorChangeFn(i.value),this.change.emit(i)}_syncButtonToggle(e,t,i=!1,r=!1){this.multiple||!this.selected||e.checked||(this.selected.checked=!1),this._selectionModel?t?this._selectionModel.select(e):this._selectionModel.deselect(e):r=!0,r?Promise.resolve().then(()=>this._updateModelValue(i)):this._updateModelValue(i)}_isSelected(e){return this._selectionModel&&this._selectionModel.isSelected(e)}_isPrechecked(e){return void 0!==this._rawValue&&(this.multiple&&Array.isArray(this._rawValue)?this._rawValue.some(t=>null!=e.value&&t===e.value):e.value===this._rawValue)}_setSelectionByValue(e){this._rawValue=e,this._buttonToggles&&(this.multiple&&e?(Array.isArray(e),this._clearSelection(),e.forEach(e=>this._selectValue(e))):(this._clearSelection(),this._selectValue(e)))}_clearSelection(){this._selectionModel.clear(),this._buttonToggles.forEach(e=>e.checked=!1)}_selectValue(e){const t=this._buttonToggles.find(t=>null!=t.value&&t.value===e);t&&(t.checked=!0,this._selectionModel.select(t))}_updateModelValue(e){e&&this._emitChangeEvent(),this.valueChange.emit(this.value)}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(n.i),n.Pb(Ti,8))},e.\u0275dir=n.Kb({type:e,selectors:[["mat-button-toggle-group"]],contentQueries:function(e,t,i){if(1&e&&n.Ib(i,Fi,!0),2&e){let e;n.tc(e=n.dc())&&(t._buttonToggles=e)}},hostAttrs:["role","group",1,"mat-button-toggle-group"],hostVars:5,hostBindings:function(e,t){2&e&&(n.Eb("aria-disabled",t.disabled),n.Hb("mat-button-toggle-vertical",t.vertical)("mat-button-toggle-group-appearance-standard","standard"===t.appearance))},inputs:{appearance:"appearance",name:"name",vertical:"vertical",value:"value",multiple:"multiple",disabled:"disabled"},outputs:{valueChange:"valueChange",change:"change"},exportAs:["matButtonToggleGroup"],features:[n.Cb([_i,{provide:Di,useExisting:e}])]}),e})();class Bi{}const Ri=Object(w.p)(Bi);let Fi=(()=>{class e extends Ri{constructor(e,t,i,r,o,s){super(),this._changeDetectorRef=t,this._elementRef=i,this._focusMonitor=r,this._isSingleSelector=!1,this._checked=!1,this.ariaLabelledby=null,this._disabled=!1,this.change=new n.p;const a=Number(o);this.tabIndex=a||0===a?a:null,this.buttonToggleGroup=e,this.appearance=s&&s.appearance?s.appearance:"standard"}get buttonId(){return this.id+"-button"}get appearance(){return this.buttonToggleGroup?this.buttonToggleGroup.appearance:this._appearance}set appearance(e){this._appearance=e}get checked(){return this.buttonToggleGroup?this.buttonToggleGroup._isSelected(this):this._checked}set checked(e){const t=Object(Ci.c)(e);t!==this._checked&&(this._checked=t,this.buttonToggleGroup&&this.buttonToggleGroup._syncButtonToggle(this,this._checked),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled||this.buttonToggleGroup&&this.buttonToggleGroup.disabled}set disabled(e){this._disabled=Object(Ci.c)(e)}ngOnInit(){const e=this.buttonToggleGroup;this._isSingleSelector=e&&!e.multiple,this.id=this.id||"mat-button-toggle-"+zi++,this._isSingleSelector&&(this.name=e.name),e&&(e._isPrechecked(this)?this.checked=!0:e._isSelected(this)!==this._checked&&e._syncButtonToggle(this,this._checked))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){const e=this.buttonToggleGroup;this._focusMonitor.stopMonitoring(this._elementRef),e&&e._isSelected(this)&&e._syncButtonToggle(this,!1,!1,!0)}focus(e){this._buttonElement.nativeElement.focus(e)}_onButtonClick(){const e=!!this._isSingleSelector||!this._checked;e!==this._checked&&(this._checked=e,this.buttonToggleGroup&&(this.buttonToggleGroup._syncButtonToggle(this,this._checked,!0),this.buttonToggleGroup._onTouched())),this.change.emit(new Oi(this,this.value))}_markForCheck(){this._changeDetectorRef.markForCheck()}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(Di,8),n.Pb(n.i),n.Pb(n.m),n.Pb(Ai.e),n.ac("tabindex"),n.Pb(Ti,8))},e.\u0275cmp=n.Jb({type:e,selectors:[["mat-button-toggle"]],viewQuery:function(e,t){if(1&e&&n.Jc(Vi,!0),2&e){let e;n.tc(e=n.dc())&&(t._buttonElement=e.first)}},hostAttrs:["role","presentation",1,"mat-button-toggle"],hostVars:12,hostBindings:function(e,t){1&e&&n.cc("focus",(function(){return t.focus()})),2&e&&(n.Eb("aria-label",null)("aria-labelledby",null)("id",t.id)("name",null),n.Hb("mat-button-toggle-standalone",!t.buttonToggleGroup)("mat-button-toggle-checked",t.checked)("mat-button-toggle-disabled",t.disabled)("mat-button-toggle-appearance-standard","standard"===t.appearance))},inputs:{disableRipple:"disableRipple",ariaLabelledby:["aria-labelledby","ariaLabelledby"],tabIndex:"tabIndex",appearance:"appearance",checked:"checked",disabled:"disabled",id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],value:"value"},outputs:{change:"change"},exportAs:["matButtonToggle"],features:[n.Ab],ngContentSelectors:Ei,decls:6,vars:9,consts:[["type","button",1,"mat-button-toggle-button","mat-focus-indicator",3,"id","disabled","click"],["button",""],[1,"mat-button-toggle-label-content"],[1,"mat-button-toggle-focus-overlay"],["matRipple","",1,"mat-button-toggle-ripple",3,"matRippleTrigger","matRippleDisabled"]],template:function(e,t){if(1&e&&(n.lc(),n.Vb(0,"button",0,1),n.cc("click",(function(){return t._onButtonClick()})),n.Vb(2,"span",2),n.kc(3),n.Ub(),n.Ub(),n.Qb(4,"span",3),n.Qb(5,"span",4)),2&e){const e=n.uc(1);n.mc("id",t.buttonId)("disabled",t.disabled||null),n.Eb("tabindex",t.disabled?-1:t.tabIndex)("aria-pressed",t.checked)("name",t.name||null)("aria-label",t.ariaLabel)("aria-labelledby",t.ariaLabelledby),n.Db(5),n.mc("matRippleTrigger",e)("matRippleDisabled",t.disableRipple||t.disabled)}},directives:[w.k],styles:[".mat-button-toggle-standalone,.mat-button-toggle-group{position:relative;display:inline-flex;flex-direction:row;white-space:nowrap;overflow:hidden;border-radius:2px;-webkit-tap-highlight-color:transparent}.cdk-high-contrast-active .mat-button-toggle-standalone,.cdk-high-contrast-active .mat-button-toggle-group{outline:solid 1px}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.mat-button-toggle-group-appearance-standard{border-radius:4px}.cdk-high-contrast-active .mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.cdk-high-contrast-active .mat-button-toggle-group-appearance-standard{outline:0}.mat-button-toggle-vertical{flex-direction:column}.mat-button-toggle-vertical .mat-button-toggle-label-content{display:block}.mat-button-toggle{white-space:nowrap;position:relative}.mat-button-toggle .mat-icon svg{vertical-align:top}.mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:1}.cdk-high-contrast-active .mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:.5}.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.04}.mat-button-toggle-appearance-standard.cdk-keyboard-focused:not(.mat-button-toggle-disabled) .mat-button-toggle-focus-overlay{opacity:.12}.cdk-high-contrast-active .mat-button-toggle-appearance-standard.cdk-keyboard-focused:not(.mat-button-toggle-disabled) .mat-button-toggle-focus-overlay{opacity:.5}@media(hover: none){.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{display:none}}.mat-button-toggle-label-content{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:inline-block;line-height:36px;padding:0 16px;position:relative}.mat-button-toggle-appearance-standard .mat-button-toggle-label-content{padding:0 12px}.mat-button-toggle-label-content>*{vertical-align:middle}.mat-button-toggle-focus-overlay{border-radius:inherit;pointer-events:none;opacity:0;top:0;left:0;right:0;bottom:0;position:absolute}.mat-button-toggle-checked .mat-button-toggle-focus-overlay{border-bottom:solid 36px}.cdk-high-contrast-active .mat-button-toggle-checked .mat-button-toggle-focus-overlay{opacity:.5;height:0}.cdk-high-contrast-active .mat-button-toggle-checked.mat-button-toggle-appearance-standard .mat-button-toggle-focus-overlay{border-bottom:solid 500px}.mat-button-toggle .mat-button-toggle-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-button-toggle-button{border:0;background:none;color:inherit;padding:0;margin:0;font:inherit;outline:none;width:100%;cursor:pointer}.mat-button-toggle-disabled .mat-button-toggle-button{cursor:default}.mat-button-toggle-button::-moz-focus-inner{border:0}\n"],encapsulation:2,changeDetection:0}),e})(),ji=(()=>{class e{}return e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({factory:function(t){return new(t||e)},imports:[[w.f,w.l],w.f]}),e})();var Ni=i("dYjB");function Ui(e,t){if(1&e){const e=n.Wb();n.Vb(0,"mat-button-toggle-group",20,21),n.cc("change",(function(){n.wc(e);const t=n.uc(1);return n.gc(4).onRightSideDisplayTypeChange(t.value)})),n.Vb(2,"mat-button-toggle",22),n.Vb(3,"mat-icon"),n.Gc(4,"insights"),n.Ub(),n.Ub(),n.Vb(5,"mat-button-toggle",23),n.Vb(6,"mat-icon"),n.Gc(7,"dehaze"),n.Ub(),n.Ub(),n.Ub()}if(2&e){const e=n.gc(4);n.mc("value",e.rightSideViewType)}}function Li(e,t){if(1&e&&(n.Vb(0,"div",24),n.Qb(1,"dh-seed-score-breakdown-graph",25),n.Ub()),2&e){const e=n.gc().ngIf,t=n.gc().ngIf,i=n.gc().ngIf;n.Db(1),n.mc("scoreResponse",e[null==i.selectedProfile?null:i.selectedProfile.id])("weights",t.weights)("profileMap",i.profileMap)("profileId",null==i.selectedProfile?null:i.selectedProfile.id)}}function Gi(e,t){if(1&e&&n.Qb(0,"dh-profile-details",26),2&e){const e=n.gc(3).ngIf;n.mc("profile",e.selectedProfile)}}function Wi(e,t){if(1&e){const e=n.Wb();n.Tb(0),n.Vb(1,"as-split",1),n.Vb(2,"as-split-area",2),n.Vb(3,"div",3),n.Vb(4,"div",4),n.Vb(5,"span",5),n.Gc(6,"Available Fields"),n.Ub(),n.Qb(7,"dh-load-available-button"),n.Ub(),n.Vb(8,"div",6),n.Qb(9,"dh-available-tree",7),n.Ub(),n.Ub(),n.Ub(),n.Vb(10,"as-split-area",8),n.Vb(11,"div",3),n.Vb(12,"div",9),n.Vb(13,"span",10),n.Gc(14,"Profile hierarchy"),n.Ub(),n.Qb(15,"dh-profile-buttons"),n.Ub(),n.Vb(16,"div",11),n.Vb(17,"dh-hierarchy",12),n.cc("profileSelected",(function(t){n.wc(e);const i=n.gc(2).ngIf;return n.gc().selectProfile(t,i.selectedProfile)}))("itemWeightChanged",(function(t){return n.wc(e),n.gc(3).itemWeightValueChanged(t)}))("childProfileWeightChanged",(function(t){return n.wc(e),n.gc(3).childProfileWeightValueChanged(t)}))("disconnectLinkClicked",(function(t){return n.wc(e),n.gc(3).disconnectLinkClicked(t)}))("addSubProfileToProfile",(function(t){return n.wc(e),n.gc(3).addSubProfileToProfile(t)}))("addProfileItemToProfile",(function(t){return n.wc(e),n.gc(3).addProfileItemToProfile(t)}))("addVirtualProfileItemToProfile",(function(t){return n.wc(e),n.gc(3).addVirtualProfileItemToProfile(t)}))("treeItemDropped",(function(t){return n.wc(e),n.gc(3).treeItemDropped(t)})),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(18,"as-split-area",13),n.Vb(19,"div",3),n.Vb(20,"div",14),n.Vb(21,"span",5),n.Gc(22),n.Ub(),n.Qb(23,"dh-profile-details-buttons",15),n.Ub(),n.Vb(24,"div",16),n.Ec(25,Ui,8,1,"mat-button-toggle-group",17),n.hc(26,"keyvalue"),n.Ec(27,Li,2,4,"div",18),n.Ec(28,Gi,1,1,"dh-profile-details",19),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Sb()}if(2&e){const e=t.ngIf,i=n.gc().ngIf,r=n.gc().ngIf,o=n.gc();n.Db(1),n.mc("restrictMove",!0),n.Db(16),n.mc("data",r.profiles)("profileMap",r.profileMap)("weights",i.weights)("selectedProfile",r.selectedProfile)("scores",e),n.Db(5),n.Ic("",null==r.selectedProfile?null:r.selectedProfile.name," Details"),n.Db(1),n.mc("selectedProfile",r.selectedProfile),n.Db(2),n.mc("ngIf",n.ic(26,11,e).length>0),n.Db(2),n.mc("ngIf","breakdown"==o.rightSideViewType),n.Db(1),n.mc("ngIf","details"==o.rightSideViewType&&r.selectedProfile)}}function $i(e,t){if(1&e&&(n.Tb(0),n.Ec(1,Wi,29,13,"ng-container",0),n.hc(2,"async"),n.Sb()),2&e){const e=n.gc(2);n.Db(1),n.mc("ngIf",n.ic(2,1,e.scoreStateService.scores$))}}function qi(e,t){if(1&e&&(n.Tb(0),n.Ec(1,$i,3,3,"ng-container",0),n.hc(2,"async"),n.Sb()),2&e){const e=n.gc();n.Db(1),n.mc("ngIf",n.ic(2,1,e.profileVsService.weightState$))}}const Hi=[{path:"",component:(()=>{class e{constructor(e,t,i,r,o,s,n,a,c,h,d){this.profileVsService=e,this.weightStateService=t,this.dhDialogService=i,this.breakpointObserver=r,this.profileStateService=o,this.selectionActionStateService=s,this.dialog=n,this.scoreStateService=a,this.routerAdapterService=c,this.apiKeyStateService=h,this.activatedRoute=d,this.fairlyBigScreen=!0,this.rightSideViewType="details",this.unsubscribe$=new l.a,this.breakpointObserver.observe("(max-width: 1200px)").subscribe(e=>{this.fairlyBigScreen=0==e.matches})}ngOnInit(){return Object(s.a)(this,void 0,void 0,(function*(){yield this.loadProfile(),this.scoreStateService.profileScored$.pipe(Object(a.a)(this.unsubscribe$)).subscribe(()=>{this.rightSideViewType="breakdown"})}))}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}loadProfile(){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading(),this.profileStateService.clearSelection(),this.apiKeyStateService.setAuth(this.activatedRoute.snapshot.params[Lt.a.profileId]),this.scoreStateService.clearScores();const e=yield this.profileStateService.getProfiles();this.dhDialogService.hideLoading(),"error"==e&&this.dhDialogService.showMessage("error loading profile")}))}onRightSideDisplayTypeChange(e){this.rightSideViewType=e}selectProfile(e,t){return Object(s.a)(this,void 0,void 0,(function*(){e.selectedNodeId!=(null==t?void 0:t.id)&&(yield this.selectionActionStateService.clearForms(),this.scoreStateService.clearScores(),this.rightSideViewType="details",yield this.profileVsService.selectProfile(e.selectedNodeId),Object(n.mb)(this))}))}showProfileDetailsModal(){this.dialog.open(ve,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",panelClass:"selected-dialog",data:{name:"test"}})}itemWeightValueChanged(e){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const t=yield this.weightStateService.updateItemLinkWeight(e);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error updating item weight":"Item weight updated")}))}childProfileWeightValueChanged(e){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const t=yield this.profileVsService.updateChildProfileLinkWeight(e);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error updating child profile weight":"Child profile weight updated")}))}disconnectLinkClicked(e){return Object(s.a)(this,void 0,void 0,(function*(){if(!(yield this.dhDialogService.showConfirmation({title:"Disconnect Sub Profile",message:"Are you sure you want to disconnect these profiles?"}).toPromise()))return;this.dhDialogService.showLoading();const t=yield this.profileVsService.disconectSubProfile(e);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error disconnecting sub profile":"Sub Profile Disconnected")}))}addSubProfileToProfile(e){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const t=yield this.profileStateService.conectSubProfile(e.parentProfileId,e.subProfileId);this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error connecting sub profile":"Sub Profile Connected")}))}addProfileItemToProfile(e){return Object(s.a)(this,void 0,void 0,(function*(){this.dhDialogService.showLoading();const t=yield this.profileStateService.addMultipleItems({profileId:e.profileId,multipleProfileItemCreateDto:[{name:e.profileItemName}]});this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(t?"Error adding profile item to profile":"profile item added to profile")}))}addVirtualProfileItemToProfile(e){return Object(s.a)(this,void 0,void 0,(function*(){if(null==e.virtualProfileItem||null==e.profileId)return;this.dhDialogService.showLoading();const t=yield this.getProfileItemsNamesUnderVirtualProfileId(e.virtualProfileItem);if(null==t||t.length<1)return;const i=yield this.profileStateService.addMultipleItems({profileId:e.profileId,multipleProfileItemCreateDto:t});this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(i?"Error adding profile item to profile":"profile item added to profile")}))}getProfileItemsNamesUnderVirtualProfileId(e){return Object(s.a)(this,void 0,void 0,(function*(){const t=new u,i=yield this.profileStateService.profileMap$.pipe(Object(d.a)()).toPromise();return t.transform(e,i).map(e=>({name:i[e].originalName}))}))}treeItemDropped(e){return Object(s.a)(this,void 0,void 0,(function*(){const t=[];for(const r of e.droppedData)this.getMultipleItemsRequestFromData(r,t);if(0==t.length)return void this.dhDialogService.showErrorMessage("No items added.");this.dhDialogService.showLoading();const i=yield this.profileStateService.addMultipleItems({profileId:e.dropTargetId,multipleProfileItemCreateDto:t});this.dhDialogService.hideLoading(),this.dhDialogService.showMessage(i?"Error adding multiple items.":"Multiple items added.")}))}getMultipleItemsRequestFromData(e,t){if(null!=e&&null!=t)if(e.isEdge)t.push({name:e.fullPath});else if(null!=(null==e?void 0:e.children))for(const i of null==e?void 0:e.children)this.getMultipleItemsRequestFromData(i,t)}}return e.\u0275fac=function(t){return new(t||e)(n.Pb(Gt.a),n.Pb(M),n.Pb(k.a),n.Pb(Wt.a),n.Pb(h.a),n.Pb(_),n.Pb(c.b),n.Pb($t.a),n.Pb(qt.a),n.Pb(Ht.a),n.Pb(o.a))},e.\u0275cmp=n.Jb({type:e,selectors:[["dh-profile"]],viewQuery:function(e,t){if(1&e&&n.Jc(Ut,!0),2&e){let e;n.tc(e=n.dc())&&(t.hierarchyComponent=e.first)}},decls:2,vars:3,consts:[[4,"ngIf"],["unit","percent","gutterSize","10",3,"restrictMove"],["size","25","minSize","5","maxSize","40"],[1,"h-full","p-4"],[1,"flex","justify-between"],[1,"text-2xl","leading-8"],[1,"p-4","overflow-y-auto",2,"height","calc( 100% - 50px)"],[1,"block","h-auto"],["size","50","minSize","10","maxSize","90"],[1,"flex",2,"height","30px"],[1,"text-2xl","leading-8","flex-1"],[1,"p-4",2,"height","calc( 100% - 30px)"],[1,"block","flex-1","overflow-hidden","h-full",3,"data","profileMap","weights","selectedProfile","scores","profileSelected","itemWeightChanged","childProfileWeightChanged","disconnectLinkClicked","addSubProfileToProfile","addProfileItemToProfile","addVirtualProfileItemToProfile","treeItemDropped"],["size","25","minSize","5","maxSize","40","id","uuuu"],[1,"flex","justify-between",2,"height","30px"],[3,"selectedProfile"],[1,"p-4","overflow-y-auto",2,"height","calc( 100% - 30px)"],[3,"value","change",4,"ngIf"],["class","mt-20",4,"ngIf"],["class","block px-4 text-base",3,"profile",4,"ngIf"],[3,"value","change"],["group","matButtonToggleGroup"],["value","breakdown","aria-label","Score breakdown"],["value","details","aria-label","Profile details"],[1,"mt-20"],[2,"height","300px",3,"scoreResponse","weights","profileMap","profileId"],[1,"block","px-4","text-base",3,"profile"]],template:function(e,t){1&e&&(n.Ec(0,qi,3,3,"ng-container",0),n.hc(1,"async")),2&e&&n.mc("ngIf",n.ic(1,1,t.profileVsService.profileState$))},directives:[r.m,li,ci,bi,yi,Si,Ut,Pi,Mi,Fi,y.a,Ni.a,me],pipes:[r.b,r.g],styles:[".full-height-without-top-bar[_ngcontent-%COMP%]{height:calc(100vh - 76px)}"]}),e})()}];let Ji=(()=>{class e{}return e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({factory:function(t){return new(t||e)},imports:[[o.e.forChild(Hi)],o.e]}),e})();var Qi=i("W1gw");i("9bRT"),i("C05f"),i("ROBh"),i("J+dc"),i("xVbo"),i("E5oP");let Yi=(()=>{class e{}return e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({factory:function(t){return new(t||e)}}),e})();i("g6G6"),i("YtkY");let Xi=(()=>{class e{}return e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({factory:function(t){return new(t||e)},imports:[[Yi,w.f],w.f]}),e})();var Zi=i("evil"),Ki=i("Yclt"),er=i("lQ7A"),tr=i("aYrn");let ir=(()=>{class e{}return e.\u0275mod=n.Nb({type:e}),e.\u0275inj=n.Mb({factory:function(t){return new(t||e)},providers:[k.a],imports:[[g.a,r.c,Ji,p.g,p.o,$.b,v.c,m.d,S.b,Qi.b,Xi,y.b,c.f,Zi.a,b.b,Ki.a,Rt.c,er.d,W.c,hi,tr.a,ji,wi.b]]}),e})()}}]);